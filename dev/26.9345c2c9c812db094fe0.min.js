webpackJsonp([26],{1007:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(1122);var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return r.html=t(1124),r.name="magicloading",r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.modalBase),o(n,[{key:"complete",value:function(){this.initDate.title=this.initDate.title?this.initDate.title:"正在努力运算中，请耐心等待",this.dom.find(".p-name").html(this.initDate.title)}}]),n}();e.exports=i},1030:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(1115);var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return r.html=t(1117),r.name="progress",r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.modalBase),o(n,[{key:"makeprogress",value:function(e){var n=Number(e.rate).toFixed(2)+"%";this.dom.find(".blue").css({width:4*e.rate}),this.dom.find(".p-name").html(n)}},{key:"autoprogress",value:function(){var e=this;if(!this.timeSt){var n=5;this.timeSt=setInterval(function(){(n+=1)<95&&e.makeprogress({rate:n})},500)}}},{key:"stopAll",value:function(){var e=this;this.timeSt&&(clearInterval(this.timeSt),this.dom.find(".blue").css({width:400}),this.dom.find(".p-name").html("100%"),setTimeout(function(){e.close()},200))}}]),n}();e.exports=i},1043:function(module,exports,__webpack_require__){"use strict";var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}__webpack_require__(954);var ctcornerstone_base=function(_Interstellar$moduleB){function ctcornerstone_base(e,n,t,o){_classCallCheck(this,ctcornerstone_base);var i=_possibleConstructorReturn(this,(ctcornerstone_base.__proto__||Object.getPrototypeOf(ctcornerstone_base)).call(this,e,n,t,o));i.sceen=0,i.choosescreen=0,i.cornerstoneArray=[],i.nowWWC=[],i.html=__webpack_require__(1045),i.makeStudy=!0,i.nidusSigle=!1,i.cornerstoneTools_config=__webpack_require__(1046),i.drawInfo=__webpack_require__(955),i.ctProgress=__webpack_require__(1047),i.brushManage=__webpack_require__(1051),i.setoolconfig=__webpack_require__(1052),i.baseLine=__webpack_require__(1053),i.crossLine=__webpack_require__(1054),__webpack_require__(1055),i.clearLayer=[],i.nodeInfo={},i.initFrist={},i.brushC=[];var a=__webpack_require__(1056);return i.nodeShow=!0,i.model=new a(i.app),i.modelData={},i.crossline=__webpack_require__(977),i}return _inherits(ctcornerstone_base,_Interstellar$moduleB),_createClass(ctcornerstone_base,[{key:"complete",value:function(){cornerstoneTools.toolColors.setToolColor("#fbb03b"),__webpack_require__(1060),__webpack_require__(1061),__webpack_require__(1062),__webpack_require__(1063),__webpack_require__(1065),__webpack_require__(1066);this.setoolconfig.setconfig("ellipticalRoiFan",this.cornerstoneTools_config.ellipticalRoi_config),this.setoolconfig.setconfig("rectangleRoiFan",this.cornerstoneTools_config.rectangleRoi_config),cornerstoneTools.magnify.setConfiguration(this.cornerstoneTools_config.magnify_config),cornerstoneWADOImageLoader.external.cornerstone=cornerstone,this.mprClass=__webpack_require__(1067),this.moduleLoad()}},{key:"moduleLoad",value:function(){var e=__webpack_require__(1072);this.ctmenu(e);var n=__webpack_require__(1076);this.initSeriesLists(n),this.deferred=ES.Deferred();var t=this;new Promise(function(e){e()}).then(function(){t.class_c=__webpack_require__(935),t.deferred.resolve({})}.bind(null,__webpack_require__)).catch(__webpack_require__.oe);var o=__webpack_require__(1080);this.nidusControl=this.app.loadModule(o,this.dom.find(".ctcornerstone .nidus_content")),this.nidusControl.event._addEvent("nidusinfo.finish",function(e){if(t.model.nidusChoose){for(var n in t.nidusControl.chooseData)t.model.nidusComponentData[t.nidusControl.backId]=t.model.nidusComponentData[t.nidusControl.backId]?t.model.nidusComponentData[t.nidusControl.backId]:{},t.model.nidusComponentData[t.nidusControl.backId][n]=t.nidusControl.chooseData[n];t.event._dispatch("ctcornerstone.editNodeItem",{chooseData:t.nidusControl.chooseData,backId:t.nidusControl.backId,sId:t.model.nidusChoose.sId,jiangui:e})}}),this.nidusControl.event._addEvent("nidusinfo.remarkFinish",function(e){if(t.model.nidusChoose){for(var n in t.nidusControl.chooseData)t.model.nidusComponentData[t.nidusControl.backId]=t.model.nidusComponentData[t.nidusControl.backId]?t.model.nidusComponentData[t.nidusControl.backId]:{},t.model.nidusComponentData[t.nidusControl.backId][n]=t.nidusControl.chooseData[n];t.model.nidusComponentData[t.nidusControl.backId].imageRemark=t.nidusControl.remarkRes,t.event._dispatch("ctcornerstone.NodeRemark",{chooseData:t.nidusControl.chooseData,remarkRes:t.nidusControl.remarkRes,backId:t.nidusControl.backId,sId:t.model.nidusChoose.sId,jiangui:e})}}),this.nidusControlAll=this.app.loadModule(o,this.dom.find(".ctcornerstone .info")),this.nidusControlAll.show(),this.nidusControlAll.event._addEvent("nidusinfo.finish",function(e){var n={},o={};for(var i in t.nidusControlAll.chooseData){var a=t.nidusControlAll.chooseData[i],r=a.isImageTag,s={formComponentId:a.formComponentId,result:a.result};r?n[i]=s:o[i]=s}e?t.event._dispatch("ctcornerstone.saveLayerMarkInfo",n):t.event._dispatch("ctcornerstone.Allthing",o)}),this.nidusControlAll.event._addEvent("nidusinfo.remarkFinish",function(){t.event._dispatch("ctcornerstone.AllRemark",t.nidusControlAll.remarkRes)})}},{key:"openmpr",value:function(){var e=this;if(this.cornerstoneArray[this.choosescreen]){this.app.loading.show();var n=this.cornerstoneArray[this.choosescreen].sId,t=this.model.seriesInfo[n];this.nowmpr=this.app.loadModule(this.mprClass,this.dom.find(".ctcornerstone .mpr"),{info:t}),this.nowmpr.openS(this.cornerstoneArray[this.choosescreen].axialStack1.imageIds,this.nodeInfo,this.brushManage),this.nowmpr.sId=n,this.nowmpr.event._addEvent("mpr.closeAll",function(){e.nowmpr=null,e.dom.find(".ctcornerstone .mpr").hide(),e.dom.find(".ctcornerstone .mpr").html(""),e.mpr=!1})}else this.app.alert.show({title:" ",msg:"请先选择一个序列",close:!0,sure:function(){window.location.reload()}})}},{key:"groupMakeSame",value:function(e){var n=1*e.backId.split("_")[0]+"_";for(var t in this.model.nidusComponentData)if(-1!=t.lastIndexOf(n)&&t!=e.backId)for(var o in e.chooseData)this.model.nidusComponentData[t][o]=e.chooseData[o]}},{key:"baseLineSt",value:function(e,n){if("cross"==n){this.crossOpen=e,this.baseLineOpen=!1;for(var t=0;t<this.sceen;t++)this.cornerstoneArray[t]&&this.gotoLayer(null,this.cornerstoneArray[t].sId);this.creatCrossLine()}else this.baseLineOpen=e,this.crossOpen=!1,this.removeCrossLine()}},{key:"creatCrossLine",value:function(){var e=this;this.crossArray=[];for(var n=0;n<this.sceen;n++)this.cornerstoneArray[n]&&function(){var t=n,o=e.dom.find("#ct"+t).box();e.crossArray[t]=e.app.loadModule(e.crossline,e.dom.find(".ct"+t+" .line")),e.crossArray[t].type="z";var i=e.model.returnScreenPoint({x:o.clientWidth/2,y:o.clientHeight/2},t,e.sceen,{w:o.clientWidth,h:o.clientHeight});e.crossArray[t].setPos(i),e.crossArray[t].setXYLinePos({x:o.clientWidth/2,y:o.clientHeight/2}),e.crossArray[t].setYHeight(o.clientHeight);var a=e.crossArray[t].nowpos;a=e.model.returnRealPoint(a,t,e.sceen,{w:o.clientWidth,h:o.clientHeight}),e.crossArray[t].setXYLinePos(a);var r=e.cornerstoneArray[t].getViewport(),s=e.getStartPos(r,o),l=(a.x-s.x)/r.scale,d=(a.y-s.y)/r.scale;e.crossArray[t].imagePoint={x:l,y:d},e.crossArray[t].event._addEvent("crossline.move",function(){e.crossmove=!0,e.cornerstoneArray[t]&&e.changePOint(t,o)}),e.crossArray[t].event._addEvent("crossline.mouseup",function(){e.crossmove=!1})}()}},{key:"changePOint",value:function(e,n){var t=this.cornerstoneArray[e].getViewport(),o=this.crossArray[e].nowpos;o=this.model.returnRealPoint(o,e,this.sceen,{w:n.clientWidth,h:n.clientHeight}),this.crossArray[e].setXYLinePos(o);var i=this.getStartPos(t,n),a=(o.x-i.x)/t.scale,r=(o.y-i.y)/t.scale;this.crossArray[e].imagePoint={x:a,y:r};for(var s=this.nowLayNum(e),l=0;l<this.sceen;l++)this.cornerstoneArray[l]&&l!=e&&this.calCrossLine({x:a,y:r,z:s},this.cornerstoneArray[e].sId,l)}},{key:"calflow",value:function(e){var n=this.dom.find("#ct"+e).box();if(this.crossArray[e]){var t=this.crossArray[e].imagePoint,o=this.returnXY(t,this.cornerstoneArray[e].getViewport(),n),i=this.model.returnScreenPoint(o,e,this.sceen,{w:n.clientWidth,h:n.clientHeight});this.crossArray[e].setPos(i),this.crossArray[e].setXYLinePos(o)}}},{key:"calCrossLine",value:function(e,n,t){var o=this.dom.find("#ct"+t).box(),i=this.cornerstoneArray[t].getViewport(),a={};if(n==this.cornerstoneArray[t].sId){a.z=e.z;var r=this.returnXY(e,i,o);a.x=r.x,a.y=r.y}else{for(var s=this.cornerstoneArray[t].sId,l=null,d=1;d<this.model.seriesInfo[s].people.length;d++){var c={referent:{imageOrientationPatient:this.model.seriesInfo[n].people[e.z].ImageOrientationPatient.toString(),imagePositionPatient:this.model.seriesInfo[n].people[e.z].imagePositionPatient.toString(),pixelSpacing:this.model.seriesInfo[n].info.data.pixelSpacing.toString(),x:Math.round(e.x),y:Math.round(e.y),z:e.z},convert:{imageOrientationPatient:this.model.seriesInfo[s].people[d].ImageOrientationPatient.toString(),imagePositionPatient:this.model.seriesInfo[s].people[d].imagePositionPatient.toString(),pixelSpacing:this.model.seriesInfo[s].info.data.pixelSpacing.toString(),width:this.model.seriesInfo[s].info.data.column,height:this.model.seriesInfo[s].info.data.row}};if(l){var u=new this.crossLine(c);u.dis<l.data.dis&&(l={data:u,num:d})}else l={data:new this.crossLine(c),num:d}}var h=(new this.crossLine).getSagPoint(l.data);a.z=l.num;var m=this.returnXY({x:h.x,y:h.y},i,o);a.x=m.x,a.y=m.y}var f=this.model.returnScreenPoint(a,t,this.sceen,{w:o.clientWidth,h:o.clientHeight});this.crossArray[t].setPos(f),this.crossArray[t].setXYLinePos(a);var p=this.getStartPos(i,o),g=(a.x-p.x)/i.scale,v=(a.y-p.y)/i.scale;this.crossArray[t].imagePoint={x:g,y:v},this.cornerstoneArray[t].funcNodule(a.z)}},{key:"getStartPos",value:function(e,n){var t=e.displayedArea.brhc.x,o=e.displayedArea.brhc.y,i=0,a=0;return t/o>n.clientWidth/n.clientHeight?a=(n.clientHeight-n.clientWidth*o/t)/2:i=(n.clientWidth-n.clientHeight*t/o)/2,{x:i,y:a}}},{key:"returnXY",value:function(e,n,t){var o=this.getStartPos(n,t),i=Math.floor(o.x+(n.translation.x+e.x)*n.scale),a=Math.floor(o.y+(n.translation.y+e.y)*n.scale);return o=null,{x:i,y:a}}},{key:"removeCrossLine",value:function(){for(var e=0;e<this.sceen;e++)this.dom.find(".ct"+e+" .line").html("")}},{key:"setSeriesNidusData",value:function(e,n,t){var o={};e.map(function(e){o[e.annotationItemId]=e}),this.model.allresult=t,this.model.nidusComponentInfo.all.annotationItemResultList=o;var i=null;for(var a in t)i=i?Object.assign(i,t[a].data.doctorNidduleAll):t[a].data.doctorNidduleAll,n.seriesRemark=t[a].data.auditResult?t[a].data.auditResult.seriesRemark:"";!n.remark||2!=n.remark&&3!=n.remark||(this.nidusSigle=!0),!n.remark||1!=n.remark&&3!=n.remark?n.remark=!1:n.remark=!0;var r=this.model.nidusComponentInfo,s=(this.model.layerMarkImageAnnotation||{}).imageAnnotation;if(s){var l=r[s];l&&this.nidusControlAll.setLayerMarkData(l)}this.nidusControlAll.setData(r.all,"序列标注信息",n,i);var d=this.cornerstoneArray[this.choosescreen]?this.cornerstoneArray[this.choosescreen].sId:null;if(d){var c=this.model.seriesInfo[d].info.data.finding,u=this.model.seriesInfo[d].info.data.conclusion;this.nidusControlAll.updataReport(c,u)}}},{key:"makeBaseLine",value:function(e,n){this.nowLine={};for(var t=0;t<this.sceen;t++)if(this.cornerstoneArray[t]&&this.cornerstoneArray[t].sId!=e){var o=this.model.seriesInfo[e],i=this.model.seriesInfo[this.cornerstoneArray[t].sId],a=this.nowLayNum(t),r={referent:{imageOrientationPatient:i.people[a].ImageOrientationPatient.toString(),imagePositionPatient:i.people[a].imagePositionPatient.toString(),pixelSpacing:i.info.data.columnPixelSpacing+","+i.info.data.rowPixelSpacing,width:i.info.data.column,height:i.info.data.row},convert:{imageOrientationPatient:o.people[n].ImageOrientationPatient.toString(),imagePositionPatient:o.people[n].imagePositionPatient.toString(),pixelSpacing:o.info.data.columnPixelSpacing+","+o.info.data.rowPixelSpacing,width:o.info.data.column,height:o.info.data.row}};this.nowLine[this.cornerstoneArray[t].sId]=new this.baseLine(r),this.gotoLayer(a,this.cornerstoneArray[t].sId)}}},{key:"makeInfo",value:function(e,n,t,o){if(e&&"IMAGE_TAG"!==o||"IMAGE_TAG"===o&&e.check_reslut){this.nidusControl.show(),this.nidusControl.showClose(),this.nidusControl.backId=n;var i=("IMAGE_TAG"===o?"图层":"病症")+"标注信息"+(t>0?"（"+t+"）":"");this.nidusControl.setData(e,i,{remark:this.nidusSigle,seriesRemark:e.annotationItemResultList?e.annotationItemResultList.imageRemark:null})}else this.nidusControl.isShow()&&this.nidusControl.hide(),"IMAGE_TAG"===o&&this.nidusControlAll.setLayerMarkData(e)}},{key:"initSeriesLists",value:function(e){var n=this;this.sequencelists=this.app.loadModule(e,this.dom.find(".ctcornerstone .slist")),this.sequencelists.event._addEvent("serieslist.clcik",function(e){var t=n.model.seriesInfo[e.sid];n.model.setCurrentSeriesInfo({seriesAnnotationResultId:t.sarId,seriesInstanceUid:e.sid}),n.choosescreen<=n.sceen&&(n.initsingle(n.choosescreen,t.imgs,{length:t.imgsTotal,major:"master",sId:e.sid}),n.sequencelist.showNowData(e.sid));var o=n.cornerstoneArray[n.choosescreen]?n.cornerstoneArray[n.choosescreen].sId:null;if(o){var i=n.model.seriesInfo[o].info.data.finding,a=n.model.seriesInfo[o].info.data.conclusion;n.nidusControlAll.updataReport(i,a)}var r=n.model.currentSeriesInfo;ES.ajax({url:n.app.domain1+"v1/anno/series_result/read",type:"POST",dataType:"json",contentType:"application/json",questring:{id:r.seriesAnnotationResultId}}).then(function(e){if(n.app.apiresult(e)){var t=n.model.projectInfo||{},o=(t.showReport,t.inspectSee),i=t.diagnosisIncome;r.inspectSee=o,r.diagnosisIncome=i,n.setSeriesNidusData(e.data.annotationItemResultList,r,{})}}),n.hideMarkInfoClearNidusChoose();var s=n.model.currentLayer;n.updateImageTagComponentData(s||1)})}},{key:"closeSequenceLists",value:function(){this.makeStudy=!1,this.dom.find(".ctcornerstone .slist").remove(),this.resize()}},{key:"clearRemark",value:function(e){this.nidusControl.clearRemark(e)}},{key:"setSequenceLists",value:function(e,n){this.sequencelists.setData(e,n)}},{key:"ctmenu",value:function(e){var n=this;this.sequencelist=this.app.loadModule(e,this.dom.find(".ctcornerstone .xulielist")),this.sequencelist.event._addEvent("sequencelist.choose",function(){var e=n.sequencelist.chooseData;n.initsingle(0,e.imageAddress,{length:e.axialImageIdss.length,major:e.major})}),this.sequencelist.event._addEvent("sequencelist.fillWho",function(e){n.brushManage.restSignleIdFill(e);var t=n.brushManage.getInfo(e).sId;n.brushManage.doneSingleChange(n.model.nidusChoose?n.model.nidusChoose:{},e,"fill");for(var o=0;o<n.sceen;o++){var i=t.split("_");if(n.cornerstoneArray[o]&&-1!=i.lastIndexOf(n.cornerstoneArray[o].sId)){var a=n.nowLayNum(o);n.gotoLayer(a,n.cornerstoneArray[o].sId)}}}),this.sequencelist.event._addEvent("sequencelist.changeColor",function(e){n.brushManage.restSignleId(e);var t=n.brushManage.getInfo(e).sId;n.brushManage.doneSingleChange(n.model.nidusChoose?n.model.nidusChoose:{},e,"color");for(var o=0;o<n.sceen;o++){var i=t.split("_");if(n.cornerstoneArray[o]&&-1!=i.lastIndexOf(n.cornerstoneArray[o].sId)){var a=n.nowLayNum(o);n.gotoLayer(a,n.cornerstoneArray[o].sId)}}}),this.sequencelist.event._addEvent("sequencelist.closeWho",function(e){n.brushManage.restSignleIdShow(e);var t=void 0;if(n.nodeInfo)for(var o in n.nodeInfo)for(var i=0;i<n.nodeInfo[o].length;i++)n.nodeInfo[o][i].nodeInfo.uuid!=e.uuid&&n.nodeInfo[o][i].nodeInfo.id!=e.uuid||(t=n.nodeInfo[o][i],n.nodeInfo[o][i].show=e.show);if(t&&-1!=window.location.hash.lastIndexOf("drapCanvas"))return n.drawNode(!0),void n.renderStage();for(var a=n.brushManage.getInfo(e)?n.brushManage.getInfo(e).sId:e.sId,r=function(e){var o=a.split("_");if(n.cornerstoneArray[e]&&-1!=o.lastIndexOf(n.cornerstoneArray[e].sId)){var i=n.nowLayNum(e);if(t&&-1==window.location.hash.lastIndexOf("markview")&&-1==window.location.hash.lastIndexOf("markaudit"))n.cornerstoneArray[e].getAllState().map(function(o){o.uuid&&"alignment"!=o.tooltype&&o.uuid==t.nodeInfo.uuid&&n.cornerstoneArray[e].clearSigleData(o.tooltype,o,!0)});n.gotoLayer(i,n.cornerstoneArray[e].sId)}},s=0;s<n.sceen;s++)r(s)}),this.sequencelist.event._addEvent("sequencelist.niddclick",function(e){var t={toolType:e.attr("toolType"),type:e.attr("brushtype")||"nobrush",sId:e.attr("sId"),niddtype:e.attr("niddtype"),uuid:e.hasClass("choose")?e.attr("uuid"):"",layerNumber:e.attr("layerInfo"),bid:e.hasClass("choose")?e.attr("bid"):""},o=n.model.nidusComponentInfo[t.niddtype]?Tool.objetClone(n.model.nidusComponentInfo[t.niddtype]):null,i=t.layerNumber,a=n.model.nidusChoose?Tool.clone(n.model.nidusChoose):null;if(t.bid&&t.uuid){var r=void 0,s=t.toolType;!isNaN(i)&&i||(i=null),n.app.loading.show();var l=n.brushManage.getInfo(t)?n.brushManage.getInfo(t).sId:t.sId;switch("nobrush"==t.type&&a&&"brush"==a.type&&n.brushManage.restChooseColor(null,a),s){case"MAGIC_STICK_SINGLE":n.model.nidusChoose=r=t,r.toolType={imageAnnotation:t.niddtype,imageAnnotationToolType:s},i?(n.brushManage.restChooseColor(r,a),n.gotoLayer(null,l)):n.restNowImageOnLayer(r,a);break;case"POLYGON":case"FREEHAND":case"QSELECT":case"REGION_PAINT":n.model.nidusChoose=r=t,r.toolType={imageAnnotation:t.niddtype,imageAnnotationToolType:s},i?(n.brushManage.restChooseColor(r,a),n.gotoLayer(i,t.sId)):n.restNowImageOnLayer(r,a);break;case"FREEHANDLINE":n.model.nidusChoose=r=t,r.toolType={imageAnnotation:t.niddtype,imageAnnotationToolType:s},n.drawNode(!0),n.renderStage();break;case"PEN":n.model.nidusChoose=r=n.brushManage.getInfo(t),r.toolType=t.toolType;break;case"IMAGE_TAG":n.model.nidusChoose=r=t,r.toolType={imageAnnotation:t.niddtype,imageAnnotationToolType:s},n.gotoLayer(t.layerNumber,t.sId);break;default:n.gotoLayer(t.layerNumber,t.sId),n.model.nidusChoose=r=n.drawInfo.getInfo(t)}var d=n.model.nidusComponentInfo[r.toolType.imageAnnotation]?Tool.objetClone(n.model.nidusComponentInfo[r.toolType.imageAnnotation]):null;n.nowmpr&&n.nowmpr.nidusChoose(n.model.nidusChoose),d&&(d.annotationItemResultList=n.model.nidusComponentData[t.bid]),n.app.loading.hide(),n.makeInfo(d,t.bid,i,s)}else{n.brushManage.restChooseColor(null,a),n.gotoLayer(null,t.sId),n.model.nidusChoose=null,-1!=window.location.hash.lastIndexOf("markpreview")?n.makeInfo(o,t.bid,i):n.makeInfo(null,t.bid,i);var c=n.model.seriesInfo[t.sId].info.data.fileType;n.model.seriesInfo[t.sId].infoAll||"DCM"==c||"NII"==c||(n.drawNode(!0),n.renderStage())}}),this.sequencelist.event._addEvent("sequencelist.allShowControl",function(e){if(n.brushManage.allShow(e),n.nodeInfo)for(var t in n.nodeInfo)for(var o=0;o<n.nodeInfo[t].length;o++)n.nodeInfo[t][o].show=e.show;if(-1!=window.location.hash.lastIndexOf("drapCanvas"))return n.drawNode(!0),void n.renderStage();for(var i=function(e){if(n.cornerstoneArray[e]){var t=n.nowLayNum(e);if(-1==window.location.hash.lastIndexOf("markview")&&-1==window.location.hash.lastIndexOf("markaudit"))n.cornerstoneArray[e].getAllState().map(function(t){t.uuid&&"alignment"!=t.tooltype&&n.cornerstoneArray[e].clearSigleData(t.tooltype,t,!0)});n.gotoLayer(t,n.cornerstoneArray[e].sId)}},a=0;a<n.sceen;a++)i(a)}),this.sequencelist.event._addEvent("sequencelist.del",function(e){n.dom.find(".cal").html("");var t=void 0;"nobrush"==e.type?(t=n.drawInfo.getInfo(e),n.gotoLayer(e.layerNumber,e.sId)):(t=e,e.backId=e.bid),setTimeout(function(){n.deleteNode(!1,t,e.type)},10)})}},{key:"updateSequencelistSid",value:function(e){this.sequencelist.updateSequencelistSid(e)}},{key:"setNname",value:function(e,n){switch(1*n){case 1:this.sequencelist.setNname(e,"左心室_"+e);break;case 2:this.sequencelist.setNname(e,"左心房_"+e);break;case 3:this.sequencelist.setNname(e,"右心室_"+e);break;case 4:this.sequencelist.setNname(e,"右心房_"+e);break;case 5:this.sequencelist.setNname(e,"主动脉_"+e);break;case 6:this.sequencelist.setNname(e,"左心肌_"+e);break;case 7:this.sequencelist.setNname(e,"冠脉_"+e)}}},{key:"returnListAnno",value:function(e){return this.sequencelist.returnAnno(e)}},{key:"restNowImageOnLayer",value:function(e,n){for(var t=0;t<this.sceen;t++)if(this.cornerstoneArray[t]&&this.cornerstoneArray[t].sId==e.sId){var o=this.nowLayNum(t);this.brushManage.changeColorById(e,n),this.gotoLayer(o,e.sId)}}},{key:"setSequence",value:function(e,n){var t=this;this.nodeInfo=0!=n.length?{}:null;var o=e;n.map(function(e){if(t.nodeInfo[e.layerNumber]||(t.nodeInfo[e.layerNumber]=[]),t.model.nidusComponentData[e.id]||(t.model.nidusComponentData[e.id]={}),"magicStickSingle"!=e.tooltype&&"polygon"!=e.tooltype&&"quickselect"!=e.tooltype&&"regionpaint"!=e.tooltype&&"freehand"!=e.tooltype){var n={};if("cobb"!=e.type&&"alignment"!=e.type&&"imagetag"!=e.type){var o={currentPoints:{image:e.result.point1},uuid:e.uuid};n.nodeInfo=cornerstoneTools[e.type].getMeasurement(o)}if("alignment"==e.type&&(n.nodeInfo={pointA:[],uuid:e.uuid},e.result.pointA.map(function(e){n.nodeInfo.pointA.push({start:e.point1})})),"cobb"==e.type&&(n.nodeInfo={lineA:[],uuid:e.uuid},e.result.lineA.map(function(t){var o={currentPoints:{image:t.point1},uuid:e.uuid};n.nodeInfo.lineA.push(cornerstoneTools.length.getMeasurement(o))})),"cobb"==e.tooltype)for(var i=0;i<n.nodeInfo.lineA.length;i++)n.nodeInfo.lineA[i].handles.end=e.result.lineA[i].point2;else if("simpleAngle"==e.tooltype)n.nodeInfo.handles.middle=e.result.point2,n.nodeInfo.handles.end=e.result.point3;else if("imagetag"==e.tooltype){var a=e.annotationItemResultList;n.nodeInfo={uuid:e.uuid,annotationItemResultList:a}}else"alignment"==e.tooltype||(n.nodeInfo.handles.end=e.result.point2);n.layerNumber=e.layerNumber?e.layerNumber:1,n.sId=e.sId,n.type=e.type,n.show=!0,t.nodeInfo[e.layerNumber].push(n),t.drawInfo.setInfo(e)}e.annotationItemResultList&&e.annotationItemResultList.map(function(n){t.model.nidusComponentData[e.id][n.annotationItemId]=n}),e.orginannotationItemResultList&&(t.model.nidusComponentData[e.id].orginannotationItemResultList=e.orginannotationItemResultList),t.model.nidusComponentData[e.id].doctorName=e.doctorName,t.model.nidusComponentData[e.id].doctorId=e.doctorId,t.model.nidusComponentData[e.id].imageRemark=e.imageRemark});var i=!!this.model.layerMarkImageAnnotation;this.sequencelist.setData(o,n,i),this.sequencelist.showNowData(this.cornerstoneArray[0].sId);var a=this.model.currentLayer;this.updateImageTagComponentData(a||1)}},{key:"updataSequencelist",value:function(e){if(e.brush)this.sequencelist.setBackId(e);else{var n=this.drawInfo.getInfo(e);if(this.sequencelist.setBackId(n),this.cornerstoneArray[0])this.cornerstoneArray[0].getAllState().map(function(n){n.uuid==e.uuid&&(n.backId=e.backId)})}this.sequencelist.sortByDom()}},{key:"updataMaskInfo",value:function(){this.brushManage.doneSingleChange(this.model.nidusChoose?this.model.nidusChoose:{},this.model.nidusChoose?this.model.nidusChoose:{},"fill");for(var e=0;e<this.sceen;e++)if(this.cornerstoneArray[e]&&this.cornerstoneArray[e].sId==this.model.nidusChoose.sId){var n=this.nowLayNum(e);this.gotoLayer(n,this.model.nidusChoose.sId)}}},{key:"removeSequencelist",value:function(e){this.sequencelist.removeNode(e)}},{key:"getSequence",value:function(){return this.sequencelist.nowplayData}},{key:"openSequenceNode",value:function(e){this.sequencelist.openNode(e)}},{key:"initCT",value:function(e,n,t){var o=this;this.initFrist[0]=!1,this.totalImage=e;for(var i=0;i<this.totalImage;i++)this.clearLayer.push(!0);this.baseData=t,this.timeLoad=0,this.setScreen(1),this.dom.find(".ct0").css({border:"1px solid #0a2634"}),this.class_c?(this.initsingle(0,n,{length:this.totalImage,major:"master",sId:t.data.seriesInstanceUID}),this.renderThumb()):this.deferred.done(function(e){o.initsingle(0,n,{length:o.totalImage,major:"master",sId:t.data.seriesInstanceUID})}),ES.selctorDoc(window).on("keydown",function(e){if(o.cornerstoneArray[o.choosescreen]){var n=o.cornerstoneArray[o.choosescreen],t=o.nowLayNum(o.choosescreen),i=n.getIndex(t);38==e.keyCode&&(i>0&&i--,o.gotoLayer(n.getLayerNum(i),n.sId)),40==e.keyCode&&(i<n.imageAddress.length-1&&i++,o.gotoLayer(n.getLayerNum(i),n.sId))}if("alignmentFan"!=o.controlename)"quickselectFan"==o.controlename&&(65==e.keyCode&&(o.cornerstoneTools_config.quickselect_config.deviation=o.cornerstoneTools_config.quickselect_config.deviation+2),68==e.keyCode&&(o.cornerstoneTools_config.quickselect_config.deviation=o.cornerstoneTools_config.quickselect_config.deviation-2)),o.makeCicle();else if(87==e.keyCode){var a=o.choosescreen;if(!o.model.nidusChoose)return o.alignmentAdd({},a),void o.dom.find(".ct"+a+" .cal").html("前上缘");if(o.model.nidusChoose&&"alignment"!=o.model.nidusChoose.type)return o.alignmentAdd({},a),void hat.dom.find(".ct"+a+" .cal").html("前上缘");if(o.model.nidusChoose){var r=o.drawInfo.getInfo(o.model.nidusChoose);if(4==r.pointA.length)return o.alignmentAdd({},a),hat.dom.find(".ct"+a+" .cal").html("前上缘"),void o.gotoLayer(null,o.cornerstoneArray[a].sId);if(r.pointA.length<4){r.pointA.push({}),r.setDataType="number";var s=o.model.returnBodyName(r.pointA.length);return o.dom.find(".ct"+a+" .cal").html(s),o.gotoLayer(null,o.cornerstoneArray[a].sId),void o.event._dispatch("ctcornerstone.editNode",r)}}}})}},{key:"makeCicle",value:function(){}},{key:"resetAllData",value:function(e){this.cornerstoneArray[e]&&(this.clearLayer=[],this.brushC=[],this.cornerstoneArray[e].progress.close(),this.cornerstoneArray[e].close(),this.cornerstoneArray[e]=null),this.initFrist[e]=!1,this.dom.find("#ct"+e).remove(),this.dom.find(".c"+e).prepend('<div id="ct'+e+'"></div>')}},{key:"initsingle",value:function(e,n,t){var o=this,i=this;this.baseData;this.resetAllData(e),this.resize();var a=null!=Tool.changeToName(n[0])&&void 0!=Tool.changeToName(n[0])?Tool.changeToName(n[0]):1;this.cornerstoneArray[e]=new this.class_c({element:this.dom.find("#ct"+e).dom[0].dom,totalImage:t.length,imageAddress:n,index:a-1,type:this.imageType.toLowerCase()||"dcm"}),this.cornerstoneArray[e].sId=t.sId,this.cornerstoneArray[e].imageIndex=0;var r=this.app.loadModule(this.ctProgress,this.dom.find(".ct"+e+" .image_progress")),s=[];n.map(function(e){var n=e.split("?")[0].split("/");s.push(1*n[n.length-1].split(".")[0])}),r.setImageData(s),this.changeLayeIdTime=null,r.event._addEvent("ctprogress.stopDrag",function(){null!=o.changeLayeIdTime&&clearInterval(o.changeLayeIdTime),o.changeLayeIdTime=null}),r.event._addEvent("ctprogress.click",function(){o.changeLayeIdTime=0;var n=Math.floor(r.getRate());i.cornerstoneArray[e].funcNodule(n)}),r.event._addEvent("ctprogress.startDrag",function(){o.changeLayeIdTime=setInterval(function(){var n=Math.floor(r.getRate());i.cornerstoneArray[e].funcNodule(n)},500)}),console.log("=============="),this.cornerstoneArray[e].progress=r;var l=t.length;this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.cornerstonetoolsmousemove",function(n){var t=JSON.parse(JSON.stringify(i.model.getDicomValue(n.detail)));t.sId=i.cornerstoneArray[e].sId,t.id=e,i.event._dispatch("ctcornerstone.HUShow",t)}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.wlChange",function(){});this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.cornerstonetoolsmousewheel",function(n){!i.crossmove&&i.crossOpen&&i.changePOint(e,i.dom.find("#ct"+e).box())}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.updateImageTagComponentData",function(e){i.updateImageTagComponentData(e)}),this.ctEvent(e,n,t,l)}},{key:"endDone",value:function(e,n){var t=this;e.uuid=e.id;if(this.drawInfo.getInfo(e).backId){if(e=this.drawInfo.removeInfo(e),this.nodeInfo&&this.nodeInfo[e.layerNumber])for(var o=0;o<this.nodeInfo[e.layerNumber].length;o++)this.nodeInfo[e.layerNumber][o].nodeInfo.uuid!=e.id&&this.nodeInfo[e.layerNumber][o].nodeInfo.id!=e.id||this.nodeInfo[e.layerNumber].splice(o,1);this.sequencelist.removeNode(e),this.hideMarkInfoClearNidusChoose(),this.event._dispatch("ctcornerstone.deleteNode",{backId:e.backId})}else setTimeout(function(){++n<200&&t.endDone(e,n)},30)}},{key:"setScreen",value:function(e){if(e>this.sceen)for(var n=this.sceen;n<e;n++){var t='<div class="c_fbb03b ct'+n+'" pos="'+n+'">\n            <div class="fl w50_ pr c'+n+'">\n                <div id="ct'+n+'"></div>\n            </div>\n            <div class="wc-ww"> \n              <p class="sc"></p>\n              <p class="wwc"></p>\n              <p class="layer"></p>\n            </div>\n            <p class="infoXYZ"></p>\n            <p class="cal"></p>\n            <div class="line"></div>\n            <div class="image_progress"></div>\n            <div class="slideContainer"></div>\n            </div>';this.dom.find(".dicom_content").append(t)}if(e<this.sceen)for(var o=e;o<this.sceen;o++)this.cornerstoneArray[o]&&(this.cornerstoneArray[o].close(),this.cornerstoneArray[o]=null),this.dom.find(".dicom_content .ct"+o).remove();var i=this;this.dom.find(".c0").off("click"),this.dom.find(".c0").on("click",function(){i.dom.find(".c_fbb03b").css({border:"1px solid #fff"});var e=ES.selctorDoc(this);e.css({border:"1px solid #448e97"}),i.choosescreen=e.attr("pos");var n=i.cornerstoneArray[i.choosescreen],t=n?n.sId:null;if(t){var o=i.model.seriesInfo[t].info.data.finding,a=i.model.seriesInfo[t].info.data.conclusion;i.nidusControlAll.updataReport(o,a),i.gotoLayer(null,t)}i.sequencelist.showNowData(t)}),this.sceen=e,this.resize()}},{key:"getImgsAnsNumbers",value:function(){var e=[],n=[],t=this.modelData.series_result_id.studyInstanceUid;for(var o in this.modelData.seriesInfo)o===t&&(e=this.modelData.seriesInfo[o].imgs,n=this.modelData.seriesInfo[o].numbers);return{imgs:e,numbers:n}}},{key:"appendHtml",value:function(e,n){var t=this,o="";e.forEach(function(e,t){var i="slideImg"+t,a=n[t];o+='<li id="'+i+'" number="'+a+'"  class="'+i+'"  src="'+e+'"  index="'+t+'" ></li>'}),$(".slideContainer").append(o),$(".slideContainer ").on("click","li",function(){var e=Number($(this).attr("number")),n=t.modelData.series_result_id.studyInstanceUid;t.gotoLayer(e,n)})}},{key:"gotoLayer",value:function(e,n){n.split("_");for(var t=0;t<this.sceen;t++)this.cornerstoneArray[t]&&-1!=n.lastIndexOf(this.cornerstoneArray[t].sId)&&(e&&"undefined"!=e||(e=this.nowLayNum(t)),this.cornerstoneArray[t].funcNodule(e))}},{key:"renderThumb",value:function(){var e=this,n=this.getImgsAnsNumbers(),t=n.imgs,o=n.numbers;this.appendHtml(t,o),t.forEach(function(n,t){var o=e.dom.find("#slideImg"+t).dom[0].dom;cornerstone.enable(o),cornerstone.loadImage(n).then(function(e){var n=cornerstone.getDefaultViewportForImage(o,e);n.voiLUT=void 0,cornerstone.displayImage(o,e,n)})})}},{key:"changeWWCImage",value:function(e){var n=this;if(e&&e[0]!=this.cornerstoneArray[this.choosescreen].axialStack1.imageIds[0]){this.cornerstoneArray[this.choosescreen].imageAddress=e,this.cornerstoneArray[this.choosescreen].axialStack1.imageIds=e;var t=this.nowLayNum(this.choosescreen);setTimeout(function(){n.cornerstoneArray[n.choosescreen].funcNodule(t)},10)}}},{key:"setSpliceId",value:function(e,n){var t=this.cornerstoneArray[0].geSiglneState(n);t&&t.data.map(function(n){n.id==e.id&&(e.uuid=n.uuid=e.id)})}},{key:"setSpliceUUID",value:function(e,n,t,o){var i=this.cornerstoneArray[o].geSiglneState(n);i&&i.data.map(function(n){n.id==e.id&&(e.uuid=n.uuid=t)})}},{key:"getAlllayer",value:function(e){for(var n=[],t=0;t<this.cornerstoneArray.length;t++)this.cornerstoneArray[t]&&this.cornerstoneArray[t].axialStack1.currentImageIdIndex==this.cornerstoneArray[e].axialStack1.currentImageIdIndex&&n.push(t);return n}},{key:"setbrush",value:function(e){if(0!=e.imglist.length){var n=this,t=0,o=e.imglist.filter(function(e){return e}).length,i=0;if(0!=o){for(var a=0;a<e.imglist.length;a++)if(e.imglist[a]){0==i&&(i=a);var r=new Image;r.id=a,r.crossOrigin="",r.onload=function(){t++,n.brushManage.creatNewImage(this,e,{width:this.width,height:this.height},this.id,n.model.nidusChoose?n.model.nidusChoose.bid:""),t>=o&&setTimeout(function(){var t=Math.floor(n.brushManage.getPixTotal(e.id)*n.model.seriesInfo[e.sId].volumeCal*100),o={id:e.id,cal:"出血量:"+t/100+"mm<sup>3</sup>"};n.sequencelist.upCal(o),n.cornerstoneArray[0]&&(n.cornerstoneArray[0].brushFan(),n.cornerstoneArray[0].disableAllTools(!0)),n.event._dispatch("ctcornerstone.brushfirstload")},300)},r.onerror=function(){++t>=o&&setTimeout(function(){n.cornerstoneArray[0]&&(n.cornerstoneArray[0].brushFan(),n.cornerstoneArray[0].disableAllTools(!0)),n.event._dispatch("ctcornerstone.brushfirstload")},300)},r.src=e.imglist[a]}this.sequencelist.setLayerInfo(e,i),this.sequencelist.sortByDom()}else this.event._dispatch("ctcornerstone.brushfirstload")}else this.event._dispatch("ctcornerstone.brushfirstload")}},{key:"nowLayNum",value:function(e){return 1*String(this.dom.find(".ct"+e+" .layer").html()).split("/")[0]}},{key:"deleteNode",value:function(e,n,t){var o=this;this.model.controlStauts.delete=!0,this.app.alert.show({title:" ",msg:"确认删除将清除该影像标注的图形和信息？",close:!0,sure:function(){var i=$(".nodeInfolist div[uuid='"+n.uuid+"']").next("div:visible");if("nobrush"==t&&"imagetag"!==n.type)o.doneDelete(e,n);else{if(o.drawInfo.removeInfo(n),o.nodeInfo&&o.nodeInfo[n.layerNumber])for(var a=0,r=o.nodeInfo[n.layerNumber].length;a<r;a++){var s=o.nodeInfo[n.layerNumber][a];if(s){var l=s.nodeInfo;l.uuid!=n.uuid&&l.id!=n.uuid&&l.uuid!=n.backId||(o.nodeInfo[n.layerNumber].splice(a,1),o.gotoLayer(n.layerNumber,n.sId))}}o.brushManage.delbrush(n),o.gotoLayer(n.layerNumber,n.sId),o.sequencelist.removeNode(n),o.hideMarkInfoClearNidusChoose(),o.model.nidusChoose&&o.model.nidusChoose.uuid==n.uuid&&(o.model.nidusChoose=null),o.event._dispatch("ctcornerstone.deleteNode",{backId:n.backId})}i.length&&i.find(".nname").click()}})}},{key:"doneDelete",value:function(e,n){var t=this,o=this;if(!e){if(this.nodeInfo){this.nodeInfo[n.layerNumber];if(this.nodeInfo[n.layerNumber])for(var i=n.id,a=0;a<this.nodeInfo[n.layerNumber].length;a++){var r=this.nodeInfo[n.layerNumber][a].nodeInfo;r&&(r.uuid!==i&&r.id!==i||this.nodeInfo[n.layerNumber].splice(a,1))}}this.sequencelist.removeNode(n)}for(var s=!1,l=function(i){t.cornerstoneArray[i]&&(t.cornerstoneArray[i].sId==n.sId&&(i,t.cornerstoneArray[i].getAllState().map(function(t){if(e){if(t.active&&t.uuid){t.layerNumber=String(o.dom.find(".ct"+i+" .layer").html()).split("/")[0];for(var a=0;a<o.nodeInfo[t.layerNumber].length;a++)o.nodeInfo[t.layerNumber][a].nodeInfo.id==t.id&&o.nodeInfo[t.layerNumber].splice(a,1);if("alignment"!=t.tooltype){o.drawInfo.getInfo(t);o.cornerstoneArray[i].clearSigleData(t.tooltype,t)}}}else"alignment"!=t.tooltype&&(t.id!=n.id&&t.uuid!=n.uuid||o.cornerstoneArray[i].clearSigleData(t.tooltype,t))}),s=!0))},d=0;d<this.sceen;d++)l(d);s||this.hideMarkInfoClearNidusChoose()}},{key:"controlNodeShowHide",value:function(e){this.nodeShow=e.stauts,this.model.controlStauts.delete=!1,this.nodeShow||this.clearData("biao");for(var n=0;n<this.sceen;n++)if(this.cornerstoneArray[n]){var t=this.dom.find(".layer").eq(n).html().split("/")[0];this.gotoLayer(t,this.cornerstoneArray[n].sId)}}},{key:"gotoLayer",value:function(e,n){n.split("_");for(var t=0;t<this.sceen;t++)this.cornerstoneArray[t]&&-1!=n.lastIndexOf(this.cornerstoneArray[t].sId)&&(e&&"undefined"!=e||(e=this.nowLayNum(t)),this.cornerstoneArray[t].funcNodule(e))}},{key:"setConfigByDicommeun",value:function(e){switch(e.type){case"bradius":this.cornerstoneTools_config.brush_config.radius=e.value;break;case"lineWidth":this.cornerstoneTools_config.freehand_config.lineWidth=e.value;break;case"pdistance":this.cornerstoneTools_config.polygon_config.distance=e.value;break;case"pdeviation":this.cornerstoneTools_config.polygon_config.deviation=e.value;break;case"qdeviation":this.cornerstoneTools_config.quickselect_config.deviation=e.value}}},{key:"defaultFunction",value:function defaultFunction(funName,tooltype){tooltype&&(this.tooltype=tooltype);for(var j=0;j<this.sceen;j++)this.cornerstoneArray[j]&&(this.cornerstoneArray[j].moveAllElementData=null);if("restFan"!=funName&&"clearFan"!=funName&&"resizeCon"!=funName&&(this.controlename=funName),"regionpaintFan"!=funName&&"freehandFan"!=funName&&"polygonFan"!=funName&&"quickselectFan"!=funName||this.model.nidusChoose&&this.sequencelist.clickById(this.model.nidusChoose),"undefinedFan"==funName)return this.controlename=null,void this.disableAllTools(!0);if(funName){var now_config={};if(this.cornerstoneTools_config){var key=funName.replace("Fan","_config");now_config=this.cornerstoneTools_config[key]?this.cornerstoneTools_config[key]:{}}"earseFan"==funName&&(funName="brushFan"),"rectangle_textFan"==funName&&(funName="rectangleRoiFan"),"lineFan"==funName&&(funName="lengthFan"),this.setoolconfig.setconfig(funName,now_config),this.nowmpr&&this.nowmpr.defaultFunction(funName);for(var i=0;i<this.sceen;i++)if(this.cornerstoneArray[i]&&this.cornerstoneArray[i].getViewport())if(this.nowWWC[i]={c:this.cornerstoneArray[i].getViewport().voi.windowCenter,w:this.cornerstoneArray[i].getViewport().voi.windowWidth},"zoomFan"!=funName&&"wlFan"!=funName&&"brushFanTe"!=funName&&"restFan"!=funName&&"resizeCon"!=funName&&"clearFan"!=funName){var sid=this.cornerstoneArray[i].sId;if(!this.model.seriesInfo[sid].needAnno)return;eval("this.cornerstoneArray[i]."+funName+"()")}else eval("this.cornerstoneArray[i]."+funName+"()")}else this.disableAllTools(!0)}},{key:"disableAllTools",value:function(){for(var e=0;e<this.sceen;e++)this.cornerstoneArray[e]&&this.cornerstoneArray[e].disableAllTools(!0)}},{key:"lungWindown",value:function(e,n,t){null!=e&&null!=n||(e=128,n=256),this.nowWWC[this.choosescreen]={c:e,w:n},this.changeWWCImage(t),this.cornerstoneArray[this.choosescreen]&&(this.cornerstoneArray[this.choosescreen].lungWindown(e,n),this.nowWWC[this.choosescreen]={c:this.cornerstoneArray[this.choosescreen].getViewport().voi.windowCenter,w:this.cornerstoneArray[this.choosescreen].getViewport().voi.windowWidth})}},{key:"getSid",value:function(){return this.cornerstoneArray[this.choosescreen].sId}},{key:"showWWC",value:function(e,n,t){var o=e.windowCenter+e.windowWidth/2,i=e.windowCenter-e.windowWidth/2;if("DCM"!=this.imageType){var a=1*this.model.seriesInfo[n].info.wwc.low,r=1*this.model.seriesInfo[n].info.wwc.hight-1*this.model.seriesInfo[n].info.wwc.low;if(o=r*o/255+a,i=r*i/255+a,this.dom.find(".ct"+t+" .wwc").html()!="wc:"+Math.round((o+i)/2)+" ww:"+Math.round(o-i)){var s={};s.sId=this.cornerstoneArray[t].sId,s.wwc={c:Math.round((o+i)/2),w:Math.round(o-i)},this.event._dispatch("ctcornerstone.wlChange",s)}}this.dom.find(".ct"+t+" .wwc").html("wc:"+Math.round((o+i)/2)+" ww:"+Math.round(o-i))}},{key:"huValue",value:function(e){var n="X:"+e.point.x.toFixed(2)+"<br/>Y:"+e.point.y.toFixed(2),t=e.hu?"<br />CT值:"+e.hu.toFixed(2):"";this.dom.find(".ct"+e.id+" .infoXYZ").html(n+t)}},{key:"clearData",value:function(e){var n=this.cornerstoneArray[0].geSiglneState("probe"),t=this.cornerstoneArray[0].geSiglneState("length"),o=this.cornerstoneArray[0].geSiglneState("rectangleRoi"),i=this.cornerstoneArray[0].geSiglneState("ellipticalRoi"),a=this.cornerstoneArray[0].geSiglneState("simpleAngle");n&&this.toolDataClear(n.data,"probe",e),a&&this.toolDataClear(n.data,"simpleAngle",e),t&&this.toolDataClear(t.data,"length",e),o&&this.toolDataClear(o.data,"rectangleRoi",e),i&&this.toolDataClear(i.data,"ellipticalRoi",e)}},{key:"toolDataClear",value:function(e,n,t){var o=this;e.map(function(i){if("meas"==t){if(!i.uuid)return o.cornerstoneArray[0].clearSigleData(n,i),void o.toolDataClear(e,n,t)}else if(i.uuid)return o.cornerstoneArray[0].clearSigleData(n,i),void o.toolDataClear(e,n,t)})}},{key:"clearSigleFan",value:function(e){this.cornerstoneArray[0].clearSigleFan(e)}},{key:"claerAll",value:function(){this.drawInfo.removeAll(),this.clearLayer=[]}},{key:"close",value:function(){for(var e=0;e<this.sceen;e++)this.cornerstoneArray[e]&&this.cornerstoneArray[e].close();this.nodeShow=!0,this.hideMarkInfoClearNidusChoose(),this.brushManage.deleteAll(),this.cornerstoneArray=[]}},{key:"updateImageTagComponentData",value:function(e){var n=this,t=$(".sequencelist .nodeInfolist .choose"),o=t.length&&"IMAGE_TAG"===t.attr("tooltype");if(this.model.layerMarkImageAnnotation){var i=this.dom.find(".sequencelist .sequence-wrapper");if(i&&i.html()){this.model.imageAnnotationResultId="";var a=this.model.currentSeriesInfo.seriesInstanceUid,r=this.dom.find(".layer-mark-title .layer-mark-layernumber");r.dom&&r.html(e);var s=this.sequencelist.findNidusFromList(a,e,"IMAGE_TAG");if(!s||!s.attr("bid"))return this.nidusControlAll.clearAllLayerMarkChoosed(),void(o&&this.sequencelist.clearChoosed());this.model.imageAnnotationResultId=s.attr("bid"),0===t.length||o&&t.attr("layerinfo")!=e?(s.find(".nname").click(),this.sequencelist.scrollToChooseItem()):(!o||t.attr("layerinfo")!=e)&&this.setImageTagData(s)}else setTimeout(function(){n.updateImageTagComponentData(e)},1e3)}}},{key:"setImageTagData",value:function(e){e.attr("toolType"),e.attr("brushtype"),e.attr("sId");var n=e.attr("niddtype"),t=(e.attr("uuid"),e.attr("layerInfo"),e.attr("bid")),o=this.model.nidusComponentInfo[n]?Tool.objetClone(this.model.nidusComponentInfo[n]):null;o&&(o.annotationItemResultList=this.model.nidusComponentData[t]),this.nidusControlAll.setLayerMarkData(o)}},{key:"hideMarkInfoClearNidusChoose",value:function(){this.nidusControl&&this.nidusControl.isShow()&&this.nidusControl.hide(),this.sequencelist.clearChoosed()}},{key:"resize",value:function(){var e=ES.selctorDoc(window).box().clientWidth,n=ES.selctorDoc(window).box().clientHeight-60-64;if(this.dom.find(".ctcornerstone").css({width:e}),this.dom.find(".ctcornerstone .dicom_content").css({width:e-290-180,height:n-105}),this.dom.find(".ctcornerstone .mpr").css({width:e-290-180,height:n}),this.dom.find(".ctcornerstone .slist").css({width:e-290-180}),this.dom.find(".ctcornerstone .slist .sequence-body-parent").css({width:e-290-180}),this.dom.find(".ctcornerstone .xulielist").css({height:n}),this.dom.find(".ctcornerstone .info").css({height:n}),this.dom.find(".ctcornerstone .nidus_content").css({height:n}),this.sceen){var t=this.model.getLayout(this.sceen),o=(e-290-180)*t.w,i=void 0;i=this.makeStudy?(n-105)*t.h:n*t.h;for(var a=0;a<this.sceen;a++)this.dom.find("#ct"+a).css({width:o,height:i}),this.dom.find(".ct"+a).css({top:0==t.t?0:a>=this.sceen/2?i:0,left:0==t.t?a*o:a>=this.sceen/2?(a-this.sceen/2)*o:a*o}),this.dom.find(".ct"+a+" .image_progress").css({height:n}),this.cornerstoneArray[a]&&(this.defaultFunction("resizeCon"),this.crossOpen&&(this.calflow(a),this.crossArray[a]&&this.crossArray[a].setYHeight(i)),this.cornerstoneArray[a].progress.resize(this.nowLayNum(a)))}this.nowmpr&&this.nowmpr.resize(e-290-180,n),this.nidusControl&&this.nidusControl.resize(),this.nidusControlAll&&this.nidusControlAll.resize()}}]),ctcornerstone_base}(Interstellar.moduleBase);window.ctcornerstone_base=window.ctcornerstone_base||ctcornerstone_base,module.exports=ctcornerstone_base},1044:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".ctcornerstone {\n  width: 100%;\n  position: relative;\n}\n.ctcornerstone .dicom_content {\n  float: left;\n}\n.ctcornerstone .dicom_content .slideContainer {\n  width: 100%;\n  height: 50px;\n  position: absolute;\n  z-index: 100;\n  padding: 5px;\n  left: 10px;\n  bottom: 15px;\n}\n.ctcornerstone .dicom_content .slideContainer li {\n  display: inline-block;\n  width: 50px;\n  height: 100%;\n  margin-right: 5px;\n  cursor: pointer;\n  box-sizing: content-box;\n}\n.ctcornerstone .dicom_content .slideContainer li.active {\n  border: 2px solid #95d4e2;\n}\n.ctcornerstone .dicom_content .c_fbb03b {\n  position: absolute;\n  color: #D2EFFC;\n  border: 1px solid #fff;\n  box-sizing: border-box;\n}\n.ctcornerstone .dicom_content .c_fbb03b .layer {\n  color: #fff;\n  padding: 5px 5px;\n  border-radius: 2px;\n  z-index: 120;\n}\n.ctcornerstone .dicom_content .c_fbb03b .line {\n  position: absolute;\n  -webkit-touch-callout: none;\n  /* iOS Safari */\n  -webkit-user-select: none;\n  /* Chrome/Safari/Opera */\n  -khtml-user-select: none;\n  /* Konqueror */\n  -moz-user-select: none;\n  /* Firefox */\n  -ms-user-select: none;\n  /* Internet Explorer/Edge */\n  user-select: none;\n  width: 100%;\n  top: 0;\n  left: 0;\n}\n.ctcornerstone .dicom_content .c_fbb03b .wc-ww {\n  position: absolute;\n  right: 20px;\n  bottom: 80px;\n  z-index: 100;\n  text-align: right;\n}\n.ctcornerstone .dicom_content .c_fbb03b .sc {\n  color: #fff;\n  border-radius: 2px;\n  z-index: 120;\n}\n.ctcornerstone .dicom_content .c_fbb03b .wwc {\n  color: #fff;\n  border-radius: 2px;\n  z-index: 100;\n}\n.ctcornerstone .dicom_content .c_fbb03b .image_progress {\n  position: absolute;\n  right: 0px;\n  top: 0;\n  background: #000;\n  z-index: 130;\n}\n.ctcornerstone .dicom_content .c_fbb03b .infoXYZ {\n  position: absolute;\n  bottom: 80px;\n  left: 10px;\n  color: #fff;\n  border-radius: 2px;\n  z-index: 20;\n}\n.ctcornerstone .dicom_content .c_fbb03b .cal {\n  position: absolute;\n  top: 10px;\n  left: 30px;\n  color: #fff;\n  padding: 5px 5px;\n  border-radius: 2px;\n  background: #000;\n  z-index: 20;\n}\n.ctcornerstone .mpr {\n  position: absolute;\n  border: 1px dashed #000;\n  display: none;\n  background: transparent;\n  top: 0px;\n  left: 180px;\n  z-index: 2000;\n}\n.ctcornerstone .cicle {\n  position: fixed;\n  border: 1px dashed #000;\n  display: none;\n  background: transparent;\n  top: 0;\n  left: 0;\n  z-index: 1000;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  pointer-events: none;\n}\n.ctcornerstone .xulielist {\n  position: relative;\n  float: left;\n  width: 180px;\n  background: #0a2634;\n}\n.ctcornerstone .info {\n  float: left;\n  width: 290px;\n  background: #0a2634;\n}\n.ctcornerstone .nidus_content {\n  position: absolute;\n  width: 290px;\n  top: 0;\n  right: 0;\n  display: none;\n  z-index: 20;\n}\n.ctcornerstone .allcornerstone {\n  position: relative;\n}\n.ctcornerstone .slist {\n  position: absolute;\n  left: 180px;\n  bottom: 0;\n  height: 100px;\n}\n.ctcornerstone .submit_data {\n  width: 200px;\n  height: 30px;\n  position: absolute;\n  left: 50%;\n  margin-left: -100px;\n  background: #0a2634;\n  border-radius: 5px;\n  display: none;\n}\n.ctcornerstone .submit_data span {\n  font-size: 14px;\n  line-height: 30px;\n  color: #d2effc;\n}\n",""])},1045:function(e,n){e.exports='<div class=ctcornerstone> <div class=xulielist></div> <div class="dicom_content allcornerstone" oncontextmenu=return!1 unselectable=on onselectstart=return!1 onmousedown=return!1> </div> <div class=info></div> <div class=nidus_content></div> <div style=clear:both></div> <div class=slist></div> <div class=cicle unselectable=on onselectstart=return!1 onmousedown=return!1 onmouseover=return!1 onmousemove=return!1></div> <div class=mpr oncontextmenu=return!1 unselectable=on onselectstart=return!1 onmousedown=return!1></div> </div> <div style=clear:both></div> '},1046:function(e,n,t){"use strict";e.exports=new function(){return{rectangleRoi_config:{areaDisplayFlag:!1,nameDisplayFlag:!1,drawHandlesOnHover:!0},rectangle_text_config:{areaDisplayFlag:!0,nameDisplayFlag:!0,drawHandlesOnHover:!0},length_config:{flag:!1,nameDisplayFlag:!1,displayMean:!0,displayText:!1,drawHandlesOnHover:!0},line_config:{flag:!1,nameDisplayFlag:!0,displayMean:!0,displayText:!0,drawHandlesOnHover:!0},ellipticalRoi_config:{areaDisplayFlag:!1,nameDisplayFlag:!1,drawHandlesOnHover:!0},magnify_config:{magnifySize:225,magnificationLevel:2},brush_config:{draw:1,radius:5,hoverColor:"rgba(230, 25, 75, 1.0)",dragColor:"rgba(230, 25, 75, 0.8)"},earse_config:{draw:0,radius:3,hoverColor:"rgba(230, 25, 75, 1.0)",dragColor:"rgba(230, 25, 75, 0.8)"},polygon_config:{distance:5,radius:1,lineWidth:1,deviation:5,hoverColor:"rgba(230, 25, 75, 0.5)",dragColor:"rgba(230, 25, 75, 0.4)"},freehand_config:{distance:2,lineWidth:2,hoverColor:"rgba(230, 25, 75, 0.5)",dragColor:"rgba(230, 25, 75, 0.4)"},quickselect_config:{deviation:50,distance:20},regionpaint_config:{draw:1,radius:4,hoverColor:"rgba(230, 25, 75, 1.0)",dragColor:"rgba(230, 25, 75, 0.8)"}}}},1047:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return t(1048),r.html=t(1050),r.name="CtProgress",r.model={},r.valH=30,r.topValue=0,r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.moduleBase),o(n,[{key:"complete",value:function(){this.topValue=0;var e=null,n=!1,t=this;this.dom.find(".progress_val").on("mousedown",function(o){n=!0,e=o.pageY,t.event._dispatch("ctprogress.startDrag")}),this.dom.find(".progress").on("click",function(e){t.topValue=e.pageY-125,t.progressPos(),t.event._dispatch("ctprogress.click"),t.event._dispatch("ctprogress.stopDrag")}),this.dom.on("mousemove",function(o){if(n)t.topValue+=o.pageY-e,e=o.pageY,t.progressPos();else{var i=o.pageY-125;t.dom.find(".layer-number").css({transform:"translate(0px, "+i+"px)"}),t.dom.find(".layer-number").show();var a=Math.floor(i/(t.totalHeight-t.barHeight)*(t.totalImage-1));a=a>t.totalImage-1?t.totalImage-1:a,t.dom.find(".layer-number").html(t.imageLists[a])}}),this.dom.on("mouseup",function(e){e.stopPropagation(),t.dom.find(".layer-number").hide(),n=!1,t.event._dispatch("ctprogress.stopDrag")}),this.dom.on("mouseleave",function(e){e.stopPropagation(),t.dom.find(".layer-number").hide(),n=!1,t.event._dispatch("ctprogress.stopDrag")}),this.dom.find(".progress").on("mouseleave",function(){t.dom.find(".layer-number").hide(),n=!1,t.event._dispatch("ctprogress.stopDrag")})}},{key:"progressPos",value:function(){this.topValue+this.barHeight>this.totalHeight&&(this.topValue=this.totalHeight-this.barHeight),this.dom.find(".progress_val").css({transform:"translate(0px, "+this.topValue+"px)"})}},{key:"setPosBar",value:function(e){if(1!=this.totalImage){var n=this.imageLists.lastIndexOf(e);this.topValue=-1==n?0:Math.floor(n/(this.totalImage-1)*(this.totalHeight-this.barHeight)),this.progressPos()}else this.dom.find(".progress_val").css({transform:"translate(0px, 0px)"})}},{key:"setBarHeight",value:function(){this.totalImage<50&&(this.valH=1);var e=this.valH/this.totalImage;this.totalHeight=this.dom.find(".progress").box().offsetHeight,this.barHeight=Math.floor(e*this.totalHeight/(1+e)),this.dom.find(".progress_val").css({height:this.barHeight})}},{key:"setImageData",value:function(e){this.imageLists=e,this.totalImage=e.length,this.setBarHeight()}},{key:"getRate",value:function(){var e=Math.floor(this.topValue/(this.totalHeight-this.barHeight)*(this.totalImage-1));return e=e>this.totalImage-1?this.totalImage-1:e,console.log(this.imageLists[e],e),this.imageLists[e]}},{key:"close",value:function(){this.dom.find(".progress_val").off("mousedown"),this.dom.off("mousemove"),this.dom.off("mouseup"),this.dom.find(".progress").off("mousemove")}},{key:"resize",value:function(e){this.setBarHeight(),this.setPosBar(e)}}]),n}();e.exports=i},1048:function(e,n,t){var o=t(1049);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1049:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".ctprogress {\n  position: relative;\n  height: 100%;\n  -webkit-touch-callout: none;\n  /* iOS Safari */\n  -webkit-user-select: none;\n  /* Chrome/Safari/Opera */\n  -khtml-user-select: none;\n  /* Konqueror */\n  -moz-user-select: none;\n  /* Firefox */\n  -ms-user-select: none;\n  /* Internet Explorer/Edge */\n  user-select: none;\n}\n.ctprogress .progress {\n  position: absolute;\n  width: 10px;\n  height: 100%;\n  right: 0;\n  top: 0px;\n  margin: 0;\n  left: auto;\n  background: #01111E;\n}\n.ctprogress .progress .progress_val {\n  position: absolute;\n  left: 0;\n  top: 0;\n  border-radius: 14px;\n  height: 0;\n  width: 6px;\n  background: #448E97;\n}\n.ctprogress .progress .layer-number {\n  position: absolute;\n  display: none;\n  left: -30px;\n  top: 0;\n  border-radius: 14px;\n  height: 0;\n  width: 6px;\n  color: #fff;\n  background: #448E97;\n  -webkit-touch-callout: none;\n  /* iOS Safari */\n  -webkit-user-select: none;\n  /* Chrome/Safari/Opera */\n  -khtml-user-select: none;\n  /* Konqueror */\n  -moz-user-select: none;\n  /* Firefox */\n  -ms-user-select: none;\n  /* Internet Explorer/Edge */\n  user-select: none;\n}\n",""])},1050:function(e,n){e.exports="<div class=ctprogress> <div class=progress> <div class=progress_val></div> <div class=layer-number></div> </div> </div>"},1051:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return o(e,[{key:"init",value:function(){this.brushInfo={},this.brushIdInfo={},this.brushlength=0,this.aplha=140,this.colorMap={AA1113:[170,17,19,this.aplha],F5A623:[245,166,35,this.aplha],F8E71C:[248,231,28,this.aplha],"7ED321":[126,211,33,this.aplha],"4A90E2":[74,144,226,this.aplha],"50E3C2":[80,227,194,this.aplha],"8B572A":[139,87,42,this.aplha],417505:[65,117,5,this.aplha],B8E986:[184,233,134,this.aplha],BD10E0:[189,16,224,this.aplha]}}},{key:"delbrush",value:function(e){for(var n in this.brushInfo)this.brushInfo[n][e.bid||e.uuid]&&delete this.brushInfo[n][e.bid||e.uuid],this.brushInfo[n][e.uuid]&&delete this.brushInfo[n][e.uuid]}},{key:"getPixTotal",value:function(e,n){console.log(e,this.brushIdInfo);var t=0;if(this.brushIdInfo[e]){var o=!0,i=!1,a=void 0;try{for(var r,s=this.brushIdInfo[e].layerLists[Symbol.iterator]();!(o=(r=s.next()).done);o=!0){var l=r.value;t+=this.brushInfo[l][e].orginimage.length}}catch(e){i=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}return t}if(this.brushIdInfo[n]){var d=!0,c=!1,u=void 0;try{for(var h,m=this.brushIdInfo[n].layerLists[Symbol.iterator]();!(d=(h=m.next()).done);d=!0){var f=h.value;t+=this.brushInfo[f][n].orginimage.length}}catch(e){c=!0,u=e}finally{try{!d&&m.return&&m.return()}finally{if(c)throw u}}return t}return t}},{key:"brushIdInfoSet",value:function(e,n){this.brushIdInfo=this.brushIdInfo?this.brushIdInfo:{},this.brushIdInfo[e]||(this.brushIdInfo[e]={layerLists:[]}),this.brushIdInfo[e].layerLists.push(n);var t=[],o={},i=!0,a=!1,r=void 0;try{for(var s,l=this.brushIdInfo[e].layerLists[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var d=s.value;o[d]||(t.push(d),o[d]=1)}}catch(e){a=!0,r=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw r}}this.brushIdInfo[e].layerLists=t}},{key:"creatBrushInfoData",value:function(e,n){this.brushInfo[e]||(this.brushInfo[e]={}),this.brushInfo[e][n]||(this.brushInfo[e][n]={})}},{key:"setBrush",value:function(e,n,t,o,i,a){this.brushInfo[e]||(this.brushInfo[e]={});var r=i;i||(r=Tool.getSigleId(),this.brushInfo[e][r]={}),this.brushInfo[e][r]||(this.brushInfo[e][r]={});var s=this.getroundpoint(n,t);return 0==t&&(s=n),this.brushIdInfoSet(r,e),this.brushInfo[e][r].image=this.creatImage(s,e,r,!0,o),this.brushInfo[e][r].uuid=r,this.brushInfo[e][r].sId=a,this.brushInfo[e][r].show=!0,this.brushInfo[e][r].fill=void 0==this.brushInfo[e][r].fill||this.brushInfo[e][r].fill,this.brushInfo[e][r].color=this.brushInfo[e][r].color?this.brushInfo[e][r].color:this.colorMap.AA1113,this.brushInfo[e][r]}},{key:"creatBrush",value:function(e,n,t,o,i){this.brushInfo[e]||(this.brushInfo[e]={});var a=t||Tool.getSigleId();this.brushInfo[e][a]||(this.brushInfo[e][a]={}),this.brushIdInfoSet(a,e),this.brushInfo[e][a].orginimage=[];var r=document.createElement("canvas");r.width=i.w,r.height=i.h;for(var s=r.getContext("2d"),l=s.getImageData(0,0,r.width,r.height),d=0;d<n.length;d++){var c=n[d];this.brushInfo[e][a].orginimage.push(c),l.data[4*c]=0,l.data[4*c+1]=200,l.data[4*c+2]=0,l.data[4*c+3]=this.aplha}s.putImageData(l,0,0);var u=new Image;return u.src=r.toDataURL("image/png"),s=null,r=null,l=null,this.brushInfo[e][a].image=u,this.brushInfo[e][a].uuid=a,this.brushInfo[e][a].sId=o,this.brushInfo[e][a].color=this.colorMap.AA1113,this.brushInfo[e][a].show=!0,this.brushInfo[e][a].fill=void 0==this.brushInfo[e][a].fill||this.brushInfo[e][a].fill,this.brushInfo[e][a]}},{key:"getInfo",value:function(e){return console.log(this.brushInfo),this.brushInfo[e.layerNumber]?this.brushInfo[e.layerNumber][e.bid]?this.brushInfo[e.layerNumber][e.bid]:this.brushInfo[e.layerNumber][e.uuid]?this.brushInfo[e.layerNumber][e.uuid]:void 0:null}},{key:"updataInfo",value:function(e){for(var n=0;n<e.length;n++)this.brushInfo[e[n].layerNumber][e[n].id].imgurl=e[n].imgurl}},{key:"removeBrush",value:function(e,n,t,o,i){if(this.brushInfo[e]&&i){console.log(this.brushInfo,"================",e,i);var a=this.getroundpoint(n,t);return this.brushInfo[e][i].image=this.creatImage(a,e,i,!1,o),this.brushInfo[e][i]}}},{key:"creatNewImage",value:function(e,n,t,o,i){var a=this;this.brushlength=this.brushlength<1*o?1*o:this.brushlength;var r=1;console.log(n.needScale),n.needScale&&(r=.5);var s=document.createElement("canvas");s.width=t.width*r,s.height=t.height*r;var l=s.getContext("2d");l.drawImage(e,0,0,t.width,t.height,0,0,s.width,s.height);for(var d=n.id,c=l.getImageData(0,0,s.width,s.height),u=this.colorMap.AA1113,h=[],m=0;m<c.data.length/4;m++)0!=c.data[4*m+3]&&(h.push(m),c.data[4*m]=u[0],c.data[4*m+1]=u[1],c.data[4*m+2]=u[2],c.data[4*m+3]=u[3]);l.putImageData(c,0,0);var f=new Image;f.src=s.toDataURL("image/png"),l=null,s=null,c=null,this.brushInfo[o]||(this.brushInfo[o]={}),this.brushInfo[o][d]||(this.brushInfo[o][d]={}),this.brushIdInfoSet(d,o),this.brushInfo[o][d].num=o,this.brushInfo[o][d].id=d,this.brushInfo[o][d].rid=n.rid,this.brushInfo[o][d].sId=n.sId,this.brushInfo[o][d].image=f,this.brushInfo[o][d].color=this.colorMap.AA1113,this.brushInfo[o][d].fill=!0,this.brushInfo[o][d].show=!0,this.brushInfo[o][d].orginimage=h,i==d&&setTimeout(function(){a.brushInfo[o][d].image=a.resetColor(a.brushInfo[o][d].orginimage,[0,200,0,a.aplha],a.brushInfo[o][d].fill,a.brushInfo[o][d].image)},20),this.brushInfo[o][d].orginimage=h}},{key:"creatImage",value:function(e,n,t,o,i){var a=this,r=document.createElement("canvas");r.width=i.w||512,r.height=i.h||512;var s=r.getContext("2d"),l=void 0,d=[0,200,0,this.aplha];o||(d=[255,255,255,0]),console.log(t,n,this.brushInfo),this.brushInfo[n][t].image?(r.width=this.brushInfo[n][t].image.width,r.height=this.brushInfo[n][t].image.height,l=s.getImageData(0,0,r.width,r.height),this.brushInfo[n][t].orginimage.map(function(e){l.data[4*e]=0,l.data[4*e+1]=200,l.data[4*e+2]=0,l.data[4*e+3]=a.aplha})):l=s.getImageData(0,0,r.width,r.height),console.log(e,"dklsjdklajdlkasjd"),this.calPoint(e,l,i.w,d),s.putImageData(l,0,0);var c=new Image;c.src=r.toDataURL("image/png"),s=null,r=null,this.brushInfo[n][t].orginimage=[];for(var u=0;u<l.data.length/4;u++)0!=l.data[4*u+3]&&this.brushInfo[n][t].orginimage.push(u);return l=null,this.brushInfo[n][t].image=c,c}},{key:"calPoint",value:function(e,n,t,o){for(var i=e.length,a=0;a<i;a++){var r=4*(1*e[a].x+e[a].y*t);n.data[r+3]==o[3]&&0==o[3]||(n.data[r]=o[0],n.data[r+1]=o[1],n.data[r+2]=o[2],n.data[r+3]=o[3])}}},{key:"doneSingleChange",value:function(e,n,t){if("color"!=t||e.uuid!=n.uuid){console.log(this.brushIdInfo);n.bid||n.uuid;e.uuid==n.uuid?this.changeColorById(n.bid,n.uuid,[0,200,0,this.aplha]):this.changeColorById(n.bid,n.uuid)}}},{key:"restChooseColor",value:function(e,n){if(console.log((new Date).getTime()),e){var t=e.bid;t&&this.changeColorById(t,e.uuid,[0,200,0,this.aplha])}if(n){var o=n.bid;o&&this.changeColorById(o,n.uuid)}console.log((new Date).getTime())}},{key:"changeColorById",value:function(e,n,t){console.log(this.brushIdInfo,e,n);var o=e;if(this.brushIdInfo){if(this.brushIdInfo[e]&&(o=e),this.brushIdInfo[n]&&(o=n),console.log(o,this.brushIdInfo[o]),this.brushIdInfo[o]){var i=!0,a=!1,r=void 0;try{for(var s,l=this.brushIdInfo[o].layerLists[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var d=s.value,c=this.brushInfo[d][o];console.log(c.fill,"brushInfoLayer.fillbrushInfoLayer.fillbrushInfoLayer.fill"),c.image=this.resetColor(c.orginimage,t||c.color,c.fill,c.image)}}catch(e){a=!0,r=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw r}}}}else this.brushIdInfo={}}},{key:"resetColor",value:function(e,n,t,o){if(0!=o.width){var i=document.createElement("canvas");i.width=o.width,i.height=o.height;var a=i.getContext("2d"),r=a.getImageData(0,0,o.width,o.height),s=n||[0,200,0,this.aplha],l={},d=!0,c=!1,u=void 0;try{for(var h,m=e[Symbol.iterator]();!(d=(h=m.next()).done);d=!0){var f=h.value;l[f]||(l[f]=1)}}catch(e){c=!0,u=e}finally{try{!d&&m.return&&m.return()}finally{if(c)throw u}}for(var p=0;p<e.length;p++){var g=4*e[p];if(r.data[g]=s[0],r.data[g+1]=s[1],r.data[g+2]=s[2],r.data[g+3]=s[3],0==t)this.fourpd(e[p],l,o.width,o.height)||(r.data[g+3]=0)}a.putImageData(r,0,0);var v=new Image;return v.src=i.toDataURL("image/png"),a=null,i=null,r=null,v}}},{key:"fourpd",value:function(e,n,t,o){var i=Math.floor((e-t)/t),a=e%t==t-1?null:e+1,r=e%t==0?null:e-1,s=Math.floor((e+t)/t),l=0;return i<0||s>o||!a||!r||(n[String(e-t)]&&l++,n[String(e+t)]&&l++,n[String(a)]&&l++,n[String(r)]&&l++,4!=l)}},{key:"restSignleId",value:function(e){for(var n in this.brushInfo)for(var t in this.brushInfo[n])t!=e.bid&&t!=e.uuid||(this.brushInfo[n][t].color=this.colorMap[e.color])}},{key:"restSignleIdFill",value:function(e){for(var n in this.brushInfo)for(var t in this.brushInfo[n])t!=e.bid&&t!=e.uuid||(this.brushInfo[n][t].fill=e.fill)}},{key:"restSignleIdShow",value:function(e){for(var n in this.brushInfo)for(var t in this.brushInfo[n])t!=e.bid&&t!=e.uuid||(this.brushInfo[n][t].show=e.show)}},{key:"allShow",value:function(e){for(var n in this.brushInfo)for(var t in this.brushInfo[n])this.brushInfo[n][t].show=e.show}},{key:"clearBrush",value:function(e){this.brushInfo[e]=null}},{key:"deleteAll",value:function(){this.brushInfo={},this.brushIdInfo=null}},{key:"getroundpoint",value:function(e,n){for(var t=[],o=Math.round(e.x-n),i=Math.round(e.y-n),a=2*n,r=a*a,s=0;s<r;s++){var l=o+Math.floor(s%a),d=i+Math.floor(s/a);(l-e.x)*(l-e.x)+(d-e.y)*(d-e.y)<=n*n&&t.push({x:l,y:d})}return t}}]),e}();e.exports=new i},1052:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"setconfig",value:function(e,n){var t=void 0;switch(e){case"rectangleRoiFan":var o=cornerstoneTools.rectangleRoi.getConfiguration();o&&(n=Object.assign(o,n)),cornerstoneTools.rectangleRoi.setConfiguration(n);break;case"lengthFan":var i=cornerstoneTools.length.getConfiguration();i&&(n=Object.assign(i,n)),cornerstoneTools.length.setConfiguration(n);break;case"brushFan":var a=cornerstoneTools.brush.getConfiguration();a&&(n=Object.assign(a,n)),cornerstoneTools.brush.setConfiguration(n);break;case"ellipticalRoiFan":var r=cornerstoneTools.ellipticalRoi.getConfiguration();r&&(n=Object.assign(r,n)),cornerstoneTools.ellipticalRoi.setConfiguration(n);break;case"polygonFan":case"freehandFan":case"regionpaintFan":(t=cornerstoneTools.brush.getConfiguration())&&(n=Object.assign(t,n)),cornerstoneTools.brush.setConfiguration(n)}}}]),e}();e.exports=new i},1053:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(){function e(n){if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),n.referent.imageOrientationPatient=e.backImageOrientationPatient(n.referent.imageOrientationPatient),n.convert.imageOrientationPatient=e.backImageOrientationPatient(n.convert.imageOrientationPatient),n.convert.imageOrientationPatient.toString()==n.referent.imageOrientationPatient.toString())return[];var t=e.makeMetix(n.referent),o=t.AInverse(),i=e.getPoint(n.referent),a=e.getPoint(n.convert),r=a.a,s=a.b,l=a.c,d=a.d,c=e.getfourline(i.pointAll),u=[];for(var h in c)u.push(e.getlineIntersection(c[h],r,s,l,d));for(var m=[],f=[],p=e.getMaxMin(i.pointAll),g=0;g<u.length;g++){var v=void 0,y=void 0;if(o){var b=o.multiply([[u[g].x,u[g].y,u[g].z]]);v=Math.round(b.orgin[0]/b.orgin[2]),y=Math.round(b.orgin[1]/b.orgin[2])}else{var w=void 0;0==u[g].x&&(w=new Metix([t.orgin[1][0],t.orgin[1][1],t.orgin[2][0],t.orgin[2][1]],2,2).AInverse().multiply([[u[g].y-t.orgin[1][2],u[g].z-t.orgin[2][2]]])),0==u[g].y&&(w=new Metix([t.orgin[0][0],t.orgin[0][1],t.orgin[2][0],t.orgin[2][1]],2,2).AInverse().multiply([[u[g].x-t.orgin[0][2],u[g].z-t.orgin[2][2]]])),0==u[g].z&&(w=new Metix([t.orgin[0][0],t.orgin[0][1],t.orgin[1][0],t.orgin[1][1]],2,2).AInverse().multiply([[u[g].x-t.orgin[0][2],u[g].y-t.orgin[1][2]]])),w&&(m.push({x:w.orgin[0][0],y:w.orgin[1][0]}),f.push({x:u[g].x,y:u[g].y,z:u[g].z}))}v>=0&&v<=n.referent.width&&y>=0&&y<=n.referent.height&&(m.push({x:v,y:y}),f.push({x:u[g].x,y:u[g].y,z:u[g].z}))}if(2==m.length){var I=Math.max(f[0].x,f[1].x),x=Math.min(f[0].x,f[1].x),_=Math.max(f[0].y,f[1].y),k=Math.min(f[0].y,f[1].y),C=Math.max(f[0].z,f[1].z),A=Math.min(f[0].z,f[1].z);return I<p.x.min||x>p.x.max?[]:_<p.y.min||k>p.y.max?[]:C<p.z.min||A>p.z.max?[]:m}return[]}return o(e,null,[{key:"getMaxMin",value:function(n){var t=e.getXYZ(n.lt),o=e.getXYZ(n.rt),i=e.getXYZ(n.lb),a=e.getXYZ(n.rb),r={};for(var s in t)r[s]={},r[s].max=Math.max(t[s],o[s],i[s],a[s]),r[s].min=Math.min(t[s],o[s],i[s],a[s]);return r}},{key:"getlineIntersection",value:function(e,n,t,o,i){var a=e.x[0],r=e.x[1],s=e.y[0],l=e.y[1],d=e.z[0],c=e.z[1],u=(n*a+t*s+o*d+i)/(n*r+t*l+o*c);return{x:a-r*u,y:s-l*u,z:d-c*u}}},{key:"getfourline",value:function(n){var t=e.getXYZ(n.lt),o=e.getXYZ(n.rt),i=e.getXYZ(n.lb),a=e.getXYZ(n.rb);return{l1:e.getlineEquation(t,o),l2:e.getlineEquation(o,a),l3:e.getlineEquation(a,i),l4:e.getlineEquation(i,t)}}},{key:"getlineEquation",value:function(e,n){return{x:[e.x,n.x-e.x],y:[e.y,n.y-e.y],z:[e.z,n.z-e.z]}}},{key:"getPoint",value:function(n){var t=e.makeMetix(n),o=[[n.width,0,1]],i=[[n.width,n.height,1]],a=[[0,n.height,1]],r={lt:t.multiply([[0,0,1]]).orgin,rt:t.multiply(o).orgin,lb:t.multiply(a).orgin,rb:t.multiply(i).orgin},s=e.getXYZ(r.lt),l=e.getXYZ(r.rt),d=e.getXYZ(r.lb);return{a:s.y*(l.z-d.z)+l.y*(d.z-s.z)+d.y*(s.z-l.z),b:s.z*(l.x-d.x)+l.z*(d.x-s.x)+d.z*(s.x-l.x),c:s.x*(l.y-d.y)+l.x*(d.y-s.y)+d.x*(s.y-l.y),d:-s.x*(l.y*d.z-d.y*l.z)-l.x*(d.y*s.z-s.y*d.z)-d.x*(s.y*l.z-l.y*s.z),pointAll:r}}},{key:"getXYZ",value:function(e){return{x:e[0][0],y:e[1][0],z:e[2][0]}}},{key:"makeMetix",value:function(e){var n=e.imageOrientationPatient,t=e.imagePositionPatient.split(","),o=e.pixelSpacing.split(",");return new Metix([n[0]*o[0],n[3]*o[0],t[0],n[1]*o[0],n[4]*o[0],t[1],n[2]*o[0],n[5]*o[0],t[2]],3,3)}},{key:"backImageOrientationPatient",value:function(e){for(var n=e.split(","),t=0;t<n.length;t++)n[t]=Math.floor(2e3*n[t])/2e3;return n}}]),e}();e.exports=i},1054:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(){function e(n){if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),!n)return this;n.referent.imageOrientationPatient=e.backImageOrientationPatient(n.referent.imageOrientationPatient),n.convert.imageOrientationPatient=e.backImageOrientationPatient(n.convert.imageOrientationPatient);var t=e.makeMetix(n.referent),o=e.makeMetix(n.convert),i=new Metix([n.referent.x,n.referent.y,1],3,1).transpose().orgin,a=t.multiply(i),r=e.getPoint(n.convert);return{nowXYZ:a,dis:Math.abs(r.a*a.orgin[0][0]+r.b*a.orgin[1][0]+r.c*a.orgin[2][0]+r.d)/Math.pow(r.a*r.a+r.b*r.b+r.c*r.c,.5),convertF:r,convert:o}}return o(e,[{key:"getSagPoint",value:function(n){if(!n.convert.AInverse()){var t=void 0;return 0==n.nowXYZ.orgin[0][0]&&(t=new Metix([n.convert.orgin[1][0],n.convert.orgin[1][1],n.convert.orgin[2][0],n.convert.orgin[2][1]],2,2).AInverse().multiply([[n.nowXYZ.orgin[1][0]-n.convert.orgin[1][2],n.nowXYZ.orgin[2][0]-n.convert.orgin[2][2]]])),0==n.nowXYZ.orgin[1][0]&&(t=new Metix([n.convert.orgin[0][0],n.convert.orgin[0][1],n.convert.orgin[2][0],n.convert.orgin[2][1]],2,2).AInverse().multiply([[n.nowXYZ.orgin[0][0]-n.convert.orgin[0][2],n.nowXYZ.orgin[2][0]-n.convert.orgin[2][2]]])),0==n.nowXYZ.orgin[2][0]&&(t=new Metix([n.convert.orgin[0][0],n.convert.orgin[0][1],n.convert.orgin[1][0],n.convert.orgin[1][1]],2,2).AInverse().multiply([[n.nowXYZ.orgin[0][0]-n.convert.orgin[0][2],n.nowXYZ.orgin[1][0]-n.convert.orgin[1][2]]])),t?{x:t.orgin[0][0],y:t.orgin[1][0]}:null}if(0==Math.floor(n.dis)){var o=n.convert.AInverse().multiply(n.nowXYZ.transpose().orgin);return{x:o.orgin[0]/o.orgin[2],y:o.orgin[1]/o.orgin[2]}}var i=n.convertF.pointAll,a=e.getXYZ(i.lt),r=e.getXYZ(i.rt),s=e.getXYZ(i.lb),l=new Metix([r.x-a.x,r.y-a.y,r.z-a.z,s.x-a.x,s.y-a.y,s.z-a.z,n.convertF.a/n.convertF.d,n.convertF.b/n.convertF.d,n.convertF.c/n.convertF.d],3,3),d=n.nowXYZ.orgin[0][0],c=n.nowXYZ.orgin[1][0],u=n.nowXYZ.orgin[2][0],h=d*(r.x-a.x)+c*(r.y-a.y)+u*(r.z-a.z),m=d*(s.x-a.x)+c*(s.y-a.y)+u*(s.z-a.z),f=new Metix([h,m,-1],3,1),p=l.AInverse().multiply(f.transpose().orgin),g=n.convert.AInverse().multiply(p.transpose().orgin);return{x:g.orgin[0]/g.orgin[2],y:g.orgin[1]/g.orgin[2]}}}],[{key:"getPoint",value:function(n){var t=e.makeMetix(n),o=[[n.width,0,1]],i=[[n.width,n.height,1]],a=[[0,n.height,1]],r={lt:t.multiply([[0,0,1]]).orgin,rt:t.multiply(o).orgin,lb:t.multiply(a).orgin,rb:t.multiply(i).orgin},s=e.getXYZ(r.lt),l=e.getXYZ(r.rt),d=e.getXYZ(r.lb);return{a:s.y*(l.z-d.z)+l.y*(d.z-s.z)+d.y*(s.z-l.z),b:s.z*(l.x-d.x)+l.z*(d.x-s.x)+d.z*(s.x-l.x),c:s.x*(l.y-d.y)+l.x*(d.y-s.y)+d.x*(s.y-l.y),d:-s.x*(l.y*d.z-d.y*l.z)-l.x*(d.y*s.z-s.y*d.z)-d.x*(s.y*l.z-l.y*s.z),pointAll:r}}},{key:"getXYZ",value:function(e){return{x:e[0][0],y:e[1][0],z:e[2][0]}}},{key:"backImageOrientationPatient",value:function(e){for(var n=e.split(","),t=0;t<n.length;t++)n[t]=Math.floor(2e3*n[t])/2e3;return n}},{key:"makeMetix",value:function(e){var n=e.imageOrientationPatient,t=e.imagePositionPatient.split(","),o=e.pixelSpacing.split(",");return new Metix([n[0]*o[0],n[3]*o[0],t[0],n[1]*o[0],n[4]*o[0],t[1],n[2]*o[0],n[5]*o[0],t[2]],3,3)}}]),e}();e.exports=i},1055:function(e,n,t){"use strict";function o(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function o(i,a){try{var r=n[i](a),s=r.value}catch(e){return void t(e)}if(!r.done)return Promise.resolve(s).then(function(e){o("next",e)},function(e){o("throw",e)});e(s)}("next")})}}cornerstoneWADOImageLoader.external.cornerstone=cornerstone,cornerstone.registerImageLoader("myImageLoader",function(e){var n=void 0,t=void 0,o=void 0,i={imageId:e,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:256,render:cornerstone.renderWebImage,getPixelData:function(){return n},setPixelData:function(){return o},getCanvas:function(){return t},getImage:function(){return o},rows:512,columns:512,height:512,width:512,Wretched:!1,rate:1,color:!0,rgba:!1,columnPixelSpacing:1,rowPixelSpacing:1,invert:!1,sizeInBytes:1048576};return{promise:new Promise(function(a,r){var s=document.createElement("CANVAS");t=s;var l=new Image;l.crossOrigin="anonymous",l.onload=function(){o=this,(this.width>2e3||this.height>2e3)&&"DCM"==window.fileTypeName&&(i.rate=.5,i.Wretched=!0),i.columns=i.width=Math.floor(this.width*i.rate),i.rows=i.height=Math.floor(this.height*i.rate),i.sizeInBytes=i.width*i.height*4,s.setAttribute("width",i.width),s.setAttribute("height",i.height);var e=s.getContext("2d");e.drawImage(this,0,0,this.width,this.height,0,0,i.width,i.height);var t=e.getImageData(0,0,i.width,i.height).data;n=t,a(i)},i.onerror=function(){that.event._dispatch("ctcornerstone.imgloadError",{src:l.src})},l.src=e.replace("myImageLoader:","")}),cancelFn:void 0}}),cornerstone.registerImageLoader("glayImage",function(e){var n=void 0,t=void 0,o=void 0,i={imageId:e,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:256,render:cornerstone.renderWebImage,getPixelData:function(){return n},setPixelData:function(){return o},getCanvas:function(){return t},getImage:function(){return o},rows:512,columns:512,height:512,width:512,Wretched:!1,rate:1,color:!0,rgba:!1,columnPixelSpacing:1,rowPixelSpacing:1,invert:!1,sizeInBytes:1048576};return{promise:new Promise(function(a,r){var s=document.createElement("CANVAS");t=s;var l=s.getContext("2d"),d=1*e.replace("glayImage:","").match(/\d{1,}/g)[0],c=e.replace("glayImage:","").match(/[a-z]{1,}/g)[0],u=window.depth/window.targetInfo.rowPixelSpacing;u=u<1?1:u;var h=window.depth/window.targetInfo.columnPixelSpacing;h=h<1?1:h;var m=void 0;switch(c){case"x":i.columns=i.width=window.imageList[0].length,i.rows=i.height=Math.round(window.imageList.length*h),console.log(h),s.setAttribute("width",i.width),s.setAttribute("height",i.height),m=l.getImageData(0,0,i.width,i.height);for(var f=0;f<i.height;f++)for(var p=0;p<i.width;p++){var g=Math.floor(f/h),v=f*i.width+p;m.data[4*v]=window.imageList[g][p][d],m.data[4*v+1]=window.imageList[g][p][d],m.data[4*v+2]=window.imageList[g][p][d],m.data[4*v+3]=255}break;case"y":i.columns=i.width=window.imageList[0][0].length,i.rows=i.height=Math.round(window.imageList.length*u),s.setAttribute("width",i.width),s.setAttribute("height",i.height),m=l.getImageData(0,0,i.width,i.height);for(var y=0;y<i.height;y++)for(var b=0;b<i.width;b++){var w=Math.floor(y/u),I=y*i.width+b;m.data[4*I]=window.imageList[w][d][b],m.data[4*I+1]=window.imageList[w][d][b],m.data[4*I+2]=window.imageList[w][d][b],m.data[4*I+3]=255}break;case"z":i.columns=i.width=window.imageList[0][0].length,i.rows=i.height=window.imageList[0].length,s.setAttribute("width",i.width),s.setAttribute("height",i.height),m=l.getImageData(0,0,i.width,i.height);for(var x=0;x<i.height;x++)for(var _=0;_<i.width;_++){var k=x*i.width+_;m.data[4*k]=window.imageList[d][x][_],m.data[4*k+1]=window.imageList[d][x][_],m.data[4*k+2]=window.imageList[d][x][_],m.data[4*k+3]=255}}l.putImageData(m,0,0);var C=new Image;C.src=s.toDataURL("image/jpeg"),C.crossOrigin="anonymous",C.onload=function(){o=this,i.columns=i.width=this.width,i.rows=i.height=this.height,i.sizeInBytes=i.width*i.height*4,s.setAttribute("width",i.width),s.setAttribute("height",i.height),(l=s.getContext("2d")).drawImage(this,0,0);var e=l.getImageData(0,0,i.width,i.height).data;n=e,a(i)},i.onerror=function(){that.event._dispatch("ctcornerstone.imgloadError",{src:C.src})},m=null}),cancelFn:void 0}}),cornerstone.registerImageLoader("pixImage",function(e){var n=void 0,t=void 0,o=void 0,i={imageId:e,minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:128,windowWidth:256,render:cornerstone.renderWebImage,getPixelData:function(){return console.log(n,"pixelDatapixelDatapixelDatapixelData"),n},setPixelData:function(){return o},getCanvas:function(){return t},getImage:function(){return o},rows:512,columns:512,height:512,width:512,Wretched:!1,rate:1,color:!0,rgba:!1,columnPixelSpacing:1,rowPixelSpacing:1,invert:!1,sizeInBytes:1048576};return{promise:new Promise(function(a,r){var s=document.createElement("CANVAS");t=s;var l=s.getContext("2d"),d=1*e.replace("pixImage:","").match(/\d{1,}/g)[0],c=e.replace("pixImage:","").match(/[a-z]{1,}/g)[0],u=void 0,h=1*window.targetInfo.wc-1*window.targetInfo.ww/2,m=1*window.targetInfo.wc+1*window.targetInfo.ww/2;h=window.targetInfo.min<h?h:window.targetInfo.min,m=window.targetInfo.max>m?m:window.targetInfo.max;var f=window.depth/window.targetInfo.rowPixelSpacing,p=window.depth/window.targetInfo.columnPixelSpacing;switch(p=p<1?1:p,f=f<1?1:f,console.log(f,p),c){case"x":i.columns=i.width=window.imageList[0].length,i.rows=i.height=Math.round(window.imageList.length*p),s.setAttribute("width",i.width),s.setAttribute("height",i.height),console.log(i.height,i.width),u=l.getImageData(0,0,i.width,i.height);for(var g=0;g<i.height;g++)for(var v=0;v<i.width;v++){var y=Math.floor(g/p),b=g*i.width+v,w=window.imageList[y][v][d]<h?h:window.imageList[y][v][d];w=w>m?m:w,w=Math.floor(255*(w-h)/(m-h)),u.data[4*b+2]=u.data[4*b+1]=u.data[4*b]=w,u.data[4*b+3]=255}break;case"y":i.columns=i.width=window.imageList[0][0].length,i.rows=i.height=Math.round(window.imageList.length*f),s.setAttribute("width",i.width),s.setAttribute("height",i.height),u=l.getImageData(0,0,i.width,i.height);for(var I=0;I<i.height;I++)for(var x=0;x<i.width;x++){var _=Math.floor(I/f),k=I*i.width+x,C=window.imageList[_][d][x]<h?h:window.imageList[_][d][x];C=C>m?m:C,C=Math.floor(255*(C-h)/(m-h)),u.data[4*k+2]=u.data[4*k+1]=u.data[4*k]=C,u.data[4*k+3]=255}break;case"z":i.columns=i.width=window.imageList[0][0].length,i.rows=i.height=window.imageList[0].length,s.setAttribute("width",i.width),s.setAttribute("height",i.height),u=l.getImageData(0,0,i.width,i.height);for(var A=0;A<i.height;A++)for(var T=0;T<i.width;T++){var S=A*i.width+T,D=window.imageList[d][A][T]<h?h:window.imageList[d][A][T];D=D>m?m:D,D=Math.floor(255*(D-h)/(m-h)),u.data[4*S+2]=u.data[4*S+1]=u.data[4*S]=D,u.data[4*S+3]=255}}l.putImageData(u,0,0);var P=new Image;P.src=s.toDataURL("image/jpeg"),P.crossOrigin="anonymous",P.onload=function(){o=this,i.columns=i.width=this.width,i.rows=i.height=this.height,i.sizeInBytes=i.width*i.height*4,s.setAttribute("width",i.width),s.setAttribute("height",i.height),(l=s.getContext("2d")).drawImage(this,0,0);var e=l.getImageData(0,0,i.width,i.height).data;console.log(n),n=e,console.log(i),a(i)},i.onerror=function(){that.event._dispatch("ctcornerstone.imgloadError",{src:P.src})},u=null}),cancelFn:void 0}}),cornerstone.registerImageLoader("niiImage",function(e){var n={imageId:e,minPixelValue:null,maxPixelValue:null,slope:1,intercept:0,windowCenter:200,windowWidth:600,render:cornerstone.renderGrayscaleImage,getPixelData:function(){return n.pixelData},rows:512,columns:512,height:512,width:512,Wretched:!1,rate:1,color:!1,columnPixelSpacing:1,rowPixelSpacing:1,invert:!1,sizeInBytes:262144};return{promise:new Promise(function(t,i){var a=this,r=(document.createElement("CANVAS"),new XMLHttpRequest);r.open("GET",e.replace("niiImage:",""),!0),r.responseType="blob",r.contentType="application/x-www-form-urlencoded",r.onreadystatechange=o(regeneratorRuntime.mark(function e(){var o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:4===r.readyState&&200===r.status&&(o=r.response,(i=new FileReader).readAsArrayBuffer(o),i.onload=function(){var e=new Int16Array(i.result,0,352),t=new Int16Array(i.result,352,i.result.length);n.columns=n.width=e[21],n.rows=n.height=e[22],262144==t.length?n.pixelData=new Int16Array(t):(n.pixelData=new Int16Array(Math.floor(t.length/2)),t.map(function(e,n){0==Math.floor(n%2)&&((void 0)[Math.floor(n/2)]=e)}));for(var o=0;o<n.pixelData.length;o++)n.maxPixelValue?n.maxPixelValue=n.maxPixelValue<n.pixelData[o]?n.pixelData[o]:n.maxPixelValue:n.maxPixelValue=n.pixelData[o],n.minPixelValue?n.minPixelValue=n.minPixelValue>n.pixelData[o]?n.pixelData[o]:n.minPixelValue:n.minPixelValue=n.pixelData[o];n.windowCenter=(n.maxPixelValue+n.minPixelValue)/2,n.windowWidth=(n.maxPixelValue-n.minPixelValue)/2,t=null},t(n));case 1:case"end":return e.stop()}},e,a)})),r.onerror=o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,a)})),r.send()}),cancelFn:void 0}})},1056:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(e){function n(e){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.nidusComponentInfo={},t.nidusComponentData={},t.nidusChoose=null,t.seriesInfo={},t.controlStauts={delete:!0},t.allresult=null,t.layerMarkImageAnnotation=null,t.seriesAnnotationResult=[],t.projectInfo={},t.currentSeriesInfo={},t.currentLayer=1,t.imageAnnotationResultId=null,t}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.modelBase),o(n,[{key:"setCurrentSeriesInfo",value:function(e){this.currentSeriesInfo=e}},{key:"getDicomValue",value:function(e){var n=e.currentPoints.image,t=e.image.width,o=e.image.height,i=e.image.getPixelData(),a=t*Math.round(n.y)+Math.round(n.x);return i.length!=t*o&&(a*=4),{point:n,allcolor:[i[a],i[a+1],i[a+2],i[a+3]],hu:i[a]}}},{key:"getLayout",value:function(e){switch(e){case 1:return{w:1,h:1,t:0};case 2:return{w:.5,h:1,t:0};case 3:return{w:1/3,h:1,t:0};case 4:return{w:.5,h:.5,t:1};case 6:return{w:1/3,h:.5,t:1};case 8:return{w:.25,h:.5,t:1}}}},{key:"returnBodyName",value:function(e){switch(e){case 1:return"前上缘";case 2:return"前下缘";case 3:return"后上缘";case 4:return"后下缘"}}},{key:"findHU",value:function(e,n,t){for(var o=[],i=0;i<n.distance;i++)o.push(this.returnscore("r",e,i,n,t)),o.push(this.returnscore("l",e,i,n,t)),o.push(this.returnscore("u",e,i,n,t)),o.push(this.returnscore("v",e,i,n,t));var a=o.filter(function(e){return e});return(a=a.sort(function(e,n){return e.d-n.d}))[0]}},{key:"returnscore",value:function(e,n,t,o,i){var a={};switch(e){case"l":a={x:n.currentPoints.image.x-t,y:n.currentPoints.image.y};break;case"r":a={x:n.currentPoints.image.x+t,y:n.currentPoints.image.y};break;case"u":a={x:n.currentPoints.image.x,y:n.currentPoints.image.y-t};break;case"b":a={x:n.currentPoints.image.x,y:n.currentPoints.image.y+t}}var r={currentPoints:{image:a},image:{width:n.image.width,getPixelData:n.image.getPixelData}},s=this.getDicomValue(r),l=o.deviation,d=0,c=.3*i.allcolor[0]+.59*i.allcolor[1]+.11*i.allcolor[2],u=.3*s.allcolor[0]+.59*s.allcolor[1]+.11*s.allcolor[2];return Math.abs(u-c)<=l?(d=Math.abs(u-c),s.point.d=d,s.point):null}},{key:"returnRealPoint",value:function(e,n,t,o){var i=this.getLayout(t),a=0==i.t?0:n>=t/2?o.h:0,r=0==i.t?n*o.w:n>=t/2?(n-t/2)*o.w:n*o.w;return{x:e.x-r,y:e.y-a}}},{key:"returnScreenPoint",value:function(e,n,t,o){var i=this.getLayout(t),a=0==i.t?0:n>=t/2?o.h:0,r=0==i.t?n*o.w:n>=t/2?(n-t/2)*o.w:n*o.w;return{x:e.x+r,y:e.y+a}}},{key:"compareColors",value:function(e,n,t){var o=e.color,i=(o[0]+n[0])/2,a=o[0]-n[0],r=o[1]-n[1],s=o[2]-n[2],l=a*a*(2+i/256)+r*r*4+s*s*(2+(255-i)/256);return Math.pow(l,.5)<t}},{key:"returnPoint",value:function(e,n,t,o){var i=t*o+n;return{x:n,y:t,i:i,color:[e[4*i],e[4*i+1],e[4*i+2],e[4*i+3]]}}},{key:"floodFill_newRGB32",value:function(e,n){console.log((new Date).getTime());var t=Math.floor(e.currentPoints.image.x),o=Math.floor(e.currentPoints.image.y),i=e.image.width,a=e.image.height;n.deviation;if(t<0||t>=i||o<0||o>=a)return[];var r=this.getDicomValue(e).allcolor,s=[],l=[];l[i*a]=void 0;var d={pixelData:e.image.getPixelData(),width:e.image.width,height:e.image.height};s.push(this.returnPoint(d.pixelData,t,o,i));var c=s.pop();do{l[c.i]||this.compareColors(c,r,n.deviation)&&(0,l[c.i]={x:c.x,y:c.y},c.x>0&&s.push(this.returnPoint(d.pixelData,c.x-1,c.y,i)),c.x<i-1&&s.push(this.returnPoint(d.pixelData,c.x+1,c.y,i)),c.y>0&&s.push(this.returnPoint(d.pixelData,c.x,c.y-1,i)),c.y<a-1&&s.push(this.returnPoint(d.pixelData,c.x,c.y+1,i)))}while(c=s.pop());return l=l.filter(function(e){return e}),console.log((new Date).getTime()),l}},{key:"getroundpoint",value:function(e,n){for(var t=[],o=Math.round(e.x-n),i=Math.round(e.y-n),a=2*n,r=a*a,s=0;s<r;s++){var l=o+Math.floor(s%a),d=i+Math.floor(s/a);(l-e.x)*(l-e.x)+(d-e.y)*(d-e.y)<=n*n&&t.push({x:l,y:d})}return t}},{key:"makeCiclePoint",value:function(e,n){for(var t=[],o=n.deviation/2,i=e.currentPoints.image.x,a=e.currentPoints.image.y,r=Math.round(i-o),s=Math.round(a-o),l=2*o,d=l*l,c=0;c<d;c++){var u=r+Math.floor(c%l),h=s+Math.floor(c/l);(u-i)*(u-i)+(h-a)*(h-a)<=o*o&&t.push({x:u,y:h})}return t}}]),n}();e.exports=i},1057:function(e,n,t){var o=t(1058);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1058:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".crossline {\n  position: relative;\n  width: 100%;\n  background: transparent;\n  -webkit-touch-callout: none;\n  /* iOS Safari */\n  -webkit-user-select: none;\n  /* Chrome/Safari/Opera */\n  -khtml-user-select: none;\n  /* Konqueror */\n  -moz-user-select: none;\n  /* Firefox */\n  -ms-user-select: none;\n  /* Internet Explorer/Edge */\n  user-select: none;\n}\n.crossline .xline {\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 3px;\n  background: #f00;\n  position: absolute;\n  transition-duration: 0s;\n  -moz-transition-duration: 0s;\n  /* Firefox 4 */\n  -webkit-transition-duration: 0s;\n  /* Safari 和 Chrome */\n  -o-transition-duration: 0s;\n  /* Opera */\n}\n.crossline .yline {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 3px;\n  background: #f00;\n  transition-duration: 0s;\n  -moz-transition-duration: 0s;\n  /* Firefox 4 */\n  -webkit-transition-duration: 0s;\n  /* Safari 和 Chrome */\n  -o-transition-duration: 0s;\n  /* Opera */\n}\n",""])},1059:function(e,n){e.exports="<div class=crossline> <div class=xline> </div> <div class=yline> </div> </div>"},1060:function(e,n,t){"use strict";new function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var n=cornerstoneTools.external,t=cornerstoneTools.mouseButtonTool,o=cornerstoneTools.toolStyle,i=cornerstoneTools.toolColors,a=cornerstoneTools.drawHandles,r=cornerstoneTools.calculateSUV,s=cornerstoneTools.drawTextBox,l=cornerstoneTools.getToolState,d=cornerstoneTools.drawing.drawRect,c=cornerstoneTools.drawing.getNewContext,u=cornerstoneTools.drawing.draw,h=cornerstoneTools.drawing.setShadow,m=(cornerstoneTools.keyboardTool,"rectangleRoi");function f(e){var n={visible:!0,active:!0,invalidated:!0,color:void 0,areaDisplayFlag:!1,nameDisplayFlag:!1,uuid:e.uuid?e.uuid:null,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}},t=g.getConfiguration();return t&&(void 0!=t.nameDisplayFlag&&null!=t.nameDisplayFlag&&(n.nameDisplayFlag=t.nameDisplayFlag),void 0!=t.areaDisplayFlag&&t.areaDisplayFlag&&(n.areaDisplayFlag=t.areaDisplayFlag)),n}function p(e){var n=e.toString().split(".");return n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),n.join(".")}var g=t({createNewMeasurement:f,onImageRendered:function(e){var t=e.detail,f=l(e.currentTarget,m);if(f){var v=n.cornerstone,y=t.image,b=t.element,w=(o.getToolWidth(),g.getConfiguration()),I=v.metaData.get("generalSeriesModule",y.imageId),x=v.metaData.get("imagePlaneModule",y.imageId),_=void 0,k=void 0,C=void 0;x?(k=x.rowPixelSpacing||x.rowImagePixelSpacing,C=x.columnPixelSpacing||x.colImagePixelSpacing):(k=y.rowPixelSpacing,C=y.columnPixelSpacing),I&&(_=I.modality);var A=c(t.canvasContext.canvas);A.lineWidth=1;for(var T=function(e){var n=f.data[e];if(!1===n.visible)return"continue";u(A,function(e){h(e,w);var o=i.getColorIfActive(n);d(e,b,n.handles.start,n.handles.end,{color:o}),w&&w.drawHandlesOnHover?!0===n.active?a(e,t,n.handles,o):a(e,t,n.handles,o,{drawHandlesIfActive:!0}):a(e,t,n.handles,o);var l=void 0,c=void 0,u=void 0;if(!1===n.invalidated)c=n.meanStdDev,u=n.meanStdDevSUV,l=n.area;else{var m={left:Math.min(n.handles.start.x,n.handles.end.x),top:Math.min(n.handles.start.y,n.handles.end.y),width:Math.abs(n.handles.start.x-n.handles.end.x),height:Math.abs(n.handles.start.y-n.handles.end.y)};y.color||(c=function(e,n){for(var t=0,o=0,i=0,a=0,r=n.top;r<n.top+n.height;r++)for(var s=n.left;s<n.left+n.width;s++)t+=e[a],o+=e[a]*e[a],i++,a++;if(0===i)return{count:i,mean:0,variance:0,stdDev:0};var l=t/i,d=o/i-l*l;return{count:i,mean:l,variance:d,stdDev:Math.sqrt(d)}}(v.getPixels(b,m.left,m.top,m.width,m.height),m),"PT"===_&&(u={mean:r(y,(c.mean-y.intercept)/y.slope),stdDev:r(y,(c.stdDev-y.intercept)/y.slope)}),c&&!isNaN(c.mean)&&(n.meanStdDev=c,n.meanStdDevSUV=u)),l=m.width*(C||1)*(m.height*(k||1)),isNaN(l)||(n.area=l),n.invalidated=!1}if(n&&n.nameDisplayFlag){var f=function(e){var n=e.meanStdDev,t=e.meanStdDevSUV,o=e.area,i=[];if(n&&n.mean){var a="";"CT"===_&&(a=" HU");var r="Mean: "+p(n.mean.toFixed(2))+a,s="StdDev: "+p(n.stdDev.toFixed(2))+a;t&&void 0!==t.mean&&(r+=" SUV: "+p(t.mean.toFixed(2)),s+=" SUV: "+p(t.stdDev.toFixed(2))),i.push(r),i.push(s)}if(o){var l=" mm"+String.fromCharCode(178);k&&C||(l=" pixels"+String.fromCharCode(178));var d="Area: "+p(o.toFixed(2))+l;i.push(d)}return i}(n);n.handles.textBox.hasMoved||(n.handles.textBox.x=Math.max(n.handles.start.x,n.handles.end.x),n.handles.textBox.y=(n.handles.start.y+n.handles.end.y)/2);var g=v.pixelToCanvas(b,n.handles.textBox);s(e,f,g.x,g.y,o,{centering:{x:!1,y:!0}})}})},S=0;S<f.data.length;S++)T(S)}},pointNearTool:function(e,t,o){if(!1===t.visible)return!1;var i=n.cornerstone,a=i.pixelToCanvas(e,t.handles.start),r=i.pixelToCanvas(e,t.handles.end),s={left:Math.min(a.x,r.x),top:Math.min(a.y,r.y),width:Math.abs(a.x-r.x),height:Math.abs(a.y-r.y)};return n.cornerstoneMath.rect.distanceToPoint(s,o)<5},toolType:m});for(var v in cornerstoneTools.rectangleRoi)cornerstoneTools.rectangleRoi[v]=g[v];cornerstoneTools.rectangleRoi.getMeasurement=function(e){return f(e)}}},1061:function(e,n,t){"use strict";new function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var n=cornerstoneTools.external,t=cornerstoneTools.mouseButtonTool,o=cornerstoneTools.toolStyle,i=cornerstoneTools.toolColors,a=cornerstoneTools.drawHandles,r=cornerstoneTools.drawTextBox,s=cornerstoneTools.getToolState,l=cornerstoneTools.drawing.drawLine,d=cornerstoneTools.drawing.setShadow,c=cornerstoneTools.drawing.getNewContext,u=cornerstoneTools.drawing.draw,h="length";function m(e){var n={visible:!0,active:!0,color:void 0,uuid:e.uuid?e.uuid:null,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}},t=f.getConfiguration();return t&&(void 0!=t.nameDisplayFlag&&null!=t.nameDisplayFlag&&(n.nameDisplayFlag=t.nameDisplayFlag),void 0!=t.areaDisplayFlag&&t.areaDisplayFlag&&(n.areaDisplayFlag=t.areaDisplayFlag)),n}var f=t({createNewMeasurement:m,onImageRendered:function(e){var t=e.detail,m=s(e.currentTarget,h);if(m){var p=n.cornerstone,g=c(t.canvasContext.canvas),v=t.image,y=t.element,b=(o.getToolWidth(),f.getConfiguration()),w=p.metaData.get("imagePlaneModule",v.imageId),I=void 0,x=void 0;w?(I=w.rowPixelSpacing||w.rowImagePixelSpacing,x=w.columnPixelSpacing||w.colImagePixelSpacing):(I=v.rowPixelSpacing,x=v.columnPixelSpacing);for(var _=function(e){var n=m.data[e];if(!1===n.visible)return"continue";u(g,function(e){d(e,b);var o=i.getColorIfActive(n);l(e,y,n.handles.start,n.handles.end,{color:o});var s={drawHandlesIfActive:b&&b.drawHandlesOnHover};a(e,t,n.handles,o,s);var c=(n.handles.end.x-n.handles.start.x)*(x||1),u=(n.handles.end.y-n.handles.start.y)*(I||1),h=Math.sqrt(c*c+u*u);if(n.length=h,!n.handles.textBox.hasMoved){var m={x:Math.max(n.handles.start.x,n.handles.end.x)};m.x===n.handles.start.x?m.y=n.handles.start.y:m.y=n.handles.end.y,n.handles.textBox.x=m.x,n.handles.textBox.y=m.y}if(n&&n.nameDisplayFlag){var f=function(e,n,t){var o=" mm";return n&&t||(o=" pixels"),""+e.length.toFixed(2)+o}(n,I,x),g=p.pixelToCanvas(y,n.handles.textBox);r(e,f,g.x,g.y,o,{centering:{x:!1,y:!0}})}})},k=0;k<m.data.length;k++)_(k)}},pointNearTool:function(e,t,o){return!1!==t.visible&&function(e,t,o,i){var a={start:cornerstone.pixelToCanvas(e,t),end:cornerstone.pixelToCanvas(e,o)};return n.cornerstoneMath.lineSegment.distanceToPoint(a,i)}(e,t.handles.start,t.handles.end,o)<25},toolType:h});for(var p in cornerstoneTools.length)cornerstoneTools.length[p]=f[p];cornerstoneTools.length.getMeasurement=function(e){return m(e)}}},1062:function(e,n,t){"use strict";new function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var n=cornerstoneTools.EVENTS,t=cornerstoneTools.external,o=cornerstoneTools.getBrowserInfo,i=cornerstoneTools.isMouseButtonEnabled,a=cornerstoneTools.setToolOptions,r=cornerstoneTools.getToolOptions,s=cornerstoneTools.drawing.getNewContext,l=cornerstoneTools.drawing.fillBox;function d(e,n,t){return Math.min(Math.max(n,e),t)}var c="magnify",u={magnifySize:300,magnificationLevel:5},h=void 0,m=void 0,f=void 0,p=void 0;function g(e){var t=e.detail,o=t.element;o.removeEventListener(n.MOUSE_DRAG,I),o.removeEventListener(n.MOUSE_UP,g),o.removeEventListener(n.MOUSE_CLICK,g),v(t)}function v(e){e.element.querySelector(".magnifyTool").style.display="none",document.body.style.cursor="default",k()}function y(e){var o=e.detail,a=o.element,s=r(c,a);(e.isTouchEvent||i(o.which,s.mouseButtonMask))&&(a.addEventListener(n.MOUSE_DRAG,I),a.addEventListener(n.TOUCH_DRAG,I),a.addEventListener(n.MOUSE_UP,g),a.addEventListener(n.TOUCH_END,g),a.addEventListener(n.MOUSE_CLICK,g),a.addEventListener(n.NEW_IMAGE,b),function(e){k();var n=e.enabledElement;void 0===n&&(n=t.cornerstone.getEnabledElement(e.element));var o=A.getConfiguration().magnificationLevel,i=n.canvas,a=n.image;(p=document.createElement("div")).width=i.width*o,p.height=i.height*o,t.cornerstone.enable(p);var r=t.cornerstone.getEnabledElement(p),s=t.cornerstone.getViewport(n.element);(f=r.canvas).width=i.width*o,f.height=i.height*o,r.viewport=Object.assign({},s),s.scale*=o,t.cornerstone.displayImage(p,a),t.cornerstone.setViewport(p,s)}(o),window.requestAnimationFrame(function(){return x(o)}),e.preventDefault(),e.stopPropagation())}function b(e){var n=e.detail;n.currentPoints=m,x(n)}function w(e){var t=e.detail,o=t.element;o.removeEventListener(n.TOUCH_DRAG_END,w),o.removeEventListener(n.TOUCH_END,w),o.removeEventListener(n.NEW_IMAGE,b),v(t)}function I(e){var t=e.detail,o=t.element;x(t),!0===t.isTouchEvent&&(o.addEventListener(n.TOUCH_DRAG_END,w),o.addEventListener(n.TOUCH_END,w)),e.preventDefault(),e.stopPropagation()}function x(e){var n=e.element,o=n.querySelector(".magnifyTool");if(o||_(e.element),void 0!==f){var i=A.getConfiguration(),a=i.magnifySize,r=i.magnificationLevel,c=n.querySelector("canvas:not(.magnifyTool)"),u=s(o),m=a,p=t.cornerstone.pixelToCanvas(e.element,e.currentPoints.image);!function(e,n){e.x=d(e.x,0,n.width),e.y=d(e.y,0,n.height)}(p,c),u.clearRect(0,0,a,a),l(u,{left:0,top:0,width:a,height:a},"transparent");var g={x:p.x*r-.5*m,y:p.y*r-.5*m};"Safari"===h&&(g.x=Math.max(g.x,0),g.y=Math.max(g.y,0)),g.x=Math.min(g.x,f.width),g.y=Math.min(g.y,f.height),u.drawImage(f,g.x,g.y,m,m,0,0,m,m),function(e,n){var t=Math.floor(n/2);e.globalCompositeOperation="destination-atop",e.fillStyle="blue",e.arc(t,t,t,0,2*Math.PI,!1),e.fill(),e.save(),e.globalCompositeOperation="source-over",e.strokeStyle="#333",e.lineWidth=1,e.arc(t,t,t,0,2*Math.PI,!1),e.stroke()}(u,a),o.style.top=p.y-.5*a+"px",o.style.left=p.x-.5*a+"px",e.isTouchEvent&&(o.style.top=p.y-.5*a-120+"px"),o.style.display="block",document.body.style.cursor="none"}}function _(e){if(null===e.querySelector(".magnifyTool")){var n=document.createElement("canvas");n.classList.add("magnifyTool");var t=A.getConfiguration();n.width=t.magnifySize,n.height=t.magnifySize,n.style.position="absolute",n.style.display="none",e.appendChild(n)}}function k(){void 0!==p&&(t.cornerstone.disable(p),p=void 0,f=void 0)}function C(e){e.removeEventListener(n.MOUSE_DOWN,y),function(e){var n=e.querySelector(".magnifyTool");n&&e.removeChild(n)}(e)}var A={enable:function(e){var n=A.getConfiguration(n);if(!h){var t=o().split(" ");h=t[0]}_(e)},activate:function(e,t){a(c,e,{mouseButtonMask:t}),e.removeEventListener(n.MOUSE_DOWN,y),e.addEventListener(n.MOUSE_DOWN,y),_(e)},deactivate:C,disable:C,getConfiguration:function(){return u},setConfiguration:function(e){u=e}};for(var T in cornerstoneTools.magnify)cornerstoneTools.magnify[T]=A[T]}},1063:function(e,n,t){"use strict";new function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var n=cornerstoneTools.external,o=cornerstoneTools.getToolState,i=cornerstoneTools.drawing.draw,a=cornerstoneTools.drawing.fillBox;function r(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=Math.round(o),r=Math.round(i);if(1===e)return[[a,r]];for(var s=[],l=0,d=-e;d<=e;d++){var c=r+d;if(!(c>n||c<0))for(var u=-e;u<=e;u++){var h=a+u;h>t||h<0||u*u+d*d<e*e&&(s[l++]=[a+u,r+d])}}return s}function s(e,n,t,o){e.forEach(function(e){var i=function(e,n){return n*o+e}(e[0],e[1]);n[i]=t})}var l="brush",d=void 0,c=!1;var u=new(t(1064))({onMouseMove:function(e){var t=e.detail;d=t.currentPoints.image,n.cornerstone.updateImage(t.element)},onMouseDown:function(e){var n=e.detail;c=!0,d=n.currentPoints.image},onMouseUp:function(e){var n=e.detail;d=n.currentPoints.image,c=!1},onDrag:function(e){var n=e.detail;c=!0,d=n.currentPoints.image},toolType:"brush",onImageRendered:function(e){var t=e.detail;if(d){var o=t.image,s=o.rows,l=o.columns,h=d,m=h.x,f=h.y;if(!(m<0||m>l||f<0||f>s)){var p=u.getConfiguration(),g=p.radius,v=t.canvasContext,y=c?p.dragColor:p.hoverColor,b=t.element;v.setTransform(1,0,0,1,0,0),p.active&&function(e,t,o,r){var s=n.cornerstone.pixelToCanvas(r,{x:0,y:0}),l=n.cornerstone.pixelToCanvas(r,{x:1,y:1}),d=l.x-s.x,c=l.y-s.y;i(t,function(t){e.forEach(function(e){var i=n.cornerstone.pixelToCanvas(r,{x:e[0],y:e[1]}),s={left:i.x,top:i.y,width:d,height:c};a(t,s,o)})})}(r(g,s,l,m,f),v,y,b)}}}});for(var h in cornerstoneTools.brush)cornerstoneTools.brush[h]=u[h];cornerstoneTools.brush.clear=u.clear,cornerstoneTools.brush.getAllId=u.getAllId,cornerstoneTools.brush.autoplay=function(e){var t=e;!function(e){var t=u.getConfiguration(),i=e.element,a=n.cornerstone.getLayer(i,t.brushLayerId),d=a.image,c=d.rows,h=d.columns,m=e.currentPoints.image,f=m.x,p=m.y,g=o(i,l).data[0].pixelData,v=t.draw,y=t.radius;f<0||f>h||p<0||p>c||(s(r(y,c,h,f,p),g,v,h),a.invalid=!0,n.cornerstone.updateImage(i))}(t),d=t.currentPoints.image,c=!0},u.setConfiguration({draw:1,radius:5,minRadius:1,maxRadius:20,hoverColor:"rgba(230, 25, 75, 1.0)",dragColor:"rgba(230, 25, 75, 0.8)",active:!1})}},1064:function(e,n,t){"use strict";e.exports=function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var t=cornerstoneTools.EVENTS,o=cornerstoneTools.external,i=cornerstoneTools.addToolState,a=cornerstoneTools.getToolState,r=cornerstoneTools.mouseButtonTool,s=cornerstoneTools.isMouseButtonEnabled,l=cornerstoneTools.setToolOptions,d=cornerstoneTools.getToolOptions;function c(e,n,t){return Math.min(Math.max(n,e),t)}var u="brush",h=void 0,m=void 0,f=n.toolType;function p(e){var n=e.detail,t=!1;t=function(e){var n=e.keyCode,t=!1;return 109===n||173===n?(y(),t=!0):61!==n&&107!==n||(v(),t=!0),t}(n)||t,(t=function(e){var n=e.keyCode,t=!1;return 219===n?(w(),t=!0):221===n&&(b(),t=!0),t}(n)||t)&&o.cornerstone.updateImage(n.element)}function g(e){var n=T.getConfiguration(),t=o.cornerstone.colors.getColormap(n.colormapId);n.draw=e;var i=t.getColor(n.draw);n.hoverColor="rgba("+i[[0]]+", "+i[[1]]+", "+i[[2]]+", 1.0 )",n.dragColor="rgba("+i[[0]]+", "+i[[1]]+", "+i[[2]]+", 0.8 )"}function v(){var e=T.getConfiguration();e.radius=c(e.radius+1,e.minRadius,e.maxRadius)}function y(){var e=T.getConfiguration();e.radius=c(e.radius-1,e.minRadius,e.maxRadius)}function b(){var e=T.getConfiguration(),n=I(),t=e.draw+1;t===n&&(t=0),g(t)}function w(){var e=T.getConfiguration(),n=I(),t=e.draw-1;t<0&&(t=n-1),g(t)}function I(){var e=T.getConfiguration();return o.cornerstone.colors.getColormap(e.colormapId).getNumberOfColors()}function x(e){n.onMouseMove(e)}function _(e){var o=e.detail.element;n.onMouseUp(e),o.removeEventListener(t.MOUSE_DRAG,x),o.removeEventListener(t.MOUSE_DRAG,k),o.removeEventListener(t.MOUSE_UP,_),o.removeEventListener(t.MOUSE_CLICK,_)}function k(e){return n.onDrag(e),!1}function C(e){var o=e.detail,i=o.element,a=d(f,i);if(s(o.which,a.mouseButtonMask))return i.addEventListener(t.MOUSE_DRAG,k),i.addEventListener(t.MOUSE_UP,_),i.addEventListener(t.MOUSE_CLICK,_),n.onMouseDown(e),!1;i.addEventListener(t.MOUSE_DRAG,x),i.addEventListener(t.MOUSE_UP,_)}function A(e){var t=e.detail,r=t.element,s=a(r,u),l=void 0;s?l=s.data[0].pixelData:(l=new Uint8ClampedArray(t.image.width*t.image.height),i(r,u,{pixelData:l}));var d=o.cornerstone.getLayer(t.element,h);d.image.setPixelData(l),d.invalid=!0,o.cornerstone.updateImage(r),n.onImageRendered(e)}var T=r({mouseMoveCallback:x,mouseDownActivateCallback:C,onImageRendered:A,deactivate:function(e){e.removeEventListener(t.IMAGE_RENDERED,A),e.removeEventListener(t.MOUSE_DOWN_ACTIVATE,C),e.removeEventListener(t.MOUSE_MOVE,x),e.removeEventListener(t.KEY_DOWN,p),T.getConfiguration().active=!1}});return T.keyDownCallback=p,T.activate=function(e,n){l(f,e,{mouseButtonMask:n}),e.removeEventListener(t.IMAGE_RENDERED,A),e.addEventListener(t.IMAGE_RENDERED,A),e.removeEventListener(t.MOUSE_DOWN_ACTIVATE,C),e.addEventListener(t.MOUSE_DOWN_ACTIVATE,C),e.removeEventListener(t.MOUSE_MOVE,x),e.addEventListener(t.MOUSE_MOVE,x),e.removeEventListener(t.KEY_DOWN,p),e.addEventListener(t.KEY_DOWN,p);var a=o.cornerstone.getEnabledElement(e),r=a.image,s=r.width,d=r.height,c=new Uint8ClampedArray(s*d),g=T.getConfiguration();g.active=!0;var v=g.colormapId;if(!v){var y=T.getConfiguration();(function(e){var n=o.cornerstone.colors.getColormap(e);n.setNumberOfColors(20),n.setColor(0,[255,255,255,0]),n.setColor(1,[230,25,75,102]),n.setColor(2,[60,180,175,102]),n.setColor(3,[255,225,25,102]),n.setColor(4,[0,130,200,102]),n.setColor(5,[245,130,48,102]),n.setColor(6,[145,30,180,102]),n.setColor(7,[70,240,240,102]),n.setColor(8,[240,50,230,102]),n.setColor(9,[210,245,60,102]),n.setColor(10,[250,190,190,102]),n.setColor(11,[0,128,128,102]),n.setColor(12,[230,190,255,102]),n.setColor(13,[170,110,40,102]),n.setColor(14,[255,250,200,102]),n.setColor(15,[128,0,0,102]),n.setColor(16,[170,255,195,102]),n.setColor(17,[128,128,0,102]),n.setColor(18,[255,215,180,102]),n.setColor(19,[0,0,128,102])})(v="BrushColorMap"),y.colormapId=v}var b={minPixelValue:0,maxPixelValue:1,slope:1,intercept:0,getPixelData:function(){return c},rows:a.image.height,columns:a.image.width,height:d,width:s,pixelData:c,setPixelData:function(e){c=e},colormap:v,color:!1,rgba:!1,labelmap:!0,invert:!1,columnPixelSpacing:1,rowPixelSpacing:1,sizeInBytes:a.image.width*a.image.height},w=void 0;m||(m=o.cornerstone.addLayer(e,o.cornerstone.getEnabledElement(e).image)),h&&(w=o.cornerstone.getLayer(e,h)),w||(h=o.cornerstone.addLayer(e,b,{viewport:{pixelReplication:!0}})),i(e,u,{pixelData:c}),g.brushLayerId=h,T.setConfiguration(g),o.cornerstone.updateImage(e)},T.changeDrawColor=g,T.increaseRadius=v,T.decreaseRadius=y,T.nextSegmentation=b,T.previousSegmentation=w,T.clear=function(){h=null,m=null},T.getAllId=function(){return{brushLayerId:h,imageLayerId:m}},T}},1065:function(e,n,t){"use strict";new function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var n=cornerstoneTools.EVENTS,t=cornerstoneTools.external,o=cornerstoneTools.mouseButtonTool,i=cornerstoneTools.toolStyle,a=cornerstoneTools.toolColors,r=cornerstoneTools.drawHandles,s=cornerstoneTools.textStyle,l=cornerstoneTools.anyHandlesOutsideImage,d=cornerstoneTools.moveNewHandle,c=cornerstoneTools.getToolState,u=cornerstoneTools.addToolState,h=cornerstoneTools.removeToolState,m=cornerstoneTools.drawTextBox,f=cornerstoneTools.drawing.drawJoinedLines,p=cornerstoneTools.drawing.draw,g=cornerstoneTools.drawing.setShadow,v=cornerstoneTools.drawing.getNewContext,y=function(e,n,t){var o=s.getFont(),i=e.font;o&&o!==i&&(e.font=o);var a=e.measureText(n).width;return o&&o!==i&&(e.font=i),a+2*t},b=function(e,n){var t=Math.pow(10,n);return Math.round(e*t)/t},w=function(e,n,o,i){var a=t.cornerstone,r={start:a.pixelToCanvas(e,n),end:a.pixelToCanvas(e,o)};return t.cornerstoneMath.lineSegment.distanceToPoint(r,i)},I="simpleAngle";function x(e){return{visible:!0,active:!0,color:void 0,uuid:e.uuid?e.uuid:null,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function _(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}var k=o({createNewMeasurement:x,addNewMeasurement:function(e){var o=t.cornerstone,i=x(e),a=e.element;u(a,I,i),a.removeEventListener(n.MOUSE_MOVE,k.mouseMoveCallback),a.removeEventListener(n.MOUSE_DRAG,k.mouseMoveCallback),a.removeEventListener(n.MOUSE_DOWN,k.mouseDownCallback),a.removeEventListener(n.MOUSE_DOWN_ACTIVATE,k.mouseDownActivateCallback),o.updateImage(a),d(e,I,i,i.handles.middle,function(){if(i.active=!1,l(e,i.handles))return h(a,I,i),a.addEventListener(n.MOUSE_MOVE,k.mouseMoveCallback),a.addEventListener(n.MOUSE_DRAG,k.mouseMoveCallback),a.addEventListener(n.MOUSE_DOWN,k.mouseDownCallback),a.addEventListener(n.MOUSE_DOWN_ACTIVATE,k.mouseDownActivateCallback),void o.updateImage(a);i.handles.end.active=!0,o.updateImage(a),d(e,I,i,i.handles.end,function(){i.active=!1,l(e,i.handles)&&h(a,I,i),a.addEventListener(n.MOUSE_MOVE,k.mouseMoveCallback),a.addEventListener(n.MOUSE_DRAG,k.mouseMoveCallback),a.addEventListener(n.MOUSE_DOWN,k.mouseDownCallback),a.addEventListener(n.MOUSE_DOWN_ACTIVATE,k.mouseDownActivateCallback),o.updateImage(a)})})},onImageRendered:function(e){var n=e.detail,o=c(e.currentTarget,I);if(o)for(var s=t.cornerstone,l=n.enabledElement,d=v(n.canvasContext.canvas),u=(i.getToolWidth(),k.getConfiguration()),h=function(e){var t=o.data[e];if(!1===t.visible)return"continue";p(d,function(e){g(e,u);var o=a.getColorIfActive(t),i=s.pixelToCanvas(n.element,t.handles.start),d=s.pixelToCanvas(n.element,t.handles.middle);f(e,n.element,t.handles.start,[t.handles.middle,t.handles.end],{color:o});var c={drawHandlesIfActive:u&&u.drawHandlesOnHover};r(e,n,t.handles,o,c);var h=n.image.columnPixelSpacing||1,p=n.image.rowPixelSpacing||1,v={x:(Math.ceil(t.handles.middle.x)-Math.ceil(t.handles.start.x))*h,y:(Math.ceil(t.handles.middle.y)-Math.ceil(t.handles.start.y))*p},w={x:(Math.ceil(t.handles.end.x)-Math.ceil(t.handles.middle.x))*h,y:(Math.ceil(t.handles.end.y)-Math.ceil(t.handles.middle.y))*p},I={x:(Math.ceil(t.handles.end.x)-Math.ceil(t.handles.start.x))*h,y:(Math.ceil(t.handles.end.y)-Math.ceil(t.handles.start.y))*p},x=_(v),k=_(w),C=_(I),A=Math.acos((Math.pow(x,2)+Math.pow(k,2)-Math.pow(C,2))/(2*x*k));if(A*=180/Math.PI,t.rAngle=b(A,2),t.rAngle){var T=function(e,n,t){var o=n&&t?"":" (isotropic)";return e.rAngle.toString()+String.fromCharCode(parseInt("00B0",16))+o}(t,n.image.rowPixelSpacing,n.image.columnPixelSpacing),S=void 0;if(!t.handles.textBox.hasMoved){S={x:d.x,y:d.y};var D=y(e,T,5);d.x<i.x?S.x-=15+D:S.x+=15;var P=s.internal.getTransform(l);P.invert();var E=P.transformPoint(S.x,S.y);t.handles.textBox.x=E.x,t.handles.textBox.y=E.y}m(e,T,S.x,S.y,o)}})},w=0;w<o.data.length;w++)h(w)},pointNearTool:function(e,n,t){return!1!==n.visible&&(w(e,n.handles.start,n.handles.middle,t)<25||w(e,n.handles.middle,n.handles.end,t)<25)},toolType:I});for(var C in cornerstoneTools.simpleAngle)cornerstoneTools.simpleAngle[C]=k[C];cornerstoneTools.simpleAngle.getMeasurement=function(e){return x(e)}}},1066:function(e,n,t){"use strict";new function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var n=cornerstoneTools.external,t=cornerstoneTools.mouseButtonTool,o=cornerstoneTools.toolStyle,i=cornerstoneTools.toolColors,a=cornerstoneTools.drawHandles,r=cornerstoneTools.pointInEllipse,s=cornerstoneTools.calculateEllipseStatistics,l=cornerstoneTools.calculateSUV,d=cornerstoneTools.drawTextBox,c=cornerstoneTools.getToolState,u=cornerstoneTools.drawing.drawEllipse,h=(cornerstoneTools.drawing.getNewContext,cornerstoneTools.drawing.draw),m=(cornerstoneTools.drawing.setShadow,"ellipticalRoi");function f(e){var n={visible:!0,active:!0,invalidated:!0,color:void 0,areaDisplayFlag:!0,nameDisplayFlag:!0,uuid:e.uuid?e.uuid:null,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}},t=v.getConfiguration();return t&&(void 0!=t.nameDisplayFlag&&null!=t.nameDisplayFlag&&(n.nameDisplayFlag=t.nameDisplayFlag),void 0!=t.areaDisplayFlag&&t.areaDisplayFlag&&(n.areaDisplayFlag=t.areaDisplayFlag)),n}function p(e,t,o,i){if(!1===t.visible)return!1;var a=n.cornerstone,s=a.pixelToCanvas(e,t.handles.start),l=a.pixelToCanvas(e,t.handles.end),d={left:Math.min(s.x,l.x)+i/2,top:Math.min(s.y,l.y)+i/2,width:Math.abs(s.x-l.x)-i,height:Math.abs(s.y-l.y)-i},c={left:Math.min(s.x,l.x)-i/2,top:Math.min(s.y,l.y)-i/2,width:Math.abs(s.x-l.x)+i,height:Math.abs(s.y-l.y)+i},u=r(d,o);return!(!r(c,o)||u)}function g(e){var n=e.toString().split(".");return n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),n.join(".")}var v=t({createNewMeasurement:f,onImageRendered:function(e){var t=e.detail,r=c(e.currentTarget,m);if(r){var f=n.cornerstone,p=t.image,y=t.element,b=(o.getToolWidth(),v.getConfiguration()),w=f.metaData.get("generalSeriesModule",p.imageId),I=f.metaData.get("imagePlaneModule",p.imageId),x=void 0,_=void 0,k=void 0;I?(_=I.rowPixelSpacing||I.rowImagePixelSpacing,k=I.columnPixelSpacing||I.colImagePixelSpacing):(_=p.rowPixelSpacing,k=p.columnPixelSpacing),w&&(x=w.modality);var C=t.canvasContext.canvas.getContext("2d");C.setTransform(1,0,0,1,0,0);for(var A=function(e){var n=r.data[e];if(!1===n.visible)return"continue";h(C,function(e){var o=i.getColorIfActive(n);u(e,y,n.handles.start,n.handles.end,{color:o}),b&&b.drawHandlesOnHover?!0===n.active?a(e,t,n.handles,o):a(e,t,n.handles,o,{drawHandlesIfActive:!0}):a(e,t,n.handles,o);var r=void 0,c=void 0,h=void 0;if(!1===n.invalidated)c=n.meanStdDev,h=n.meanStdDevSUV,r=n.area;else{var m={left:Math.round(Math.min(n.handles.start.x,n.handles.end.x)),top:Math.round(Math.min(n.handles.start.y,n.handles.end.y)),width:Math.round(Math.abs(n.handles.start.x-n.handles.end.x)),height:Math.round(Math.abs(n.handles.start.y-n.handles.end.y))};if(!p.color){var v=f.getPixels(y,m.left,m.top,m.width,m.height);c=s(v,m),"PT"===x&&(h={mean:l(p,(c.mean-p.intercept)/p.slope),stdDev:l(p,(c.stdDev-p.intercept)/p.slope)}),c&&!isNaN(c.mean)&&(n.meanStdDev=c,n.meanStdDevSUV=h)}r=Math.PI*(m.width*(k||1)/2)*(m.height*(_||1)/2),isNaN(r)||(n.area=r),n.invalidated=!1}if(n&&n.nameDisplayFlag){var w=function(e){var n=e.meanStdDev,t=e.meanStdDevSUV,o=e.area,i=[];if(n&&void 0!==n.mean){var a="";"CT"===x&&(a=" HU");var r="Mean: "+g(n.mean.toFixed(2))+a,s="StdDev: "+g(n.stdDev.toFixed(2))+a;t&&void 0!==t.mean&&(r+=" SUV: "+g(t.mean.toFixed(2)),s+=" SUV: "+g(t.stdDev.toFixed(2))),i.push(r),i.push(s)}if(o){var l=" mm"+String.fromCharCode(178);_&&k||(l=" pixels"+String.fromCharCode(178));var d="Area: "+g(o.toFixed(2))+l;i.push(d)}return i}(n);n.handles.textBox.hasMoved||(n.handles.textBox.x=Math.max(n.handles.start.x,n.handles.end.x),n.handles.textBox.y=(n.handles.start.y+n.handles.end.y)/2);var I=f.pixelToCanvas(y,n.handles.textBox);d(e,w,I.x,I.y,o,{centering:{x:!1,y:!0}})}})},T=0;T<r.data.length;T++)A(T)}},pointNearTool:function(e,n,t){return p(e,n,t,15)},toolType:m});for(var y in cornerstoneTools.ellipticalRoi)cornerstoneTools.ellipticalRoi[y]&&(cornerstoneTools.ellipticalRoi[y]=v[y]);cornerstoneTools.ellipticalRoi.getMeasurement=function(e){return f(e)}}},1067:function(module,exports,__webpack_require__){"use strict";var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}__webpack_require__(1068);var progress=function(_Interstellar$moduleB){function progress(e,n,t,o){_classCallCheck(this,progress);var i=_possibleConstructorReturn(this,(progress.__proto__||Object.getPrototypeOf(progress)).call(this,e,n,t,o));i.html=__webpack_require__(1070),i.name="mpr",i.screen=3;var a=__webpack_require__(1071);i.modelImage=new a,i.imageList,new Promise(function(e){e()}).then(function(){i.class_c=__webpack_require__(935)}.bind(null,__webpack_require__)).catch(__webpack_require__.oe),i.cornerstoneArray=new Array(3),i.crossArray=new Array(3),console.log(i.initDate.info);var r=i.initDate.info.info.data;return window.targetInfo={wc:r.firstWindowCenter,ww:r.firstWindowWidth,columnPixelSpacing:r.pixelSpacing[0],rowPixelSpacing:r.pixelSpacing[1]},i.initDate.info.people[1]&&i.initDate.info.people[2]?window.depth=Math.abs(i.initDate.info.people[1].imagePositionPatient[2]-i.initDate.info.people[2].imagePositionPatient[2]):window.depth=r.pixelSpacing[0],i.crossline=__webpack_require__(977),i}return _inherits(progress,_Interstellar$moduleB),_createClass(progress,[{key:"complete",value:function(){var e=this;this.dom.find(".close_btn").on("click",function(){e.close()})}},{key:"openS",value:function(e,n,t){var o=this;this.dom.show(),this.modelImage.imageList(e),this.nodeInfo=n,this.brushManage=t,this.modelImage.event._addEvent("makeJPG.finish",function(){o.app.loading.hide(),o.xUrl=o.modelImage.xUrl,o.yUrl=o.modelImage.yUrl,o.zUrl=o.modelImage.zUrl,o.point={x:Math.floor(o.modelImage.width/2),y:Math.floor(o.modelImage.height/2),z:Math.floor(o.modelImage.zUrl.length/2)},o.loadAll()})}},{key:"loadAll",value:function(){this.nowWWC=[],this.loadSing(0,this.zUrl,"z"),this.loadSing(1,this.yUrl,"y"),this.loadSing(2,this.xUrl,"x")}},{key:"loadSing",value:function(e,n,t){var o=this,i=n,a=this.dom.find("#cb"+e).box(),r=this,s=!1;if("jpg"==this.modelImage.type){var l=this.initDate.info.info.data.firstWindowCenter+this.initDate.info.info.data.firstWindowWidth/2,d=this.initDate.info.info.data.firstWindowCenter-this.initDate.info.info.data.firstWindowWidth/2,c=1*this.initDate.info.info.wwc.low,u=1*this.initDate.info.info.wwc.hight-1*this.initDate.info.info.wwc.low,h=255*(d-c)/u,m=255*(l-c)/u;this.nowWWC[e]={c:(h+m)/2,w:m-h}}this.crossArray[e]=this.app.loadModule(this.crossline,this.dom.find(".cb"+e+" .line")),this.crossArray[e].type=t,this.crossArray[e].setPos({x:0,y:0}),this.crossArray[e].setYHeight(a.clientHeight),this.crossArray[e].event._addEvent("crossline.move",function(){o.crossmove=!0,o.cornerstoneArray[e]&&o.changePOint(o.crossArray[e].nowpos,o.cornerstoneArray[e].getViewport(),o.dom.find("#cb"+e).box(),t)}),this.crossArray[e].event._addEvent("crossline.mouseup",function(){o.crossmove=!1}),this.cornerstoneArray[e]=new this.class_c({element:this.dom.find("#cb"+e).dom[0].dom,totalImage:n.length,imageAddress:n,index:0,type:"JPG"}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.cornerstonetoolsmousemove",function(e){}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.ImageRendered",function(o){ES.selctorDoc(o.element).parent(),ES.selctorDoc(o.element).attr("id").replace("cb","");var a=1*i[1*o.currentCount].match(/\d{1,}/g)[0]+1;if(r.dom.find(".cb"+e+" .layer").html(a+"/"+n.length),r.dom.find(".cb"+e+" .sc").html(r.cornerstoneArray[e].getViewport().scale.toFixed(2)),s)r.point[t]=a;else{var l=r.cornerstoneArray[e].getViewport().voi;r.nowWWC[e]&&(l.windowCenter==r.nowWWC[e].c&&l.windowWidth==r.nowWWC[e].w||r.lungWindown(r.nowWWC[e].c,r.nowWWC[e].w,e)),s=!0}if(r.crossmove||r.renderXYZ(),"z"==t){cornerstone.pixelToCanvas(o.element,{x:0,y:0}),cornerstone.getViewport(o.element);var d=r.brushManage.brushInfo[a]?r.brushManage.brushInfo[a]:{},c={};for(var u in d)d[u].sId==r.sId&&(c[u]=d[u]);for(var h in c)if(c[h].image){d[h].image;o.canvasContext.drawImage(d[h].image,0,0)}for(var m=r.nodeInfo?r.nodeInfo[a]:[],f=(m=m||[]).filter(function(e){return e.sId==r.sId}),p=0;p<f.length;p++){var g=o.canvasContext;g.beginPath(),g.mozImageSmoothingEnabled=!1,g.lineWidth=Math.floor(o.image.columns/512),g.strokeStyle="#f00",r.chooseNidus&&(r.chooseNidus.uuid!=f[p].nodeInfo.uuid&&r.chooseNidus.id!=f[p].nodeInfo.uuid||(g.strokeStyle="#0ff"));var v=f[p].nodeInfo.handles;switch(f[p].type){case"rectangleRoi":var y=Math.abs(v.end.x-v.start.x),b=Math.abs(v.end.y-v.start.y),w=Math.min(v.end.x,v.start.x),I=Math.min(v.end.y,v.start.y);g.strokeRect(w,I,y,b),g.stroke();break;case"ellipticalRoi":var x=(v.start.x+v.end.x)/2,_=(v.start.y+v.end.y)/2,k=Math.max(Math.abs((v.end.x-v.start.x)/2),Math.abs((v.end.y-v.start.y)/2));g.arc(x,_,k,0,2*Math.PI,!1),g.stroke();break;case"length":g.moveTo(v.start.x,v.start.y),g.lineTo(v.end.x,v.end.y),g.stroke();break;case"simpleAngle":g.moveTo(v.start.x,v.start.y),g.lineTo(v.middle.x,v.middle.y),g.lineTo(v.end.x,v.end.y),g.stroke()}}}}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.ModifiedFinsh",function(e){}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.MeasurementEnd",function(e){}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.brushDown",function(e){}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.click",function(e){}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.mousedown",function(e){}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.MouseDrag",function(e){}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.MeasurementRemove",function(e){})}},{key:"lungWindown",value:function(e,n,t){null!=e&&null!=n||(e=128,n=256),this.nowWWC[t]={c:e,w:n},this.cornerstoneArray[t]&&(this.cornerstoneArray[t].lungWindown(e,n),this.nowWWC[t]={c:this.cornerstoneArray[t].getViewport().voi.windowCenter,w:this.cornerstoneArray[t].getViewport().voi.windowWidth})}},{key:"close",value:function(){this.modelImage.clearAllData(),this.xUrl=this.yUrl=this.zUrl=null;for(var e=0;e<3;e++)this.cornerstoneArray[e]&&(this.dom.find(".cb"+e+" .line").remove(),this.cornerstoneArray[e].close(),this.cornerstoneArray[e]=null);this.event._dispatch("mpr.closeAll")}},{key:"defaultFunction",value:function defaultFunction(name){var funName=name;"restFan"!=funName&&"clearFan"!=funName&&"resizeCon"!=funName&&"wlFan"!=funName&&"zoomFan"!=funName&&(funName="");for(var i=0;i<3;i++)this.cornerstoneArray[i]&&eval("this.cornerstoneArray[i]."+funName+"()")}},{key:"renderXYZ",value:function(){for(var e=["z","y","x"],n=0;n<3;n++){var t=this.dom.find(".cb"+n+" .layer").html().split("/")[0];t&&t!=this.point[e[n]]&&this.cornerstoneArray[n].funcNodule(this.point[e[n]]);var o=this.dom.find("#cb"+n).box(),i=this.cornerstoneArray[n].getViewport();if("z"==e[n]&&this.crossArray[n].setPos(this.returnXY({x:this.point.x,y:this.point.y},i,o)),"y"==e[n]){var a=window.depth/window.targetInfo.columnPixelSpacing;this.crossArray[n].setPos(this.returnXY({x:this.point.x,y:(this.point.z-1)*a},i,o))}if("x"==e[n]){var r=window.depth/window.targetInfo.rowPixelSpacing;this.crossArray[n].setPos(this.returnXY({x:this.point.y,y:(this.point.z-1)*r},i,o))}}}},{key:"changePOint",value:function(e,n,t,o){var i=this.getStartPos(n,t),a=Math.floor((e.x-i.x)/n.scale),r=Math.floor((e.y-i.y)/n.scale),s="y"==o?window.depth/window.targetInfo.rowPixelSpacing:window.depth/window.targetInfo.columnPixelSpacing;switch(s=s<1?1:s,o){case"z":this.point.x=a,this.point.y=r;break;case"y":this.point.x=a,this.point.z=Math.floor(r/s);break;case"x":this.point.y=a,this.point.z=Math.floor(r/s)}this.renderXYZ()}},{key:"getStartPos",value:function(e,n){var t=e.displayedArea.brhc.x,o=e.displayedArea.brhc.y,i=0,a=0;return t/o>n.clientWidth/n.clientHeight?a=(n.clientHeight-n.clientWidth*o/t)/2:i=(n.clientWidth-n.clientHeight*t/o)/2,{x:i,y:a}}},{key:"returnXY",value:function(e,n,t){var o=this.getStartPos(n,t),i=Math.floor(o.x+(n.translation.x+e.x)*n.scale),a=Math.floor(o.y+(n.translation.y+e.y)*n.scale);return o=null,{x:i,y:a}}},{key:"resize",value:function(e,n){this.dom.find("#cb0").css({width:e/2-2,height:n-2}),this.dom.find("#cb1").css({width:e/2-3,height:n/2-2}),this.dom.find("#cb2").css({width:e/2-3,height:n/2-2});for(var t=0;t<3;t++)this.cornerstoneArray[t]&&this.cornerstoneArray[t].resizeCon()}},{key:"renderAllLayer",value:function(){for(var e=0;e<3;e++){var n=this.dom.find(".cb"+e+" .layer").html().split("/")[0];n&&this.cornerstoneArray[e].funcNodule(n)}}},{key:"nidusChoose",value:function(e){this.chooseNidus=e,this.renderAllLayer()}}]),progress}(Interstellar.moduleBase);module.exports=progress},1068:function(e,n,t){var o=t(1069);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1069:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".mprc {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  background: #000;\n}\n.mprc .close_btn {\n  position: absolute;\n  top: 0;\n  left: 0;\n  color: #fff;\n  font-size: 12px;\n}\n.mprc .line {\n  position: absolute;\n  -webkit-touch-callout: none;\n  /* iOS Safari */\n  -webkit-user-select: none;\n  /* Chrome/Safari/Opera */\n  -khtml-user-select: none;\n  /* Konqueror */\n  -moz-user-select: none;\n  /* Firefox */\n  -ms-user-select: none;\n  /* Internet Explorer/Edge */\n  user-select: none;\n  width: 100%;\n  top: 0;\n  left: 0;\n}\n.mprc .le,\n.mprc .ri {\n  position: relative;\n  width: 50%;\n  height: 100%;\n}\n.mprc .c_fbb03b {\n  border: 1px solid #1f474c;\n  position: relative;\n}\n.mprc .c_fbb03b .wwc {\n  position: absolute;\n  bottom: 35px;\n  right: 10px;\n}\n.mprc .c_fbb03b .layer {\n  position: absolute;\n  bottom: 10px;\n  right: 10px;\n}\n.mprc .c_fbb03b .sc {\n  position: absolute;\n  left: 10px;\n  right: 10px;\n}\n.mprc .cb0 {\n  height: 100%;\n}\n.mprc .cb0 .c0 {\n  height: 100%;\n}\n.mprc .cb0 #cb0 {\n  height: 100%;\n}\n.mprc .cb1 {\n  height: 50%;\n}\n.mprc .cb1 .c1 {\n  height: 100%;\n}\n.mprc .cb1 #cb1 {\n  height: 100%;\n}\n.mprc .cb2 {\n  height: 50%;\n}\n.mprc .cb2 .c2 {\n  height: 100%;\n}\n.mprc .cb2 #cb2 {\n  height: 100%;\n}\n",""])},1070:function(e,n){e.exports='<div class=mprc> <div class="fl le"> <div class="c_fbb03b cb0"> <div class="w50_ pr c0"> <div id=cb0></div> <div class=line></div> </div> <p class=xyz></p> <p class=sc></p> <p class=wwc></p> <p class=layer></p> </div> </div> <div class="fl ri"> <div class="c_fbb03b cb1"> <div class="w50_ pr c1"> <div id=cb1></div> <div class=line></div> </div> <p class=xyz></p> <p class=sc></p> <p class=wwc></p> <p class=layer></p> </div> <div class="c_fbb03b cb2"> <div class="w50_ pr c2"> <div id=cb2></div> <div class=line></div> </div> <p class=xyz></p> <p class=sc></p> <p class=wwc></p> <p class=layer></p> </div> </div> <div style=clear:both></div> <p class=close_btn><span>x</span></p> </div>'},1071:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.event=new Interstellar.event}return o(e,[{key:"imageList",value:function(e){this.len=e.length,this.count=0,this.type="jpg",this.startNum=0,-1!=e[0].toLocaleLowerCase().lastIndexOf(".dcm")&&(this.type="dcm"),window.imageList=new Array(this.len),this.zUrl=new Array(this.len);for(var n=0;n<this.len;n++)this.zUrl[n]="jpg"==this.type?"glayImage:z"+n:"pixImage:z"+n;"jpg"==this.type?this.jpgParse(e,0):this.fiveLoad(e)}},{key:"fiveLoad",value:function(e){this.count=0,this.fiveL=0;for(var n=this.startNum;n<this.startNum+5;n++)console.log(n),this.dcmParse(e,n)}},{key:"dcmParse",value:function(e,n){var t=this;if(!(n>this.len-1)&&e[n]){this.fiveL++;var o=document.createElement("div");cornerstone.enable(o),console.log(e[n]),cornerstone.loadImage(e[n]).then(function(i){console.log(i),t.count++,t.startNum++,window.imageList[n]||(window.imageList[n]=new Array(i.columns)),0==n&&t.urlAddress(i.columns,i.rows),t.z||(t.z=[]),t.width=i.columns,t.height=i.rows,t.z[n]=i.data.string("x00200032").match(/(\-|\+)?\d+(\.\d+|\d)/g)[2],window.targetInfo={wc:i.data.string("x00281050").match(/(\-|\+)?\d+/g)[0],ww:i.data.string("x00281051").match(/(\-|\+)?\d+/g)[0],columnPixelSpacing:i.columnPixelSpacing,rowPixelSpacing:i.rowPixelSpacing};for(var a=i.getPixelData(),r=0;r<a.length;r++){var s=Math.floor(r/i.columns);window.imageList[n][s]||(window.imageList[n][s]=new Int16Array(i.columns));var l=a[r]*i.slope+i.intercept;window.imageList[n][s][Math.floor(r%i.columns)]=l,window.targetInfo.min=window.targetInfo.min&&window.targetInfo.min<l?window.targetInfo.min:l,window.targetInfo.max=window.targetInfo.max&&window.targetInfo.max>l?window.targetInfo.max:l}cornerstone.disable(o),t.count==t.fiveL&&(t.startNum<t.len-1?t.fiveLoad(e):(window.depth=Math.abs(t.z[0]-t.z[1]),t.event._dispatch("makeJPG.finish")))})}}},{key:"jpgParse",value:function(e,n){var t=this;if(e[n]){var o=new Image;o.crossOrigin="anonymous",o.onload=function(){t.count++;var e=document.createElement("CANVAS");t.width=this.width,t.height=this.height,e.setAttribute("width",this.width),e.setAttribute("height",this.height),0==n&&t.urlAddress(this.width,this.height),window.imageList[n]||(window.imageList[n]=new Array(this.height));var o=e.getContext("2d");o.drawImage(this,0,0);for(var i=o.getImageData(0,0,this.width,this.height).data,a=i.length/4,r=0;r<a;r++){var s=Math.floor(r/this.width);window.imageList[n][s]||(window.imageList[n][s]=new Uint8Array(this.width)),window.imageList[n][s][Math.floor(r%this.width)]=i[4*r]}o=null,i=null,e=null,t.count<t.len||t.event._dispatch("makeJPG.finish")},o.onerror=function(){console.log("error")},o.src=e[n].replace("myImageLoader:",""),this.jpgParse(e,n+1)}}},{key:"urlAddress",value:function(e,n){this.xUrl=new Array(e),this.yUrl=new Array(n);for(var t=0;t<e;t++)this.xUrl[t]="jpg"==this.type?"glayImage:x"+t:"pixImage:x"+t;for(var o=0;o<n;o++)this.yUrl[o]="jpg"==this.type?"glayImage:y"+o:"pixImage:y"+o}},{key:"clearAllData",value:function(){window.imageList=null,window.wwc=null,window.depth=null,this.xUrl=this.yUrl=this.zUrl=this.len=null}}]),e}();e.exports=i},1072:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(1073);var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),ES.selctorDoc("#content #right-content").css({margin:0});var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return r.html=t(1075),r.cornerstoneArray={},r.myScrollgood=null,r.deferred=ES.Deferred(),r.chooseData={},r.loadAll={},r.loadId=0,r.nowplayData=null,r.listData=null,r.sequencelistData=[],r.currentSid="",r.ClipboardJS=t(237),r.isShowSequenceStatistics=!1,r.drawInfo=t(955),r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.moduleBase),o(n,[{key:"complete",value:function(){var e=this;this.dom.find(".sequence-sort-btn").on("click",function(){e.sortByDom()})}},{key:"showNowData",value:function(e){if(this.currentSid=e,e){if(this.dom.find(".nodeInfo .nodeInfolist>div").hide(),!this.dom.find(".nodeInfo .nodeInfolist>div").dom)return;var n=e.split("_");this.dom.find(".nodeInfo .nodeInfolist>div").dom.map(function(e){-1!=n.lastIndexOf(e.attr("sid"))&&e.show()}),this.initscrollgood(),this.showMarkCount(e)}else this.dom.find(".nodeInfo")}},{key:"upCal",value:function(e){var n="one_"+e.id,t=this.chooseData.element.find(".nodeInfo ."+n+" .socre_cal");t.dom&&t.html(e.cal)}},{key:"updateSequencelistSid",value:function(e){this.dom.find('div[bid="'+e.id+'"]').attr("sid",e.sId)}},{key:"sortSequenceList",value:function(e){e.sort(function(e,n){return n.layerNumber===e.layerNumber?e.type===n.type?e.backId-n.backId:"imagetag"===n.type?1:-1:e.layerNumber-n.layerNumber})}},{key:"sortByDom",value:function(){var e=this;setTimeout(function(){var n=e.currentSid,t=$('.sequencelist .nodeInfolist div[sid="'+n+'"]').get();t.sort(function(e,n){var t=$(e),o=$(n),i=Number(t.attr("layerinfo"))-Number(o.attr("layerinfo"));return 0===i?t.attr("tooltype")===o.attr("tooltype")||"IMAGE_TAG"!==o.attr("tooltype")&&"IMAGE_TAG"!==t.attr("tooltype")?Number(t.attr("bid"))-Number(o.attr("bid")):"IMAGE_TAG"===o.attr("tooltype")?1:-1:i}),$(".sequencelist .nodeInfolist").append(t),e.initscrollgood(),e.scrollToChooseItem()},300)}},{key:"setData",value:function(e,n,t){var o=this.listData=e;this.sequencelistData=n,this.dom.find(".sequencelist").html(""),this.myScrollgood=null;for(var i=0,a=o.length;i<a;i++)this.initsingle(i,o[i]);n.length&&this.sortSequenceList(n);for(var r=0,s=n.length;r<s;r++){var l=n[r];this.addNode(l)}this.isShowSequenceStatistics=t}},{key:"setHasAuditedNode",value:function(e){var n=e.sId,t=e.backId,o=$(".ctcornerstone .xulielist .sequencelist .nodeInfolist").find("div[sid='"+n+"'][bid='"+t+"']");!o.hasClass("audited")&&o.addClass("audited"),this.showMarkCount()}},{key:"showMarkCount",value:function(e){var n=window.location.hash,t=n.includes("markaudit/")||n.includes("markauditview/");e=e||this.currentSid;for(var o=0,i=0,a=0,r=0,s=$('.sequencelist .nodeInfolist div[sid="'+e+'"]'),l=0;l<s.length;l++){var d=s[l],c=$(d).attr("tooltype"),u=$(d).hasClass("audited");"IMAGE_TAG"===c?(o++,u&&a++):(i++,u&&r++)}this.dom.find("#layerMarkCount").html(o),this.dom.find("#nidusMarkCount").html(i),this.dom.find("#auditLayerMarkCount").html(a),this.dom.find("#auditNidusMarkCount").html(r);var h=this.dom.find(".sequence-statistics-wrapper");h.removeClass("audit-wrapper"),t&&h.addClass("audit-wrapper"),h.css({display:"block"})}},{key:"setLayerInfo",value:function(e,n){this.dom.find('div[bid="'+e.id+'"]').attr("layerinfo",n),this.dom.find('div[bid="'+e.id+'"] .edit_color ul').attr("layerinfo",n)}},{key:"setBackId",value:function(e){var n=this.dom.find("div[uuid='"+e.uuid+"']");n.attr("bid",e.backId),n.addClass("one_"+e.backId),n.find(".cul").dom&&n.find(".cul").attr("bid",e.backId),n.find(".nname").click();var t=Tool.configobjformat(this.app.constmap.LESION);n.find(".nname").html(t[e.toolType.imageAnnotation]+"_"+e.backId)}},{key:"openNode",value:function(e){this.dom.find("div[bid='"+e.id+"'] .nname").click()}},{key:"findNidusFromList",value:function(e,n,t){var o=$('.sequencelist .nodeInfolist div[sid="'+e+'"][layerinfo="'+n+'"][tooltype="'+t+'"]');if(o.length)return o}},{key:"addNode",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(e.type){case"length":case"freehandline":case"rectangleRoi":case"ellipticalRoi":case"simpleAngle":case"cobb":case"imagetag":this.addNormal(e,"nobrush",n);break;case"brush":case"alignment":case"magicStickSingle":case"polygon":case"freehand":case"quickselect":case"regionpaint":this.addNormal(e,"brush",n)}n&&this.sortByDom(),n&&this.showMarkCount()}},{key:"returnAnno",value:function(e){return this.dom.find('div[bid="'+e.backId+'"]').attr("niddtype")}},{key:"removeNode",value:function(e){var n=this.chooseData.element,t="one_"+(e.backId||e.uuid);n.find(".nodeInfo .nodeInfolist ."+t).remove(),this.showMarkCount(this.currentSid),this.initscrollgood()}},{key:"setNname",value:function(e,n){this.dom.find('div[bid="'+e+'"] .nname').html(n)}},{key:"addNormal",value:function(e,n,t){var o=this.chooseData.element,i="one_"+e.uuid,a=o.find(".nodeInfo ."+i),r=this,s=Tool.configobjformat(this.app.constmap.LESION),l=e.imageAnnotationToolType||e.tooltype,d=["AA1113","F5A623","F8E71C","7ED321","4A90E2","50E3C2","8B572A","417505","B8E986","BD10E0"];if(!a.dom){var c=null!==e.auditResult&&void 0!==e.auditResult,u=-1!==window.location.hash.lastIndexOf("markaudit")&&c?"audited":"",h='<div sId="'+e.sId+'" bid="'+(e.backId?e.backId:"")+'" niddtype="'+e.toolType.imageAnnotation+'" uuid="'+e.uuid+'" toolType="'+l+'" layerInfo="'+e.layerNumber+'" class="'+i+" "+(t&&"IMAGE_TAG"===l?"choose":"")+" "+u+'"><div>';if("brush"==n){h+='<div class="edit_color"><span class="color_c c1"></span><ul class="cul" sId="'+e.sId+'" bid="'+(e.backId?e.backId:"")+'" uuid="'+e.uuid+'" layerInfo="'+e.layerNumber+'">';for(var m=0;m<d.length;m++)h+='<li class="color_li" name="'+d[m]+'" data="'+d[m]+'">\n          <span class="cc c'+(m+1)+'"></span>\n          <span class="textc">'+d[m]+"</span>\n          </li>";h+='</ul></div><span class=\'fillcon iconfont icon-danxinggoumian1\' title="去除填充" cc="fill"></span>'}h+='<p class="nname">'+s[e.toolType.imageAnnotation]+"_"+e.uuid+"</p>"+("imagetag"!==e.type?"<span class='showHide chooseIcon iconfont icon-biyan1'></span>":"<span class='layer-number-tip'>"+e.layerNumber+"</span>"),-1==this.app.parpam.type.lastIndexOf("viewer")&&-1==this.app.parpam.type.lastIndexOf("check")&&(h+='<span class="del"><i class="iconfont icon-shanchu" enable="enable"></i></span>'),"脑出血"!=s[e.toolType.imageAnnotation]?h+="</div></div>":h+='</div><div class="socre_cal">出血量:'+(e.cal||0)+"mm<sup>3</sup></div>",r.clearChoosed(),o.find(".nodeInfolist").append(h),o.find("."+i+" .nname").on("click",function(){r.btnClick(ES.selctorDoc(this).parent().parent(),n)}),o.find("."+i+" .showHide").on("click",function(){var e=ES.selctorDoc(this),n=e.parent().parent(),t=!0;e.hasClass("icon-biyan1")?(e.removeClass("icon-biyan1"),e.addClass("icon-biyan"),t=!1):(e.addClass("icon-biyan1"),e.removeClass("icon-biyan"),t=!0),r.event._dispatch("sequencelist.closeWho",{show:t,uuid:n.attr("uuid"),sId:n.attr("sId"),bid:n.attr("bid"),tooltype:n.attr("toolType"),layerNumber:n.attr("layerInfo")})}),o.find("."+i+" .fillcon").on("click",function(){var e=ES.selctorDoc(this),n=e.parent().parent(),t=!0;"fill"==e.attr("cc")?(e.removeClass("icon-danxinggoumian1"),e.addClass("icon-danxinggoumian"),e.attr("cc","none"),t=!1):(e.attr("cc","fill"),e.removeClass("icon-danxinggoumian"),e.addClass("icon-danxinggoumian1"),t=!0),r.event._dispatch("sequencelist.fillWho",{fill:t,uuid:n.attr("uuid"),sId:n.attr("sId"),bid:n.attr("bid"),tooltype:n.attr("toolType"),layerNumber:n.attr("layerInfo")})}),o.find("."+i+" .color_c").on("click",function(){var e=$("."+i+" .cul"),n=e.outerHeight(),t=$(this).parent().parent().parent();n>$(window).height()-t[0].getBoundingClientRect().bottom-50?e.css({top:"unset",bottom:20}):e.css({top:30,bottom:"unset"}),e.show()}),o.find("."+i+" .cul .color_li").on("click",function(){o.find("."+i+" .cul").hide();var e=ES.selctorDoc(this),n=e.parent(),t=e.attr("data");o.find("."+i+" .color_c").css({background:"#"+t}),r.event._dispatch("sequencelist.changeColor",{color:t,uuid:n.attr("uuid"),sId:n.attr("sId"),bid:n.attr("bid"),layerNumber:n.attr("layerInfo")})}),o.find("."+i+" .del").on("click",function(){var e=ES.selctorDoc(this).parent().parent();r.event._dispatch("sequencelist.del",{toolType:o.attr("toolType"),type:n,uuid:e.attr("uuid"),sId:e.attr("sId"),layerNumber:e.attr("layerInfo"),bid:e.attr("bid")})}),o.find("."+i+" .edit").on("click",function(){r.btnClick(ES.selctorDoc(this).parent().parent(),n)})}this.initscrollgood()}},{key:"updateStatisticsData",value:function(e,n){if("imagetag"===e){var t=this.dom.find("#layerMarkCount");t.html(+t.html()+n)}else{var o=this.dom.find("#nidusMarkCount");o.html(+o.html()+n)}}},{key:"clickById",value:function(e){var n=this.chooseData.element,t="one_"+e.uuid;n.find(".nodeInfo ."+t).find(".nname").click(),this.scrollToChooseItem()}},{key:"clearChoosed",value:function(){$(".sequencelist .nodeInfo .choose").removeClass("choose")}},{key:"btnClick",value:function(e,n,t){var o=e,i=o.hasClass("choose");this.dom.find(".sequencelist .nodeInfo .choose").removeClass("choose"),i||o.addClass("choose"),o.attr("brushtype",n),this.event._dispatch("sequencelist.niddclick",o)}},{key:"initsingle",value:function(e,n){var t=this,o="cdd"+Math.floor((new Date).getTime()*Math.random());this.loadAll[o]=!1;var i="";0!=e?i="style='display:none'":this.nowplayData={data:n,num:0};var a="<li "+i+'  sid="'+n.studyId+'" datamain="'+n.major+'" class="wk" onmousemove="return false;" unselectable="on" onselectstart="return false;"><div class="head-name" data-num="'+e+'">\n        <p title="'+n.sequenceName+'" class="sequence-wrapper" data-clipboard-text="'+n.sequenceName+'"><span class="sequenceName">'+n.sequenceName+'</span></p><span class=\'showHide chooseIcon iconfont icon-biyan1\'></span></div>\n        <div class="nodeInfo">\n        <div class="nodeInfolist"></div>\n        </div>\n        <div class="cc" id="'+o+'" oncontextmenu="return false" style="width: 110px;height: 110px; display:none;" unselectable="on" onselectstart="return false;" onmousedown="return false;"></div>\n        </li>';this.dom.find(".sequencelist").append(a),0==e&&(this.chooseData.element=this.dom.find('li[sid="'+n.studyId+'"]')),new this.ClipboardJS(".sequence-wrapper").on("success",function(e){t.app.alert.show({title:"提示",msg:"已复制到粘贴板",close:!1})}),this.dom.find(".sequencelist .head-name .showHide").on("click",function(e){var n=ES.selctorDoc(this);t.dom.find(".nodeInfolist .showHide").removeClass("icon-biyan1");var o=!0;n.hasClass("icon-biyan1")?(n.removeClass("icon-biyan1"),n.addClass("icon-biyan"),t.dom.find(".nodeInfolist .showHide").removeClass("icon-biyan1"),t.dom.find(".nodeInfolist .showHide").addClass("icon-biyan"),o=!1):(n.addClass("icon-biyan1"),n.removeClass("icon-biyan"),t.dom.find(".nodeInfolist .showHide").removeClass("icon-biyan"),t.dom.find(".nodeInfolist .showHide").addClass("icon-biyan1"),o=!0),t.event._dispatch("sequencelist.allShowControl",{show:o})}),this.dom.find(".sequencelist .head-name").eq(0).css({background:"#95d4e2",color:"#333"})}},{key:"resize",value:function(){this.initscrollgood()}},{key:"initscrollgood",value:function(){var e=ES.selctorDoc(window).box().clientHeight-220;if(this.dom.find(".nodeInfo").css({height:e}),this.myScrollgood)this.myScrollgood.refresh();else{var n="aaaww_"+Math.floor((new Date).getTime()*Math.random());this.dom.find(".nodeInfo").attr("id",n),this.myScrollgood=new IScroll("#"+n,{scrollbars:!0,mouseWheel:!0,interactiveScrollbars:!0,hideScrollbar:!1,vScrollbar:!0,shrinkScrollbars:"scale",fadeScrollbars:!1,disableMouse:!0,disablePointer:!0})}}},{key:"scrollToChooseItem",value:function(){if(this.myScrollgood){var e=$(".sequencelist .nodeInfo .choose");if(e.length){var n=$(".nodeInfo").height(),t=e.offset().top;t>=166&&t<=n+166||this.myScrollgood.scrollToElement(".sequencelist .nodeInfolist .choose",100)}}}}]),n}();e.exports=i},1073:function(e,n,t){var o=t(1074);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1074:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".sequencelist .wk {\n  width: 100%;\n  border-radius: 2px;\n  position: relative;\n}\n.sequencelist .wk .head-name {\n  padding: 8px 0;\n}\n.sequencelist .wk .head-name p {\n  width: 130px;\n  font-size: 14px;\n  line-height: 30px;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  text-align: center;\n  margin-left: 29px;\n  color: #fff;\n}\n.sequencelist .wk .head-name .sequence-wrapper {\n  cursor: pointer;\n}\n.sequencelist .wk .head-name .sequence-wrapper .sequenceName {\n  display: unset;\n}\n.sequencelist .wk .head-name .showHide {\n  position: absolute;\n  top: 16px;\n  left: 10px;\n  color: #fff;\n  cursor: pointer;\n}\n.sequencelist .wk .cc {\n  width: 110px;\n  height: 110px;\n  margin-left: 5px;\n}\n.sequencelist .wk:hover .over {\n  display: block;\n}\n.sequencelist .nodeInfo {\n  overflow: hidden;\n  position: relative;\n}\n.sequencelist .nodeInfo .nodeInfolist > div {\n  width: 100%;\n  color: #71f9ff;\n  font-size: 12px;\n  line-height: 30px;\n}\n.sequencelist .nodeInfo .nodeInfolist > div > div {\n  text-align: left;\n  width: 160px;\n  margin-left: 10px;\n  position: relative;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .nname {\n  width: 67%;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  margin-left: 15px;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .nname span {\n  display: unset;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .nname .chooseIcon {\n  padding-left: 23px;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .fillcon {\n  position: absolute;\n  right: 10px;\n  top: 0;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .showHide {\n  position: absolute;\n  left: -5px;\n  top: 0;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .showHide .iconfont {\n  font-size: 12px;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .del {\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .del .iconfont {\n  font-size: 12px;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .edit {\n  position: absolute;\n  right: 20px;\n  top: 0;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .edit .iconfont {\n  font-size: 12px;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .edit_color {\n  position: absolute;\n  right: 50px;\n  top: 1px;\n  width: 20px;\n  height: 20px;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .edit_color .color_c {\n  position: absolute;\n  top: 8px;\n  left: 27px;\n  width: 14px;\n  height: 14px;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .edit_color ul {\n  position: absolute;\n  top: 30px;\n  left: -20px;\n  z-index: 40;\n  background: #0c1e21;\n  display: none;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .edit_color ul .color_li {\n  width: 80px;\n  height: 20px;\n  line-height: 20px;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .edit_color ul .color_li .cc {\n  width: 16px;\n  height: 16px;\n  margin-top: 2px;\n  vertical-align: text-bottom;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .edit_color ul .color_li .textc {\n  margin-left: 5px;\n  font-size: 12px;\n  line-height: 20px;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .c3 {\n  background: #f8e71c;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .c1 {\n  background: #aa1113;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .c2 {\n  background: #f5a623;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .c4 {\n  background: #7ed321;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .c5 {\n  background: #4a90e2;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .c6 {\n  background: #50e3c2;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .c7 {\n  background: #8b572a;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .c8 {\n  background: #417505;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .c9 {\n  background: #b8e986;\n}\n.sequencelist .nodeInfo .nodeInfolist > div .c10 {\n  background: #bd10e0;\n}\n.sequencelist .nodeInfo .nodeInfolist > div.choose {\n  background: #095c85;\n  color: #fff;\n}\n.sequencelist .nodeInfo .nodeInfolist > div.audited .icon-biyan,\n.sequencelist .nodeInfo .nodeInfolist > div.audited .icon-biyan1,\n.sequencelist .nodeInfo .nodeInfolist > div.audited .layer-number-tip {\n  color: yellow;\n}\n.sequencelist .layer-number-tip {\n  font-family: cursive;\n  color: #ade9ea;\n  position: absolute;\n  left: -10px;\n  top: 1px;\n  text-align: center;\n  width: 22px;\n}\n.sequence-statistics-wrapper {\n  width: 100%;\n  display: none;\n  position: absolute;\n  bottom: 10px;\n  color: #fff;\n  padding-left: 25px;\n}\n.sequence-statistics-wrapper.audit-wrapper {\n  padding-left: 15px;\n}\n.sequence-statistics-wrapper.audit-wrapper .audit-info {\n  display: inline-block;\n  font-size: 12px;\n}\n.sequence-statistics-wrapper.audit-wrapper .sequence-sort-btn {\n  display: none;\n}\n.sequence-statistics-wrapper .audit-info {\n  display: none;\n}\n.sequence-statistics-wrapper .sequence-sort-btn {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  border: 1px solid #999;\n  background: #999;\n  color: #fff;\n  font-size: 12px;\n  padding: 2px;\n  cursor: pointer;\n}\n",""])},1075:function(e,n){e.exports="<div class=sequence-body> <ul class=sequencelist> </ul> <div class=sequence-statistics-wrapper> <p> <span>图层标记：</span><span id=layerMarkCount></span> <span class=audit-info>（已审<span id=auditLayerMarkCount></span>）</span> </p> <p> <span>病灶标记：</span><span id=nidusMarkCount></span> <span class=audit-info>（已审<span id=auditNidusMarkCount></span>）</span> </p> <div class=sequence-sort-btn>排序</div> </div> </div> "},1076:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(1077);var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return r.html=t(1079),r.cornerstoneArray={},r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.moduleBase),o(n,[{key:"complete",value:function(){this.dom.find(".serieslist").html(""),this.class_c=t(935)}},{key:"setData",value:function(e,n){var t=this,o=this.listData=e;this.dom.find(".serieslist").html("");var i="",a=0;for(var r in o)o[r].index=a,i+=this.initsingle(o[r],n),a++;if(this.dom.find(".serieslist").append(i),this.dom.find(".serieslist").css({width:105*a}),"DCM"==n)for(var s in o)new this.class_c({element:this.dom.find("#img"+o[s].index).dom[0].dom,totalImage:1,imageAddress:[o[s].imgs[0]],index:(Tool.changeToName(o[s].imgs[0])||1)-1,type:"dcm"});this.dom.find(".serieslist .wk").on("click",function(){var e=ES.selctorDoc(this);t.event._dispatch("serieslist.clcik",{sid:e.attr("sid")})}),this.initscrollgood()}},{key:"initsingle",value:function(e,n){var t=e.info.data;if(!e.imgs[0])return'<li  title="" sid="'+t.seriesInstanceUID+'" class="wk" onmousemove="return false;" unselectable="on" onselectstart="return false;">\n        <div class="imgContent" id="img'+e.index+'"></div><div class="head-name"><p><span>总张数：0</span></p></div></li>';var o=e.imgs[0].replace("myImageLoader:",""),i='<li  title="'+t.seriesInstanceUID+'" sid="'+t.seriesInstanceUID+'" class="wk" onmousemove="return false;" unselectable="on" onselectstart="return false;">\n        <div class="imgContent" id="img'+e.index+'">';return i+="DCM"==n?"":"<img src="+o+" />",i+='</div>\n        <div class="head-name"><p><span>总张数：'+e.imgsTotal+"</span></p></div>\n        </li>"}},{key:"resize",value:function(){this.initscrollgood()}},{key:"initscrollgood",value:function(){if(this.myScrollgood)this.myScrollgood.refresh();else{var e="aaa_"+Math.floor((new Date).getTime()*Math.random());this.dom.find(".sequence-body").parent().attr("id",e),this.myScrollgood=new IScroll("#"+e,{scrollbars:!0,mouseWheel:!0,scrollX:!0,interactiveScrollbars:!0,hideScrollbar:!1,vScrollbar:!0,shrinkScrollbars:"scale",fadeScrollbars:!1,disableMouse:!0,disablePointer:!0})}}}]),n}();e.exports=i},1077:function(e,n,t){var o=t(1078);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1078:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".sequence-body-parent {\n  overflow: hidden;\n  display: inline-block;\n  width: auto;\n}\n.sequence-body-parent .sequence-body {\n  display: inline-block;\n  width: auto;\n}\n.sequence-body-parent .sequence-body .serieslist {\n  height: 100px;\n}\n.sequence-body-parent .sequence-body .serieslist .wk {\n  width: 100px;\n  border-radius: 2px;\n  position: relative;\n  float: left;\n  border: 1px solid #ccc;\n  box-sizing: border-box;\n  margin-right: 5px;\n}\n.sequence-body-parent .sequence-body .serieslist .wk .imgContent {\n  width: 70px;\n  height: 70px;\n  margin-left: 15px;\n  position: relative;\n  overflow: hidden;\n}\n.sequence-body-parent .sequence-body .serieslist .wk .imgContent img {\n  width: 100%;\n}\n.sequence-body-parent .sequence-body .serieslist .wk .head-name {\n  height: 24px;\n  width: 100%;\n  padding: 4px 0;\n}\n.sequence-body-parent .sequence-body .serieslist .wk .head-name p {\n  width: 100px;\n  font-size: 12px;\n  line-height: 24px;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  text-align: center;\n  color: #fff;\n}\n.sequence-body-parent .sequence-body .serieslist .wk .head-name span {\n  display: unset;\n}\n.sequence-body-parent .sequence-body .serieslist .wk .cc {\n  width: 110px;\n  height: 110px;\n  margin-left: 5px;\n}\n.sequence-body-parent .sequence-body .serieslist .wk:hover .over {\n  display: block;\n}\n.sequence-body-parent .sequence-body .serieslist .nodeInfo {\n  overflow: hidden;\n  position: relative;\n}\n.sequence-body-parent .sequence-body .serieslist .nodeInfo .nodeInfolist > div {\n  width: 100%;\n  color: #71f9ff;\n  font-size: 12px;\n  line-height: 30px;\n}\n.sequence-body-parent .sequence-body .serieslist .nodeInfo .nodeInfolist > div > div {\n  text-align: left;\n  width: 160px;\n  margin-left: 10px;\n  position: relative;\n}\n.sequence-body-parent .sequence-body .serieslist .nodeInfo .nodeInfolist > div .nname {\n  width: 75%;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n.sequence-body-parent .sequence-body .serieslist .nodeInfo .nodeInfolist > div .nname span {\n  display: unset;\n}\n.sequence-body-parent .sequence-body .serieslist .nodeInfo .nodeInfolist > div .del {\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n.sequence-body-parent .sequence-body .serieslist .nodeInfo .nodeInfolist > div .del .iconfont {\n  font-size: 12px;\n}\n.sequence-body-parent .sequence-body .serieslist .nodeInfo .nodeInfolist > div .edit {\n  position: absolute;\n  right: 20px;\n  top: 0;\n}\n.sequence-body-parent .sequence-body .serieslist .nodeInfo .nodeInfolist > div .edit .iconfont {\n  font-size: 12px;\n}\n.sequence-body-parent .sequence-body .serieslist .nodeInfo .nodeInfolist > div.choose {\n  background: #095c85;\n  color: #fff;\n}\n",""])},1079:function(e,n){e.exports="<div class=sequence-body-parent> <div class=sequence-body> <ul class=serieslist> </ul> </div> </div> "},1080:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return t(1081),r.html=t(1083),r.name="nidusinfo",r.chooseData={},r.doctorResult={},r.reportControl=null,r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.moduleBase),o(n,[{key:"complete",value:function(){this.btnEvent(),this.myScrollgood=null,this.myScrollgood1=null,this.resize()}},{key:"btnEvent",value:function(){var e=this;this.dom.find(".btn-cancle").on("click",function(){e.hide(),$(".sequencelist .nodeInfo .choose").removeClass("choose")})}},{key:"clearRemark",value:function(){this.dom.find(".nidusinfo .remark input").val("")}},{key:"updataReport",value:function(e,n){this.reportControl&&this.reportControl.updataData(e,n)}},{key:"setLayerMarkData",value:function(e){if(e){var n=$(".nidusinfo .socrll > div:first");n.find(".layer-mark-wrapper").length||n.prepend('\n          <div class="layer-mark-title" style="margin-top:6px">图层标注 [<span class="layer-mark-layernumber">1</span>]</div>\n          <div class="layer-mark-wrapper"></div>'),this.makeOption(e,"layer-mark-wrapper",!0)}}},{key:"setData",value:function(e,n,o,i){var a=this;if(this.chooseData={},this.showReport=o?o.inspectSee||o.diagnosisIncome:null,this.showReport){var r=t(1084);this.reportControl=this.app.loadModule(r,this.dom.find(".nidusinfo .report"),o)}else this.dom.find(".report").html("");o&&o.remark?(-1!=this.app.parpam.type.lastIndexOf("viewer")&&this.dom.find(".nidusinfo .remark input").attr("readonly","readonly"),this.dom.find(".nidusinfo .remark input").val(o.seriesRemark?o.seriesRemark:""),this.dom.find(".nidusinfo .remark input").blur(function(){a.remarkRes=a.dom.find(".nidusinfo .remark input").val(),a.event._dispatch("nidusinfo.remarkFinish")})):this.dom.find(".nidusinfo .remark").html("");var s=-1==window.location.hash.lastIndexOf("/doctorAudEdit/")&&-1==window.location.hash.lastIndexOf("/mark/")&&-1==window.location.hash.lastIndexOf("/markview/")&&-1==window.location.hash.lastIndexOf("/markpreview/")&&-1==window.location.hash.lastIndexOf("/markseriesview/"),l=-1==window.location.hash.lastIndexOf("/drapCanvas/")&&-1==window.location.hash.lastIndexOf("/drapCanvasCheck/")&&-1==window.location.hash.lastIndexOf("/drapCanvasView/");if(s&&l&&(i||"{}"!=JSON.stringify(e.annotationItemResultList))){var d={};if(i)for(var c in i)d=this.dealnidus(i[c],c,e,d);var u=e.annotationItemResultList.doctorId;u&&(d=this.dealnidus(e.annotationItemResultList.orginannotationItemResultList,u,e,d)),this.makeMarkScroe(d,u)}this.dom.find(".config_content").html(""),this.dom.find(".socrll .node-name").html(n),this.makeOption(e,"config_content"),this.resize()}},{key:"dealnidus",value:function(e,n,t,o){return e.map(function(e){if(t[e.formComponentId]){o[e.formComponentId]||(o[e.formComponentId]={name:"",res:[]},o[e.formComponentId].name=t[e.formComponentId].componentName);var i=JSON.parse(JSON.stringify(t[e.formComponentId]));i.doctorId=n,i.result=[],i.codeResult=e.result,-1!=e.result.lastIndexOf(",")?e.result.split(",").map(function(e){i.result.push(i.data?i.data[e]:e)}):i.result=[i.data?i.data[1*e.result]:e.result],o[e.formComponentId].res.push(i)}}),o}},{key:"makeMarkScroe",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.doctorResult=e;var t='<div><ul class="mark_doctor_content">';for(var o in 0===Object.keys(e).length&&n&&(t+='<li><p class="niddle-z"><span>医生：'+n+"</span></p></li>"),e)t+="<li>",t+='<p class="niddle-z"><span>'+e[o].name+"</span></p>",e[o].res.map(function(e){t+="<p><span>"+e.doctorId+"&nbsp;:&nbsp;</span>",e.result.map(function(e){t+="<span>"+(e||"未填")+"</span><br />"}),t+="</p>"}),t+="</li>";t+="</ul></div>",this.dom.find(".config_content_all .socrll1").html(t),this.dom.find(".mark-score").removeClass("hide"),this.myScrollgood1=this.initScoll(this.dom.find(".mark-score .socrll1"))}},{key:"clearAllLayerMarkChoosed",value:function(){for(var e in this.dom.find(".nidusinfo .layer-mark-wrapper").find(".choose").removeClass("choose"),this.chooseData){var n=this.chooseData[e];n.isImageTag&&(n.result="")}}},{key:"makeOption",value:function(e,n,t){var o={c:{},nc:{}};for(var i in e)if("annotationItemResultList"!==i){var a=e[i];t&&(a.isImageTag=!0),o[["checkbox","radiobox"].includes(a.type)?"c":"nc"][a.sequence]=a}var r='<ul class="node_info">',s='<ul class="node_info">',l=o.c,d=t&&!!e.annotationItemResultList;for(var c in l){var u=l[c];u&&(u.isImageTagSetCompData=d,!d&&(s+=this.returnHtmlDOM(u,u.id)),this.makeBtn(u,u.id,e.annotationItemResultList?e.annotationItemResultList[u.id]:null))}var h=o.nc;for(var m in h){var f=h[m];f&&(f.isImageTagSetCompData=d,!d&&(r+=this.returnHtmlDOM(f,f.id)),this.makeBtn(f,f.id,e.annotationItemResultList?e.annotationItemResultList[f.id]:null))}r+="</ul>",s+="</ul>",!d&&this.dom.find("."+n).append(""+r+s+'<div style="clear:both"></div>')}},{key:"makeBtn",value:function(e,n,t){var o=this;setTimeout(function(){o.toDoneCompend(e,n,t)},0)}},{key:"toDoneCompend",value:function(e,n,o){var i=this,a=this,r=e.isImageTag,s=e.isImageTagSetCompData,l=o?o.result:"";switch(e.type){case"select":t.e(82).then(function(){var i=t(919),s=[{optionname:"请选择",val:"请选择",idx:""}],l=null;JSON.parse(e.componentData).map(function(n){s.push({optionname:n.text,val:n.text,idx:n.code}),o?(1*o.result==1*n.code&&""!=o.result&&(l={optionname:n.text,val:n.text,idx:n.code}),""==o.result&&(l={optionname:"请选择",val:"请选择",idx:""})):(l={optionname:"请选择",val:"请选择",idx:""},e.componentParameter&&JSON.parse(e.componentParameter)&&JSON.parse(e.componentParameter).isdefault&&(l=s[0]))});var d=a.app.loadModule(i,a.dom.find('li[nodezd="'+n+'"]').firstchildren(".drop_down_content"),{className:"node-select",firstSelect:l||s[0],data:s});a.chooseData[d.dom.parent().attr("select_id")]={formComponentId:e.componentId,result:l?l.idx:s[0].idx,isImageTag:r},JSON.parse(e.componentParameter).isdefault&&!o&&(-1==window.location.hash.lastIndexOf("#!/markaudit/")||-1==window.location.hash.lastIndexOf("#!/drapCanvasAudEdit/")?a.event._dispatch("nidusinfo.finish",r):a.event._dispatch("nidusinfo.finish",!0)),d.event._addEvent("dropDown.clear",function(){a.chooseData[d.dom.parent().attr("select_id")].result="";var e=a.dom.find('li[nodezd="'+n+'"]').firstchildren(".drop_down_content").find(".nowname");e.val(""),e.attr("placeholder","请选择"),e.attr("data-idx",""),a.event._dispatch("nidusinfo.finish",r)}),d.event._addEvent("option.click",function(e){var n=e.idx||"";"check_reslut"==d.dom.parent().attr("select_id")&&1*e.idx==0&&a.syncResult(),a.chooseData[d.dom.parent().attr("select_id")].result=n.includes("props=")?"":n,a.event._dispatch("nidusinfo.finish",r)}),-1!=a.app.parpam.type.lastIndexOf("viewer")&&d.disable()}.bind(null,t)).catch(t.oe);break;case"text":this.chooseData[e.id]={result:l,formComponentId:e.componentId,isImageTag:r};var d=this.dom.find('li[nodezd="'+n+'"] input[name=input-text]');if(d.blur(function(){i.chooseData[e.id].result=d.val(),i.event._dispatch("nidusinfo.finish",r)}),d.val(l),-1!=this.app.parpam.type.lastIndexOf("viewer"))d.attr("readonly","readonly");else{var c=d.parent(),u=c.find(".icon-shanchutishiicon");c.on("mouseenter",function(){d.val()&&u.show()}),c.on("mouseleave",function(){u.hide()}),u.on("click",function(n){n.stopPropagation(),d.val(""),i.chooseData[e.id].result="",i.event._dispatch("nidusinfo.finish",r)})}break;case"radiobox":this.chooseData[e.id]={result:l,formComponentId:e.componentId,isImageTag:r};var h=JSON.parse(e.componentData);if(JSON.parse(e.componentParameter).isdefault,o?h.map(function(e){var t=i.dom.find('li[nodezd="'+n+'"]').find('div[code="'+e.code+'"]');o.result&&1*o.result==e.code?!t.hasClass("choose")&&t.addClass("choose"):t.hasClass("choose")&&t.removeClass("choose")}):e.componentParameter&&JSON.parse(e.componentParameter)?JSON.parse(e.componentParameter).isdefault&&(this.chooseData[e.id].result=h[0].code,this.dom.find('li[nodezd="'+n+'"]').find('div[code="'+h[0].code+'"]').addClass("choose"),this.event._dispatch("nidusinfo.finish",r)):h.map(function(e){var t=i.dom.find('li[nodezd="'+n+'"]').find('div[code="'+e.code+'"]');t.hasClass("choose")&&t.removeClass("choose")}),-1!=this.app.parpam.type.lastIndexOf("viewer")||s)return;var m=this.dom.find('li[nodezd="'+n+'"]').find(".radiobox");m.off("click"),m.on("click",function(){var e=ES.selctorDoc(this),t=e.parent().parent().attr("select_id");e.hasClass("choose")?(e.removeClass("choose"),a.chooseData[t].result=""):(a.dom.find('li[nodezd="'+n+'"]').find(".radiobox").removeClass("choose"),e.addClass("choose"),a.chooseData[t].result=e.attr("code")),a.event._dispatch("nidusinfo.finish",r)});break;default:if(this.chooseData[e.id]={result:o?","+o.result+",":"",formComponentId:e.componentId,isImageTag:r},o&&o.result.split(",").map(function(e){i.dom.find('li[nodezd="'+n+'"]').find('div[code="'+e+'"]').addClass("choose")}),-1!=this.app.parpam.type.lastIndexOf("viewer"))return;this.dom.find('li[nodezd="'+n+'"]').find(".checkbox").on("click",function(){var e=ES.selctorDoc(this),t=e.attr("type"),o=e.parent().parent().attr("select_id");e.hasClass("choose")?(e.removeClass("choose"),a.chooseData[o].result=a.chooseData[o].result?a.chooseData[o].result.replace(","+e.attr("code")+",",","):""):("sp"==t&&-1==e.attr("code")?(a.dom.find('li[nodezd="'+n+'"]').find(".checkbox").removeClass("choose"),a.chooseData[o].result=",-1,"):",-1,"==a.chooseData[o].result?(a.dom.find('li[nodezd="'+n+'"]').find('div[code="-1"]').removeClass("choose"),a.chooseData[o].result=","+e.attr("code")+","):a.chooseData[o].result=a.chooseData[o].result?a.chooseData[o].result+e.attr("code")+",":","+e.attr("code")+",",e.addClass("choose")),a.event._dispatch("nidusinfo.finish",r)})}}},{key:"syncResult",value:function(){var e=this;for(var n in this.doctorResult){var t=this.doctorResult[n];if(this.chooseData[n]||(this.chooseData[n]={annotationItemId:n,formComponentId:n,id:n,result:""}),t.res)switch(this.dom.find('li[nodezd="'+n+'"]').attr("ctype")){case"select":this.chooseData[n].result=t.res[0].codeResult,this.dom.find('li[nodezd="'+n+'"]').firstchildren(".drop_down_content").find(".nowname").val(this.doctorResult[n].res[0].result[0]);break;case"text":this.chooseData[n].result=t.res[0].codeResult,this.dom.find('li[nodezd="'+n+'"] input[name=input-text]').val(t.res[0].codeResult);break;case"radiobox":this.chooseData[n].result=t.res[0].codeResult,this.dom.find('li[nodezd="'+n+'"] .radiobox').removeClass("choose"),this.dom.find('li[nodezd="'+n+'"]').find('div[code="'+t.res[0].codeResult+'"]').addClass("choose");break;default:this.chooseData[n].result=","+t.res[0].codeResult+",",this.dom.find('li[nodezd="'+n+'"] .checkbox').removeClass("choose"),t.res[0].codeResult.split(",").map(function(t){t&&e.dom.find('li[nodezd="'+n+'"]').find('div[code="'+t+'"]').addClass("choose")})}}}},{key:"returnHtmlDOM",value:function(e,n){var t=-1!=e.type.lastIndexOf("checkbox")||-1!=e.type.lastIndexOf("radiobox")?"select-content1":"select-content",o='<li ctype="'+e.type+'" select_id="'+e.id+'" class="'+t+'" nodezd="'+n+'"><p class="niddle-z" title="'+e.name+'">';switch(e.optional?o+='<span style="color:#f00">*</span><span>'+e.name+"</span></p>":o+="<span>"+e.name+"</span></p>",e.type){case"select":e.relation,o+='<div class="drop_down_content"></div>';break;case"text":o+='<p><input class="input-t" value="" name="input-text"></input><i class="iconfont icon-shanchutishiicon" style="display: none"></i></p>';break;case"textarea":o+='<textarea class="input-tex" value="" name="input-text"></textarea>';break;case"text-s":o+='<input class="input-r" readonly="readonly" value=""></input>';break;case"radiobox":for(var i in e.data)o+='<div class="check-choose"><div class="radiobox radio-box" code="'+i+'" data-ini="'+e.data[i]+'"></div><span title="'+e.data[i]+'">'+e.data[i]+"</span></div>";break;case"checkbox":for(var i in e.data)o+='<div class="check-choose"><div class="checkbox check-box" code="'+i+'" data-ini="'+e.data[i]+'"></div><span title="'+e.data[i]+'">'+e.data[i]+"</span></div>";break;case"checkbox-sp":for(var i in e.data)o+='<div class="check-choose"><div class="checkbox check-box" type="sp" code="'+i+'" data-ini="'+e.data[i]+'"></div><span title="'+e.data[i]+'">'+e.data[i]+"</span></div>"}return o+="</li>"}},{key:"resize",value:function(){var e=ES.selctorDoc(window).box().clientHeight-60-64;this.showReport&&(e-=160),this.dom.find(".mark-score .socrll1").css({height:e-55}),this.dom.find(".nidusinfo").firstchildren(".socrll").css({height:e-35}),this.myScrollgood?this.myScrollgood.refresh():this.myScrollgood1?this.myScrollgood1.refresh():(this.myScrollgood=this.initScoll(this.dom.find(".nidusinfo .socrll")),this.myScrollgood1=this.initScoll(this.dom.find(".mark-score .socrll1")))}},{key:"initScoll",value:function(e){var n="aaa_"+Math.floor((new Date).getTime()*Math.random());return e.attr("id",n),new IScroll("#"+n,{scrollbars:!0,mouseWheel:!0,interactiveScrollbars:!0,hideScrollbar:!1,vScrollbar:!0,shrinkScrollbars:"scale",fadeScrollbars:!1,disableMouse:!0,disablePointer:!0})}},{key:"showClose",value:function(){this.dom.find(".btn_content").eq(0).removeClass("hide")}},{key:"show",value:function(){this.dom.show()}},{key:"isShow",value:function(){return-1===this.dom.attr("style").lastIndexOf("none")}},{key:"hide",value:function(){this.dom.hide()}}]),n}();e.exports=i},1081:function(e,n,t){var o=t(1082);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1082:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".nidusinfo {\n  padding: 10px;\n  background: #0a2634;\n  position: relative;\n}\n.nidusinfo .socrll1,\n.nidusinfo .socrll {\n  overflow: hidden;\n  position: relative;\n}\n.nidusinfo .remark .socrllr {\n  overflow: hidden;\n  position: relative;\n}\n.nidusinfo .remark .socrllr .con {\n  border: 1px solid #fff;\n  padding: 0 5px;\n  background: transparent;\n  color: #fff;\n}\n.nidusinfo .remark .node-name {\n  color: #fff;\n  border-bottom: 1px solid #fff;\n  margin-bottom: 10px;\n  padding-bottom: 5px;\n}\n.nidusinfo .node-name,\n.nidusinfo .layer-mark-title {\n  color: #fff;\n  border-bottom: 1px solid #fff;\n  margin-bottom: 5px;\n  padding-bottom: 5px;\n}\n.nidusinfo .config_content_all .node_info,\n.nidusinfo .layer-mark-wrapper .node_info,\n.nidusinfo .config_content .node_info {\n  clear: both;\n}\n.nidusinfo .config_content_all .node_info .checkbox,\n.nidusinfo .layer-mark-wrapper .node_info .checkbox,\n.nidusinfo .config_content .node_info .checkbox,\n.nidusinfo .config_content_all .node_info .radiobox,\n.nidusinfo .layer-mark-wrapper .node_info .radiobox,\n.nidusinfo .config_content .node_info .radiobox {\n  margin-right: 5px;\n  margin-top: 3px;\n}\n.nidusinfo .config_content_all .node_info .radio-box,\n.nidusinfo .layer-mark-wrapper .node_info .radio-box,\n.nidusinfo .config_content .node_info .radio-box,\n.nidusinfo .config_content_all .node_info .check-box,\n.nidusinfo .layer-mark-wrapper .node_info .check-box,\n.nidusinfo .config_content .node_info .check-box {\n  vertical-align: top;\n}\n.nidusinfo .config_content_all .node_info .select-content,\n.nidusinfo .layer-mark-wrapper .node_info .select-content,\n.nidusinfo .config_content .node_info .select-content {\n  display: inline-block;\n  width: 120px;\n  margin-right: 5px;\n  font-size: 12px;\n  color: #fff;\n  line-height: 20px;\n  margin-bottom: 5px;\n  margin-left: 5px;\n  position: relative;\n}\n.nidusinfo .config_content_all .node_info .select-content .niddle-z,\n.nidusinfo .layer-mark-wrapper .node_info .select-content .niddle-z,\n.nidusinfo .config_content .node_info .select-content .niddle-z {\n  width: 120px;\n  word-break: break-all;\n}\n.nidusinfo .config_content_all .node_info .select-content .niddle-z span,\n.nidusinfo .layer-mark-wrapper .node_info .select-content .niddle-z span,\n.nidusinfo .config_content .node_info .select-content .niddle-z span {\n  display: unset;\n  font-size: 14px;\n  font-weight: 600;\n}\n.nidusinfo .config_content_all .node_info .select-content .drop_down_content,\n.nidusinfo .layer-mark-wrapper .node_info .select-content .drop_down_content,\n.nidusinfo .config_content .node_info .select-content .drop_down_content {\n  margin-top: 5px;\n  height: 20px;\n}\n.nidusinfo .config_content_all .node_info .select-content .input-r,\n.nidusinfo .layer-mark-wrapper .node_info .select-content .input-r,\n.nidusinfo .config_content .node_info .select-content .input-r,\n.nidusinfo .config_content_all .node_info .select-content .input-t,\n.nidusinfo .layer-mark-wrapper .node_info .select-content .input-t,\n.nidusinfo .config_content .node_info .select-content .input-t {\n  width: 100%;\n  border: 1px solid #ccc;\n  margin-top: 5px;\n  border-radius: 4px;\n}\n.nidusinfo .config_content_all .node_info .select-content .icon-shanchutishiicon,\n.nidusinfo .layer-mark-wrapper .node_info .select-content .icon-shanchutishiicon,\n.nidusinfo .config_content .node_info .select-content .icon-shanchutishiicon {\n  position: absolute;\n  font-size: 12px;\n  color: #C0C4CC;\n  bottom: 0;\n  right: 4px;\n  cursor: pointer;\n}\n.nidusinfo .config_content_all .node_info .select-content .input-tex,\n.nidusinfo .layer-mark-wrapper .node_info .select-content .input-tex,\n.nidusinfo .config_content .node_info .select-content .input-tex {\n  width: 100%;\n  height: 50px;\n  border: 1px solid #ccc;\n  margin-top: 5px;\n  border-radius: 4px;\n}\n.nidusinfo .config_content_all .node_info .select-content1,\n.nidusinfo .layer-mark-wrapper .node_info .select-content1,\n.nidusinfo .config_content .node_info .select-content1 {\n  width: 240px;\n  clear: both;\n  margin-right: 5px;\n  font-size: 12px;\n  color: #fff;\n  line-height: 20px;\n  margin-bottom: 5px;\n  margin-left: 5px;\n}\n.nidusinfo .config_content_all .node_info .select-content1 .check-choose,\n.nidusinfo .layer-mark-wrapper .node_info .select-content1 .check-choose,\n.nidusinfo .config_content .node_info .select-content1 .check-choose {\n  display: inline-block;\n  width: 120px;\n  word-break: break-all;\n  vertical-align: top;\n}\n.nidusinfo .config_content_all .node_info .select-content1 .check-choose span,\n.nidusinfo .layer-mark-wrapper .node_info .select-content1 .check-choose span,\n.nidusinfo .config_content .node_info .select-content1 .check-choose span {\n  width: 98px;\n  overflow: hidden;\n}\n.nidusinfo .config_content_all .node_info .select-content1 .niddle-z,\n.nidusinfo .layer-mark-wrapper .node_info .select-content1 .niddle-z,\n.nidusinfo .config_content .node_info .select-content1 .niddle-z {\n  width: 120px;\n  padding: 5px 0;\n}\n.nidusinfo .config_content_all .node_info .select-content1 .niddle-z span,\n.nidusinfo .layer-mark-wrapper .node_info .select-content1 .niddle-z span,\n.nidusinfo .config_content .node_info .select-content1 .niddle-z span {\n  display: unset;\n  font-size: 14px;\n  font-weight: 600;\n}\n.nidusinfo .config_content_all .node_info .select-content1 .drop_down_content,\n.nidusinfo .layer-mark-wrapper .node_info .select-content1 .drop_down_content,\n.nidusinfo .config_content .node_info .select-content1 .drop_down_content {\n  margin-top: 5px;\n  height: 20px;\n}\n.nidusinfo .config_content_all .node_info .select-content1 .input-r,\n.nidusinfo .layer-mark-wrapper .node_info .select-content1 .input-r,\n.nidusinfo .config_content .node_info .select-content1 .input-r,\n.nidusinfo .config_content_all .node_info .select-content1 .input-t,\n.nidusinfo .layer-mark-wrapper .node_info .select-content1 .input-t,\n.nidusinfo .config_content .node_info .select-content1 .input-t {\n  width: 100%;\n  border: 1px solid #ccc;\n  margin-top: 5px;\n  border-radius: 4px;\n}\n.nidusinfo .config_content_all .node_info .select-content1 .input-tex,\n.nidusinfo .layer-mark-wrapper .node_info .select-content1 .input-tex,\n.nidusinfo .config_content .node_info .select-content1 .input-tex {\n  width: 100%;\n  height: 50px;\n  border: 1px solid #ccc;\n  margin-top: 5px;\n  border-radius: 4px;\n}\n.nidusinfo .config_content_all {\n  width: 100%;\n  clear: both;\n  margin-right: 5px;\n  font-size: 12px;\n  color: #fff;\n  line-height: 20px;\n  margin-bottom: 5px;\n  margin-left: 5px;\n}\n.nidusinfo .config_content_all .mark_doctor_content li {\n  border-bottom: 1px solid #fff;\n}\n.nidusinfo .config_content_all .mark_doctor_content li .niddle-z {\n  width: 160px;\n  word-break: break-all;\n}\n.nidusinfo .config_content_all .mark_doctor_content li .niddle-z span {\n  display: unset;\n  font-size: 14px;\n  font-weight: 600;\n}\n.nidusinfo .btn_content {\n  float: right;\n  margin-left: 5px;\n  margin-bottom: 5px;\n  z-index: 20;\n  position: relative;\n}\n.nidusinfo .btn_content .btn {\n  width: 50px;\n  height: 20px;\n  color: #fff;\n  background: #448e97;\n  border-radius: 4px;\n  font-size: 12px;\n  text-align: center;\n  line-height: 20px;\n  border: 1px solid #448e97;\n  cursor: pointer;\n}\n.nidusinfo .btn_content .btn-mark {\n  width: 100px;\n}\n.nidusinfo .mark-score {\n  padding-top: 10px;\n  position: absolute;\n  background: #0a2634;\n  width: 60%;\n  top: 0;\n  left: -60%;\n}\n.nidusinfo .layer-mark-wrapper {\n  color: #fff;\n  margin-bottom: 10px;\n}\n",""])},1083:function(e,n){e.exports='<div class=nidusinfo> <p class="btn_content hide"> <span class="btn btn-cancle">关闭</span> </p> <div class=report></div> <div class=remark> <div class=socrllr> <div class=node-name>备注</div> <input type=text name=remark class=con> </div> </div> <div style=clear:both;height:1px></div> <div class=socrll> <div> <div class=node-name></div> <div class=config_content></div> </div> </div> <div class="mark-score hide"> <div> <div class=node-name>标注医生结果</div> <div class=config_content_all> <div class=socrll1> <div><div></div></div> </div> </div> </div> </div> </div> '},1084:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return t(1085),r.html=t(1087),r.name="report",r.chooseData={},r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.moduleBase),o(n,[{key:"complete",value:function(){console.log(this.initDate),this.initDate.diagnosisIncome?this.initDate.conclusion&&(this.dom.find(".socrllr .con").eq(1).html("<p>"+this.initDate.conclusion+"</p>"),this.newSorle(this.dom.find(".socrllr").eq(1))):this.dom.find(".socrllr").eq(1).hide(),this.initDate.inspectSee?this.initDate.finding&&(this.dom.find(".socrllr .con").eq(0).html("<p>"+this.initDate.finding+"</p>"),this.newSorle(this.dom.find(".socrllr").eq(0))):this.dom.find(".socrllr").eq(0).hide()}},{key:"updataData",value:function(e,n){this.initDate.diagnosisIncome&&n&&(this.dom.find(".socrllr .con").eq(1).html("<p>"+n+"</p>"),this.newSorle(this.dom.find(".socrllr").eq(1))),this.initDate.inspectSee&&e&&(this.dom.find(".socrllr .con").eq(0).html("<p>"+e+"</p>"),this.newSorle(this.dom.find(".socrllr").eq(0)))}},{key:"newSorle",value:function(e){var n="aaa_"+Math.floor((new Date).getTime()*Math.random());e.find(".con").attr("id",n),this.myScrollgood=new IScroll("#"+n,{scrollbars:!0,mouseWheel:!0,interactiveScrollbars:!0,hideScrollbar:!1,vScrollbar:!0,shrinkScrollbars:"scale",fadeScrollbars:!1,disableMouse:!0,disablePointer:!0})}}]),n}();e.exports=i},1085:function(e,n,t){var o=t(1086);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1086:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".report {\n  background: #0a2634;\n  position: relative;\n}\n.report .socrllr {\n  overflow: hidden;\n  position: relative;\n}\n.report .socrllr .con {\n  border: 1px solid #fff;\n  height: 60px;\n  padding: 0 5px;\n  position: relative;\n  overflow: hidden;\n}\n.report .socrllr .con p {\n  color: #fff;\n}\n.report .node-name {\n  color: #fff;\n  border-bottom: 1px solid #fff;\n  margin-bottom: 5px;\n  padding-bottom: 5px;\n}\n",""])},1087:function(e,n){e.exports=" <div class=report> <div class=socrllr> <div class=node-name>检查所见</div> <div class=con> </div> </div> <div class=socrllr> <div class=node-name>诊断</div> <div class=con> </div> </div> </div> "},1088:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(954);var i=function(e){function n(e,t,o,i){return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t,o,i))}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,ctcornerstone_base),o(n,[{key:"ctEvent",value:function(e,n,t,o){var i=this;this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.ImageRendered",function(t){if(i.model.seriesInfo[i.cornerstoneArray[e].sId]&&(t.image.columnPixelSpacing=i.model.seriesInfo[i.cornerstoneArray[e].sId].info.data.columnPixelSpacing,t.image.rowPixelSpacing=i.model.seriesInfo[i.cornerstoneArray[e].sId].info.data.rowPixelSpacing),i.model.seriesInfo[i.cornerstoneArray[e].sId]&&(i.model.seriesInfo[i.cornerstoneArray[e].sId].info.data.column=t.image.columns,i.model.seriesInfo[i.cornerstoneArray[e].sId].info.data.row=t.image.rows),i.initFrist[e]||(i.initFrist[e]=!0,(t.image.rows>1e3||t.image.columns>1e3)&&t.image.rate<1&&(i.defaultFunction("brushFanTe"),i.defaultFunction("")),i.event._dispatch("ctcornerstone.loadingfinish",{sId:i.cornerstoneArray[e].sId})),i.model.seriesInfo[i.cornerstoneArray[e].sId]&&"DCM"==i.model.seriesInfo[i.cornerstoneArray[e].sId].info.data.fileType&&i.showWWC(t.viewport,i.cornerstoneArray[e].sId,e),i.baseLineOpen&&(i.nowLayNum(e)!=Tool.changeToName(n[1*t.currentCount],"jpg")&&i.makeBaseLine(i.cornerstoneArray[e].sId,Tool.changeToName(n[1*t.currentCount],"jpg")),i.nowLine&&i.nowLine[i.cornerstoneArray[e].sId])){var a=i.nowLine[i.cornerstoneArray[e].sId];if(0!=a.length){var r=t.canvasContext;r.beginPath(),r.mozImageSmoothingEnabled=!1,r.lineWidth=Math.floor(t.image.columns/512),r.strokeStyle="#fff",r.moveTo(a[0].x,a[0].y),r.lineTo(a[1].x,a[1].y),r.stroke()}}i.crossOpen&&!i.crossmove&&i.calflow(e);ES.selctorDoc(t.element).parent(),t.xDate;var s=Tool.changeToName(n[1*t.currentCount],"jpg");if(i.model.currentLayer=s,i.dom.find(".ct"+e+" .layer").html(s+"/"+o),$(".ct"+e).find(".slideContainer li").each(function(e){Number($(this).attr("number"))===s?$(this).addClass("active"):$(this).removeClass("active")}),i.dom.find(".ct"+e+" .sc").html(i.cornerstoneArray[e].getViewport().scale.toFixed(2)),console.log(i.model.nidusChoose),i.nodeShow){var l=cornerstone.pixelToCanvas(t.element,{x:0,y:0}),d=cornerstone.getViewport(t.element),c=i.brushManage.brushInfo[s]?i.brushManage.brushInfo[s]:{},u={};for(var h in c){console.log(c[h].sId),-1!=c[h].sId.split("_").lastIndexOf(i.cornerstoneArray[e].sId)&&c[h].show&&(u[h]=c[h])}for(var m in console.log(u,"brushNodesbrushNodesbrushNodesbrushNodes",c),u)if(u[m].image){c[m].image;t.canvasContext.drawImage(c[m].image,0,0)}var f=i.nodeInfo?i.nodeInfo[s]:[],p=(f=f||[]).filter(function(n){return n.sId==i.cornerstoneArray[e].sId&&n.show});console.log(i.model.nidusChoose,"that.model.nidusChoosethat.model.nidusChoosethat.model.nidusChoose",p);for(var g=function(){var n=t.canvasContext;n.beginPath(),n.mozImageSmoothingEnabled=!1,n.lineWidth=Math.floor(t.image.columns/512),n.strokeStyle="#f00",n.fillStyle="#f00";var o=!1;i.model.nidusChoose&&(i.model.nidusChoose.uuid!=p[v].nodeInfo.uuid&&i.model.nidusChoose.id!=p[v].nodeInfo.uuid||(n.strokeStyle="#0ff",n.fillStyle="#0ff",o=!0));var a=p[v].nodeInfo.handles;switch(p[v].type){case"rectangleRoi":var r=Math.abs(1*a.end.x-1*a.start.x),s=Math.abs(1*a.end.y-1*a.start.y),c=Math.min(1*a.end.x,1*a.start.x),u=Math.min(1*a.end.y,1*a.start.y);console.log(l,d),console.log(c),n.strokeRect(c,u,r,s),n.stroke();break;case"ellipticalRoi":var h=(1*a.start.x+1*a.end.x)/2,m=(1*a.start.y+1*a.end.y)/2,f=Math.max(Math.abs((1*a.end.x-1*a.start.x)/2),Math.abs((1*a.end.y-1*a.start.y)/2));n.arc(h,m,f,0,2*Math.PI,!1),n.stroke();break;case"length":n.moveTo(a.start.x,a.start.y),n.lineTo(a.end.x,a.end.y),n.stroke();break;case"simpleAngle":n.moveTo(a.start.x,a.start.y),n.lineTo(a.middle.x,a.middle.y),n.lineTo(a.end.x,a.end.y),n.stroke();break;case"cobb":p[v].nodeInfo.lineA.map(function(e){n.moveTo(e.handles.start.x,e.handles.start.y),n.lineTo(e.handles.end.x,e.handles.end.y)}),i.model.nidusChoose&&(i.model.nidusChoose.uuid!=p[v].nodeInfo.uuid&&i.model.nidusChoose.id!=p[v].nodeInfo.uuid||2!=p[v].nodeInfo.lineA.length||i.dom.find(".ct"+e+" .cal").html("cobb角"+Tool.calAngel(p[v].nodeInfo.lineA[0].handles,p[v].nodeInfo.lineA[1].handles))),n.stroke();break;case"alignment":console.log(p[v].nodeInfo.pointA,"fliterNodes[i].nodeInfo.pointAfliterNodes[i].nodeInfo.pointA"),n.font="bold 28px Arial";var g=1;p[v].nodeInfo.pointA.map(function(e){e.start&&(n.fillRect(e.start.x,e.start.y,3,3),o&&n.fillText(g,e.start.x+5,e.start.y)),g++}),n.stroke()}},v=0;v<p.length;v++)g()}null==i.changeLayeIdTime&&i.cornerstoneArray[e].progress.setPosBar(i.nowLayNum(e))}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.click",function(n){if(console.log(i.controlename,n.e.detail,"======="),i.controlename&&"zoomFan"!=i.controlename&&"wlFan"!=i.controlename&&"restFan"!=i.controlename);else{var t=n.e.detail.currentPoints.image.x,o=n.e.detail.currentPoints.image.y,a=i.nowLayNum(e),r=i.nodeInfo?i.nodeInfo[a]:[],s=void 0;if((r=(r=r||[]).filter(function(e){return e.show})).map(function(e){var n=e.nodeInfo;if(n.handles&&n.handles.start.x<t&&n.handles.end.x>t&&n.handles.start.y<o&&n.handles.end.y>o)return s=n.backId||n.uuid,void i.sequencelist.clickById({uuid:s});if(n.pointA){var a=[1e5,0],r=[1e5,0];if(n.pointA.map(function(e){a[0]=a[0]<e.start.x?a[0]:e.start.x,a[1]=a[1]>e.start.x?a[1]:e.start.x,r[0]=r[0]<e.start.y?r[0]:e.start.y,r[1]=r[1]>e.start.y?r[1]:e.start.y}),console.log(a,r),a[0]<t&&a[1]>t&&r[0]<o&&r[1]>o)return s=n.backId||n.uuid,void i.sequencelist.clickById({uuid:s});console.log(n)}}),s)return;var l=i.brushManage.brushInfo[a]?i.brushManage.brushInfo[a]:{};for(var d in console.log(l),l){if(l[d].sId)if(-1!=l[d].sId.split("_").lastIndexOf(i.cornerstoneArray[e].sId)){var c=Math.floor(o)*n.e.detail.image.width+Math.floor(t);if(console.log(c),l[d].orginimage.includes(c))return s=l[d].backId||l[d].id,void i.sequencelist.clickById({uuid:s})}}}}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.ModifiedFinsh",function(e){}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.MeasurementEnd",function(e){}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.brushDown",function(e){}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.MouseDrag",function(e){}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.MeasurementRemove",function(e){})}},{key:"setbrush",value:function(e){if(console.log(e,""),0!=e.imglist.length){for(var n=this,t=(e.imglist.filter(function(e){return e}).length,0),o=0,i=function(i){e.imglist[i]?(0==t&&(t=i),setTimeout(function(){var t=new Image;t.id=i,t.crossOrigin="",t.onload=function(){if(o++,n.brushManage.creatNewImage(this,e,{width:this.width,height:this.height},this.id),o==e.imglist.length){var t=Math.floor(n.brushManage.getPixTotal(e.id)*n.model.seriesInfo[e.sId].volumeCal*100),i={id:e.id,cal:"出血量:"+t/100+"mm<sup>3</sup>"};n.sequencelist.upCal(i),n.event._dispatch("ctcornerstone.brushfirstload"),n.gotoLayer(n.nowLayNum(),e.sId)}},t.onerror=function(){++o==e.imglist.length&&(n.event._dispatch("ctcornerstone.brushfirstload"),n.gotoLayer(n.nowLayNum(),e.sId))},t.src=e.imglist[i]},300)):++o==e.imglist.length&&(n.event._dispatch("ctcornerstone.brushfirstload"),n.gotoLayer(n.nowLayNum(),e.sId))},a=0;a<e.imglist.length;a++)i(a);this.sequencelist.setLayerInfo(e,t)}else this.event._dispatch("ctcornerstone.brushfirstload")}}]),n}();e.exports=i},1089:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(954);var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return r.freehand=t(1090),r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,ctcornerstone_base),o(n,[{key:"ctEvent",value:function(e,n,t,o){var i=this;this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.ImageRendered",function(t){if(i.model.seriesInfo[i.cornerstoneArray[e].sId]&&(t.image.columnPixelSpacing=i.model.seriesInfo[i.cornerstoneArray[e].sId].info.data.columnPixelSpacing,t.image.rowPixelSpacing=i.model.seriesInfo[i.cornerstoneArray[e].sId].info.data.rowPixelSpacing),i.model.seriesInfo[i.cornerstoneArray[e].sId]&&(i.model.seriesInfo[i.cornerstoneArray[e].sId].info.data.column=t.image.columns,i.model.seriesInfo[i.cornerstoneArray[e].sId].info.data.row=t.image.rows),i.model.seriesInfo[i.cornerstoneArray[e].sId]&&"DCM"==i.model.seriesInfo[i.cornerstoneArray[e].sId].info.data.fileType&&i.showWWC(t.viewport,i.cornerstoneArray[e].sId,e),i.baseLineOpen&&(i.nowLayNum(e)!=Tool.changeToName(n[1*t.currentCount],"jpg")&&i.makeBaseLine(i.cornerstoneArray[e].sId,Tool.changeToName(n[1*t.currentCount],"jpg")),i.nowLine&&i.nowLine[i.cornerstoneArray[e].sId])){var a=i.nowLine[i.cornerstoneArray[e].sId];if(0!=a.length){var r=t.canvasContext;r.beginPath(),r.mozImageSmoothingEnabled=!1,r.lineWidth=Math.floor(t.image.columns/512),r.strokeStyle="#f00",r.moveTo(a[0].x,a[0].y),r.lineTo(a[1].x,a[1].y),r.stroke()}}i.crossOpen&&!i.crossmove&&i.calflow(e);ES.selctorDoc(t.element).parent(),ES.selctorDoc(t.element).attr("id").replace("ct","");var s=Tool.changeToName(n[1*t.currentCount],"jpg");i.model.currentLayer=s,i.dom.find(".ct"+e+" .layer").html(s+"/"+o),$(".ct"+e).find(".slideContainer li").each(function(e){Number($(this).attr("number"))===s?$(this).addClass("active"):$(this).removeClass("active")}),i.dom.find(".ct"+e+" .sc").html(i.cornerstoneArray[e].getViewport().scale.toFixed(2));var l=i.nodeInfo?i.nodeInfo[s]:[],d=(l=l||[]).filter(function(n){n.show||i.cornerstoneArray[e].getAllState().map(function(t){console.log(t,"itemitemitemitem"),t.uuid&&"alignment"!=t.tooltype&&t.uuid==n.nodeInfo.uuid&&i.cornerstoneArray[e].clearSigleData(t.tooltype,t,!0)});return n.sId==i.cornerstoneArray[e].sId&&n.show}),c=i.brushManage.brushInfo[s]?i.brushManage.brushInfo[s]:{},u={};for(var h in c){if(c[h].sId)-1!=c[h].sId.split("_").lastIndexOf(i.cornerstoneArray[e].sId)&&c[h].show&&(u[h]=c[h])}i.nodeShow&&i.drawImg(u,t),i.nodeShow&&i.drawNode(d,t);var m=i.cornerstoneArray[e].getViewport().voi;if(i.nowWWC[e]&&(m.windowCenter==i.nowWWC[e].c&&m.windowWidth==i.nowWWC[e].w||i.lungWindown(m.windowCenter,m.windowWidth)),"brushFan"!=i.controlename&&"earseFan"!=i.controlename&&"brushFanTe"!=i.controlename||i.nowWWC[e]&&i.lungWindown(i.nowWWC[e].c,i.nowWWC[e].w),!i.initFrist[e]){i.initFrist[e]=!0;var f=i.controlename;(t.image.rows>1e3||t.image.columns>1e3)&&t.image.rate<1&&i.defaultFunction("brushFanTe"),i.defaultFunction(""),f&&i.defaultFunction(f),i.event._dispatch("ctcornerstone.loadingfinish",{sId:i.cornerstoneArray[e].sId})}null==i.changeLayeIdTime&&(console.log(i.nowLayNum(e)),i.cornerstoneArray[e].progress.setPosBar(i.nowLayNum(e)))}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.ModifiedFinsh",function(n){if(console.log(i.controlename),"zoomFan"!=i.controlename&&"wlFan"!=i.controlename&&"restFan"!=i.controlename){var t=i.cornerstoneArray[e].sId;if(!i.model.seriesInfo[t].needAnno)return}i.model.controlStauts.delete=!0;var o=i.getAlllayer(1*ES.selctorDoc(n.element).attr("id").replace("ct","")),a=(i.cornerstoneArray[o[o.length-1]],n.e),r=n.splitHandle.handles,s=r.start?r.start.x:r.end.x,l=r.start?r.start.y:r.end.y,d=r.end?r.end.x:r.start.x,c=r.end?r.end.y:r.start.y,u=Math.max(c-l,d-s),h=Math.max(c-l,d-s),m={handles:r,id:n.splitHandle.id,uuid:n.splitHandle.uuid,tooltype:a.detail.toolType,layerNumber:i.nowLayNum(e),diameter:h,meanHu:n.splitHandle.meanStdDev?n.splitHandle.meanStdDev.mean:0,makeType:0,diameterm:u.toFixed(2)};if("simpleAngle"==a.detail.toolType){var f=r;m.pointArray=[f.start.x,f.start.y,f.middle.x,f.middle.y,f.end.x,f.end.y].toString(),m.rangel=n.splitHandle.rAngle}if("rectangleRoi"==a.detail.toolType||"ellipticalRoi"==a.detail.toolType||"length"==a.detail.toolType){var p=r;m.pointArray=[p.start.x,p.start.y,null,null,p.end.x,p.end.y].toString(),m.rangel=0}i.cornerstoneArray[e].moveAllElementData=m}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.MeasurementEnd",function(n){if(n){if("zoomFan"!=i.controlename&&"wlFan"!=i.controlename&&"restFan"!=i.controlename){var t=i.cornerstoneArray[e].sId;if(!i.model.seriesInfo[t].needAnno)return}n.sId=i.cornerstoneArray[e].sId,i.model.controlStauts.delete=!0;var o=i.nowLayNum(e);if("brushFan"==i.controlename||"earseFan"==i.controlename){if(!i.model.nidusChoose)return;var a=i.model.nidusChoose.toolType.imageAnnotationToolType;if("MAGIC_STICK_SINGLE"!=a&&"POLYGON"!=a&&"QSELECT"!=a&&"REGION_PAINT"!=a&&"FREEHAND"!=a)return void(i.brushId=null);if("MAGIC_STICK_SINGLE"==a||"POLYGON"==a||"QSELECT"==a||"REGION_PAINT"==a||"FREEHAND"==a)return n.layerNumber=o,console.log(i.model.nidusChoose),n.backId=i.model.nidusChoose.bid,n.toolType=n.toolType?n.toolType:{type:i.model.nidusChoose.toolType.imageAnnotationToolType},i.updateAllCanvas(n.sId),void i.event._dispatch("ctcornerstone.editBrush",n)}if("polygonFan"==i.controlename){var r=i.brushManage.creatBrush(n.layerNumber,i.freehand.endPath(),n.uuid,i.cornerstoneArray[e].sId,{w:i.freehand.canvas.width,h:i.freehand.canvas.height});return i.cornerstoneArray[e].moveAllElementData.image=r.image,i.model.nidusChoose&&"POLYGON"==i.model.nidusChoose.toolType.imageAnnotationToolType&&i.model.nidusChoose.toolType.imageAnnotation==i.tooltype.imageAnnotation?(n.backId=i.model.nidusChoose.bid,i.event._dispatch("ctcornerstone.editBrush",n),i.updateAllCanvas(n.sId),void(i.cornerstoneArray[e].moveAllElementData=null)):(n.show=!0,i.sequencelist.addNode(n,!0),i.event._dispatch("ctcornerstone.addImageResult",n),i.updateAllCanvas(n.sId),void(i.cornerstoneArray[e].moveAllElementData=null))}if("freehandFan"==i.controlename){var s=i.brushManage.creatBrush(n.layerNumber,i.freehand.noneClosePath(),n.uuid,i.cornerstoneArray[e].sId,{w:i.freehand.canvas.width,h:i.freehand.canvas.height});return i.cornerstoneArray[e].moveAllElementData.image=s.image,i.model.nidusChoose&&"FREEHAND"==i.model.nidusChoose.toolType.imageAnnotationToolType&&i.model.nidusChoose.toolType.imageAnnotation==i.tooltype.imageAnnotation?(n.backId=i.model.nidusChoose.bid,i.event._dispatch("ctcornerstone.editBrush",n),i.updateAllCanvas(n.sId),void(i.cornerstoneArray[e].moveAllElementData=null)):(n.show=!0,i.sequencelist.addNode(n,!0),i.event._dispatch("ctcornerstone.addImageResult",n),i.updateAllCanvas(n.sId),void(i.cornerstoneArray[e].moveAllElementData=null))}if("regionpaintFan"==i.controlename)return console.log(n),i.model.nidusChoose&&"REGION_PAINT"==i.model.nidusChoose.toolType.imageAnnotationToolType&&i.model.nidusChoose.toolType.imageAnnotation==i.tooltype.imageAnnotation?(n.backId=i.model.nidusChoose.bid,i.event._dispatch("ctcornerstone.editBrush",n),i.updateAllCanvas(n.sId),void(i.cornerstoneArray[e].moveAllElementData=null)):(n.show=!0,i.sequencelist.addNode(n,!0),i.updateAllCanvas(n.sId),i.event._dispatch("ctcornerstone.addImageResult",n),void(i.cornerstoneArray[e].moveAllElementData=null));if(console.log(n,"cobbFan",i.controlename,n.tooltype,n.uuid),console.log(cornerstoneTools.getToolState(i.cornerstoneArray[e].element,"length")),"cobbFan"==i.controlename&&!n.uuid){if(console.log(i.model.nidusChoose),!i.model.nidusChoose)return console.log("addd"),void i.cobbAdd(n,o,e);if(i.model.nidusChoose&&"cobb"!=i.model.nidusChoose.type)return console.log("addd"),void i.cobbAdd(n,o,e);if(i.model.nidusChoose){var l=i.drawInfo.getInfo(i.model.nidusChoose);if(2==l.lineA.length)return console.log("addd"),void i.cobbAdd(n,o,e);if(l.lineA.length<2)return console.log("edit"),i.setSpliceUUID(n,"length",i.model.nidusChoose.uuid,e),l.lineA.push(n.handles),i.dom.find(".ct"+e+" .cal").html("cobb角"+Tool.calAngel(l.lineA[0],l.lineA[1])),l.setDataType="number",void i.event._dispatch("ctcornerstone.editNode",l)}}if(("rectangleRoiFan"==i.controlename||"ellipticalRoiFan"==i.controlename||"simpleAngleFan"==i.controlename||"lengthFan"==i.controlename)&&!n.uuid){var d=i.controlename.replace("Fan","");if(d==n.tooltype)return n.uuid||i.setSpliceUUID(n,d,n.id,e),i.drawInfo.setInfo(n),n.setDataType="number",n.toolType=i.tooltype,n.layerNumber=o,n.show=!0,n.type=d,i.sequencelist.addNode(n,!0),i.nodeInfo||(i.nodeInfo={}),i.nodeInfo[o]||(i.nodeInfo[o]=[]),i.nodeInfo[o].push({layerNumber:o,type:n.tooltype,nodeInfo:n,sId:n.sId,show:!0}),void i.event._dispatch("ctcornerstone.addNode",n)}if(n.tooltype&&("rectangleRoi"==n.tooltype||"ellipticalRoi"==n.tooltype||"simpleAngle"==n.tooltype||"length"==n.tooltype)&&n.uuid){if(i.drawInfo.setInfo(n),"cobb"==n.type){var c=i.cornerstoneArray[e].geSiglneState("length");console.log(c),c&&(n.lineA=[],c.data.map(function(e){e.uuid==n.uuid&&n.lineA.push(e.handles)}),2==n.lineA.length&&i.dom.find(".ct"+e+" .cal").html("cobb角:"+Tool.calAngel(n.lineA[0],n.lineA[1])))}n.imageAnnotationId=n.toolType.imageAnnotationId||n.imageAnnotationId,n.imageAnnotationToolId=n.toolType.id||n.imageAnnotationToolId,n.imageAnnotationToolType=n.toolType.type||n.imageAnnotationToolType,n.imageAnnotationType=n.toolType.imageAnnotation||n.imageAnnotationType,n.setDataType="number",i.event._dispatch("ctcornerstone.editNode",n)}}}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.brushDown",function(e){i.controlename}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.click",function(n){if(console.log(i.controlename,n.e.detail,"======="),i.controlename&&"zoomFan"!=i.controlename&&"wlFan"!=i.controlename&&"restFan"!=i.controlename){if("zoomFan"!=i.controlename&&"wlFan"!=i.controlename&&"restFan"!=i.controlename){var t=i.cornerstoneArray[e].sId;if(!i.model.seriesInfo[t].needAnno)return}if("magicStickSingleFan"==i.controlename){n.layerNumber=i.nowLayNum(e),n.toolType=i.tooltype,n.id=n.uuid=Tool.guid(),n.type=i.controlename.replace("Fan",""),n.imageAnnotationId=n.toolType.imageAnnotationId,n.imageAnnotationToolId=n.toolType.id,n.imageAnnotationToolType=n.toolType.type,n.imageAnnotationType=n.toolType.imageAnnotation,n.sId=i.cornerstoneArray[e].sId,i.sequencelist.addNode(n,!0);var o=[[0,0],[0,1],[1,0],[1,1]];n.points=[];for(var a=0;a<4;a++){var r={image:n.e.detail.image,currentPoints:{image:{x:n.e.detail.currentPoints.image.x+o[a][0],y:n.e.detail.currentPoints.image.y+o[a][1]}}};r.currentPoints.image.ct=i.model.getDicomValue(r).hu,n.points.push(r.currentPoints.image)}n.ct=i.model.getDicomValue(n.e.detail),i.event._dispatch("ctcornerstone.makeMagic",n)}if("quickselectFan"==i.controlename){if(i.model.nidusChoose&&i.model.nidusChoose.sId!=i.cornerstoneArray[e].sId)return void i.app.alert.show({title:" ",msg:"选择的病灶跟当前选中序列不是同一序列，请取消病灶选中，或者切换序列",close:!0});var s="";i.model.nidusChoose&&"QSELECT"==i.model.nidusChoose.toolType.imageAnnotationToolType&&i.model.nidusChoose.toolType.imageAnnotation==i.tooltype.imageAnnotation&&(s=i.model.nidusChoose.uuid);var l=i.model.makeCiclePoint(n.e.detail,i.cornerstoneTools_config.quickselect_config),d=i.brushManage.setBrush(i.nowLayNum(e),l,0,{w:n.e.detail.image.width,h:n.e.detail.image.height},s,i.cornerstoneArray[e].sId);if(d.toolType=i.tooltype,d.layerNumber=i.nowLayNum(e),d.type="brush",d.imageAnnotationId=i.tooltype.imageAnnotationId,d.imageAnnotationToolId=i.tooltype.id,d.imageAnnotationToolType=i.tooltype.type,d.imageAnnotationType=i.tooltype.imageAnnotation,d.sId=i.cornerstoneArray[e].sId,d.show=!0,i.cornerstoneArray[e].moveAllElementData=d,i.model.nidusChoose){if(i.model.nidusChoose.sId!=i.cornerstoneArray[e].sId)return;if("QSELECT"==i.model.nidusChoose.toolType.imageAnnotationToolType&&i.model.nidusChoose.toolType.imageAnnotation==i.tooltype.imageAnnotation)return d.backId=i.model.nidusChoose.bid,i.updateAllCanvas(i.cornerstoneArray[e].sId),i.event._dispatch("ctcornerstone.editBrush",d),void(i.cornerstoneArray[e].moveAllElementData=null)}console.log(d,"brushInfobrushInfobrushInfobrushInfobrushInfobrushInfobrushInfobrushInfo"),i.sequencelist.addNode(d,!0),i.updateAllCanvas(i.cornerstoneArray[e].sId),i.event._dispatch("ctcornerstone.addImageResult",d),i.cornerstoneArray[e].moveAllElementData=null}if("alignmentFan"==i.controlename){if(console.log(i.model.nidusChoose),!i.model.nidusChoose)return console.log("addd"),i.alignmentAdd(n,e),void i.dom.find(".ct"+e+" .cal").html("前上缘");if(i.model.nidusChoose&&"alignment"!=i.model.nidusChoose.type)return console.log("addd"),i.alignmentAdd(n,e),void i.dom.find(".ct"+e+" .cal").html("前上缘");if(i.model.nidusChoose&&i.model.nidusChoose.imageAnnotationType!=i.tooltype.imageAnnotation)return console.log("addd"),i.alignmentAdd(n,e),void i.dom.find(".ct"+e+" .cal").html("前上缘");if(i.model.nidusChoose){var c=i.drawInfo.getInfo(i.model.nidusChoose);if(4==c.pointA.length)return console.log("addd"),i.alignmentAdd(n,e),i.dom.find(".ct"+e+" .cal").html("前上缘"),void i.gotoLayer(e,i.cornerstoneArray[e].sId);if(c.pointA.length<4){console.log("edit",c),c.layerNumber=i.nowLayNum(e),c.pointA.push({start:{x:n.e.detail.currentPoints.image.x,y:n.e.detail.currentPoints.image.y}}),c.setDataType="number";var u=i.model.returnBodyName(c.pointA.length);return i.nodeInfo[c.layerNumber].map(function(e){e.nodeInfo.uuid!=c.uuid&&e.nodeInfo.uuid!=c.id||(e.nodeInfo.pointA=c.pointA)}),i.dom.find(".ct"+e+" .cal").html(u),i.gotoLayer(null,i.cornerstoneArray[e].sId),void i.event._dispatch("ctcornerstone.editNode",c)}}}}else{var h=n.e.detail.currentPoints.image.x,m=n.e.detail.currentPoints.image.y,f=i.nowLayNum(e),p=i.nodeInfo?i.nodeInfo[f]:[],g=void 0;if((p=(p=p||[]).filter(function(e){return e.show})).map(function(e){var n=e.nodeInfo;if(n.handles&&n.handles.start.x<h&&n.handles.end.x>h&&n.handles.start.y<m&&n.handles.end.y>m)return g=n.backId||n.uuid,console.log("aaaaaaaaaaaa"),void i.sequencelist.clickById({uuid:g});if(n.pointA){var t=[2e4,0],o=[2e4,0];if(n.pointA.map(function(e){t[0]=t[0]<e.start.x?t[0]:e.start.x,t[1]=t[1]>e.start.x?t[1]:e.start.x,o[0]=o[0]<e.start.y?o[0]:e.start.y,o[1]=o[1]>e.start.y?o[1]:e.start.y}),console.log(t,o),t[0]<h&&t[1]>h&&o[0]<m&&o[1]>m)return g=n.backId||n.uuid,void i.sequencelist.clickById({uuid:g});console.log(n)}}),g)return;var v=i.brushManage.brushInfo[f]?i.brushManage.brushInfo[f]:{};for(var y in console.log(v),v){if(v[y].sId)if(-1!=v[y].sId.split("_").lastIndexOf(i.cornerstoneArray[e].sId)){var b=Math.floor(m)*n.e.detail.image.width+Math.floor(h);if(console.log(b),v[y].orginimage.includes(b))return g=v[y].backId||v[y].id,void i.sequencelist.clickById({uuid:g})}}}}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.mousedown",function(n){if("zoomFan"!=i.controlename&&"wlFan"!=i.controlename&&"restFan"!=i.controlename&&i.controlename){var t=i.cornerstoneArray[e].sId;if(!i.model.seriesInfo[t].needAnno)return void i.app.alert.show({title:" ",msg:"该序列不能标注",close:!0})}if(i.cornerstoneArray[e].moveAllElementData&&i.cornerstoneArray[e].moveAllElementData.uuid&&"simpleAngle"==i.cornerstoneArray[e].moveAllElementData.tooltype){var o=i.drawInfo.getInfo(i.cornerstoneArray[e].moveAllElementData);o&&(o.handles=i.cornerstoneArray[e].moveAllElementData.handles,o.imageAnnotationId=o.toolType.imageAnnotationId||o.imageAnnotationId,o.imageAnnotationToolId=o.toolType.id||o.imageAnnotationToolId,o.imageAnnotationToolType=o.toolType.type||o.imageAnnotationToolType,o.imageAnnotationType=o.toolType.imageAnnotation||o.imageAnnotationType,o.setDataType="number",i.event._dispatch("ctcornerstone.editNode",o),i.cornerstoneArray[e].moveAllElementDat=null)}if("brushFan"!=i.controlename&&"earseFan"!=i.controlename||i.model.nidusChoose){if("polygonFan"==i.controlename||"freehandFan"==i.controlename){var a=i.cornerstoneTools_config[i.controlename.replace("Fan","_config")].lineWidth,r=n.e,s={width:r.detail.image.width,height:r.detail.image.height};console.log(i.cornerstoneArray[e].moveAllElementData,i.model.nidusChoose);var l=void 0;if(i.model.nidusChoose){if(i.model.nidusChoose.sId!=i.cornerstoneArray[e].sId)return void i.app.alert.show({title:" ",msg:"选择的病灶跟当前选中序列不是同一序列，请取消病灶选中，或者切换序列",close:!0});var d=i.controlename.replace("Fan","");if(i.model.nidusChoose.toolType.imageAnnotationToolType==d.toUpperCase())if(i.model.nidusChoose.toolType.imageAnnotation==i.tooltype.imageAnnotation){console.log("same");var c={layerNumber:i.nowLayNum(e),uuid:i.model.nidusChoose.uuid},u=i.brushManage.getInfo(c);l=u?u.orginimage:null}else l=null;else l=null}else l=i.cornerstoneArray[e].moveAllElementData?i.cornerstoneArray[e].moveAllElementData.orginimage:null;i.chooseHU=i.model.getDicomValue(n.e.detail),i.freehand.creatPath(r.detail.startPoints.image,s,l,a)}}else n.toolType?i.sequencelist.addNode(n,!0):i.app.alert.show({title:" ",msg:"没有对应的病灶",close:!0})}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.MouseDrag",function(n){if("zoomFan"!=i.controlename&&"wlFan"!=i.controlename&&"restFan"!=i.controlename){var t=i.cornerstoneArray[e].sId;if(!i.model.seriesInfo[t].needAnno)return}n.layerNumber=i.nowLayNum(e);var o=i.cornerstoneTools_config.brush_config.radius,a=(i.cornerstoneTools_config.brush_config.lineWidth,null),r=i.cornerstoneArray[e].moveAllElementData?i.cornerstoneArray[e].moveAllElementData.uuid:"";if("polygonFan"==i.controlename||"freehandFan"==i.controlename){if(i.model.nidusChoose){if(i.model.nidusChoose.sId!=i.cornerstoneArray[e].sId)return;i.model.nidusChoose.toolType.imageAnnotationToolType!=i.controlename&&i.model.nidusChoose.toolType.imageAnnotationToolType!=i.controlename.replace("Fan","").toUpperCase()||i.model.nidusChoose.toolType.imageAnnotation==i.tooltype.imageAnnotation&&(r=i.model.nidusChoose.uuid)}console.log(n.layerNumber,r);var s=n.e.detail.currentPoints.image,l=i.brushManage.creatBrush(n.layerNumber,i.freehand.drawPath(s),r,i.cornerstoneArray[e].sId,{w:n.e.detail.image.width,h:n.e.detail.image.height});return l.toolType=i.tooltype,l.layerNumber=n.layerNumber,l.type="brush",l.imageAnnotationId=i.tooltype.imageAnnotationId,l.imageAnnotationToolId=i.tooltype.id,l.imageAnnotationToolType=i.tooltype.type,l.imageAnnotationType=i.tooltype.imageAnnotation,l.show=!0,i.cornerstoneArray[e].moveAllElementData=l,void i.updateAllCanvas(i.cornerstoneArray[e].sId)}if("regionpaintFan"==i.controlename){if(i.model.nidusChoose){if("regionpaintFan"!=i.model.nidusChoose.toolType.imageAnnotationToolType&&"REGION_PAINT"!=i.model.nidusChoose.toolType.imageAnnotationToolType||i.model.nidusChoose.toolType.imageAnnotation==i.tooltype.imageAnnotation&&(r=i.model.nidusChoose.uuid),i.model.nidusChoose.sId!=i.cornerstoneArray[e].sId)return;if(i.model.nidusChoose.sId!=i.cornerstoneArray[e].sId)return}console.log(n.e.detail.image);var d=i.brushManage.setBrush(n.layerNumber,n.e.detail.currentPoints.image,o,{w:n.e.detail.image.width,h:n.e.detail.image.height},r,i.cornerstoneArray[e].sId);return d.toolType=i.tooltype,d.layerNumber=n.layerNumber,d.type="brush",d.imageAnnotationId=i.tooltype.imageAnnotationId,d.imageAnnotationToolId=i.tooltype.id,d.imageAnnotationToolType=i.tooltype.type,d.imageAnnotationType=i.tooltype.imageAnnotation,d.show=!0,i.cornerstoneArray[e].moveAllElementData=d,void i.updateAllCanvas(i.cornerstoneArray[e].sId)}if(i.model.controlStauts.delete=!0,"preview"==i.app.parpam.type&&i.model.nidusChoose&&(i.model.nidusChoose.bid=i.model.nidusChoose.uuid),"brushFan"==i.controlename||"earseFan"==i.controlename){if(!i.model.nidusChoose)return;if(i.model.nidusChoose.sId!=i.cornerstoneArray[e].sId)return}"brushFan"==i.controlename&&(r=i.model.nidusChoose?i.model.nidusChoose.uuid:"","MAGIC_STICK_SINGLE"==i.model.nidusChoose.toolType.imageAnnotationToolType&&(r=i.model.nidusChoose?i.model.nidusChoose.bid:""),a=i.brushManage.setBrush(n.layerNumber,n.e.detail.currentPoints.image,o,{w:n.e.detail.image.width,h:n.e.detail.image.height},r,i.cornerstoneArray[e].sId),i.updateAllCanvas(i.cornerstoneArray[e].sId)),"earseFan"==i.controlename&&(console.log("earseFan","====================",n.layerNumber,r),r=i.model.nidusChoose?i.model.nidusChoose.uuid:"","MAGIC_STICK_SINGLE"==i.model.nidusChoose.toolType.imageAnnotationToolType&&(r=i.model.nidusChoose?i.model.nidusChoose.bid:""),a=i.brushManage.removeBrush(n.layerNumber,n.e.detail.currentPoints.image,o,{w:n.e.detail.image.width,h:n.e.detail.image.height},r),i.updateAllCanvas(i.cornerstoneArray[e].sId)),i.cornerstoneArray[e].moveAllElementData=a}),this.cornerstoneArray[e].event._addEvent("Cornerstone_Class.MeasurementRemove",function(n){i.model.controlStauts.delete&&(console.log(n,"MeasurementRemoveMeasurementRemoveMeasurementRemoveMeasurementRemove",i.cornerstoneArray[e].moveAllElementData),n.id&&i.endDone(n,0))}),ES.selctorDoc(window).on("mousemove",function(e){var n=ES.selctorDoc(e.target).parent().attr("id");n&&(n=1*n.replace("ct",""),i.cornerstoneArray[n]?(i.mousemoveView=i.cornerstoneArray[n].getViewport(),i.mousePos={x:e.pageX,y:e.pageY}):(i.mousemoveView=null,i.mousePos=null)),"quickselectFan"==i.controlename?null!=n&&i.makeCicle():"brushFan"==i.controlename||"earseFan"==i.controlename?null!=n&&(console.log("================"),i.makeBrushCicle()):i.dom.find(".cicle").hide()})}},{key:"alignmentAdd",value:function(e,n,t){e.layerNumber=this.nowLayNum(n),this.drawInfo.setInfo(e),e.show=!0,e.toolType=this.tooltype,e.id=e.uuid=Tool.guid(),e.type=this.controlename.replace("Fan",""),e.imageAnnotationId=e.toolType.imageAnnotationId,e.imageAnnotationToolId=e.toolType.id,e.imageAnnotationToolType=e.toolType.type,e.imageAnnotationType=e.toolType.imageAnnotation,e.sId=this.cornerstoneArray[n].sId,e.e?e.pointA=[{start:{x:e.e.detail.currentPoints.image.x,y:e.e.detail.currentPoints.image.y}}]:e.pointA=[{}],console.log(e),e.handles={start:{},end:{}},this.nodeInfo||(this.nodeInfo={}),this.nodeInfo[e.layerNumber]||(this.nodeInfo[e.layerNumber]=[]),this.nodeInfo[e.layerNumber].push({layerNumber:e.layerNumber,type:e.type,nodeInfo:e,sId:e.sId,show:!0}),this.sequencelist.addNode(e,!0),this.event._dispatch("ctcornerstone.addNode",e)}},{key:"cobbAdd",value:function(e,n,t){var o=this.controlename.replace("Fan","");e.uuid||this.setSpliceUUID(e,"length",e.id,t),this.drawInfo.setInfo(e),e.setDataType="number",e.toolType=this.tooltype,e.layerNumber=n,e.type=o,e.lineA=[e.handles],e.show=!0,this.sequencelist.addNode(e,!0),this.nodeInfo||(this.nodeInfo={}),this.nodeInfo[n]||(this.nodeInfo[n]=[]),this.nodeInfo[n].push({layerNumber:n,type:e.tooltype,nodeInfo:e,sId:e.sId,show:!0}),this.event._dispatch("ctcornerstone.addNode",e)}},{key:"makeCicle",value:function(){if(this.mousemoveView){var e=this.cornerstoneTools_config.quickselect_config.deviation,n=Math.ceil(e*this.mousemoveView.scale);this.dom.find(".cicle").hide(),this.dom.find(".cicle").css({width:n,height:n,"border-radius":n,broder:"1px dashed #000",background:"transparent",transform:"translate("+(this.mousePos.x-n/2)+"px,"+(this.mousePos.y-n/2)+"px)",display:"block"})}}},{key:"makeBrushCicle",value:function(){if(this.mousemoveView){var e=this.cornerstoneTools_config.brush_config.radius,n=Math.ceil(e*this.mousemoveView.scale);this.dom.find(".cicle").hide(),this.dom.find(".cicle").css({width:n,height:n,"border-radius":n,broder:"0",background:"#f00",transform:"translate("+(this.mousePos.x-n/2)+"px,"+(this.mousePos.y-n/2)+"px)",display:"block"})}}},{key:"updateAllCanvas",value:function(e){if(this.model.nidusChoose){var n=this.model.nidusChoose.bid||this.model.nidusChoose.uuid,t={id:n,cal:"出血量:"+Math.floor(this.brushManage.getPixTotal(n,this.model.nidusChoose.uuid)*this.model.seriesInfo[e].volumeCal*100)/100+"mm<sup>3</sup>"};this.sequencelist.upCal(t)}for(var o=0;o<this.sceen;o++)this.cornerstoneArray[o]&&this.cornerstoneArray[o].sId==e&&cornerstone.updateImage(this.cornerstoneArray[o].element)}},{key:"drawImg",value:function(e,n){cornerstone.pixelToCanvas(n.element,{x:0,y:0}),cornerstone.getViewport(n.element);for(var t in e)if(e[t].image){var o=e[t].image;e[t].image.width,e[t].image.height;n.canvasContext.drawImage(o,0,0)}}},{key:"drawNode",value:function(e,n){for(var t=0,o=(cornerstone.pixelToCanvas(n.element,{x:0,y:0}),cornerstone.getViewport(n.element),0);o<e.length;o++){var i=e[o].type;switch(e[o].type){case"cobb":i="length"}var a=!0;if("alignment"==e[o].type)t=1,a=!1;else{var r=cornerstoneTools.getToolState(n.element,i);r&&r.data.map(function(n){n.uuid==e[o].nodeInfo.uuid&&(a=!1,t++)})}if(this.model.nidusChoose)if(!e[o].nodeInfo||this.model.nidusChoose.uuid!=e[o].nodeInfo.uuid&&this.model.nidusChoose.id!=e[o].nodeInfo.uuid)"alignment"==e[o].type&&this.drawAlignment(n,e[o],"#f00");else{var s=e[o].nodeInfo.handles,l=n.canvasContext;if(l.lineWidth=10,l.strokeStyle="#f00",l.beginPath(),l.mozImageSmoothingEnabled=!1,"cobb"==e[o].type||"alignment"==e[o].type){if("cobb"==e[o].type&&2==e[o].nodeInfo.lineA.length){var d=(e[o].nodeInfo.lineA[0].handles.start.x+e[o].nodeInfo.lineA[0].handles.end.x)/2,c=(e[o].nodeInfo.lineA[0].handles.start.y+e[o].nodeInfo.lineA[0].handles.end.y)/2;l.strokeRect(d,c,2,2),this.dom.find("."+n.element.id+" .cal").html("cobb角"+Tool.calAngel(e[o].nodeInfo.lineA[0].handles,e[o].nodeInfo.lineA[1].handles))}"alignment"==e[o].type&&this.drawAlignment(n,e[o],"#0f0",!0)}else s&&(console.log(s,"handleshandleshandles"),l.moveTo((1*s.start.x+1*s.end.x)/2,1*s.start.y-5),l.lineTo((1*s.start.x+1*s.end.x)/2,1*s.start.y-2),l.lineTo((1*s.start.x+1*s.end.x)/2+3,1*s.start.y-2),l.lineTo((1*s.start.x+1*s.end.x)/2+3,1*s.start.y-5),l.lineTo((1*s.start.x+1*s.end.x)/2,1*s.start.y-5),l.stroke())}else"alignment"==e[o].type&&this.drawAlignment(n,e[o],"#f00");if(a&&e[o].nodeInfo){if("cobb"==e[o].type)return void e[o].nodeInfo.lineA.map(function(e){cornerstoneTools.addToolState(n.element,"length",e)});cornerstoneTools.addToolState(n.element,e[o].type,e[o].nodeInfo);var u=this.app.local.get(e[o].nodeInfo.uuid)?1*this.app.local.get(e[o].nodeInfo.uuid):1;this.app.local.set(e[o].nodeInfo.uuid,u+1,!0),cornerstoneTools[e[o].type]&&cornerstoneTools[e[o].type].activate(n.element,1),this.defaultFunction(this.controlename)}}0==t&&0!=e.length&&this.defaultFunction(this.controlename)}},{key:"drawAlignment",value:function(e,n,t,o){var i=e.canvasContext;i.font="bold 28px Arial";var a=1;i.lineWidth=2,i.strokeStyle=t,i.mozImageSmoothingEnabled=!1,n.nodeInfo.pointA.map(function(e){e.start&&(i.strokeRect(e.start.x,e.start.y,3,3),o&&(i.fillStyle="#0f0",i.fillText(a,e.start.x+5,e.start.y))),a++})}}]),n}();e.exports=i},1090:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"creatPath",value:function(e,n,t,o){if(n=n||{width:512,height:512},this.craetCanvas(n,o),t){var i=this.ctx.getImageData(0,0,n.width,n.height);t.map(function(e){i.data[4*e]=0,i.data[4*e+1]=200,i.data[4*e+2]=0,i.data[4*e+3]=140}),this.ctx.putImageData(i,0,0)}this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y)}},{key:"drawPath",value:function(e){this.ctx.lineTo(e.x,e.y),this.ctx.stroke();for(var n=[],t=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),o=0;o<t.data.length/4;o++)t.data[4*o+1]+t.data[4*o]+t.data[4*o+2]>128&&n.push(o);return n}},{key:"noneClosePath",value:function(){for(var e=[],n=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),t=0;t<n.data.length/4;t++)n.data[4*t+3]=0,n.data[4*t+1]+n.data[4*t]+n.data[4*t+2]>128&&e.push(t);return e}},{key:"endPath",value:function(){this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke();for(var e=[],n=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),t=0;t<n.data.length/4;t++)n.data[4*t+3]=0,n.data[4*t+1]>128&&e.push(t);return e}},{key:"craetCanvas",value:function(e,n){this.canvas?(this.ctx.lineWidth=n||1,this.ctx.clearRect(0,0,e.width+1,e.height+1)):(this.canvas=document.createElement("canvas"),this.canvas.width=e.width,this.canvas.height=e.height,this.ctx=this.canvas.getContext("2d"),this.ctx.lineWidth=n||1,this.ctx.strokeStyle="rgba(0,200,0,1)",this.ctx.fillStyle="rgba(0,200,0,0.5)")}}]),e}();e.exports=new i},1091:function(e,n,t){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(1092);var a=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));r.html=t(1094);var s=t(1095);r.model=new s(r.app),r.drawInfo=t(1096);try{r.hitArea=new createjs.Shape,r.hitArea.graphics.beginFill("#000").drawRect(0,0,r.model._pathSize,r.model._pathSize)}catch(e){console.log(e)}return r.controlename="move",r.freehand=t(1097),r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,ctcornerstone_base),i(n,[{key:"complete",value:function(){this.moduleLoad(),this.tpLoad(),location.href.includes("drapCanvasPro")&&(document.getElementById("canvas_box").className="drapCanvasPro",console.log(document.getElementById("canvas_box"),"我是dom"))}},{key:"tpLoad",value:function(){var e=this,n=t(1098);this.tpControl=this.app.loadModule(n,this.dom.find("#canvas_box .tp")),this.tpControl.model=this.model,this.tpControl.event._addEvent("ThumbnailProgress.dragThumbnail",function(n){e.moveBoX(n)}),this.tpControl.event._addEvent("ThumbnailProgress.bgClick",function(n){console.log(n),e.moveBoXLarge(n)}),this.tpControl.event._addEvent("ThumbnailProgress.borClick",function(n){e.stage.mouseX=e.model._vpCanvasInfo.width/2,e.stage.mouseY=e.model._vpCanvasInfo.height/2,e.scaleCanvas(n.x,n.y)}),this.tpControl.event._addEvent("ThumbnailProgress.progress",function(n){e.stage.mouseX=e.model._vpCanvasInfo.width/2,e.stage.mouseY=e.model._vpCanvasInfo.height/2,e.tpControl.progressPos.call(e,n.pageY)}),this.tpControl.event._addEvent("ThumbnailProgress.changeImage",function(n){e.setContainerPos(n.spos),e.model.nowImageLevel=n.level,e.model.pathSize=n.pathSize,e.handlerImageLoad()}),this.tpControl.event._addEvent("ThumbnailProgress.scaleImage",function(n){e.setContainerPos(n.spos),e.model.pathSize=n.pathSize,e.scaleBox()})}},{key:"initCT",value:function(e,n,t){this.model.serinfo=t.data,this.model.orginImgSizes=t.data.segmentationInfo,this.tpControl.initBreviaryImg(),this.initImgCanvas(),this.ctEvent()}},{key:"loadImage",value:function(){var e=function(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function o(i,a){try{var r=n[i](a),s=r.value}catch(e){return void t(e)}if(!r.done)return Promise.resolve(s).then(function(e){o("next",e)},function(e){o("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function e(n,t,o){var i,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1==n.lastIndexOf("undefined")){e.next=2;break}return e.abrupt("return");case 2:(i=new Image).src=n,i.crossOrigin="Anonymous",i.onload=function(e){console.log(n.split("?")[0],o),a.makeSingleBitmap(t,e.target,o)},i.onerror=function(e){console.log("no path")};case 7:case"end":return e.stop()}},e,this)}));return function(n,t,o){return e.apply(this,arguments)}}()},{key:"makeSingleBitmap",value:function(e,n,t){if(this.model.imagePool[e])this.model.imagePool[e].image=n;else{var o=new createjs.Bitmap(n);this.model.imagePool[e]=o,o.hitArea=this.hitArea,this.container.addChild(this.model.imagePool[e])}this.model.imagePool[e].x=t.bitmapNumx*this.model._pathSize,this.model.imagePool[e].y=t.bitmapNumy*this.model._pathSize,this.model.imagePool[e].scale=this.model._pathSize/this.model._section,this.model.imagePool[e].bx=t.bitmapNumx,this.model.imagePool[e].by=t.bitmapNumy,this.renderStage()}},{key:"queryImgs",value:function(){if(0!=this.model.numberList.length){var e=[];this.model.numberList.forEach(function(n){var t=Object.keys(n)[0];"blank"!=t&&e.push(Number(t))});console.log(this.model.numberList),console.log(e),0!=e.length?this.event._dispatch("ctcornerstone.loadImage",{seriesInstanceUID:this.model.serinfo.seriesInstanceUID,fileType:"BIG_IMAGE",windowType:this.model.nowImageLevel,numberList:e}):this.makeImage({data:{list:[]}})}}},{key:"makeImage",value:function(e){for(var n=this,t=[],o=0;o<e.data.list.length;o++){var i=e.data.list[o];t[i.number]=i.urlWAN}this.model.numberList.forEach(function(e){var o=Object.keys(e)[0];if("blank"!=o){var i=t[Number(o)];setTimeout(function(){n.loadImage(i,e[o].i,e[o].bit)},60)}else n.makeSingleBitmap(e[o].i,n.model.blank,e[o].bit)})}},{key:"ctEvent",value:function(){var e=this,n=!0;this.stage.addEventListener("stagemousedown",function(t){if(n=!1,2!=t.nativeEvent.buttons){if(e.dragOffset.x=e.stage.mouseX,e.dragOffset.y=e.stage.mouseY,("brushFan"==e.controlename||"earseFan"==e.controlename)&&!e.model.nidusChoose)return n=!0,void e.app.alert.show({title:" ",msg:"没有对应的病灶",close:!0});1==t.nativeEvent.buttons&&e.craetData()}else n=!0}),this.stage.addEventListener("stagemousemove",function(t){var o=e.stage.mouseX-e.dragOffset.x,i=e.stage.mouseY-e.dragOffset.y;if(e.dragOffset.x=e.stage.mouseX,e.dragOffset.y=e.stage.mouseY,2==t.nativeEvent.buttons&&e.moveBoX({moveX:o,moveY:i}),!n&&1==t.nativeEvent.buttons)switch(e.controlename.replace("Fan","")){case"move":e.moveBoX({moveX:o,moveY:i});break;case"freehand":e.drawLine();break;case"zoom":e.scaleCanvas(o,i);break;case"brush":e.editLine("add");break;case"earse":e.editLine("remove")}}),this.stage.addEventListener("stagemouseup",function(t){n=!0,e.endDraw()})}},{key:"setSequence",value:function(e,n){var t=this;this.nodeInfo=0!=n.length?{}:null;var i=e;console.log(n,"我是粗来的值==============",i),i.map(function(e){e.id="object"==o(e.id)?e.id.series:e.id,e.sequenceName="object"==o(e.sequenceName)?e.sequenceName.series:e.sequenceName,e.studyId="object"==o(e.studyId)?e.studyId.series:e.studyId}),n.map(function(e){t.nodeInfo[e.layerNumber]||(t.nodeInfo[e.layerNumber]=[]),t.model.nidusComponentData[e.id]||(t.model.nidusComponentData[e.id]={});var n={};n.layerNumber=e.layerNumber,n.sId=e.sId,n.type=e.type,n.uuid=e.uuid,n.show=!0,n.nodeInfo={uuid:e.uuid,id:e.id},console.log(e,"item"),t.nodeInfo[e.layerNumber].push(n),t.drawInfo.setInfo(e),e.annotationItemResultList&&e.annotationItemResultList.map(function(n){t.model.nidusComponentData[e.id][n.annotationItemId]=n}),e.orginannotationItemResultList&&(t.model.nidusComponentData[e.id].orginannotationItemResultList=e.orginannotationItemResultList),t.model.nidusComponentData[e.id].doctorName=e.doctorName,t.model.nidusComponentData[e.id].imageRemark=e.imageRemark}),this.sequencelist.setData(i,n),this.drawNode(!1),this.renderStage()}},{key:"creatShape",value:function(e,n){var t=this,o=new createjs.Shape;return o.graphics.beginStroke(n?"#0f0":"#f00"),o.graphics.setStrokeStyle(this.cornerstoneTools_config.freehand_config.lineWidth,"round","round"),o.x=this.model.imageLeftPoint.x,o.y=this.model.imageLeftPoint.y,o.addEventListener("click",function(e){t.sequencelist.clickById({uuid:e.target.uuid})}),this.stage&&e&&this.stage.addChild(o),console.log(this.stage),o}},{key:"craetData",value:function(){switch(this.controlename.replace("Fan","")){case"freehand":if(this.drawData=this.model.nidusChoose?this.drawInfo.getInfo(this.model.nidusChoose):this.drawInfo.setInfo({path:{},uuid:null}),this.drawData.type="freehandline",this.drawData.setDataType="number",this.drawData.layerNumber=1,this.drawData.sId=this.model.serinfo.seriesInstanceUID,this.drawData.imageAnnotationId=this.tooltype.imageAnnotationId,this.drawData.imageAnnotationToolId=this.tooltype.id,this.drawData.imageAnnotationToolType=this.tooltype.type,this.drawData.imageAnnotationType=this.tooltype.imageAnnotation,console.log(this.tooltype),this.drawData.toolType=this.tooltype,this.model.nidusChoose){var e=this.model.calSaveXYPos({x:this.stage.mouseX,y:this.stage.mouseY});this.prePoint=e;var n=this.drawInfo.getInfo(this.model.nidusChoose),t=this.model.calGetMinDistance(n.path,e);n.shape.graphics.moveTo(t.x,t.y);var o=this.model.calXYPos({x:this.stage.mouseX,y:this.stage.mouseY});n.shape.graphics.lineTo(o.x,o.y)}else{var i=this.model.calSaveXYPos({x:this.stage.mouseX,y:this.stage.mouseY});i.father=null,i.child=null,console.log(i),this.drawData.path[i.x+"_"+i.y]=i,this.prePoint=i,this.drawData.shape=this.creatShape(!0,!1);var a=this.model.calXYPos({x:this.stage.mouseX,y:this.stage.mouseY});this.drawData.shape.graphics.moveTo(a.x,a.y),this.drawData.shape.uuid=this.drawData.uuid,this.drawData.show=!0,this.renderStage(!1)}break;case"brush":this.drawData=this.drawInfo.getInfo(this.model.nidusChoose);var r=this.model.calSaveXYPos({x:this.stage.mouseX,y:this.stage.mouseY}),s=this.model.calGetMinDistance(this.drawData.path,r);this.prePoint=r,this.drawData.shape.graphics.moveTo(s.x,s.y);var l=this.model.calXYPos({x:this.stage.mouseX,y:this.stage.mouseY});this.drawData.shape.graphics.lineTo(l.x,l.y)}}},{key:"drawLine",value:function(){var e=this.drawData,n=this.model.calSaveXYPos({x:this.stage.mouseX,y:this.stage.mouseY});if(n.x!=this.prePoint.x||n.y!=this.prePoint.y){var t=this.prePoint.x+"_"+this.prePoint.y;this.drawData.path[t].child?(this.drawData.path[t].father=n.x+"_"+n.y,e.path[n.x+"_"+n.y]=n,n.child=t,n.father=null):(this.drawData.path[t].child=n.x+"_"+n.y,e.path[n.x+"_"+n.y]=n,n.father=t,n.child=null),this.prePoint=n;var o=this.model.calXYPos({x:this.stage.mouseX,y:this.stage.mouseY});e.shape.graphics.lineTo(o.x,o.y),this.renderStage()}}},{key:"endDraw",value:function(){if(this.drawData){var e={},n=this.model.returnNull(this.drawData.path);if(n){var t=this.model.calShowXYPos(this.drawData.path[n]);this.drawData.shape.graphics.lineTo(t.x,t.y),this.renderStage()}for(var o in this.drawData)e[o]=this.drawData[o];console.log(this.drawData),!this.model.nidusChoose&&this.drawData?(this.sequencelist.addNode(e),this.nodeInfo||(this.nodeInfo={}),this.nodeInfo[1]||(this.nodeInfo[1]=[]),this.nodeInfo[1].push({layerNumber:1,type:e.tooltype,nodeInfo:e,sId:this.model.serinfo.seriesInstanceUID,show:!0}),this.event._dispatch("ctcornerstone.addNode",this.drawData)):(console.log(this.drawData),this.event._dispatch("ctcornerstone.editNode",this.drawData)),this.drawData=null,this.prePoint=null}}},{key:"editLine",value:function(e){if("add"==e)this.drawLine();else{this.drawData=this.drawInfo.getInfo(this.model.nidusChoose);this.drawData;this.drawData.shape.graphics.clear(),this.drawData.shape.graphics.beginStroke("#f00"),this.drawData.shape.graphics.setStrokeStyle(this.cornerstoneTools_config.freehand_config.lineWidth,"round","round"),this.model.removeData(this.drawData.path,{x:this.stage.mouseX,y:this.stage.mouseY,d:this.cornerstoneTools_config.earse_config.radius}),this.reDrawShape(this.drawData.path,this.drawData.shape),this.renderStage()}}},{key:"reDrawShape",value:function(e,n){for(var t in e){var o=e[t];if(o.child){var i=this.model.calShowXYPos(o);if(n.graphics.moveTo(i.x,i.y),e[o.child]){var a=this.model.calShowXYPos(e[o.child]);n.graphics.lineTo(a.x,a.y)}}}}},{key:"initImgCanvas",value:function(){var e=this;this.canvas=document.getElementById("canvas");var n=this.model.getCanvasSize();this.canvas.width=n.width,this.canvas.height=n.height,this.stage=new createjs.Stage(canvas),this.container=new createjs.Container,this.container.x=this.model.imageLeftPoint.x,this.container.y=this.model.imageLeftPoint.y,this.stage.addChild(this.container),this.dragOffset={x:0,y:0},window.onmousewhee=document.onmousewheel=function(n){var t=0;n||(n=window.event),n.wheelDelta&&(t=n.wheelDelta/120,window.opera&&(t=-t)),console.log(t),t&&e.scaleCanvas("",t)},this.handlerImageLoad()}},{key:"handlerImageLoad",value:function(){var e=this,n=Math.floor(-this.model.imageLeftPoint.x/this.model._pathSize),t=Math.floor(-this.model.imageLeftPoint.y/this.model._pathSize);n=n<0?0:n,t=t<0?0:t;Math.floor(this.model.imageLeftPoint.x%this.model._pathSize),Math.floor(this.model.imageLeftPoint.x%this.model._pathSize);this.orginImg=this.model._orginImgSizes[this.model.nowImageLevel],console.log(this.orginImg,"我是最新的倍数"),this.tpControl.orginImg=this.orginImg;var o=this.model._vpCanvasInfo.colnum,i=this.model._vpCanvasInfo.row*o;this.model.numberList=[];for(var a=0;a<i;a++){var r=n+a%o,s=t+Math.floor(a/o),l={};l[this.model.backImageNumber({bitmapNumx:r,bitmapNumy:s})]={i:a,bit:{bitmapNumx:r,bitmapNumy:s}},this.model.numberList.push(l)}this.queryImgs(),setTimeout(function(){e.tpControl.makeShowArea()},100),this.tpControl.changProgress()}},{key:"setContainerPos",value:function(e){this.model.imageLeftPoint.x=this.model.imageLeftPoint.x+e.moveX,this.model.imageLeftPoint.y=this.model.imageLeftPoint.y+e.moveY,this.container.x=this.model.imageLeftPoint.x,this.container.y=this.model.imageLeftPoint.y}},{key:"moveBoXLarge",value:function(e){this.setContainerPos(e),console.log(this.model.imageLeftPoint,e);var n=this.model.imagePool.length;this.model.numberList=[];var t=-Math.floor(this.model.imageLeftPoint.x/this.model._pathSize);t=t<0?0:t;var o=-Math.floor(this.model.imageLeftPoint.y/this.model._pathSize);o=o<0?0:o;for(var i=0;i<n;i++){var a=t-1+i%this.model._vpCanvasInfo.colnum,r=o-1+Math.floor(i/this.model._vpCanvasInfo.colnum),s={};s[this.model.backImageNumber({bitmapNumx:a,bitmapNumy:r})]={i:i,bit:{bitmapNumx:a,bitmapNumy:r}},this.model.numberList.push(s)}this.queryImgs(),this.tpControl.makeShowArea(),this.drawNode(!1),this.renderStage()}},{key:"moveBoX",value:function(e){this.setContainerPos(e),console.log(this.model.imageLeftPoint,e);var n=this.model.imagePool.length;this.model.numberList=[],console.log(e.moveX/this.model._pathSize),console.log(e.moveY/this.model._pathSize),console.log(this.model._vpCanvasInfo);for(var t=0;t<n;t++){var o=!1,i=Math.round(this.model.imagePool[t].x/this.model._pathSize),a=Math.round(this.model.imagePool[t].y/this.model._pathSize);if(this.model.imagePool[t].x+this.container.x+this.model._pathSize<=-this.model._pathSize/2&&(i+=this.model._vpCanvasInfo.colnum,o=!0),this.model.imagePool[t].x+this.container.x>=this.model._vpCanvasInfo.width+this.model._pathSize/2&&(i-=this.model._vpCanvasInfo.colnum,o=!0),this.model.imagePool[t].y+this.container.y+this.model._pathSize<-this.model._pathSize/2&&(a+=this.model._vpCanvasInfo.row,o=!0),this.model.imagePool[t].y+this.container.y>=this.model._vpCanvasInfo.height+this.model._pathSize/2&&(a-=this.model._vpCanvasInfo.row,o=!0),console.log(o),o){var r={};r[this.model.backImageNumber({bitmapNumx:i,bitmapNumy:a})]={i:t,bit:{bitmapNumx:i,bitmapNumy:a}},this.model.numberList.push(r)}}this.queryImgs(),this.tpControl.makeShowArea(),this.drawNode(!1),this.renderStage()}},{key:"scaleCanvas",value:function(e,n){if(n){var t=n<0?-2:2;if(!("1x"==this.model.nowImageLevel&&this.model._pathSize+t<this.model._section-this.model._changeRange||this.model.nowImageLevel==this.model._orginImgSizes.length+"x"&&this.model._pathSize+t>=this.model._section+this.model._changeRange)){var o=this.getColRow({x:this.model.imageLeftPoint.x,y:this.model.imageLeftPoint.y},{x:this.stage.mouseX,y:this.stage.mouseY}),i={moveX:-o.col*t,moveY:-o.row*t};return this.setContainerPos(i),this.model.pathSize=this.model._pathSize+t,this.model._pathSize>this.model._section+this.model._changeRange?(this.model.pathSize=this.model._section-this.model._changeRange,this.model.nowImageLevel=1*this.model.nowImageLevel.replace("x","")+1+"x",this.drawNode(!0),void this.handlerImageLoad()):this.model._pathSize<this.model._section-this.model._changeRange?(this.model.pathSize=this.model._section+this.model._changeRange,this.model.nowImageLevel=1*this.model.nowImageLevel.replace("x","")-1+"x",this.drawNode(!0),void this.handlerImageLoad()):void this.scaleBox()}}}},{key:"scaleBox",value:function(){for(var e=0;e<this.model.imagePool.length;e++)this.model.imagePool[e].scale=this.model._pathSize/this.model._section,this.model.imagePool[e].x=this.model._pathSize*this.model.imagePool[e].bx,this.model.imagePool[e].y=this.model._pathSize*this.model.imagePool[e].by;this.tpControl.makeShowArea(),this.tpControl.changProgress(),this.drawNode(!0),console.log("scaleBox2"),this.renderStage()}},{key:"getColRow",value:function(e,n){return{col:Math.floor((n.x-e.x)/this.model._pathSize),row:Math.floor((n.y-e.y)/this.model._pathSize)}}},{key:"resize",value:function(){var e=ES.selctorDoc(window).box().clientWidth,n=ES.selctorDoc(window).box().clientHeight-60-64;this.dom.find(".ctcornerstone").css({width:e}),this.dom.find(".ctcornerstone .slist").css({width:e-290-180}),this.dom.find(".ctcornerstone .xulielist").css({height:n}),this.dom.find(".ctcornerstone .info").css({height:n}),this.dom.find(".ctcornerstone .nidus_content").css({height:n}),this.dom.find("#canvas_box").css({width:this.model._vpCanvasInfo.width-1,height:this.model._vpCanvasInfo.height}),this.nidusControl&&this.nidusControl.resize(),this.nidusControlAll&&this.nidusControlAll.resize()}},{key:"close",value:function(){}},{key:"doneDelete",value:function(e,n){console.log(e,n),this.stage.removeChild(n.shape),this.drawInfo.removeInfo(n),this.sequencelist.removeNode(n),this.nodeInfo[1]=this.nodeInfo[1].filter(function(e){return e.uuid!=n.uuid}),this.model.nidusChoose=null,this.renderStage(),this.event._dispatch("ctcornerstone.deleteNode",{backId:n.backId})}},{key:"renderStage",value:function(){console.log("cttool.renderStage"),this.event._dispatch("cttool.renderStage"),this.stage.update()}},{key:"drawNode",value:function(e){var n=this;console.log(this.nodeInfo),this.nodeInfo&&this.nodeInfo[1]&&this.nodeInfo[1].forEach(function(t){t.uuid=t.uuid||(t.nodeInfo?t.nodeInfo.uuid:"");var o=n.drawInfo.getInfo(t);console.log(o.shape),o&&(e&&o.shape&&(n.stage.removeChild(o.shape),o.shape=null),t.show&&(o.shape?(o.shape.x=n.model.imageLeftPoint.x,o.shape.y=n.model.imageLeftPoint.y):(n.model.nidusChoose&&n.model.nidusChoose.uuid==o.uuid?o.shape=n.creatShape(!0,!0):o.shape=n.creatShape(!0,!1),o.shape.uuid=t.uuid,n.reDrawShape(o.path,o.shape))))})}},{key:"freehandFan",value:function(){this.controlename="freehand"}},{key:"movefun",value:function(){this.controlename="move"}},{key:"zoomFan",value:function(){this.controlename="scale"}},{key:"brushFan",value:function(){this.controlename="brush"}},{key:"earseFan",value:function(){this.controlename="earse"}},{key:"restFan",value:function(){}}]),n}();e.exports=a},1092:function(e,n,t){var o=t(1093);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1093:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".ctcornerstone {\n  display: flex;\n  width: 100%;\n  position: relative;\n}\n.ctcornerstone .drapCanvasPro {\n  margin-right: 174px;\n}\n.ctcornerstone #canvas_box {\n  position: relative;\n  overflow: hidden;\n}\n.ctcornerstone .cicle {\n  position: fixed;\n  border: 1px dashed #000;\n  display: none;\n  background: transparent;\n  top: 0;\n  left: 0;\n  z-index: 1000;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  pointer-events: none;\n}\n.ctcornerstone .xulielist {\n  width: 180px;\n  background: #0a2634;\n}\n.ctcornerstone .info {\n  width: 290px;\n  background: #0a2634;\n}\n.ctcornerstone .nidus_content {\n  position: absolute;\n  width: 290px;\n  top: 0;\n  right: 0;\n  display: none;\n  z-index: 20;\n}\n.ctcornerstone .allcornerstone {\n  position: relative;\n}\n.ctcornerstone .slist {\n  position: absolute;\n  left: 180px;\n  bottom: 0;\n  height: 100px;\n}\n.ctcornerstone .submit_data {\n  width: 200px;\n  height: 30px;\n  position: absolute;\n  left: 50%;\n  margin-left: -100px;\n  background: #0a2634;\n  border-radius: 5px;\n  display: none;\n}\n.ctcornerstone .submit_data span {\n  font-size: 14px;\n  line-height: 30px;\n  color: #d2effc;\n}\n",""])},1094:function(e,n){e.exports="<div class=ctcornerstone> <div class=xulielist></div> <div id=canvas_box> <canvas id=canvas oncontextmenu=return!1 unselectable=on onselectstart=return!1 onmousedown=return!1></canvas> <div class=tp></div> </div> <div class=info></div> <div class=nidus_content></div> <div style=clear:both></div> <div class=slist></div> <div class=cicle unselectable=on onselectstart=return!1 onmousedown=return!1 onmouseover=return!1 onmousemove=return!1></div> </div> <div style=clear:both></div>"},1095:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(e){function n(e){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));t.nidusComponentInfo={},t.nidusComponentData={},t.nidusChoose=null,t.seriesInfo={},t.controlStauts={delete:!0},t.allresult=null;var o=t.getCanvasSize();t._pathSize=254,t._section=254,t._changeRange=Math.round(t._section/3);var i=t.viewPortColRow({w:o.width,h:o.height});return t.blank="",t.seriesNext=[],t.getBlankImg(),t._vpCanvasInfo={width:o.width,height:o.height,colnum:i.col,row:i.row,length:i.length},t._orginImgSizes={},t.sequence={},t.numberList=[],t.breviaryImg={width:600,height:225,top:0,left:0},t._breviaryImgBorder={width:148,height:148},t.imageLeftPoint={x:0,y:0},t.imagePool=[],t.beforeImages=[],t.afterImages=[],t.nowImageLevel="1x",t}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.modelBase),o(n,[{key:"viewPortColRow",value:function(e){return{col:Math.ceil(1.5*e.w/this._pathSize)+2,row:Math.ceil(1.5*e.h/this._pathSize)+2,length:(Math.ceil(1.5*e.w/this._pathSize)+2)*(Math.ceil(1.5*e.h/this._pathSize)+2)}}},{key:"changeViewPort",value:function(e){this.setPrivate(this._vpCanvasInfo,e)}},{key:"backImageNumber",value:function(e){return e.bitmapNumx>=this._orginImgSizes[this.nowImageLevel].colnum||e.bitmapNumy>=this._orginImgSizes[this.nowImageLevel].row?"blank":e.bitmapNumy<0||e.bitmapNumx<0?"blank":(console.log(e,this._orginImgSizes[this.nowImageLevel],this.nowImageLevel),e.bitmapNumx+e.bitmapNumy*this._orginImgSizes[this.nowImageLevel].colnum+1)}},{key:"getCanvasSize",value:function(){var e=window.innerWidth-180-289,n=window.innerHeight-60-60;return location.href.includes("drapCanvasPro")&&(e-=174),{width:e,height:n}}},{key:"getBlankImg",value:function(){var e=this,n=new Image;n.onload=function(n){e.blank=n.target},n.src="/images/blank.jpg",n.crossOrigin="Anonymous"}},{key:"returnRate",value:function(){var e=this._orginImgSizes[this.nowImageLevel].width*(this._pathSize/this._section);return this._orginImgSizes[this._orginImgSizes.length+"x"].width/e}},{key:"calSaveXYPos",value:function(e){var n=this.returnRate();return{x:Math.round((e.x-this.imageLeftPoint.x)*n),y:Math.round((e.y-this.imageLeftPoint.y)*n)}}},{key:"calXYPos",value:function(e){return{x:Math.round(e.x-this.imageLeftPoint.x),y:Math.round(e.y-this.imageLeftPoint.y)}}},{key:"calShowXYPos",value:function(e){var n=1/this.returnRate();return{x:e.x*n,y:e.y*n}}},{key:"returnNull",value:function(e){var n=[];for(var t in e)e[t].father&&e[t].child||n.push(t);var o=1/this.returnRate();if(n[0]&&n[1]){var i=e[n[0]],a=e[n[1]],r=(i.x-a.x)*(i.x-a.x)+(i.y-a.y)*(i.y-a.y);if((r=r*o*o)<300)return e[n[0]].child?(e[n[1]].child=e[n[0]].x+"_"+e[n[0]].y,e[n[0]].father=e[n[1]].x+"_"+e[n[1]].y,n[0]):(e[n[0]].child=e[n[1]].x+"_"+e[n[1]].y,e[n[1]].father=e[n[0]].x+"_"+e[n[0]].y,n[1])}return!1}},{key:"removeData",value:function(e,n){var t=this.returnRate(),o=this.calXYPos({x:n.x,y:n.y}),i=[(o.x-n.d)*t,(o.x+n.d)*t],a=[(o.y-n.y)*t,(o.y+n.d)*t];for(var r in e)if(e[r].x>=i[0]&&e[r].x<=i[1]&&e[r].y>=a[0]&&e[r].y<=a[1]){var s=e[r].father,l=e[r].child;delete e[r],e[s]&&(e[s].child=null),e[l]&&(e[l].father=null)}}},{key:"calGetMinDistance",value:function(e,n){var t=void 0,o=null;for(var i in e)if(!e[i].father||!e[i].child){var a=(e[i].x-n.x)*(e[i].x-n.x)+(e[i].y-n.y)*(e[i].y-n.y);null==o?(o=a,t=i):a<o&&(t=i)}return t?e[t].father&&e[t].child?(e[n.x+"_"+n.y]={x:n.x,y:n.y,father:null,child:null},this.calShowXYPos({x:n.x,y:n.y})):(e[n.x+"_"+n.y]={x:n.x,y:n.y},e[t].father?(e[n.x+"_"+n.y].father=t,e[t].child=n.x+"_"+n.y):(e[n.x+"_"+n.y].child=t,e[t].father=n.x+"_"+n.y),this.calShowXYPos({x:e[t].x,y:e[t].y})):(e[n.x+"_"+n.y]={x:n.x,y:n.y,father:null,child:null},this.calShowXYPos({x:n.x,y:n.y}))}},{key:"pathSize",get:function(){return this._pathSize},set:function(e){this.setPrivate(this,{_pathSize:e})}},{key:"orginImgSizes",set:function(e){this.setPrivate(this,{_orginImgSizes:e})}}]),n}();e.exports=i},1096:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return o(e,[{key:"init",value:function(){this.info={},this.singelId=Tool.getSigleId(),this.brushInfo={}}},{key:"setInfo",value:function(e){return e.uuid||(e.uuid=Tool.getSigleId()),this.info[e.uuid]=e,this.info[e.uuid]}},{key:"getInfo",value:function(e){return this.info[e.uuid]}},{key:"getAll",value:function(){return this.info}},{key:"removeInfo",value:function(e){delete this.info[e.uuid]}},{key:"removeAll",value:function(){this.info={}}}]),e}();e.exports=new i},1097:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"creatPath",value:function(){}}]),e}();e.exports=new i},1098:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return t(1099),r.html=t(1101),r.name="ThumbnailProgress",r.model={},i=i,r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.moduleBase),o(n,[{key:"complete",value:function(){-1==window.location.hash.lastIndexOf("/drapCanvasAud/")&&-1==window.location.hash.lastIndexOf("/drapCanvasAudEdit/")||(this.dom.find(".breviary").css({right:180}),this.dom.find(".progress").css({right:200}))}},{key:"initBreviaryImg",value:function(){var e=this,n=new Image,t=this;n.id="bre_img",n.onload=function(){t.dom.find("#bre_img").attr("src",this.src);var e={width:0,height:0,top:0,left:0};this.width/this.height<t.model._breviaryImgBorder.width/t.model._breviaryImgBorder.height?(e.height=t.model._breviaryImgBorder.height,e.top=0,e.width=this.width*t.model._breviaryImgBorder.height/this.height,e.left=(t.model._breviaryImgBorder.width-e.width)/2):(e.width=t.model._breviaryImgBorder.width,e.left=0,e.height=this.height*t.model._breviaryImgBorder.width/this.width,e.top=(t.model._breviaryImgBorder.height-e.height)/2),t.model.breviaryImg=JSON.parse(JSON.stringify(e)),t.dom.find("#bre_img").css(e),t.makeShowArea()},n.src=this.model._orginImgSizes.thumbnail,n.crossOrigin="Anonymous";var o={};this.dom.find("#drag_div").on("mousedown",function(n){o={x:n.pageX,y:n.pageY},e.rate=e.model.breviaryImg.width/(e.orginImg.colnum*e.model.pathSize),e.dom.find("#breviary").on("mousemove",function(n){var t=n.pageX-o.x,i=n.pageY-o.y;e.dragDivPos({changeX:t,changeY:i},"drag"),o={x:n.pageX,y:n.pageY}}),e.dom.find("#breviary").on("mouseup",function(n){e.dom.find("#breviary").off("mousemove")})}),this.dom.find("#bre_img").on("click",function(n){e.rate=e.model.breviaryImg.width/(e.orginImg.colnum*e.model.pathSize);var t=document.querySelector("#breviary").getClientRects()[0],o=n.pageX-t.left,i=n.pageY-t.top,a=e.returnXY(),r=Math.floor(o-1*e.dom.find("#drag_div").dom[0].dom.style.width.replace("px","")/2-1*a[0]),s=Math.floor(i-1*e.dom.find("#drag_div").dom[0].dom.style.height.replace("px","")/2-1*a[1]);e.dragDivPos({changeX:r,changeY:s},"click")}),this.dom.find(".bor").on("click",function(n){e.event._dispatch("ThumbnailProgress.borClick",{x:0,y:"-"==n.target.innerHTML?-1:1})}),this.dom.find("#myProgress").on("click",function(n){e.event._dispatch("ThumbnailProgress.progress",n)})}},{key:"progressPos",value:function(e){var n=e-document.getElementById("myProgress").getClientRects()[0].top,t=132/this.model._orginImgSizes.length,o=Math.floor((132-n)/t);o=o>this.model._orginImgSizes.length?o-1+"x":o+1+"x";var i=this.model._section+Math.floor((132-n)%t*(this.model._changeRange/100)),a=void 0;if(o!=this.model.nowImageLevel){var r=1-this.model._orginImgSizes[o].colnum*i/(this.model._orginImgSizes[this.model.nowImageLevel].colnum*this.model._pathSize);a={moveX:(this.stage.mouseX-this.model.imageLeftPoint.x)*r,moveY:(this.stage.mouseY-this.model.imageLeftPoint.y)*r},this.setContainerPos(a),this.model.nowImageLevel=o,this.model.pathSize=i,this.handlerImageLoad()}else{var s=this.getColRow({x:this.model.imageLeftPoint.x,y:this.model.imageLeftPoint.y},{x:this.stage.mouseX,y:this.stage.mouseY});a={moveX:-s.col*(i-this.model.pathSize),moveY:-s.row*(i-this.model.pathSize)},this.setContainerPos(a),this.model.pathSize=i,this.scaleBox()}}},{key:"changProgress",value:function(){var e=132/this.model._orginImgSizes.length,n=.5*e*(this.model.pathSize-this.model._section+this.model._changeRange)/this.model._changeRange,t=(1*this.model.nowImageLevel.replace("x","")-1)*e+n;t+="px",this.dom.find(".progress_val").css({height:t})}},{key:"dragDivPos",value:function(e,n){var t=this.returnXY(),o="translate("+Math.floor(1*t[0]+e.changeX)+"px,"+Math.floor(1*t[1]+e.changeY)+"px)";this.dom.find("#drag_div").css({transform:o});var i=-e.changeX/this.rate,a=-e.changeY/this.rate;"drag"==n?this.event._dispatch("ThumbnailProgress.dragThumbnail",{moveX:i,moveY:a}):this.event._dispatch("ThumbnailProgress.bgClick",{moveX:i,moveY:a})}},{key:"returnXY",value:function(){var e=this.dom.find("#drag_div").dom[0].dom.style.transform;return[e.split(",")[0].split("(")[1].split("px")[0],e.split(",")[1].split(")")[0].split("px")[0]]}},{key:"makeShowArea",value:function(){var e=this.model._pathSize/this.model._section,n=this.model.breviaryImg.width/(this.orginImg.width*e),t=this.model._vpCanvasInfo.width>this.orginImg.width*e?1:this.model._vpCanvasInfo.width/(this.orginImg.width*e),o=this.model._vpCanvasInfo.height>this.orginImg.height*e?1:this.model._vpCanvasInfo.height/(this.orginImg.height*e),i={},a=this.model.breviaryImg.left-(1==t?0:this.model.imageLeftPoint.x*n),r=this.model.breviaryImg.top-(1==o?0:this.model.imageLeftPoint.y*n);i.width=this.model.breviaryImg.width*t,i.height=this.model.breviaryImg.height*o,i.transform="translate("+a+"px,"+r+"px)",this.dom.find("#drag_div").css(i)}},{key:"getColRow",value:function(e,n){return{col:Math.floor((n.x-e.x)/this.model._pathSize),row:Math.floor((n.y-e.y)/this.model._pathSize)}}}]),n}();e.exports=i},1099:function(e,n,t){var o=t(1100);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1100:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".thumbnailprogress .progress {\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  width: 10px;\n  height: 200px;\n  right: 23px;\n  top: 158px;\n  left: auto;\n  margin: 0;\n  background: transparent;\n}\n.thumbnailprogress .progress #myProgress {\n  border-radius: 6px;\n  width: 6px;\n  height: 192px;\n  background: #01111E;\n  margin-left: 4px;\n  position: relative;\n}\n.thumbnailprogress .progress .select_size {\n  width: 14px;\n  height: 14px;\n  border: 2px solid #448E97;\n  background: white;\n  position: absolute;\n  bottom: 0;\n  border-radius: 14px;\n  left: 50%;\n  transform: translateX(-50%);\n  z-index: 9999;\n  box-sizing: border-box;\n}\n.thumbnailprogress .progress .progress_val {\n  position: absolute;\n  left: 0;\n  bottom: 0;\n  border-radius: 14px;\n  height: 0;\n  width: 6px;\n  background: #448E97;\n}\n.thumbnailprogress .progress .bor {\n  border: 1px solid #448E97;\n  color: #448E97;\n  height: 12px;\n  width: 12px;\n  font-size: 14px;\n  text-align: center;\n  line-height: 12px;\n  background: white;\n  margin: 10px 0;\n}\n.thumbnailprogress .btn_opear {\n  position: fixed;\n  top: 20px;\n  right: 20px;\n}\n.thumbnailprogress .breviary {\n  border: 1px solid #01111E;\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 148px;\n  height: 148px;\n  background: #fff;\n  overflow: hidden;\n}\n.thumbnailprogress .breviary .breviary_conter {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n.thumbnailprogress .breviary .drag_div {\n  border: 1px solid red;\n  box-sizing: border-box;\n  position: absolute;\n  z-index: 99999999;\n  top: 0;\n  left: 0;\n}\n.thumbnailprogress .breviary #bre_img {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n}\n",""])},1101:function(e,n){e.exports='<div class=thumbnailprogress> <div id=breviary class=breviary> <div class=breviary_conter> <img src=xxxHTMLLINKxxx0.37880910535304580.33872081145878297xxx id=bre_img alt="" draggable=false onmousedown=return!1 onmousemove=return!1> <div id=drag_div class=drag_div></div> </div> </div> <div class=progress> <div class="reduce bor">-</div> <div id=myProgress value=10> <div class=progress_val></div> </div> <div class="add bor">+</div> </div> </div>'},1102:function(e,n,t){"use strict";e.exports=function(e){var n={brush:{t:"m",c:!0},ellipticalRoi:{t:"m",c:!0},rectangleRoi:{t:"m",c:!0},length:{t:"m",c:!0},earse:{t:"m",c:!0},simpleAngle:{t:"m",c:!0},magicStickSingle:{t:"m",c:!0},polygon:{t:"m",c:!0},freehand:{t:"m",c:!0},quickselect:{t:"m",c:!0},regionpaint:{t:"m",c:!0},screen:{t:"m",c:!0},mpr:{t:"m",c:!0},add:{t:"m",c:!1},sub:{t:"m",c:!1},cobb:{t:"m",c:!1},alignment:{t:"m",c:!1},upstep:{t:"s",c:!0},nextstep:{t:"s",c:!0},line:{t:"m",c:!0},zoom:{t:"m",c:!0},pan:{t:"m",c:!0},magnify:{t:"m",c:!0},rest:{t:"m",c:!0},proe:{t:"m",c:!0},rectangle_text:{t:"m",c:!0},light:{t:"m",c:!0},wl:{t:"m",c:!0},wl_text:{t:"s",c:!0},del:{t:"s",c:!0},layer_del:{t:"s",c:!0},all_del:{t:"s",c:!0},yinyang:{t:"s",c:!0},next_task:{t:"s",c:!0}};return"1"==e&&(n={screen:{t:"m",c:!1},mpr:{t:"m",c:!1},add:{t:"m",c:!1},sub:{t:"m",c:!1},cobb:{t:"m",c:!1},alignment:{t:"m",c:!1},brush:{t:"m",c:!1},ellipticalRoi:{t:"m",c:!1},rectangleRoi:{t:"m",c:!1},length:{t:"m",c:!1},earse:{t:"m",c:!1},simpleAngle:{t:"m",c:!1},magicStickSingle:{t:"m",c:!1},polygon:{t:"m",c:!1},freehand:{t:"m",c:!1},quickselect:{t:"m",c:!1},regionpaint:{t:"m",c:!1},upstep:{t:"s",c:!0},nextstep:{t:"s",c:!0},line:{t:"m",c:!0},zoom:{t:"m",c:!0},pan:{t:"m",c:!0},magnify:{t:"m",c:!0},rest:{t:"m",c:!0},proe:{t:"m",c:!0},rectangle_text:{t:"m",c:!0},light:{t:"m",c:!0},wl:{t:"m",c:!0},wl_text:{t:"s",c:!0},del:{t:"s",c:!0},layer_del:{t:"s",c:!0},all_del:{t:"s",c:!0},yinyang:{t:"s",c:!0},next_task:{t:"s",c:!0}}),n}},1103:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(1104);var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return r.html=t(1106),r.name="dicommenu",r.chooseData={ctVal:200},r.tool={data:{}},r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.moduleBase),o(n,[{key:"complete",value:function(){var e=this;for(var n in t.e(82).then(function(){var n=e.dropdown=t(919);setTimeout(function(){var t=[];e.app.constmap.WINDOW&&e.app.constmap.WINDOW.children.map(function(e){t.push({optionname:e.name,val:e.name,idx:e.remark})});var o=e.app.loadModule(n,e.dom.find(".wl"),{className:"ctdrop",firstSelect:{optionname:"选择窗位",val:"选择窗位",idx:""},data:t});o.event._addEvent("option.click",function(n){var t=n.idx.split("*");e.chooseData.wl={w:t[1],c:t[0]},e.event._dispatch("dicommenu.wlchange")}),o.event._addEvent("dropDown.clear",function(n){e.chooseData.wl={w:null,c:null},e.event._dispatch("dicommenu.wlchange")})},100)}.bind(null,t)).catch(t.oe),this.initRange(),this.initDate)if(!this.initDate[n].c){var o=this.dom.find(".dicommenu li[fun="+n+"]");o.attr("close","close");var i=o.attr("title");o.attr("title",i+" 已禁用"),o.css({cursor:"auto",background:"#01111e",color:"#706F6F"});var a=o.find("input").attr("name");o.find("input").dom&&"copdData"!=a&&"datava"!=a&&o.find("input").attr("readonly","readonly")}this.btn_event()}},{key:"initRange",value:function(){for(var e=this,n=t(1107),o=[{name:"半径",type:"bradius",value:4,max:30,min:1},{name:"粗细",type:"lineWidth",value:2,max:10,min:1},{name:"半径",type:"bradius",value:4,max:30,min:1},{name:"半径",type:"bradius",value:3,max:80,min:1}],i=0,a=o.length;i<a;i++){var r=this.app.loadModule(n,this.dom.find(".chooseDate").eq(i),o[i]);r.event._addEvent("rangetextchoose.change",function(n){e.synchronization(o,n),e.event._dispatch("dicommenu.setData",n)}),r.event._addEvent("rangetextchoose.errorMSG",function(n){e.event._dispatch("dicommenu.errorMSG",n)}),o[i].classObject=r}this.dom.find(".chooseDate1 .sure-btn").on("click",function(){var n=e.dom.find('.chooseDate1 input[name="copdData"]').val();localStorage.setItem("copdVal",n);var t={value:n};e.event._dispatch("dicommenu.CTData",t)})}},{key:"synchronization",value:function(e,n){for(var t=0,o=e.length;t<o;t++)e[t].type==n.type&&e[t].classObject.setAllData(n.value)}},{key:"btn_event",value:function(){var e=this,n=this;this.dom.find(".dicommenu .mask").on("click",function(){ES.selctorDoc(this).hide(),n.dom.find(".chooseDate").hide(),n.dom.find(".dicommenu .hover_vp").hide()}),this.dom.find(".dicommenu .fun_btn").on("click",function(){var e=ES.selctorDoc(this);switch(n.dom.find(".chooseDate").hide(),n.dom.find(".dicommenu .hover_vp").hide(),e.attr("fun")){case"rest":n.event._dispatch("dicommenu.reset");break;case"mpr":n.event._dispatch("dicommenu.mpr");break;default:n.toBtn_choose(e)?(console.log(e.attr("fun"),"funfufnf"),n.chooseData.fun=e.attr("fun")):n.chooseData={},n.event._dispatch("dicommenu.choose")}}),this.dom.find(".dicommenu .fun_btn_spice").on("click",function(e){var t=ES.selctorDoc(this);n.dom.find(".chooseDate").hide(),n.dom.find(".dicommenu .hover_vp").hide();var o=n.toBtn_choose(t);(o||null==o)&&t.find(".chooseDate").show(),o&&(n.chooseData.fun=t.attr("fun")),n.event._dispatch("dicommenu.choose")}),this.dom.find(".btn-c").on("click",function(){var e=ES.selctorDoc(this);n.toBtn_choose(e),n.chooseData.click=e.attr("fun"),n.event._dispatch("dicommenu.done")}),this.dom.find(".btn-yy").on("click",function(){var e=ES.selctorDoc(this);n.toBtn_choose(e)&&(n.dom.find(".btn-yy .btn").removeClass("light"),e.find(".btn").addClass("light"),n.event._dispatch("dicommenu.yinyang",{data:e.attr("data")}))}),this.dom.find(".opende").on("click",function(){var e=ES.selctorDoc(this).find("div"),t=!0;"隐藏标注"==e.html()?(t=!1,e.html("显示标注")):(t=!0,e.html("隐藏标注")),n.event._dispatch("dicommenu.shc",{stauts:t})}),this.dom.find(".dicommenu .screen").on("click",function(n){if("close"==e.dom.find(".dicommenu .screen").attr("close"))return!1;var t=document.querySelector(".dicommenu .screen");e.dom.find(".chooseDate").hide(),"block"==t.children[1].style.display?e.dom.find(".dicommenu .hover_vp").hide():e.dom.find(".dicommenu .hover_vp").show()}),this.dom.find(".dicommenu .vp_item").on("click",function(e){var t=ES.selctorDoc(this),o=n.dom.find(".dicommenu .screen").firstchildren("i");o.removeAttr("class"),o.attr("class",t.find("i").attr("class")),n.event._dispatch("dicommenu.splitScreen",1*t.attr("code"))}),this.dom.find(".dicommenu .fun_btn_single").on("click",function(){if("close"==n.dom.find(".dicommenu .fun_btn_single").attr("close"))return!1;n.dom.find(".dicommenu .fun_btn_single1").removeClass("choose");var e=ES.selctorDoc(this);n.dom.find(".chooseDate").hide(),n.dom.find(".dicommenu .hover_vp").hide(),e.hasClass("choose")?(e.removeClass("choose"),n.event._dispatch("dicommenu.baseLine",{st:!1})):(e.addClass("choose"),n.event._dispatch("dicommenu.baseLine",{st:!0}))}),this.dom.find(".dicommenu .fun_btn_single1").on("click",function(){if("close"==n.dom.find(".dicommenu .fun_btn_single").attr("close"))return!1;n.dom.find(".dicommenu .fun_btn_single").removeClass("choose");var e=ES.selctorDoc(this);n.dom.find(".chooseDate").hide(),n.dom.find(".dicommenu .hover_vp").hide(),e.addClass("choose"),n.event._dispatch("dicommenu.cross",{st:!0})}),this.dom.find(".dicommenu .chooseDate1").on("click",function(){console.log("我是点击了 希望能阻止")}),this.app.parpam.type&&-1!=this.app.parpam.type.lastIndexOf("viewer")&&this.dom.find('li[fun="remove_xu"]').remove()}},{key:"openYY",value:function(){this.dom.find(".btn-yy").show()}},{key:"closeYY",value:function(){this.dom.find(".btn-yy").attr("close","close")}},{key:"addDoctorSocre",value:function(e,n){console.log(n,e),"无"!=n&&this.dom.find(".yyshow").append("<p>"+e+":"+(1==n?"阴":"阳")+"</p>")}},{key:"setYY",value:function(e){var n=null;for(var t in e)n=e[t].data.yayAttributes;1==n?this.dom.find(".btn-yy .btn").eq(0).addClass("light"):2==n&&this.dom.find(".btn-yy .btn").eq(1).addClass("light")}},{key:"defaultWWC",value:function(e){this.dom.find(".ctdrop input").val(e.name),this.dom.find(".ctdrop input").attr("data-idx",e.remark),this.chooseData.wl={w:1*e.remark.split("*")[1],c:1*e.remark.split("*")[0]}}},{key:"makeValueRange",value:function(e,n){var o=this,i=n,a=t(1111),r=this.app.loadModal(a,{adv:!1,class:"sm",data:i.property});r.event._addEvent("modal.confirm",function(){var n=JSON.parse(i.property);1*r.data.yzmin>1*r.data.yzmax?r.showError("最小值大于最大值"):1*r.data.yzmin<1*n.yzmin||1*r.data.yzmax>1*n.yzmax?r.showError("填写的值不在预设值范围内"):o.toBtn_choose(e)&&(o.chooseData.fun=e.attr("fun"),o.chooseData.data.userChoose=r.data,r.close(),o.event._dispatch("dicommenu.choose"))})}},{key:"toBtn_choose",value:function(e){if("close"==e.attr("close"))return!1;this.dom.find(".dropNid").hide();var n="";if("enable"==e.find("i").attr("enable")){var t=e.hasClass("choose");this.dom.find(".dicommenu .fun_btn").removeClass("choose"),this.dom.find(".dicommenu .fun_btn_spice").removeClass("choose"),t?n="cancel":(e.addClass("choose"),n="choose")}if(e.find(".chooseDate").dom&&e.find(".dropNid").css({"margin-top":50}),"brush"==e.attr("fun")||"earse"==e.attr("fun"))return"choose"!=n?(this.chooseData={},!1):(this.chooseData.data=this.tool.data[e.attr("fun")][0],!0);if(this.tool.data[e.attr("fun")]){if(this.tool.data[e.attr("fun")].length>1)return"choose"==n?(e.find(".dropNid").show(),null):(e.find(".dropNid").hide(),!1);if("choose"!=n)return this.chooseData={},!1;this.chooseData.data=this.tool.data[e.attr("fun")][0]}return!0}},{key:"resetAll",value:function(){this.dom.find(".dicommenu .fun_btn").removeClass("choose")}},{key:"set_wl",value:function(e,n){this.chooseData.wl={w:e||null,c:n||null}}},{key:"openadd",value:function(e,n){var t=this,o=this.dom.find(".dicommenu li[fun="+n+"]");if(o.removeAttr("close"),o.removeAttr("style"),o.attr("title",o.attr("title").split(" ")[0]),this.tool.data[n]);else if(this.tool.data[n]=e,this.tool.data[n].length>1&&"brush"!=n&&"earse"!=n&&"screen"!=n&&"mpr"!=n){this.dom.find('li[fun="'+n+'"] .dropNid').remove(),this.dom.find('li[fun="'+n+'"]').append('<div class="dropNid"></div>');for(var i="",a=Tool.configxlkformat(this.app.constmap.LESION),r=function(e){var o=a.find(function(o){return o.idx==t.tool.data[n][e].imageAnnotation});o.optionname=o.name,i+='<li data="'+e+'" funName="'+n+'">'+o.val+"</li>"},s=0;s<this.tool.data[n].length;s++)r(s);this.dom.find('li[fun="'+n+'"] .dropNid').html(i);var l=this;this.dom.find('li[fun="'+n+'"] .dropNid li').on("click",function(e){e.stopPropagation();var n=ES.selctorDoc(this);l.chooseData.fun=n.attr("funName"),l.chooseData.data=l.tool.data[n.attr("funName")][n.attr("data")],console.log("=============="),l.dom.find(".dropNid").hide(),l.event._dispatch("dicommenu.choose")})}}}]),n}();e.exports=i},1104:function(e,n,t){var o=t(1105);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1105:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,'.dicommenu {\n  height: 100%;\n  position: relative;\n}\n.dicommenu .mask {\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  position: relative;\n}\n.dicommenu .mask .mask {\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  display: none;\n  background: transparent;\n  border: 1px solid #d2effc;\n  padding: 0 5px;\n  border-radius: 4px;\n  margin-left: 2px;\n  height: 25px;\n}\n.dicommenu .ct_text {\n  width: auto;\n  margin: 0 12px;\n}\n.dicommenu .ct_text span {\n  margin-right: 3px;\n  color: #d2effc;\n}\n.dicommenu .ct_text input {\n  width: 45px;\n  color: #d2effc;\n  background: transparent;\n  border: 1px solid #d2effc;\n  padding: 0 5px;\n  border-radius: 4px;\n  margin-left: 2px;\n  height: 25px;\n}\n.dicommenu .wl {\n  width: 100px !important;\n  margin-top: 5px;\n}\n.dicommenu .textshow {\n  width: auto;\n  float: right;\n  margin-right: 5px;\n}\n.dicommenu .textshow span {\n  font-size: 16px;\n  letter-spacing: 3px;\n}\n.dicommenu .textshow span i {\n  color: #f00;\n  font-size: 16px;\n  font-style: normal;\n}\n.dicommenu .line-d {\n  width: 1px;\n  height: 36px;\n  background: #d2effc;\n}\n.dicommenu .btn-c {\n  width: auto;\n  margin-left: 5px;\n  cursor: pointer;\n}\n.dicommenu .btn-c .btn {\n  border: 1px solid #fff;\n  padding: 0 5px;\n  line-height: 25px;\n  width: auto !important;\n  border-radius: 4px;\n  height: 25px;\n  margin-top: 5px;\n}\n.dicommenu .luan {\n  position: absolute;\n  top: -5px;\n  left: 681px;\n  width: 80px;\n  text-align: center;\n}\n.dicommenu .luan span {\n  color: #d2effc;\n}\n.dicommenu .luan .zou {\n  display: inline-block;\n  border-top: 1px dashed #d2effc;\n  border-left: 1px dashed #d2effc;\n  width: 20px;\n  height: 10px;\n  position: relative;\n  top: 4px;\n}\n.dicommenu .luan .you {\n  display: inline-block;\n  border-top: 1px dashed #d2effc;\n  border-right: 1px dashed #d2effc;\n  width: 20px;\n  height: 10px;\n  position: relative;\n  top: 4px;\n}\n.dicommenu .toolsImg {\n  background: #000;\n  width: 100%;\n  padding-left: 5px;\n  margin-top: 12px;\n  font-size: 12px;\n}\n.dicommenu .toolsImg #makeimg_id.disabled {\n  pointer-events: none;\n}\n.dicommenu .toolsImg .wl_text {\n  width: auto;\n  margin: 0 12px;\n}\n.dicommenu .toolsImg .wl_text span {\n  margin-right: 3px;\n  color: #d2effc;\n}\n.dicommenu .toolsImg .wl_text input {\n  width: 45px;\n  color: #d2effc;\n  background: transparent;\n  border: 1px solid #d2effc;\n  padding: 0 5px;\n  border-radius: 4px;\n  margin-left: 2px;\n  height: 25px;\n}\n.dicommenu .toolsImg .ct_text {\n  width: auto;\n  margin: 0 12px;\n}\n.dicommenu .toolsImg .ct_text span {\n  margin-right: 3px;\n  color: #d2effc;\n}\n.dicommenu .toolsImg .ct_text input {\n  width: 45px;\n  color: #d2effc;\n  background: transparent;\n  border: 1px solid #d2effc;\n  padding: 0 5px;\n  border-radius: 4px;\n  margin-left: 2px;\n  height: 25px;\n}\n.dicommenu .toolsImg .wl {\n  width: 92px !important;\n  margin-top: 5px;\n}\n.dicommenu .toolsImg .textshow {\n  width: auto;\n  float: right;\n  margin-right: 5px;\n}\n.dicommenu .toolsImg .textshow span {\n  font-size: 16px;\n  letter-spacing: 3px;\n}\n.dicommenu .toolsImg .textshow span i {\n  color: #f00;\n  font-size: 16px;\n  font-style: normal;\n}\n.dicommenu .toolsImg .line-d {\n  width: 1px;\n  height: 36px;\n  background: #d2effc;\n}\n.dicommenu .toolsImg .btn-c {\n  width: auto;\n  margin-right: 5px;\n  cursor: pointer;\n}\n.dicommenu .toolsImg .btn-c .btn {\n  border: 1px solid #fff;\n  padding: 0 5px;\n  line-height: 25px;\n  width: auto !important;\n  border-radius: 4px;\n  height: 25px;\n  margin-top: 5px;\n}\n.dicommenu .toolsImg .btn-yy {\n  width: auto;\n  margin-right: 5px;\n  cursor: pointer;\n  display: none;\n}\n.dicommenu .toolsImg .btn-yy .btn {\n  border: 1px solid #fff;\n  padding: 0 5px;\n  line-height: 25px;\n  width: auto !important;\n  border-radius: 4px;\n  height: 25px;\n  margin-top: 5px;\n}\n.dicommenu .toolsImg .btn-yy .light {\n  color: #000;\n  background: #fff;\n}\n.dicommenu .toolsImg .red .btn {\n  color: #f00;\n}\n.dicommenu .toolsImg .opende {\n  width: auto;\n  margin-right: 5px;\n  cursor: pointer;\n}\n.dicommenu .toolsImg .opende .btn {\n  border: 1px solid #fff;\n  padding: 0 5px;\n  line-height: 25px;\n  width: auto !important;\n  border-radius: 4px;\n  height: 25px;\n  margin-top: 5px;\n}\n.dicommenu .toolsImg .yinyang {\n  width: 110px;\n  margin-right: 15px;\n}\n.dicommenu .toolsImg .radiobox {\n  width: 10px;\n  height: 10px;\n  border-radius: 6px;\n  margin: -1px 5px;\n  cursor: pointer;\n  border: 1px solid #d2effc;\n  position: relative;\n}\n.dicommenu .toolsImg .radiobox.choose:before {\n  width: 6px;\n  height: 6px;\n  content: "";\n  position: absolute;\n  border-radius: 4px;\n  border: 0;\n  left: 2px;\n  top: 2px;\n  background: #d2effc;\n}\n.dicommenu .toolsImg .spice {\n  color: #89de03;\n}\n.dicommenu .toolsImg .spice i {\n  font-size: 16px;\n}\n.dicommenu .toolsImg > li {\n  width: 36px;\n  height: 36px;\n  position: relative;\n  float: left;\n  text-align: center;\n  line-height: 36px;\n  color: #d2effc;\n  border-radius: 4px;\n}\n.dicommenu .toolsImg .fun_btn,\n.dicommenu .toolsImg .fun_btn_single,\n.dicommenu .toolsImg .fun_btn_copd,\n.dicommenu .toolsImg .fun_btn_spice,\n.dicommenu .toolsImg .fun_btn_single1 {\n  cursor: pointer;\n  background: #01111e;\n}\n.dicommenu .toolsImg .fun_btn .dropNid,\n.dicommenu .toolsImg .fun_btn_single .dropNid,\n.dicommenu .toolsImg .fun_btn_copd .dropNid,\n.dicommenu .toolsImg .fun_btn_spice .dropNid,\n.dicommenu .toolsImg .fun_btn_single1 .dropNid {\n  width: 60px;\n  text-align: left;\n  position: absolute;\n  z-index: 100;\n  background: #01111e;\n  color: #fff;\n  margin-top: 15px;\n  display: none;\n}\n.dicommenu .toolsImg .fun_btn .dropNid li,\n.dicommenu .toolsImg .fun_btn_single .dropNid li,\n.dicommenu .toolsImg .fun_btn_copd .dropNid li,\n.dicommenu .toolsImg .fun_btn_spice .dropNid li,\n.dicommenu .toolsImg .fun_btn_single1 .dropNid li {\n  padding-left: 5px;\n}\n.dicommenu .toolsImg .fun_btn .dropNid li:hover,\n.dicommenu .toolsImg .fun_btn_single .dropNid li:hover,\n.dicommenu .toolsImg .fun_btn_copd .dropNid li:hover,\n.dicommenu .toolsImg .fun_btn_spice .dropNid li:hover,\n.dicommenu .toolsImg .fun_btn_single1 .dropNid li:hover {\n  background: #fbfbfb;\n  color: #000;\n}\n.dicommenu .toolsImg .fun_btn.choose {\n  background: #fbfbfb;\n  color: #000;\n}\n.dicommenu .toolsImg .fun_btn_spice.choose {\n  background: #fbfbfb;\n  color: #000;\n}\n.dicommenu .toolsImg .fun_btn:hover {\n  background: #fbfbfb;\n  color: #000;\n}\n.dicommenu .toolsImg .fun_btn_spice {\n  position: relative;\n}\n.dicommenu .toolsImg .fun_btn_spice .chooseDate {\n  display: none;\n  position: absolute;\n  top: 50px;\n  left: 0;\n  z-index: 20000;\n  width: 200px;\n}\n.dicommenu .toolsImg .fun_btn_copd {\n  position: relative;\n}\n.dicommenu .toolsImg .fun_btn_copd .chooseDate1 {\n  display: none;\n  position: absolute;\n  top: 50px;\n  left: 0;\n  z-index: 20000;\n  width: 200px;\n  background: #01111e;\n  color: #d2effc;\n}\n.dicommenu .toolsImg .fun_btn_spice:hover {\n  background: #fbfbfb;\n  color: #000;\n}\n.dicommenu .toolsImg .fun_btn_single:hover {\n  background: #fbfbfb;\n  color: #000;\n}\n.dicommenu .toolsImg .fun_btn_single.choose {\n  background: #fbfbfb;\n  color: #000;\n}\n.dicommenu .toolsImg .fun_btn_single1:hover {\n  background: #fbfbfb;\n  color: #000;\n}\n.dicommenu .toolsImg .fun_btn_single1.choose {\n  background: #fbfbfb;\n  color: #000;\n}\n.dicommenu .choose {\n  background: #fbfbfb !important;\n  color: #000 !important;\n}\n.dicommenu .hover_vp {\n  display: none;\n  position: absolute;\n  z-index: 9999;\n  width: 200px;\n  background: #0c1e21;\n  border-radius: 8px;\n}\n.dicommenu .hover_vp .vp_item {\n  display: flex;\n  align-items: center;\n  color: #fff;\n  font-size: 14px;\n  justify-content: space-around;\n  margin-top: 10px;\n}\n.dicommenu .hover_vp .vp_item:hover {\n  background: white;\n  color: black !important;\n}\n.dicommenu .yyshow {\n  position: absolute;\n  top: 2px;\n  right: 165px;\n  color: #fff;\n  line-height: 16px;\n}\n',""])},1106:function(e,n){e.exports='<div class=dicommenu> <ul class="tc mt15 toolsImg"> <li class="mb20 fun_btn" fun=zoom title=缩放> <i class="iconfont icon-fangda" enable=enable></i> </li> <li class="mb20 screen" title=多视窗 fun=screen> <i class="iconfont icon-fenping" enable=enable></i> <div class=hover_vp> <div class=vp_item code=1> <i class="iconfont icon-fenping"></i> <div>1*1</div> </div> <div class=vp_item code=2> <i class="iconfont icon-liangfenping"></i> <div>2*1</div> </div> <div class=vp_item code=3> <i class="iconfont icon-shusanping"></i> <div>3*1</div> </div> <div class=vp_item code=4> <i class="iconfont icon-sifenping"></i> <div>2*2</div> </div> <div class=vp_item code=6> <i class="iconfont icon-fenping1"></i> <div>3*2</div> </div> <div class=vp_item code=8> <i class="iconfont icon-fenpingcopy"></i> <div>4*2</div> </div> </div> </li> <li class="mb20 fun_btn" fun=wl title=窗位> <i class="iconfont icon-tiaochuang" enable=enable style=font-size:19px></i> </li> <li class="mb20 wl" fun=light title=自动调节窗高窗位> <i class="iconfont icon-chizi" enable=enable></i> </li> <li class="mb20 fun_btn" fun=mpr title=MPR> <i class="iconfont icon-mpr" enable=enable></i> </li> <li class="mb20 fun_btn_single" fun=add title=基准线> <i class="iconfont icon-jizhunxian" enable=enable></i> </li> <li class="mb20 fun_btn_single1" fun=sub title=十字瞄准线> <i class="iconfont icon-shizixian" enable=enable></i> </li> <li class="mb20 fun_btn" fun=rest title=刷新> <i class="iconfont icon-shuaxin" enable=enable></i> </li> <li class="mb20 line-d"></li> <li class="mb20 fun_btn_spice" fun=regionpaint title=区域勾面> <i class="iconfont icon-danxinggoumian" enable=enable></i> <div class=chooseDate></div> </li> <li class="mb20 fun_btn_spice" fun=freehand title=自由画笔> <i class="iconfont icon-huabi" enable=enable></i> <div class=chooseDate></div> </li> <li class="mb20 fun_btn_spice" fun=polygon title=多边形> <i class="iconfont icon-duobianxing-zhanshi" enable=enable></i> </li> <li class="mb20 fun_btn_spice" fun=quickselect title=快速选择> <i class="iconfont icon-caozuoxing-kuaisuxua" enable=enable></i> </li> <li class="mb20 fun_btn hide" fun=magicStickSingle title=单点魔法棒> <i class="iconfont icon-moshu" enable=enable style=font-size:20px></i> </li> <li class="mb20 fun_btn" fun=ellipticalRoi title=圆形> <i class="iconfont icon-yuanxing" enable=enable></i> </li> <li class="mb20 fun_btn" fun=rectangleRoi title=矩形> <i class="iconfont icon-juxing" enable=enable></i> </li> <li class="mb20 fun_btn hide" fun=cobb title=Cobb角> <i class="iconfont icon-ShapeCopy" enable=enable></i> </li> <li class="mb20 fun_btn hide" fun=alignment title=椎体定位> <i class="iconfont icon-guke" enable=enable></i> </li>  <li class="mb20 fun_btn" fun=length title=直线> <i class="iconfont icon-Rectangle" enable=enable></i> </li> <li class="mb20 fun_btn" fun=simpleAngle title=角度> <i class="iconfont icon-jiaodu" enable=enable></i> </li> <li class="mb20 line-d"></li> <li class="mb20 spice fun_btn" fun=line title=尺子> <i class="iconfont icon-chizi" enable=enable style=font-size:18px></i> </li> <li class="mb20 line-d"></li> <li class="mb20 fun_btn_spice" fun=brush title=画笔> <i class="iconfont icon-huabi" enable=enable></i> <div class=chooseDate></div> </li> <li class="mb20 fun_btn_spice" fun=earse title=橡皮擦> <i class="iconfont icon-xiangpica" enable=enable></i> <div class=chooseDate></div> </li> <li class="mb20 line-d"></li> <li class="mb20 btn-c" fun=layer_del> <div class=btn title=单层清除测量数据>单层删除</div> </li> <li class="mb20 opende" fun=openmark> <div class=btn>隐藏标注</div> </li> <li class="mb20 btn-c" style=float:right;margin-right:20px fun=remove_xu> <div class=btn>标为废片</div> </li> <li class="mb20 btn-yy" data=1 style=float:right;margin-right:5px> <div class=btn>标为阴性</div> </li> <li class="mb20 btn-yy red" data=2 style=float:right;margin-right:5px> <div class=btn>标为阳性</div> </li> </ul> <div class=yyshow></div> </div> '},1107:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(1108);var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return r.name="rangetextchoose",r.html=t(1110),r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.moduleBase),o(n,[{key:"complete",value:function(){this.moveDis=94,this.max=this.nowParam.max?this.nowParam.max:100,this.min=null!=this.nowParam.min||void 0!=this.nowParam.min?this.nowParam.min:1,this.startPos=-2,this.dom.find(".range-text .name").html(this.nowParam.name+":"),this.nowPos=this.startPos+this.moveDis*(this.nowParam.value-this.min)/(this.max-this.min),this.setInputVal(this.nowParam.value),this.initAll()}},{key:"setInputVal",value:function(e,n){n&&(this.nowPos=this.startPos+this.moveDis*(e-this.min)/(this.max-this.min),this.dom.find(".controlbar .controlR").css({left:this.nowPos})),n||this.dom.find("input[name=datava]").val(e)}},{key:"setAllData",value:function(e){this.nowPos=this.startPos+this.moveDis*(e-this.min)/(this.max-this.min),this.dom.find("input[name=datava]").val(this.calReturnValue()),this.dom.find(".controlbar .controlR").css({left:this.nowPos})}},{key:"initAll",value:function(){var e=this,n=!1,t=this,o=(this.nowParam.max,void 0);this.dom.find(".range-mask").on("click",function(){t.dom.find(".range-mask").hide(),t.dom.find(".control-content").hide()}),this.dom.find(".controlbar .barbg").on("click",function(e){e.stopPropagation(),t.nowPos=e.offsetX,t.setInputVal(t.calReturnValue()),t.changeEvent()}),this.dom.find("input[name=datava]").change(function(){e.setInputVal(e.dom.find("input[name=datava]").val(),!0),e.changeEvent()}),this.dom.find("input[name=datava]").on("input",function(){e.setInputVal(e.dom.find("input[name=datava]").val(),!0),e.changeEvent()}),this.dom.find(".controlbar .controlR").on("mousedown",function(e){n=!0,o=e.pageX}),this.dom.on("mousemove",function(e){if(n){var i=e.pageX-o;t.nowPos=t.nowPos+i,t.setInputVal(t.calReturnValue()),t.changeEvent(),o=e.pageX}}),this.dom.find(".controlbar").on("mouseup",function(e){e.stopPropagation(),n=!1}),this.dom.find(".controlbar").on("mouseleave",function(e){e.stopPropagation(),n=!1})}},{key:"calReturnValue",value:function(){this.nowPos=this.nowPos<this.startPos?this.startPos:this.nowPos,this.nowPos=this.nowPos>this.moveDis+this.startPos?this.moveDis+this.startPos:this.nowPos;var e=this.min+Math.round((this.nowPos-this.startPos)*(this.max-this.min)/this.moveDis);return e=(e=e>this.max?this.max:e)<this.min?this.min:e}},{key:"changeEvent",value:function(){var e=this.nowParam.type;1*this.dom.find("input[name=datava]").val()>this.max&&(this.event._dispatch("rangetextchoose.errorMSG",{msg:"超过边界"}),this.dom.find("input[name=datava]").val(this.max)),this.event._dispatch("rangetextchoose.change",{type:e,value:this.dom.find("input[name=datava]").val()})}}]),n}();e.exports=i},1108:function(e,n,t){var o=t(1109);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1109:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".rangetextchoose {\n  width: 100%;\n  min-width: 180px;\n  position: relative;\n  background: #0c1e21;\n  height: 40px;\n  border-radius: 8px;\n  text-align: left;\n}\n.rangetextchoose .range-text {\n  color: #fff;\n  padding: 0 10px;\n  height: 24px;\n  line-height: 24px;\n  margin-top: 7px;\n  font-size: 14px;\n  float: left;\n  z-index: 5;\n}\n.rangetextchoose .range-text span {\n  -webkit-touch-callout: none;\n  /* iOS Safari */\n  -webkit-user-select: none;\n  /* Chrome/Safari/Opera */\n  -khtml-user-select: none;\n  /* Konqueror */\n  -moz-user-select: none;\n  /* Firefox */\n  -ms-user-select: none;\n  /* Internet Explorer/Edge */\n  user-select: none;\n}\n.rangetextchoose .range-mask {\n  position: fixed;\n  width: 100%;\n  height: 100%;\n  background: transparent;\n  display: none;\n  top: -86px;\n  left: 0;\n}\n.rangetextchoose .controlbar {\n  float: left;\n  width: 100px;\n  height: 40px;\n  z-index: 10;\n  position: relative;\n}\n.rangetextchoose .controlbar .barbg {\n  width: 100%;\n  height: 6px;\n  background: #fff;\n  border-radius: 3px;\n  margin-top: 16px;\n}\n.rangetextchoose .controlbar .controlR {\n  width: 12px;\n  height: 12px;\n  border-radius: 10px;\n  background: #448e97;\n  position: absolute;\n  top: 13px;\n  left: -2px;\n}\n.rangetextchoose .new {\n  float: right;\n  width: 25px;\n  margin-right: 10px;\n}\n.rangetextchoose .new input {\n  width: 100%;\n  text-align: center;\n  background: transparent;\n  border: 1px solid #ccc;\n  border-radius: 3px;\n  height: 20px;\n  line-height: 20px;\n  font-size: 12px;\n  margin-top: 8px;\n  color: #fff;\n}\n",""])},1110:function(e,n){e.exports="<div class=rangetextchoose> <div class=range-text> <span class=name></span> </div> <div class=range-mask></div> <div class=controlbar> <div class=barbg></div> <div class=controlR></div> </div> <div class=new> <input type=text name=datava> </div> </div>"},1111:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(1112);var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return r.html=t(1114),r.name="setyz",r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.modalBase),o(n,[{key:"complete",value:function(){var e=this;if(console.log(this.initDate.data),this.initDate.data){var n=this.data=this.initDate.data?JSON.parse(this.initDate.data):{yzmin:"",yzmax:""};this.dom.find(".setyz_content").html('请填写该影像标注的CT值，确认后进入影像标注的位置标注。<span class="yz">(预设值范围为'+n.yzmin+"-"+n.yzmax+")</span>"),this.dom.find('.setyz_set input[name="yzmin"]').val(n.yzmin),this.dom.find('.setyz_set input[name="yzmax"]').val(n.yzmax)}else this.dom.find(".error-info").html("");this.dom.find(".setyz_set input").on("focus",function(){e.dom.find(".error-info").addClass("hide")}),this.dom.find(".setyz_set input").on("blur",function(){e.data={yzmin:e.dom.find('.setyz_set input[name="yzmin"]').val(),yzmax:e.dom.find('.setyz_set input[name="yzmax"]').val()},e.dom.find(".error-info").addClass("hide")})}},{key:"showError",value:function(e){this.dom.find(".error-info").html(e),this.dom.find(".error-info").removeClass("hide")}}]),n}();e.exports=i},1112:function(e,n,t){var o=t(1113);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1113:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".setyz {\n  background: #fff;\n}\n.setyz .setyz_content {\n  font-size: 20px;\n  text-align: left;\n  padding: 0 10px 10px 10px;\n}\n.setyz .setyz_content .yz {\n  font-size: 14px;\n  color: #f00;\n}\n.setyz .setyz_set {\n  text-align: center;\n  margin: 10px 0;\n}\n.setyz .setyz_set input {\n  width: 90px;\n  height: 30px;\n  margin: 0 10px;\n  font-size: 16px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  line-height: 30px;\n  padding-left: 5px;\n}\n.setyz .error-info {\n  color: #f00;\n  font-size: 12px;\n  top: -7px;\n  left: 20px;\n  position: absolute;\n}\n",""])},1114:function(e,n){e.exports='<div class=setyz> <span class="error-info hide"></span> <div class=setyz_content>请填写该影像标注的CT值，确认后进入影像标注的位置标注。</div> <div class=setyz_set><input name=yzmin type=text><span>——</span><input name=yzmax type=text></div> </div>'},1115:function(e,n,t){var o=t(1116);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1116:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".progress {\n  width: 480px;\n  height: 240px;\n  background: #0a2634;\n  border: 0;\n  border-radius: 10px;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  margin-left: -240px;\n  margin-top: -120px;\n}\n.progress .line {\n  width: 400px;\n  height: 20px;\n  border: 0;\n  border-radius: 10px;\n  position: absolute;\n  top: 120px;\n  left: 40px;\n  background: #fff;\n}\n.progress .blue {\n  background: #448E97;\n  width: 10px;\n}\n.progress .p-title {\n  font-size: 14px;\n  position: absolute;\n  top: 80px;\n  left: 40px;\n  color: #fff;\n  text-align: left;\n}\n.progress .p-name {\n  position: absolute;\n  top: 80px;\n  right: 25px;\n  font-size: 16px;\n  color: #fff;\n  text-align: left;\n}\n",""])},1117:function(e,n){e.exports='<div class=progress> <p class=p-title>下载进度</p> <div class=line></div> <div class="line blue"></div> <p class=p-name></p> </div>'},1118:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(1119);var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return r.html=t(1121),r.name="seriessubmit",r.footer=!1,r.body="",r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.modalBase),o(n,[{key:"sure",value:function(e){this.hide()}},{key:"complete",value:function(){var e=this;e.resize(),e.body=e.dom.find(".modal-body"),this.dom.find(".modal-close").on("click",function(){e.hide()}),e.dom.find(".btn-cancel").on("click",function(){e.hide(),e.closeSure()}),e.dom.find(".btn-confirm").on("click",function(){e.hide(),e.sure()})}},{key:"resize",value:function(){}},{key:"show",value:function(e){var n=this,t="";e.msg?(t=e.msg,n.dom.find(".modal-title").html(e.title?e.title:"错误提示"),n.dom.find(".modal-body").html('<p style="width:320px;text-align:left;margin:0 auto;">'+t+"</p>")):(n.dom.find(".modal-title").html(e.title||""),n.dom.find(".modal-body").html(e.template||"")),e.sure&&e.sure instanceof Function?this.sure=e.sure:this.sure=function(){n.hide()},e.closeSure&&e.closeSure instanceof Function?n.closeSure=e.closeSure:n.closeSure=function(){},e.noshadow?n.dom.find(".modal").addClass("noshadow"):n.dom.find(".modal").removeClass("noshadow"),e.resetbody&&n.dom.find(".showalert").css({padding:e.resetbody.padding}),n.dom.show()}},{key:"hide",value:function(){this.dom.hide()}}]),n}();e.exports=i},1119:function(e,n,t){var o=t(1120);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1120:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".seriessubmit .modal-footer {\n  text-align: center;\n}\n.seriessubmit .modal-footer .btn-confirm {\n  color: #fff;\n  height: 40px;\n  width: 90px;\n  background: #4c9fa9;\n  display: inline-block;\n  line-height: 40px;\n  border-radius: 4px;\n  margin-right: 30px;\n  font-size: 12px;\n}\n.seriessubmit .modal-footer .btn-cancel {\n  border: 1px solid #4c9fa9;\n  color: #333333;\n  height: 40px;\n  width: 90px;\n  display: inline-block;\n  line-height: 40px;\n  border-radius: 4px;\n  font-size: 12px;\n}\n",""])},1121:function(e,n){e.exports='<div class="modal modal-sm seriessubmit"> <div class=modal-header> <p class=modal-title></p> <i class="modal-close icon-guanbi iconfont"></i> </div> <div class="modal-body showalert" style="padding:20px 10px 40px 10px"></div> <div class=modal-footer> <a class="btn btn-confirm">提交获取新序列</a> <a class="btn btn-cancel">提交返回首页</a> </div> </div>'},1122:function(e,n,t){var o=t(1123);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1123:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".magicloading {\n  width: 480px;\n  height: 240px;\n  background: #0a2634;\n  border: 0;\n  border-radius: 10px;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  margin-left: -240px;\n  margin-top: -120px;\n}\n.magicloading .content {\n  width: 100px;\n  color: #FFF;\n  border-radius: 10px;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  margin-left: -50px;\n  margin-top: -50px;\n  height: 100px;\n}\n.magicloading .content .pic {\n  background: url(/images/loading1.gif);\n  height: 100%;\n  width: 100%;\n}\n.magicloading .p-name {\n  width: 100%;\n  font-size: 16px;\n  color: #fff;\n  text-align: center;\n  position: absolute;\n  bottom: 50px;\n}\n",""])},1124:function(e,n){e.exports="<div class=magicloading> <div class=content> <div class=pic> </div> </div> <p class=p-name>正在努力运算中，请耐心等待</p> </div>"},1125:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(1126);var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return r.html=t(1128),r.res={},r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.modalBase),o(n,[{key:"complete",value:function(){var e=this;this.render(),this.dom.find(".radio-box").on("click",function(n){e.dom.find(".radio-box").removeClass("choose");var t=ES.selctorDoc(this);e.dom.find(".error-info").addClass("hide"),t.addClass("choose"),e.res.type=t.parent().find(".name-des").attr("code"),"99"==e.res.type?(e.dom.find(".reason").show(),e.res.des=e.dom.find(".reason textarea").val()):(e.dom.find(".reason").hide(),e.dom.find(".reason textarea").val(""),e.res.des=t.parent().find(".name-des").html()),console.log(e.res.type,"that.res.type that.res.type that.res.type that.res.type ")}),this.dom.find(".reason textarea").on("blur",function(){console.log(e.dom.find(".reason textarea").val()),e.res.des=e.dom.find(".reason textarea").val()})}},{key:"render",value:function(){if(console.log(this.initDate.data),this.initDate.data){var e="";this.initDate.data.map(function(n){1*n.value!=98&&1*n.value!=99&&(e+='<li><span class="radio-box"></span><span class="name-des" code="'+n.value+'">'+n.name+"</span></li>")}),e+=' <li><span class="radio-box"></span><span class="name-des" code="98">序列加载异常</span></li>\n        <li><span class="radio-box"></span><span class="name-des" code="99">其他</span></li>\n        <li class="reason" style=\'display: none;clear:both;\'><span >备注</span><textarea ></textarea></li>',this.dom.find(".removeseries ul").html(e)}}},{key:"showError",value:function(e){switch(e){case 0:this.dom.find(".error-info").html("必须选择原因");break;case 1:this.dom.find(".error-info").html("请填写备注信息")}this.dom.find(".error-info").removeClass("hide")}}]),n}();e.exports=i},1126:function(e,n,t){var o=t(1127);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},1127:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".removeseries {\n  background: #fff;\n}\n.removeseries ul li {\n  width: 45%;\n  float: left;\n  margin-left: 10px;\n}\n.removeseries ul li .radio-box {\n  position: absolute;\n  top: 18px;\n}\n.removeseries ul li .name-des {\n  margin-left: 20px;\n  margin-bottom: 15px;\n}\n.removeseries ul li textarea {\n  width: 190%;\n  resize: none;\n}\n.removeseries .error-info {\n  color: #f00;\n  font-size: 12px;\n  top: -7px;\n  left: 20px;\n  position: absolute;\n}\n",""])},1128:function(e,n){e.exports='<div class=removeseries> <span class="error-info hide">必须选择原因</span> <ul> <li><span class=radio-box></span><span class=name-des data=1>背景复杂</span></li> <li><span class=radio-box></span><span class=name-des data=2>部位不匹配</span></li> <li><span class=radio-box></span><span class=name-des data=4>肿块直径>3cm</span></li> <li><span class=radio-box></span><span class=name-des data=3>结节大于10个</span></li> <li><span class=radio-box></span><span class=name-des data=98>序列加载异常</span></li> <li><span class=radio-box></span><span class=name-des data=99>其他</span></li> <li class=reason style=display:none><span>备注</span><textarea></textarea></li> </ul> <div style=clear:both></div> </div>'},15:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(e){function n(e){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.___auto=!0,t.taskInfo={},t.projectInfo={},t.cachelist={},t.seriesInfo={},t.seriesResult={},t.series_result_id={seriesAnnotationResultId:"",seriesInstanceUid:""},t.userInfo={},t.doneNum=0,t.toolInfo={},t.loadData={total:0,num:0},t}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.modelBase),o(n,[{key:"translateWord",value:function(e){switch(e){case"LINE":return"length";case"COBB":return"cobb";case"ALIGNMENT":return"alignment";case"FREEHANDLINE":return"freehandline";case"ELLIPSE":return"ellipticalRoi";case"RECTANGLE":return"rectangleRoi";case"ANGLE":return"simpleAngle";case"MAGIC_STICK_SINGLE":return"magicStickSingle";case"POLYGON":return"polygon";case"FREEHAND":return"freehand";case"QSELECT":return"quickselect";case"REGION_PAINT":return"regionpaint"}}},{key:"translateDataReslut",value:function(e,n,t){var o=this;e.map(function(e){if("string"==typeof e.result){var i=void 0;try{i=JSON.parse(e.result)}catch(n){i=e.result}switch(e.uuid=e.backId=e.id,e.setDataType="number",e.sId=n||null,e.imageAnnotationToolType){case"LINE":e.type="length",t&&(i.point1.x=i.point1.x/2,i.point1.y=i.point1.y/2,i.point2.x=i.point2.x/2,i.point2.y=i.point2.y/2),e.result=i,e.layerNumber=1*i.point1.z,e.tooltype="length",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"COBB":e.type="cobb",i.lineA.map(function(e){t&&(e.point1.x=e.point1.x/2,e.point1.y=e.point1.y/2,e.point2.x=e.point2.x/2,e.point2.y=e.point2.y/2)}),e.result=i,e.lineA=[],i.lineA.map(function(n){e.lineA.push({end:{x:n.point2.x,y:n.point2.y},start:{x:n.point1.x,y:n.point1.y}})}),e.layerNumber=i.lineA[0].point1.z,e.tooltype="cobb",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"ALIGNMENT":e.type="alignment",i.pointA.map(function(e){t&&e.point1&&(e.point1.x=e.point1.x/2,e.point1.y=e.point1.y/2)}),e.result=i,e.pointA=[],i.pointA.map(function(n){n.point1?(e.pointA.push({start:{x:n.point1.x,y:n.point1.y}}),e.layerNumber=n.point1.z):e.pointA.push({})}),e.tooltype="alignment",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"FREEHANDLINE":e.type="freehandline",t&&(i.point1.x=i.point1.x/2,i.point1.y=i.point1.y/2,i.point2.x=i.point2.x/2,i.point2.y=i.point2.y/2),e.result=i,e.layerNumber=i.point1.z,e.tooltype="freehandline",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"ELLIPSE":var a=o.seriesInfo[n].info.data.pixelSpacing?o.seriesInfo[n].info.data.pixelSpacing[0]:1;e.type="ellipticalRoi",t&&(i.x=i.x/2,i.y=i.y/2,i.maxd=i.maxd/2,i.mind=i.mind/2),e.layerNumber=i.z,e.result={},e.result={point1:{x:i.x-.5*i.maxd/a,y:i.y-.5*i.maxd/a},point2:{x:i.x+.5*i.maxd/a,y:i.y+.5*i.maxd/a}},e.tooltype="ellipticalRoi",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"RECTANGLE":e.type="rectangleRoi",t&&(i.point1.x=i.point1.x/2,i.point1.y=i.point1.y/2,i.point2.x=i.point2.x/2,i.point2.y=i.point2.y/2),e.result=i,e.layerNumber=i.point1.z,e.tooltype="rectangleRoi",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"ANGLE":e.type="simpleAngle",t&&(i.point1.x=i.point1.x/2,i.point1.y=i.point1.y/2,i.point2.x=i.point2.x/2,i.point2.y=i.point2.y/2,i.point3.x=i.point3.x/2,i.point3.y=i.point3.y/2),e.result=i,e.layerNumber=i.point1.z,e.tooltype="simpleAngle",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"MAGIC_STICK_SINGLE":e.type="magicStickSingle",e.result=e.result,e.tooltype="magicStickSingle",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"POLYGON":e.type="polygon",e.result=e.result,e.tooltype="polygon",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"FREEHAND":e.type="freehand",e.result=e.result,e.tooltype="freehand",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"QSELECT":e.type="quickselect",e.result=e.result,e.tooltype="quickselect",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"REGION_PAINT":e.type="regionpaint",e.result=e.result,e.tooltype="regionpaint",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"IMAGE_TAG":e.type="imagetag",e.result=i,e.layerNumber=i.z,e.tooltype="imagetag",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;default:e.type=e.imageAnnotationToolType.toLowerCase(),e.result=e.result,e.tooltype=e.imageAnnotationToolType.toLowerCase(),e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType}}}})}},{key:"getpoints",value:function(e,n,t){var o=[];if(1==t)return[[Math.round(e.x),Math.round(e.y),e.z]];for(var i=0;i<t;i++){var a=[Math.round(e.x-n+2*Math.random()*n),Math.round(e.y-n+2*Math.random()*n),e.z];o.push(a)}return o}},{key:"getImages",value:function(e,n,t){if(!e)return[];var o=[];return e.map(function(e){var i=e.number;0==n?o[i-1]=e.urlWAN||e.urlWan:o[t-i+1]=e.urlWAN||e.urlWan}),o}},{key:"getImagesBack",value:function(e,n,t){if(!e)return[];var o=[];return e.map(function(e){o[e.number]=e.urlWAN||e.urlWan}),o}},{key:"judgeX",value:function(e,n){return"DCM"==e&&("DX"==n||"DR"==n||"CR"==n||"CX"==n)}},{key:"judgeCT",value:function(e,n){return"DCM"==e&&"DX"!=n&&"DR"!=n&&"CR"!=n&&"CX"!=n}}]),n}();window.MarkModel=window.MarkModel||i,e.exports=i},172:function(e,n,t){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var a=function(e){function n(e){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t._orginImgSizes={},t}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,MarkModel),i(n,[{key:"makeJsonToBackend",value:function(e){return null,JSON.stringify(e)}},{key:"translateDataReslut",value:function(e,n,t){e.map(function(e){if(console.log(e),"string"==typeof e.result){var o=void 0;try{o=JSON.parse(e.result)}catch(n){o=e.result}switch(e.uuid=e.backId=e.id,e.setDataType="number",e.sId=n||null,e.imageAnnotationToolType){case"LINE":e.type="length",t&&(o.point1.x=o.point1.x/2,o.point1.y=o.point1.y/2,o.point2.x=o.point2.x/2,o.point2.y=o.point2.y/2),e.result=o,e.layerNumber=o.point1.z,e.tooltype="length",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"FREEHANDLINE":e.type="freehandline",e.path={},e.path=o,e.layerNumber=1,e.tooltype="freehandline",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"FREEHAND":e.type="freehand",e.path={},o.map(function(n){e.path[n.x+"_"+n.y]=n}),e.tooltype="freehand",e.layerNumber=1,e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"QSELECT":e.type="quickselect",e.result=e.result,e.tooltype="quickselect",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType};break;case"REGION_PAINT":e.type="regionpaint",e.result=e.result,e.tooltype="regionpaint",e.toolType={id:e.imageAnnotationToolId,imageAnnotation:e.imageAnnotationType,imageAnnotationId:e.imageAnnotationId,type:e.imageAnnotationToolType}}}})}},{key:"changeItemDataToBackendCheck",value:function(e){var n=[];if("object"!=(void 0===e?"undefined":o(e))||null==e.length&&void 0==e.length){for(var t in e)if("check_reslut"!=e[t].formComponentId){var i=String(e[t].result).split(",").filter(function(e){return e||"0"==e}).toString();n.push({componentId:e[t].formComponentId,result:i})}}else e.map(function(e){n.push({componentId:e.formComponentId,result:e.result})});return n}},{key:"changeItemDataToBackend",value:function(e,n){var t={};for(var o in t.id=e,t.annotationItemResultList=[],n){var i=n[o].result;-1!=String(n[o].result).lastIndexOf(",")&&(i=n[o].result.split(",").filter(function(e){return e}).toString()),t.annotationItemResultList.push({annotationItemId:o,formComponentId:n[o].formComponentId,result:i})}return t}},{key:"translateBackData",value:function(e,n){var t=e.data;t.annotationItemResultList=t.annotationItemResultList?t.annotationItemResultList:[],t.imageAnnotationResultList=t.imageAnnotationResultList?t.imageAnnotationResultList:[],t.doctorNidduleAll={};var o=this.check_data_deal(t),i={};t.annoResultList.map(function(e){t.doctorNidduleAll[e.doctorName]||(t.doctorNidduleAll[e.doctorName]=e.annotationItemResultList),e.imageAnnotationResultList.map(function(n){n.doctorName=e.doctorName,n.id=n.iarClusterId+"_"+n.annoIarId,n.annotationItemResultList.map(function(e){e.id=e.formComponentId,e.annotationItemId=e.formComponentId}),n.orginannotationItemResultList=JSON.parse(JSON.stringify(n.annotationItemResultList)),n.annotationItemResultList=o[n.iarClusterId]?o[n.iarClusterId].annotationItemResultList:[],n.auditResult=o[n.iarClusterId]?o[n.iarClusterId].auditResult:null,t.auditResult.imageAnnotationResultList.map(function(e){n.iarClusterId==e.iarClusterId&&(n.imageRemark=e.imageRemark)})}),t.imageAnnotationResultList=t.imageAnnotationResultList.concat(e.imageAnnotationResultList),e.annotationItemResultList.map(function(e){i[e.formComponentId]?null!=i[e.formComponentId]&&i[e.formComponentId]!=e.result.split(",").sort(function(e,n){return e-n}).toString()&&(i[e.formComponentId]=null):i[e.formComponentId]=e.result.split(",").sort(function(e,n){return e-n}).toString()})}),t.imageAnnotationResultList=t.imageAnnotationResultList.sort(function(e,n){return e.iarClusterId-n.iarClusterId});var a={};t.auditResult.annotationItemResultList.map(function(e){a[e.formComponentId]=e.result}),n.map(function(e){var n="";a[e.componentId]&&(n=a[e.componentId]),i[e.formComponentId]&&!n&&(n=i[e.formComponentId]),t.annotationItemResultList.push({formComponentId:e.componentId,annotationItemId:e.componentId,id:e.componentId,result:n})}),console.log(t.annotationItemResultList,"=====================",i,e)}},{key:"check_data_deal",value:function(e){var n={};return e.auditResult.imageAnnotationResultList.map(function(e){if(!n[e.iarClusterId]){if(e.annotationItemResultList){e.annotationItemResultList.map(function(e){e.id=e.formComponentId,e.annotationItemId=e.formComponentId});var t="";0==e.auditResult&&(t="1"),1==e.auditResult&&(t="0"),e.annotationItemResultList.splice(0,0,{formComponentId:"check_reslut",result:t,id:"check_reslut",annotationItemId:"check_reslut"})}n[e.iarClusterId]=e}}),n}},{key:"returnSelectComponent",value:function(){return{componentCode:"check_reslut",componentData:'[{"text":"对","code":"0"},{"text":"错","code":"1"}]',componentId:"check_reslut",componentName:"正确与否",componentParameter:'{"isdefault ":false}',componentType:"select",optional:!0,sequence:0}}},{key:"orginImgSizes",set:function(e){this.setPrivate(this,{_orginImgSizes:e})}}]),n}();e.exports=a},2175:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,"#drapCanvasAud-content-fade {\n  width: 100%;\n}\n#drapCanvasAud-content-fade .dragCanvas {\n  width: 100%;\n  background: #fff;\n}\n#drapCanvasAud-content-fade .dragCanvas .mark-header {\n  width: 100%;\n  height: 60px;\n  background-image: linear-gradient(-180deg, #0c1e21, #041d32 98%);\n  color: #d2effc;\n}\n#drapCanvasAud-content-fade .dragCanvas .mark-header .back-icon {\n  margin-left: 10px;\n}\n#drapCanvasAud-content-fade .dragCanvas .mark-header .lefta {\n  transform: rotate(-90deg);\n}\n#drapCanvasAud-content-fade .dragCanvas .mark-header i {\n  width: 16px;\n  line-height: 60px;\n}\n#drapCanvasAud-content-fade .dragCanvas .mark-header span {\n  font-size: 16px;\n  height: 60px;\n  line-height: 60px;\n  float: left;\n  margin-right: 10px;\n  overflow: hidden;\n  white-space: nowrap;\n}\n#drapCanvasAud-content-fade .dragCanvas .mark-header .cotrol-btn {\n  display: flex;\n  margin-top: 8px;\n}\n#drapCanvasAud-content-fade .dragCanvas .mark-header .cotrol-btn .btn {\n  width: 100px;\n  height: 40px;\n  color: #fff;\n  background: #448e97;\n  border-radius: 5px;\n  margin-right: 35px;\n  font-size: 16px;\n  text-align: center;\n  line-height: 40px;\n  border: 1px solid #448e97;\n  cursor: pointer;\n}\n#drapCanvasAud-content-fade .dragCanvas .mark-header .cotrol-btn .btn:hover {\n  background: #3bcbdc;\n  border: 1px solid #3bcbdc;\n  transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n}\n#drapCanvasAud-content-fade .dragCanvas .mark-menu {\n  clear: both;\n  height: 60px;\n  width: 100%;\n  background: #01111e;\n  border-bottom: 2px solid #0a2634!important;\n  border-top: 2px solid #0a2634!important;\n}\n#drapCanvasAud-content-fade .dragCanvas .mark-content {\n  clear: both;\n}\n",""])},7:function(e,n,t){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();function a(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function o(i,a){try{var r=n[i](a),s=r.value}catch(e){return void t(e)}if(!r.done)return Promise.resolve(s).then(function(e){o("next",e)},function(e){o("throw",e)});e(s)}("next")})}}var r=function(e){function n(e,t,o,i){return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t,o,i))}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.pagesBase),i(n,[{key:"complete",value:function(){this.useinfo=JSON.parse(this.app.local.get("all")),this.nowTaskOver=!1,this.type="doctor",this.imageType="JPG",this.imageDataType="orgin",t(1043),this.cornerstoneLoad(),this.styleModel(1),this.dicommenuLoad(),this.modalLoad(),this.baseApi(),this.btnEvent(),this.resize(),this.drawInfo=t(955)}},{key:"series_result_id",value:function(){this.start_series()}},{key:"projectInfo",value:function(){this.annotationIteminit(),this.setWWC()}},{key:"setWWC",value:function(){this.model.projectInfo.window&&this.dicommenu.defaultWWC(this.model.projectInfo.window)}},{key:"seriesResult",value:function(){this.seriesInfo()}},{key:"seriesInfo",value:function(){var e=this,n=0,t=0;for(var o in this.model.seriesInfo)this.model.seriesInfo[o].imgs&&n++;for(var i in this.model.seriesResult)t++;n==t&&0!=t&&0!=n&&(this.cornerstoneStart(),setTimeout(function(){e.listInit()},500))}},{key:"cornerstoneLoad",value:function(){var e=this,n=this,o=void 0;o=-1!=window.location.hash.lastIndexOf("markview")||-1!=window.location.hash.lastIndexOf("markaudit")?t(1088):-1==window.location.hash.lastIndexOf("drapCanvas")?t(1089):t(1091),this.cornerstoneContorl=this.app.loadModule(o,this.dom.find(".mark-content")),this.cornerstoneContorl.event._addEvent("ctcornerstone.imgloadError",function(e){n.progress&&(n.progress.stopAll(),n.progress.close())}),this.cornerstoneContorl.event._addEvent("ctcornerstone.loadingfinish",function(e){n.makeWwC(e.sId),n.progress&&n.progress.stopAll()}),this.cornerstoneContorl.event._addEvent("ctcornerstone.HUShow",function(n){var t=e.model.seriesInfo[n.sId].info;"DCM"==t.data.fileType?"orgin"!=e.imageDataType&&(n.hu=(1*t.wwc.hight-1*t.wwc.low)*n.hu/255+1*t.wwc.low):n.hu="",e.cornerstoneContorl.huValue(n)}),this.cornerstoneContorl.event._addEvent("ctcornerstone.saveLayerMarkInfo",function(n){var t=e;t.app.loading.show();var o=t.cornerstoneContorl.model,i=function(e){var i=[];for(var a in n){var r=n[a],s=r.formComponentId,l=r.result;i.push({annotationItemId:a,formComponentId:s,result:l})}t.api.image_result_item_edit({id:o.imageAnnotationResultId,annotationItemResultList:i}).done(function(){t.app.loading.hide();var e=o.imageAnnotationResultId;o.nidusComponentData[e]||(o.nidusComponentData[e]={});var n=o.nidusComponentData[e];i.forEach(function(e){var t=e.annotationItemId,o=e.result;n[t]?n[t].result=o:n[t]=e})})},a=o.currentLayer;if(o.imageAnnotationResultId)i();else{var r=o.currentSeriesInfo,s=r.seriesAnnotationResultId,l=r.seriesInstanceUid,d=o.layerMarkImageAnnotation,c=d.imageAnnotationToolId,u=d.imageAnnotationToolType,h=d.imageAnnotationId,m=d.imageAnnotation;t.api.image_result_create({seriesAnnotationResultId:s,imageAnnotationId:h,imageAnnotationToolId:c,result:JSON.stringify({z:a})}).done(function(e){var n=o.imageAnnotationResultId=e.data.id,r={uuid:n,backId:n,sId:l,type:"imagetag",layerNumber:a,toolType:{imageAnnotation:m},imageAnnotationToolType:u};t.drawInfo.setInfo(r),t.cornerstoneContorl.sequencelist.addNode(r,!0),i()})}}),this.cornerstoneContorlOther()}},{key:"cornerstoneContorlOther",value:function(){}},{key:"dicommenuLoad",value:function(){var e=this,n=this,o=t(1102)(1),i=t(1103);this.dicommenu=this.app.loadModule(i,this.dom.find(".mark-menu"),o),-1!=window.location.hash.lastIndexOf("view")&&this.dicommenu.closeYY(),this.dicommenu.event._addEvent("dicommenu.choose",function(e){if("{}"!=JSON.stringify(n.dicommenu.chooseData)){var t=n.dicommenu.chooseData,o=n.dicommenu.chooseData.data;n.cornerstoneContorl.defaultFunction(t.fun+"Fan",o)}else n.cornerstoneContorl.defaultFunction(null,null)}),this.dicommenu.event._addEvent("dicommenu.wlchange",function(e){var t=n.dicommenu.chooseData.wl,o=n.cornerstoneContorl.getSid();if(null!=t.w&&null!=t.c){var i=2==n.model.projectInfo.seriesImgFileType?{wc:t.c,ww:t.w}:n.getwwc({wc:1*t.c,ww:1*t.w},o);n.cornerstoneContorl.lungWindown(1*i.wc,1*i.ww,n.getMMCImage(1*t.w,o))}else{var a=n.model.seriesInfo[o].info;if(a.data.windowCenterUpper&&a.data.windowWidthUpper){var r=2==n.model.projectInfo.seriesImgFileType?{wc:a.data.firstWindowCenter,ww:a.data.firstWindowWidth}:n.getwwc({wc:1*a.data.firstWindowCenter,ww:1*a.data.firstWindowWidth},o,"def");return void n.cornerstoneContorl.lungWindown(1*r.wc,1*r.ww,n.getMMCImage(null,o))}n.cornerstoneContorl.lungWindown(null,null,n.getMMCImage(null,o))}}),this.dicommenu.event._addEvent("dicommenu.splitScreen",function(e){n.cornerstoneContorl.setScreen(e)}),this.dicommenu.event._addEvent("dicommenu.setCopdVal",a(regeneratorRuntime.mark(function t(){var o,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n.cornerstoneContorl.model.nidusChoose){t.next=5;break}return n.alerError("请选择病症"),n.dom.find(".dicommenu .fun_btn_copd").removeClass("choose"),n.dom.find(".chooseDate1").hide(),t.abrupt("return");case 5:return t.prev=5,t.next=8,e.api.HttpRequest.POST("/anno/image_result/getSegThresholdByIarId",{iarId:1*n.cornerstoneContorl.model.nidusChoose.bid});case 8:o=t.sent,i=o.data,n.dom.find('.chooseDate1 input[name="copdData"]').val(i),t.next=15;break;case 13:t.prev=13,t.t0=t.catch(5);case 15:case"end":return t.stop()}},t,e,[[5,13]])}))),this.dicommenu.event._addEvent("dicommenu.CTData",function(e){if(e.value>-850)return n.alerError("阈值不能超过-850!"),void n.dom.find('.chooseDate1 input[name="copdData"]').val(-850);if(e.value<-1200)return n.alerError("阈值不能低于-1200!"),void n.dom.find('.chooseDate1 input[name="copdData"]').val(-1200);if(e.value=1*e.value,"number"==typeof e.value&&e.value%1==0){var t=JSON.parse(JSON.stringify(n.cornerstoneContorl.model.nidusChoose));if(t.backId=t.bid,n.cornerstoneContorl.model.nidusChoose.bid){var o={segThreshold:1*e.value,iarId:1*n.cornerstoneContorl.model.nidusChoose.bid};n.api.alg_sar_reset_mask_image&&(n.app.loading.show(),n.api.alg_sar_reset_mask_image(o).done(function(e){n.api.anno_iar_read({id:1*o.iarId}).done(function(e){n.app.loading.hide();var o={id:t.result,images:e.data.imageList,sId:n.cornerstoneContorl.model.nidusChoose.sId};n.creatAllPoint(o,t,!1,!1)})}))}else n.alerError("请选择copd类型")}else n.alerError("请输入整数")}),this.dicommenu.event._addEvent("dicommenu.done",function(){-1!=n.dicommenu.chooseData.click.lastIndexOf("del")?n.cornerstoneContorl.clearData("meas"):n.openRemove()}),this.dicommenu.event._addEvent("dicommenu.mpr",function(){n.cornerstoneContorl.mpr||(n.cornerstoneContorl.openmpr(),n.cornerstoneContorl.mpr=!0)}),this.dicommenu.event._addEvent("dicommenu.yinyang",function(e){n.api.series_result_yayAttributes({sarIdList:n.getSarIds(),yayAttributes:e.data})}),this.dicommenu.event._addEvent("dicommenu.cal",function(e){var t=n.cornerstoneContorl.cornerstoneArray[n.cornerstoneContorl.choosescreen].sId,o={seriesInstanceUid:t,sarId:n.model.seriesInfo[t].sarId};n.app.loading.show(),n.api.dcm_cerebralHemorrhage(o).done(function(e){n.api.anno_iar_read({id:1*e.data.iarId}).done(function(o){var i={id:e.data.iarId,images:o.data.imageList,sId:t};e.data.toolType={imageAnnotationId:e.data.imageAnnotationId,imageAnnotationToolId:e.data.imageAnnotationToolId,imageAnnotationToolType:e.data.imageAnnotationToolType,imageAnnotationType:e.data.imageAnnotationType,imageAnnotation:e.data.imageAnnotationType},e.data.type=n.model.translateWord(e.data.imageAnnotationToolType),e.data.sId=t,e.data.uuid=e.data.backId=e.data.iarId,n.cornerstoneContorl.sequencelist.addNode(e.data),n.creatAllPoint(i,e.data,!1,!1),n.app.loading.hide()})})}),this.dicommenu.event._addEvent("dicommenu.reset",function(){n.cornerstoneContorl.defaultFunction("resizeCon")}),this.dicommenu.event._addEvent("dicommenu.shc",function(n){e.cornerstoneContorl.controlNodeShowHide(n)}),this.dicommenu.event._addEvent("dicommenu.setData",function(n){e.cornerstoneContorl.setConfigByDicommeun(n)}),this.dicommenu.event._addEvent("dicommenu.errorMSG",function(n){e.alerError(n.msg)}),this.dicommenu.event._addEvent("dicommenu.baseLine",function(n){e.cornerstoneContorl.baseLineSt(n.st,"baseLine")}),this.dicommenu.event._addEvent("dicommenu.cross",function(n){e.cornerstoneContorl.baseLineSt(n.st,"cross")})}},{key:"getMMCImage",value:function(e,n){return null!=e?e<=200&&this.model.seriesInfo[n].imagesAll.SMALL?this.model.seriesInfo[n].imagesAll.SMALL.imgs.toString().split(","):e>1e3&&this.model.seriesInfo[n].imagesAll.LARGE?this.model.seriesInfo[n].imagesAll.LARGE.imgs.toString().split(","):this.model.seriesInfo[n].imagesAll.default.imgs.toString().split(","):this.model.seriesInfo[n].imagesAll.default.imgs.toString().split(",")}},{key:"modalLoad",value:function(){var e=t(1030);this.progress=this.app.loadModal(e,{adv:!0}),this.progress.hide();var n=t(1118);this.alertSubmit=this.app.loadModal(n,{adv:!0}),this.alertSubmit.hide()}},{key:"baseApi",value:function(){var e=this;this.app.loading.show(),this.apiload(),this.api.project_anno_read({projectId:this.app.parpam.projectId}).done(function(n){e.app.loading.hide();var t=n.data;e.model.setData("projectInfo",t),e.cornerstoneContorl.model.projectInfo=t,e.imageDataType="2"==String(n.data.seriesImgFileType)?"orgin":"noneOrgin"})}},{key:"apiload",value:function(){}},{key:"annotationIteminit",value:function(){var e=this.model.projectInfo,n={};for(var t in e.imageAnnotationList.map(function(e){e.toolList.map(function(t){n[t.type]||(n[t.type]=[]);var o=JSON.parse(JSON.stringify(t));o.imageAnnotation=e.type,o.imageAnnotationId=e.id,n[t.type].push(o)})}),this.model.toolInfo=n,n)switch(t){case"ELLIPSE":this.dicommenu.openadd(n[t],"ellipticalRoi");break;case"RECTANGLE":this.dicommenu.openadd(n[t],"rectangleRoi");break;case"COBB":this.dicommenu.openadd(n[t],"cobb");break;case"ALIGNMENT":this.dicommenu.openadd(n[t],"alignment");break;case"PEN":case"POINT":this.dicommenu.openadd(n[t],"brush"),this.dicommenu.openadd(n[t],"earse");break;case"ANGLE":this.dicommenu.openadd(n[t],"simpleAngle");break;case"LINE":this.dicommenu.openadd(n[t],"length");break;case"MAGIC_STICK_SINGLE":this.dicommenu.openadd(n[t],"magicStickSingle"),this.dicommenu.openadd(n[t],"brush"),this.dicommenu.openadd(n[t],"earse");break;case"FREEHAND":case"FREEHANDLINE":this.dicommenu.openadd(n[t],"freehand"),this.dicommenu.openadd(n[t],"brush"),this.dicommenu.openadd(n[t],"earse");break;case"POLYGON":this.dicommenu.openadd(n[t],"polygon"),this.dicommenu.openadd(n[t],"brush"),this.dicommenu.openadd(n[t],"earse");break;case"QSELECT":this.dicommenu.openadd(n[t],"quickselect"),this.dicommenu.openadd(n[t],"brush"),this.dicommenu.openadd(n[t],"earse");break;case"REGION_PAINT":this.dicommenu.openadd(n[t],"regionpaint"),this.dicommenu.openadd(n[t],"brush"),this.dicommenu.openadd(n[t],"earse");break;case"IMAGE_TAG":this.handleLayerMarkImageAnnotation(n[t][0])}var o={all:{}};o.all=this.translateData(e.annotationItemList);for(var i=0;i<e.imageAnnotationList.length;i++){0!=e.imageAnnotationList[i].annotationItemList.length&&(o[e.imageAnnotationList[i].type]=this.translateData(e.imageAnnotationList[i].annotationItemList))}this.cornerstoneContorl.model.nidusComponentInfo=Tool.clone(o),o=null,this.series_get()}},{key:"handleLayerMarkImageAnnotation",value:function(e){if(e){var n=e.id,t=e.type,o=e.imageAnnotationId,i=e.imageAnnotation;this.cornerstoneContorl.model.layerMarkImageAnnotation={imageAnnotationToolId:n,imageAnnotationToolType:t,imageAnnotationId:o,imageAnnotation:i}}}},{key:"series_get",value:function(){}},{key:"start_series",value:function(){for(var e=this.model.series_result_id,n=0;n<e.seriesInstanceUids.length;n++)this.getSeriesAllImage(e.seriesInstanceUids[n]);this.result_get_fromback()}},{key:"getSeriesAllImage",value:function(){var e=a(regeneratorRuntime.mark(function e(n){var t,i,a,r,s,l,d,c,u,h,m,f,p,g,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="object"==o(n.seriesInstanceUid)?n.seriesInstanceUid.series:n.seriesInstanceUid,this.model.seriesInfo[t]={},this.model.seriesInfo[t].needAnno="object"==o(n.seriesInstanceUid)?n.seriesInstanceUid.needAnno:n.needAnno,this.app.loading.show(),-1!=t.lastIndexOf("-")&&(t=t.split("-")[0]),e.next=7,this.api.sys_transfer({service:"DR",method:"/v1/series/read",params:JSON.stringify({seriesInstanceUID:t})});case 7:i=e.sent,this.app.loading.hide(),this.model.seriesInfo[t].info=i,"DCM"==i.data.fileType&&"DR"!=i.data.modality&&"CX"!=i.data.modality&&"CR"!=i.data.modality&&"DX"!=i.data.modality&&(this.dicommenu.openadd([],"mpr"),this.dicommenu.openadd([],"add"),this.dicommenu.openadd([],"sub")),e.t0=i.data.fileType,e.next="DCM"===e.t0?14:"NII"===e.t0?16:"JPG"===e.t0?18:"BIG_IMAGE"===e.t0?20:22;break;case 14:return"noneOrgin"==this.imageDataType?this.imageType="JPG":this.imageType="DCM",e.abrupt("break",24);case 16:return this.imageType="JPG",e.abrupt("break",24);case 18:return"noneOrgin"==this.imageDataType?this.imageType="JPG_COMPRESS":this.imageType="JPG",e.abrupt("break",24);case 20:return this.imageType="BIG_IMAGE",e.abrupt("break",24);case 22:return this.imageType="JPG",e.abrupt("break",24);case 24:if(i.data.jpgInfo||"DCM"!=i.data.fileType||this.model.taskInfo){e.next=27;break}return this.app.alert.show({title:" ",msg:"数据异常,点击确认进入下一个序列",close:!1,sure:function(){that.discaseToDone({type:98,des:"序列加载异常"})}}),e.abrupt("return");case 27:return a=JSON.parse(i.data.jpgInfo),this.model.seriesInfo[t].info.wwc=i.data.jpgInfo?a:{low:0,hight:255,flag:0},this.model.series_result_id.conclusion=i.data.conclusion,this.model.series_result_id.finding=i.data.finding,r=this.model.seriesInfo[t].info.data.pixelSpacing?this.model.seriesInfo[t].info.data.pixelSpacing.split("\\"):[1,1],this.model.seriesInfo[t].info.data.pixelSpacing=r,this.model.seriesInfo[t].info.data.columnPixelSpacing=r[0],this.model.seriesInfo[t].info.data.rowPixelSpacing=r[1],this.model.setData("seriesInfo",this.model.seriesInfo),e.next=38,this.api.sys_transfer({service:"DR",method:"/v1/image/query",params:JSON.stringify({seriesInstanceUID:t,fileType:this.imageType})});case 38:return s=e.sent,this.model.seriesInfo[t]||(this.model.seriesInfo[t]={}),this.model.seriesInfo[t].imagesAll={},l=this.model.seriesInfo[t].imagesAll,"DCM"!=this.imageType&&(this.model.seriesInfo[t].infoAll={},this.model.seriesInfo[t].infoAll.large=s.data.jpgInfoLarge?s.data.jpgInfoLarge:null,this.model.seriesInfo[t].infoAll.small=s.data.jpgInfoSmall?s.data.jpgInfoSmall:null,this.model.seriesInfo[t].infoAll.default=s.data.jpgInfo?s.data.jpgInfo:'{"low": 0,"hight": 255,"flag": 0}',this.model.seriesInfo[t].info||(this.model.seriesInfo[t].info={}),this.model.seriesInfo[t].info.wwc=JSON.parse(this.model.seriesInfo[t].infoAll.default)),e.next=45,this.getPeoplePostion(t,n.imageList);case 45:if(this.model.seriesInfo[t].imgsTotal=null,s.data.list)for(d=0;d<s.data.list.length;d++)c=void 0,u=s.data.list[d],c="DCM"!=this.imageType?"myImageLoader:"+u.urlWAN:"wadouri:"+u.urlWAN,h=u.number,this.model.seriesInfo[t].imgsTotal?this.model.seriesInfo[t].imgsTotal<1*u.number&&(this.model.seriesInfo[t].imgsTotal=1*u.number):this.model.seriesInfo[t].imgsTotal=1*u.number,u.windowType?(l[u.windowType]||(l[u.windowType]={},l[u.windowType].imgs=[]),l[u.windowType].imgs[h]=c):(l.default||(l.default={},l.default.imgs=[]),l.default.imgs[h]=c);for(m in s.data.list&&0!=s.data.list.length||(l.default={},l.default.imgs=[]),l){if(n.imageList){for(f=[],p=0;p<n.imageList.length;p++)g=n.imageList[p],v=l[m].imgs[g]?l[m].imgs[g]:null,f.push(v);l[m].imgs=JSON.parse(JSON.stringify(f)),f=null}l[m].imgs=l[m].imgs.filter(function(e){return e})}this.model.seriesInfo[t].imgs=this.model.seriesInfo[t].imagesAll.default.imgs.toString().split(","),this.model.seriesInfo[t].imgs=this.model.seriesInfo[t].imgs.filter(function(e){return e}),this.model.imagesInfo=s.data,this.model.seriesInfo[t].numbers=s.data.list.map(function(e){return e.number}),this.model.setData("seriesInfo",this.model.seriesInfo);case 54:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}()},{key:"getPeoplePostion",value:function(){var e=a(regeneratorRuntime.mark(function e(n,t){var o,i,a,r,s,l,d,c,u,h,m,f,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.sys_transfer({service:"DR",method:"/v1/image/query",params:JSON.stringify({seriesInstanceUID:n,fileType:"DCM"})});case 2:for(o=e.sent,this.model.seriesInfo[n].people||(this.model.seriesInfo[n].people=[]),i=0;i<o.data.list.length;i++)(a=o.data.list[i]).imageOrientationPatient||a.imagePositionPatient?(a.info=a.info?a.info:{},a.info.imagePositionPatient=a.imagePositionPatient.split("\\"),a.info.ImageOrientationPatient=a.imageOrientationPatient.split("\\"),this.model.seriesInfo[n].people[a.number]={imagePositionPatient:a.info.imagePositionPatient,ImageOrientationPatient:a.info.ImageOrientationPatient}):this.model.seriesInfo[n].people.push(null);if(t){for(r=[],s=0;s<t.length;s++)l=t[s],d=this.model.seriesInfo[n].people[l]?this.model.seriesInfo[n].people[l]:null,r.push(d);this.model.seriesInfo[n].people=JSON.parse(JSON.stringify(r)),r=null}this.model.seriesInfo[n].people[1]&&this.model.seriesInfo[n].people[2]?(c=this.model.seriesInfo[n].people[1].imagePositionPatient,u=this.model.seriesInfo[n].people[2].imagePositionPatient,h=Math.abs(1*c[2]-1*u[2]),m=Math.abs(1*c[0]-1*u[0]),f=Math.abs(1*c[1]-1*u[1]),p=Math.pow(m*m+f*f+h*h,.5),this.model.seriesInfo[n].volumeCal=p*this.model.seriesInfo[n].info.data.pixelSpacing[0]*this.model.seriesInfo[n].info.data.pixelSpacing[1]):this.model.seriesInfo[n].volumeCal=this.model.seriesInfo[n].info.data.pixelSpacing[0]*this.model.seriesInfo[n].info.data.pixelSpacing[1];case 7:case"end":return e.stop()}},e,this)}));return function(n,t){return e.apply(this,arguments)}}()},{key:"result_get_fromback",value:function(){-1==window.location.hash.lastIndexOf("markaudit")&&-1==window.location.hash.lastIndexOf("drapCanvasAud")&&-1==window.location.hash.lastIndexOf("drapCanvsPro")||this.audito_result_get_fromback()}},{key:"audito_result_get_fromback",value:function(){var e=this;this.model.taskInfo&&1*this.model.taskInfo.hasYay==1&&this.dicommenu.openYY();var n="all";this.model.taskInfo.studyAnno&&(n="study");for(var t=function(t){e.api.series_result_read({sarId:e.model.series_result_id.seriesInstanceUids[t].seriesAnnotationResultId}).done(function(i){e.model.translateBackData(i,e.model.projectInfo.annotationItemList);var a=e.model.series_result_id.seriesInstanceUids[t].seriesInstanceUid;"object"==(void 0===a?"undefined":o(a))?a.series:a.seriesInstanceUid;if(i.data.seriesInstanceUid=i.data.seriesUid,e.model.seriesResult[i.data.seriesUid]=i,e.model.series_result_id.remark=i.data.remark,"all"==n||"study"==n){for(var r=0;r<i.data.annoResultList.length;r++)e.dicommenu.addDoctorSocre(i.data.annoResultList[r].doctorId,i.data.annoResultList[r].hasYay?i.data.annoResultList[r].yayAttributes:"无");"study"==n&&(n="close")}i.data.yayAttributes&&(e.dicommenu.openYY(),e.dicommenu.setYY(i.data.yayAttributes)),e.model.setData("seriesResult",e.model.seriesResult),-1==window.location.hash.lastIndexOf("view")?t==e.model.series_result_id.seriesInstanceUids.length-1&&e.api.audit_annoitem_update({sarIdList:e.model.series_result_id.sarIdList.join(),type:"ANNOITEM",resultList:e.model.changeItemDataToBackendCheck(i.data.annotationItemResultList)}).done(function(){}):e.dicommenu.closeYY()})},i=0;i<this.model.series_result_id.seriesInstanceUids.length;i++)t(i)}},{key:"cornerstoneStart",value:function(){var e=this;for(var n in this.model.projectInfo.isYayAttributes&&this.dicommenu.openYY(),this.dicommenu.setYY(this.model.seriesResult),this.model.seriesInfo){var t=this.model.seriesInfo[n];return window.fileTypeName=t.info.data.fileType,this.cornerstoneContorl.imageType=this.imageType,this.model.taskInfo.studyAnno&&this.dicommenu.openadd([],"screen"),this.cornerstoneContorl.penRealy=!1,this.cornerstoneContorl.modelData=this.model,this.cornerstoneContorl.initCT(t.imgsTotal,t.imgs,t.info),void this.cornerstoneContorl.event._addEvent("ctcornerstone.wlChange",function(n){var t={c:n.wwc.c,w:n.wwc.w},o=2==e.model.projectInfo.seriesImgFileType?{wc:t.c,ww:t.w}:e.getwwc({wc:1*t.c,ww:1*t.w},n.sId);e.cornerstoneContorl.lungWindown(1*o.wc,1*o.ww,e.getMMCImage(1*o.ww,n.sId))})}}},{key:"getWidth",value:function(e){return new Promise(function(n,t){var o=new Image;o.src=e,o.onload=function(){this.width>2e3||this.height>2e3?n(!0):n(!1)}})}},{key:"listInit",value:function(){var e=a(regeneratorRuntime.mark(function e(){var n,t,o,i,a,r,s,l,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r in n=this.model.seriesResult,t=this.model.series_result_id,o={studyId:t.studyInstanceUid,sequenceName:t.studyInstanceUid,major:"major",id:t.studyInstanceUid},i=[],a=null,n)s=n[r].data.seriesInstanceUid||n[r].data.seriesUid,l=this.model.seriesInfo[s]?this.model.seriesInfo[s].info.data:{modality:null,fileType:"JPG"},d=!1,"DCM"!=l.fileType||"DX"!=l.modality&&"DR"!=l.modality&&"CR"!=l.modality||(d=!0),this.model.translateDataReslut(n[r].data.imageAnnotationResultList,s,d),i=i.concat(n[r].data.imageAnnotationResultList),this.model.seriesInfo[s].sarId=r,a||(a=n[r].data.annotationItemResultList),this.cornerstoneContorl.fileTypeName=l.fileType;this.cornerstoneContorl.model.seriesInfo=this.model.seriesInfo,this.model.projectInfo.largeFigure=void 0!=this.model.taskInfo.largeFigure&&null!=this.model.taskInfo.largeFigure?this.model.taskInfo.largeFigure:this.model.projectInfo.largeFigure,void 0!=this.model.taskInfo.studyAnno&&null!=this.model.taskInfo.studyAnno&&null!=this.model.projectInfo.largeFigure&&void 0!=this.model.projectInfo.largeFigure&&(this.model.taskInfo.studyAnno&&!this.model.projectInfo.largeFigure?this.cornerstoneContorl.setSequenceLists(this.model.seriesInfo,this.imageType):this.cornerstoneContorl.closeSequenceLists()),this.cornerstoneContorl.setSequence([o],i),t.inspectSee=this.model.projectInfo.inspectSee,t.diagnosisIncome=this.model.projectInfo.diagnosisIncome,this.cornerstoneContorl.setSeriesNidusData(a,t,n),this.getAllimageData(i);case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getAllimageData",value:function(e){var n=this,t=e,o=this;this.model.loadData={total:0,num:0},t.map(function(){var e=a(regeneratorRuntime.mark(function e(t){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=-1!=String(t.id).lastIndexOf("_")?t.id.split("_")[1]:t.id,"MAGIC_STICK_SINGLE"!=t.imageAnnotationToolType){e.next=8;break}return t.brush=!0,e.next=5,o.api.magicToolRead({id:i});case 5:a=e.sent,o.baseMagicTranData(t.id,a,t,!1),n.model.loadData.total++;case 8:"POLYGON"!=t.imageAnnotationToolType&&"QSELECT"!=t.imageAnnotationToolType&&"REGION_PAINT"!=t.imageAnnotationToolType&&"FREEHAND"!=t.imageAnnotationToolType||(n.model.loadData.total++,t.brush=!0,n.api.anno_iar_read({id:1*i}).done(function(e){e.data||o.model.loadData.total--;var n={id:t.result,images:e.data.imageList,sId:t.sId},a=Tool.configxlkformat(o.app.constmap.LESION).find(function(e){return e.idx==t.imageAnnotationType}),r=!1;if(a&&"心脏分割"==a.val){r=!0;var s=e.data.imageList[0].urlWan.split("?")[0].split("/");o.cornerstoneContorl.setNname(1*i,1*s[s.length-2])}var l=!1;a&&"MCA供血分区"==a.val&&(l=!0),o.creatAllPoint(n,t,!1,r,l)}));case 9:case"end":return e.stop()}},e,n)}));return function(n){return e.apply(this,arguments)}}())}},{key:"creatAllPoint",value:function(e,n,t,o,i){var a={};a.result=e.id;var r=void 0,s=void 0;for(var l in this.model.seriesResult)this.model.seriesResult[l].data.seriesInstanceUid==n.sId?r=l:s=this.model.seriesResult[l].data.seriesInstanceUid;a.seriesAnnotationResultId=r,a.imageAnnotationId=n.toolType.imageAnnotationId,a.imageAnnotationToolId=n.toolType.id;var d=this.model.seriesInfo[n.sId],c={imglist:this.model.getImagesBack(e.images,d.info.wwc.flag,d.imgsTotal),id:n.backId,rid:n.backId,sId:n.sId};i&&(c.sId+="_"+s,this.cornerstoneContorl.updateSequencelistSid(c)),o&&(c.imglist=this.model.getImages(e.images,d.info.wwc.flag,d.imgsTotal)),c.needScale=this.model.judgeX(d.info.data.fileType,d.info.data.modality),this.needApiAll(n,t,c,a)}},{key:"creatOnePoint",value:function(e,n,t){var o=void 0;for(var i in this.model.seriesResult)this.model.seriesResult[i].data.seriesInstanceUid==n.sId&&(o=i);var a={};a.result=e.id,a.seriesAnnotationResultId=o,a.imageAnnotationId=n.toolType.imageAnnotationId,a.imageAnnotationToolId=n.toolType.id;var r=this.model.seriesInfo[n.sId],s={imglist:this.model.getImages(e.images,r.info.wwc.flag,r.imgsTotal),id:n.backId,rid:e.id,sId:n.sId};s.needScale=this.model.judgeX(this.model.seriesInfo[n.sId].info.data.fileType,this.model.seriesInfo[n.sId].info.data.modality),this.needApiAll(n,t,s,a)}},{key:"baseMagicTranData",value:function(e,n,t,o,i){var a=this.model.seriesInfo[t.sId],r={imglist:this.model.getImages(n.data.imageList,a.info.wwc.flag,a.imgsTotal),id:e,rid:e,sId:t.sId,needScale:this.model.judgeX(a.info.data.fileType,a.info.data.modality)};t.id=e,t.backId=e,o&&(t.brush=!0,this.cornerstoneContorl.updataSequencelist(t)),this.cornerstoneContorl.setbrush(r)}},{key:"needApiAll",value:function(e,n,t,o){}},{key:"getwwc",value:function(e,n,t){var o=[e.wc-e.ww/2,e.ww/2+e.wc];if("DCM"==this.imageType)return e;if(this.model.seriesInfo[n].info.wwc=JSON.parse(this.model.seriesInfo[n].infoAll.default),t||(e.ww<=200&&this.model.seriesInfo[n].infoAll.small&&(this.model.seriesInfo[n].info.wwc=JSON.parse(this.model.seriesInfo[n].infoAll.small)),e.ww>1e3&&this.model.seriesInfo[n].infoAll.large&&(this.model.seriesInfo[n].info.wwc=JSON.parse(this.model.seriesInfo[n].infoAll.large))),this.model.seriesInfo[n].info.wwc){var i=1*this.model.seriesInfo[n].info.wwc.low,a=1*this.model.seriesInfo[n].info.wwc.hight-1*this.model.seriesInfo[n].info.wwc.low,r=255*(o[0]-i)/a,s=255*(o[1]-i)/a;return{wc:(r+s)/2,ww:s-r}}return e}},{key:"makeWwC",value:function(e){if(this.dicommenu.chooseData){var n=this.dicommenu.chooseData.wl?this.dicommenu.chooseData.wl:{c:null,w:null};if(null==n.c&&null==n.w){var t=this.model.seriesInfo[e].info;if(t.data.firstWindowCenter&&t.data.firstWindowWidth&&"{}"!=t.data.jpgInfo){var o=2==this.model.projectInfo.seriesImgFileType?{wc:t.data.firstWindowCenter,ww:t.data.firstWindowWidth}:this.getwwc({wc:1*t.data.firstWindowCenter,ww:1*t.data.firstWindowWidth},e,"def");this.cornerstoneContorl.lungWindown(1*o.wc,1*o.ww,this.getMMCImage(o.ww,e))}else if(t.data.firstWindowCenter&&t.data.firstWindowWidth&&"DCM"==this.imageType){var i=2==this.model.projectInfo.seriesImgFileType?{wc:t.data.firstWindowCenter,ww:t.data.firstWindowWidth}:this.getwwc({wc:1*t.data.firstWindowCenter,ww:1*t.data.firstWindowWidth},e,"def");this.cornerstoneContorl.lungWindown(1*i.wc,1*i.ww,this.getMMCImage(i.ww,e))}else this.cornerstoneContorl.lungWindown(null,null,this.getMMCImage(null,e))}else{var a=2==this.model.projectInfo.seriesImgFileType?{wc:n.c,ww:n.w}:this.getwwc({wc:1*n.c,ww:1*n.w},e);this.cornerstoneContorl.lungWindown(1*a.wc,1*a.ww,this.getMMCImage(1*n.w,e))}}else this.cornerstoneContorl.lungWindown(null,null,this.getMMCImage(null,e))}},{key:"openRemove",value:function(){var e=this,n=t(1125),o=this.model.projectInfo.discardList?this.model.projectInfo.discardList:null,i=this.app.loadModal(n,{adv:!1,class:"xs",title:"请选择该序列标为废片的原因",data:o});i.event._addEvent("modal.confirm",function(){var n=JSON.parse(JSON.stringify(i.res));"{}"!=JSON.stringify(i.res)?(i.res.type=!i.res.des)?i.showError(1):(e.discaseToDone(n,i),i.close()):i.showError(0)})}},{key:"translateData",value:function(e){for(var n={},t=function(t){var i=e[t],a=i.id;n[a]=e[t],n[a].id=i.id,n[a].type=i.componentType,n[a].name=i.componentName,i.componentParameter&&("object"==o(JSON.parse(i.componentParameter))?JSON.parse(i.componentParameter).hasnull&&(i.type="checkbox-sp"):i.componentParameter=null),i.componentData&&(n[a].data={},"checkbox-sp"==i.type&&(n[a].data[-1]="无"),"object"==o(JSON.parse(i.componentParameter))?JSON.parse(i.componentData).map(function(e){n[a].data[e.code]=e.text}):i.componentData=null)},i=0;i<e.length;i++)t(i);return n}},{key:"getSericesTotal",value:function(e){var n=e.length-1;return Tool.changeToName(e[n])}},{key:"discaseToDone",value:function(e,n){}},{key:"btnEvent",value:function(){}},{key:"submitSeries",value:function(){}},{key:"series_submit",value:function(){}},{key:"errorShow",value:function(e,n){}},{key:"alerError",value:function(e){this.app.alert.show({title:" ",msg:e,close:!0})}},{key:"submitFinish",value:function(e){}},{key:"dispose",value:function(){this.cornerstoneContorl&&this.cornerstoneContorl.close(),this.progress&&this.progress.close(),this.alertSubmit&&this.alertSubmit.close(),ES.selctorDoc(window).off("keydown"),ES.selctorDoc(window).off("mousemove"),this.app.alert.hide()}},{key:"resize",value:function(){this.cornerstoneContorl&&this.cornerstoneContorl.resize()}},{key:"getSarIds",value:function(){var e=[];for(var n in this.model.seriesResult)e.push(n);return e.toString()}},{key:"getCurrentSeriesSarId",value:function(){return this.cornerstoneContorl.model.currentSeriesInfo.seriesAnnotationResultId}}]),n}();window.MarkBase=window.MarkBase||r,e.exports=r},882:function(e,n,t){var o=t(2175);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},883:function(e,n,t){"use strict";var o={sys_transfer:function(e){return this.HttpRequest.POST("/sys/transfer",e)},annoitem_task_read:function(e){o.app.tokentime()||delete e.token;var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/audit/annoitem/task/read",type:"POST",dataType:"json",contentType:"application/json;charset=UTF-8",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},task_read:function(e){o.app.tokentime()||delete e.token;var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/audit/task/read",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},series_read:function(e){o.app.tokentime()||delete e.token;var n=ES.Deferred();return ES.ajax({url:o.app.domain+"v1/series/read",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},image_query:function(e){o.app.tokentime()||delete e.token;var n=ES.Deferred();return ES.ajax({url:o.app.domain+"v1/image/query",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},series_get:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/anno/user/series/get",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},series_result_create:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/anno/series_result/create",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},series_result_read:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/audit/task/series/result/read",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},series_result_submit:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/anno/series_result/submit",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},series_result_query:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/anno/series_result/query",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},series_result_item_edit:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/anno/series_result/item/edit",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},image_result_create:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/anno/image_result/create",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},audit_imganno_audit:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/audit/imganno/audit",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},anno_iar_read:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/anno/iar/read",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},audit_annoitem_update:function(e){var n=ES.Deferred();return console.log("wwwwww"),ES.ajax({url:o.app.domain1+"v1/audit/annoitem/update",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){console.log(e),o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},series_audit_submit:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/audit/series/audit/submit",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},series_result_yayAttributes:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/anno/series_result/yayAttributes",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},series_result_next:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/audit/task/series/result/next",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n},task_study_result_read:function(e){var n=ES.Deferred();return ES.ajax({url:o.app.domain1+"v1/audit/task/study/result/read",type:"POST",dataType:"json",contentType:"application/json",questring:e}).then(function(e){o.app.apiresult(e)&&n.resolve(e)},function(){n.reject(!0)}),n}};e.exports=o},884:function(e,n,t){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();function a(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function o(i,a){try{var r=n[i](a),s=r.value}catch(e){return void t(e)}if(!r.done)return Promise.resolve(s).then(function(e){o("next",e)},function(e){o("throw",e)});e(s)}("next")})}}var r=function(e){function n(e,t,o,i){return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t,o,i))}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,MarkBase),i(n,[{key:"baseApi",value:function(){var e=this;this.app.loading.show(),this.api.annoitem_task_read({taskId:this.app.parpam.taskId}).done(function(n){e.app.loading.hide(),e.api.task_read({id:e.app.parpam.taskId}).done(function(t){e.dom.find(".task-name span").eq(1).html(t.data.name),e.model.taskInfo=t.data,e.model.setData("projectInfo",n.data)})})}},{key:"annotationIteminit",value:function(){var e=this,n=this.model.projectInfo,t={all:{}},o=0;n.annotationItemList.map(function(e){e.id=e.componentId,e.sequence=o,e.formComponentId=e.componentId,o++}),t.all=this.translateData(n.annotationItemList);for(var i=function(o){var i=n.imageAnnotationList[o].annotationItemList,a=0;n.imageAnnotationList[o].annotationItemList.splice(0,0,{componentCode:"check_reslut",componentData:'[{"text":"对","code":"0"},{"text":"错","code":"1"}]',componentId:"check_reslut",componentName:"正确与否",componentParameter:'{"isdefault ":false}',componentType:"select",optional:!0,sequence:a}),n.imageAnnotationList[o].annotationItemList.map(function(e){e.sequence=a,e.id=e.componentId,a++}),0!=i.length&&(t[n.imageAnnotationList[o].type]=e.translateData(n.imageAnnotationList[o].annotationItemList))},a=0;a<n.imageAnnotationList.length;a++)i(a);if(this.cornerstoneContorl.model.nidusComponentInfo=Tool.clone(t),t=null,this.cornerstoneContorl&&this.cornerstoneContorl.close(),this.dicommenu&&this.dicommenu.resetAll(),"check_viewer"!=this.app.parpam.type&&"check_viewer_taskdetail"!=this.app.parpam.type&&"check_viewer_taskdetail_view"!=this.app.parpam.type)this.app.loading.show(),this.api.series_result_next({index:1*this.app.parpam.taskInfo.split("$$")[1],taskId:1*this.app.parpam.taskId,userId:parseInt(this.app.parpam.uid)}).done(function(n){e.app.loading.hide();n.data.sarId,n.data.series;var t={studyInstanceUid:n.data.series,seriesInstanceUids:[{seriesAnnotationResultId:n.data.sarId,seriesInstanceUid:n.data.series}]};e.model.setData("series_result_id",t)});else{var r=this.app.parpam.taskInfo.split("$$");if(this.model.taskInfo.studyAnno)this.api.task_study_result_read({userId:r[2],taskId:1*this.app.parpam.taskId,studyUid:r[0]}).done(function(n){for(var t={studyInstanceUid:r[0],seriesInstanceUids:[]},o=0;o<n.data.list.length;o++)t.seriesInstanceUids.push({seriesAnnotationResultId:n.data.list[o].sarId,seriesInstanceUid:n.data.list[o].seriesUid});t.remark=n.data.remark,e.model.setData("series_result_id",t)});else{r[1],r[0];var s={studyInstanceUid:r[0],seriesInstanceUids:[{seriesAnnotationResultId:r[1],seriesInstanceUid:r[0]}]};s.remark=r[2],this.model.setData("series_result_id",s)}}}},{key:"series_get",value:function(e){var n=this;this.cornerstoneContorl&&this.cornerstoneContorl.close(),this.dicommenu&&this.dicommenu.resetAll(),this.api.series_get({taskId:this.app.parpam.taskId,userId:5088}).done(function(e){1001==e.code&&(window.location.href=window.location.origin+"/#!/viewaudittask/"+n.app.parpam.taskId,window.location.reload()),e.data||(window.location.href=window.location.origin+"/#!/viewaudittask/"+n.app.parpam.taskId,window.location.reload());e.data.seriesAnnotationResultId,e.data.seriesInstanceUid;for(var t=[],o=0;o<e.data.sarIdList.length;o++)t.push({seriesAnnotationResultId:e.data.sarIdList[o],seriesInstanceUid:e.data.seriesList[o]});var i={studyInstanceUid:e.data.seriesList[0],seriesInstanceUids:t};n.model.setData("series_result_id",i)})}},{key:"start_series",value:function(){for(var e=this.model.series_result_id,n=0;n<e.seriesInstanceUids.length;n++)this.getSeriesAllImage(e.seriesInstanceUids[n]);this.result_get_fromback()}},{key:"getSeriesAllImage",value:function(){var e=a(regeneratorRuntime.mark(function e(n){var t,i,a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(t="object"==o(n.seriesInstanceUid)?n.seriesInstanceUid.series:n.seriesInstanceUid).split("-")[0],this.model.seriesInfo[t]={},this.app.loading.show(),e.next=6,this.api.sys_transfer({service:"DR",method:"/v1/series/read",params:JSON.stringify({seriesInstanceUID:t})});case 6:i=e.sent,this.model.imageCacheList={},e.t0=regeneratorRuntime.keys(i.data.segmentationInfo);case 9:if((e.t1=e.t0()).done){e.next=18;break}if("thumbnail"==(a=e.t1.value)){e.next=16;break}return e.next=14,this.api.sys_transfer({service:"DR",method:"/v1/image/query",params:JSON.stringify({seriesInstanceUID:t,fileType:"BIG_IMAGE",windowType:a})});case 14:r=e.sent,this.model.imageCacheList[a]=r.data.list;case 16:e.next=9;break;case 18:if(this.app.loading.hide(),this.model.seriesInfo[t].info=i,this.model.taskInfo){e.next=23;break}return this.app.alert.show({title:" ",msg:"数据异常,点击确认进入下一个序列",close:!1,sure:function(){that.discaseToDone({type:98,des:"序列加载异常"})}}),e.abrupt("return");case 23:this.formatOrigin(i.data.segmentationInfo),this.model.seriesInfo[t].imgs=[],this.model.seriesInfo[t].orginImgSizes=JSON.parse(JSON.stringify(this.model._orginImgSizes)),this.model.orginImgSizes=null,this.model.series_result_id.conclusion=i.data.conclusion,this.model.series_result_id.finding=i.data.finding,this.model.setData("seriesInfo",this.model.seriesInfo);case 30:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}()},{key:"getimage",value:function(){var e=a(regeneratorRuntime.mark(function e(n){var t,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={data:{list:[]}},this.model.imageCacheList[n.windowType]){e.next=7;break}return e.next=4,this.api.sys_transfer({service:"DR",method:"/v1/image/query",params:JSON.stringify(n)});case 4:t=e.sent,e.next=8;break;case 7:n.numberList.map(function(e){t.data.list.push(o.model.imageCacheList[n.windowType][e-1])});case 8:this.cornerstoneContorl.makeImage(t);case 9:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}()},{key:"cornerstoneContorlOther",value:function(){var e=this;this.cornerstoneContorl.event._addEvent("ctcornerstone.loadImage",function(n){e.getimage(n)}),this.cornerstoneContorl.event._addEvent("ctcornerstone.addNode",function(e){}),this.cornerstoneContorl.event._addEvent("ctcornerstone.editNode",function(e){}),this.cornerstoneContorl.event._addEvent("ctcornerstone.deleteNode",function(e){}),this.cornerstoneContorl.event._addEvent("ctcornerstone.brushfirstload",function(e){}),this.cornerstoneContorl.event._addEvent("ctcornerstone.Allthing",function(e){}),this.cornerstoneContorl.event._addEvent("ctcornerstone.editNodeItem",function(e){})}},{key:"formatOrigin",value:function(e){for(var n in e.length=1,e)"thumbnail"!=n&&"length"!=n&&(e[n]=JSON.parse(e[n]),e[n].row=e[n].rows,e[n].colnum=e[n].columns,e[n].height=e[n].hieght||e[n].height,1*n.replace("x","")>e.length&&(e.length=1*n.replace("x","")));this.model.orginImgSizes=e}},{key:"btnEvent",value:function(){var e=this;this.dom.find(".back-icon").on("click",function(){"check_viewer_taskdetail"!=e.app.parpam.type?"check_viewer_taskdetail_view"!=e.app.parpam.type?e.app.changePage("viewaudittask",{id:e.app.parpam.taskId}):e.app.changePage("taskdetail",{taskId:e.app.parpam.taskId,type:"view"}):e.app.changePage("taskdetail",{taskId:e.app.parpam.taskId,type:"editor"})});if(-1==this.app.parpam.type.lastIndexOf("viewer_all"))this.dom.find(".cotrol-btn .btn-submit1").remove(),this.dom.find(".cotrol-btn .btn-submit2").remove();else{var n=this.app.parpam.taskInfo.split("$$");this.dom.find(".cotrol-btn .btn-submit1").on("click",function(){if(1*n[1]>0){var t=n[0]+"_"+(n[1]-1);window.location.href=window.location.origin+"/#!/drapCanvasAud/"+e.app.parpam.taskId+"/"+t+"/check_viewer_all",window.location.reload()}else e.alerError("没有上一个序列了！")}),this.dom.find(".cotrol-btn .btn-submit2").on("click",function(){if(1*n[1]<n[0]-1){var t=n[0]+"_"+(1*n[1]+1);window.location.href=window.location.origin+"/#!/drapCanvasAud/"+e.app.parpam.taskId+"/"+t+"/check_viewer_all",window.location.reload()}else e.dom.find(".back-icon").click()})}}}]),n}();e.exports=r},885:function(e,n){e.exports='<div class=dragCanvas> <ul class=mark-header> <li class="back-icon fl"> <span><span class=lefta><i class="iconfont icon-icon-test3" style=font-size:12px></i></span><span class=infojian>医生主页</span></span> </li> <li class="task-name fl"> <span>|</span> <span>Cassiel0705标注4</span> </li> <li class="cotrol-btn fr"> <div class="btn btn-submit1">上一个序列</div> <div class="btn btn-submit2">下一个序列</div> </li> <li class="discard_info fr" style=margin-right:10px></li> </ul> <div class=mark-menu></div> <div class=mark-content> </div> </div>'},935:function(e,n,t){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var a=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);this.colwDefault=this.colcDefault=null,this.removeId="",this.thickness,this.distanceStart,this.newImgOrender="",this.spsec,this.calculationCars=new Array,this.event=new Interstellar.event,this.stepPage=n.stepPage||5,this.scroll=void 0==n.scroll&&null==n.scroll||n.scroll,this.imgType=n.type||"png",this.moveAllElementData={},this.modifyCount1=new Object,this.modifyCount2=new Object,this.modifyDate1=new Object,this.element=n.element,this.nodeArray=[],this.imageAddress=n.imageAddress,this.axialStack1={currentImageIdIndex:n.index||0,imageIds:this.imageAddress,preventCache:!0},this.nowloadNum=0,this.perload=void 0==n.perload&&null==n.perload||n.perload,this.burshChoose=!1,this.movelist=!1,this.init()}return i(e,[{key:"init",value:function(){for(var e=cornerstone.getEnabledElements(),n=!1,t=0;t<e.length;t++){e[t].element.id==ES.selctorDoc(this.element).attr("id")&&(n=!0)}if(n){var o=this.buildUrl(this.axialStack1.currentImageIdIndex);this.loadImage(o,this.element,!0)}else this.loadAndViewImage(this.axialStack1.currentImageIdIndex,!0,!0);this.perload&&setTimeout(function(){},0)}},{key:"beforehandCacheLoad",value:function(e,n,t,o){if(e)for(var i=1;i<this.stepPage;i++)this.loadCache(i,t);else null==this.calculationCars[n+1]&&n<o&&this.loadCache(n+1,t),null==this.calculationCars[n-1]&&n>1&&this.loadCache(n-1,t)}},{key:"funcNodiuCacheLoad",value:function(e,n,t){var o=this.imageAddress.length-e;if(0!=o)for(var i=1*e+1*(o<this.stepPage?o:this.stepPage),a=e;a<i;a++)null==this.calculationCars[a]&&e<t&&this.loadCache(a,n);if(e>this.stepPage)for(a=e-this.stepPage;a<e;a++)null==this.calculationCars[a]&&e>1&&this.loadCache(a,n)}},{key:"funcNodule",value:function(e,n){this.axialStack1.currentImageIdIndex=e-1;var t=this.buildUrl(e-1);this.loadImage(t,this.element),setTimeout(function(){},0)}},{key:"loadCache",value:function(e,n){this.buildUrlLoad(e,n)}},{key:"buildUrl",value:function(e){if("object"==o(this.imageAddress)){if(-1!=this.imageAddress[0].lastIndexOf("glayImage")||-1!=this.imageAddress[0].lastIndexOf("pixImage"))return this.axialStack1.currentImageIdIndex=e,this.imageAddress[e];for(var n=0;n<this.imageAddress.length;n++){var t=this.imageAddress[n].split("?")[0],i="/"+("000000"+(1*e+1)).slice(-6)+".";if(-1!=t.lastIndexOf(i))return this.axialStack1.currentImageIdIndex=n,this.imageAddress[n]}return null}}},{key:"getIndex",value:function(e){for(var n=0;n<this.imageAddress.length;n++){var t=this.imageAddress[n].split("?")[0],o="/"+("000000"+1*e).slice(-6)+".";if(-1!=t.lastIndexOf(o))return n}}},{key:"getLayerNum",value:function(e){var n=this.imageAddress[e].split("?")[0].split("/");return 1*n[n.length-1].split(".")[0]}},{key:"buildUrlLoad",value:function(e,n){return"object"==o(this.imageAddress)?this.imageAddress[e]:"dcm"==this.imgType?n+"/"+this.getLenStr(6,e)+".dcm":n+"/"+this.getLenStr(6,e)+".png"}},{key:"getLenStr",value:function(e,n){return(n+"").length<e?(String(Math.pow(10,e))+n).slice(-e):n}},{key:"GenNonDuplicateID",value:function(e){return Number(Math.random().toString().substr(3,e)+Date.now()).toString(36)}},{key:"cornerstonetoolsmeasurementadded",value:function(e){e.detail.measurementData.id=this.GenNonDuplicateID(12),this.event._dispatch("Cornerstone_Class.MeasurementAdded")}},{key:"cornerstonetoolsmouseup",value:function(e){this.moveAllElementData&&this.removeId&&this.removeId==this.moveAllElementData.id&&(this.moveAllElementData=null,this.removeId=null),this.event._dispatch("Cornerstone_Class.MeasurementEnd",this.moveAllElementData)}},{key:"cornerstonetoolsmousedown",value:function(e){this.event._dispatch("Cornerstone_Class.mousedown",{e:e})}},{key:"cornerstonetoolsmouseclick",value:function(e){this.event._dispatch("Cornerstone_Class.click",{e:e})}},{key:"cornerstonemeasurementremoved",value:function(e){var n=e.detail.measurementData.uuid;this.removeId=n,this.event._dispatch("Cornerstone_Class.MeasurementRemove",{id:n,layerNumber:this.getLayerNum(this.axialStack1.currentImageIdIndex)})}},{key:"cornerstonetoolsmeasurementmodified",value:function(e){var n=e.detail.measurementData.id;if(this.removeId!=n){var t=e.detail.measurementData;this.event._dispatch("Cornerstone_Class.ModifiedFinsh",{element:this.element,e:e,splitHandle:t,spsec:this.spsec})}}},{key:"cornerstonetoolsmousedrag",value:function(e){this.event._dispatch("Cornerstone_Class.MouseDrag",{element:this.element,e:e,layerNumber:this.getLayerNum(this.axialStack1.currentImageIdIndex)})}},{key:"cornerstonetoolsmousewheel",value:function(e){this.event._dispatch("Cornerstone_Class.cornerstonetoolsmousewheel",e)}},{key:"loadImage",value:function(e,n,t){if(e){var o=this;cornerstone.loadImage(e).then(function(e){cornerstoneTools.getToolState(o.element,"stack")&&(cornerstoneTools.getToolState(o.element,"stack").data[0].currentImageIdIndex=o.axialStack1.currentImageIdIndex),t&&o.zoomFan(),cornerstone.displayImage(n,e),setTimeout(function(){o.event._dispatch("Cornerstone_Class.LoadFinish",{el:o.element})},0)},function(e){alert(e)})}}},{key:"loadAndViewImage",value:function(e,n,t){new Map;this.axialStack1.currentImageIdIndex=e,cornerstone.enable(this.element),cornerstoneTools.mouseInput.enable(this.element),cornerstoneTools.mouseWheelInput.enable(this.element);var o=this.buildUrl(e);console.log(o,e);var i=this;this.element.addEventListener("cornerstonenewimage",function(e){i.onNewImage(e)}),this.element.addEventListener("cornerstoneimagerendered",function(e){i.onImageRendered(e)}),this.element.addEventListener("cornerstonetoolsmeasurementmodified",function(e){i.cornerstonetoolsmeasurementmodified(e)}),this.element.addEventListener("cornerstonetoolsmeasurementadded",function(e){i.cornerstonetoolsmeasurementadded(e)}),this.element.addEventListener("cornerstonemeasurementremoved",function(e){i.onlyClose||i.cornerstonemeasurementremoved(e)}),this.element.addEventListener("cornerstonetoolsmousewheel",function(e){i.cornerstonetoolsmousewheel(e)}),this.element.addEventListener("cornerstonetoolsmouseclick",function(e){i.cornerstonetoolsmouseclick(e)}),this.element.addEventListener("cornerstonetoolsmousedownactivate",function(e){i.cornerstonetoolsmousedownactivate(e)}),this.element.addEventListener("cornerstoneimageloadfailed",function(e){}),this.element.addEventListener("cornerstonetoolsmousemove",function(e){i.cornerstonetoolsmousemove(e)}),this.element.addEventListener("cornerstonetoolsmousedrag",function(e){i.cornerstonetoolsmousedrag(e)}),this.element.addEventListener("cornerstonetoolsmousedown",function(e){i.cornerstonetoolsmousedown(e)}),this.element.addEventListener("cornerstonetoolsmouseup",function(e){i.cornerstonetoolsmouseup(e)}),this.element.addEventListener("cornerstoneactivelayerchanged",function(e){i.cornerstoneactivelayerchanged(e)}),this.element.addEventListener("cornerstonelayeradded",function(e){i.cornerstonelayeradded(e)}),cornerstone.loadImage(o).then(function(e){var o=cornerstone.getDefaultViewportForImage(i.element,e);n?(i.colcDefault=o.voi.windowCenter,i.colwDefault=o.voi.windowWidth):null!=i.colcDefault&&null!=i.colwDefault&&(o.voi.windowWidth=i.colwDefault,o.voi.windowCenter=i.colcDefault),o.voiLUT=void 0,cornerstone.displayImage(i.element,e,o),cornerstoneTools.addStackStateManager(i.element,["stack"]),cornerstoneTools.addToolState(i.element,"stack",i.axialStack1),t&&(cornerstoneTools.ellipticalRoi.deactivate(i.element,1),cornerstoneTools.pan.activate(i.element,4),i.scroll&&cornerstoneTools.stackScrollWheel.activate(i.element)),setTimeout(function(){i.event._dispatch("Cornerstone_Class.LoadFinish",{el:i.element})},0)},function(e){alert(e)})}},{key:"cornerstonetoolsmousemove",value:function(e){this.event._dispatch("Cornerstone_Class.cornerstonetoolsmousemove",e)}},{key:"cornerstoneactivelayerchanged",value:function(e){this.event._dispatch("Cornerstone_Class.ActiveLayerChanged",e)}},{key:"cornerstonelayeradded",value:function(e){this.event._dispatch("Cornerstone_Class.LayerAdded",e)}},{key:"cornerstonetoolsmousedownactivate",value:function(e){this.event._dispatch("Cornerstone_Class.brushDown",e)}},{key:"onImageRendered",value:function(e){this.removePartData();e.detail.measurementData;var n=e.detail.image;console.log(n.imageId,"============",this.axialStack1.currentImageIdIndex);for(var t=0;t<this.imageAddress.length;t++)this.imageAddress[t]==n.imageId&&(console.log(t),this.axialStack1.currentImageIdIndex=t);var o=e.detail,i={viewport:cornerstone.getViewport(this.element).voi,e:e,canvasContext:o.canvasContext,element:this.element,image:n,currentCount:this.axialStack1.currentImageIdIndex};this.spsec=n.rowPixelSpacing,this.event._dispatch("Cornerstone_Class.ImageRendered",i),this.event._dispatch("Cornerstone_Class.updateImageTagComponentData",this.getLayerNum(this.axialStack1.currentImageIdIndex))}},{key:"onNewImage",value:function(e){var n=this.axialStack1.currentImageIdIndex+1;this.perload&&this.beforehandCacheLoad(!1,n,this.imageAddress,this.imageAddress.length)}},{key:"getViewport",value:function(){return cornerstone.getViewport(this.element)}},{key:"setViewport",value:function(e){cornerstone.setViewport(this.element,e)}},{key:"getAllState",value:function(){var e=cornerstoneTools.getToolState(this.element,"rectangleRoi"),n=cornerstoneTools.getToolState(this.element,"simpleAngle"),t=cornerstoneTools.getToolState(this.element,"ellipticalRoi"),o=cornerstoneTools.getToolState(this.element,"length"),i=[];return e&&this.setUUidData(e,i,"rectangleRoi"),n&&this.setUUidData(n,i,"simpleAngle"),t&&this.setUUidData(t,i,"ellipticalRoi"),o&&this.setUUidData(o,i,"length"),i}},{key:"setUUidData",value:function(e,n,t){e.data.map(function(e){e.uuid&&(e.tooltype=t,n.push(e))})}},{key:"geSiglneState",value:function(e){return cornerstoneTools.getToolState(this.element,e)}},{key:"resetAfter",value:function(){}},{key:"disableAllTools",value:function(e){e&&(cornerstoneTools.zoom.disable(this.element,1),cornerstoneTools.wwwc.disable(this.element,1),cornerstoneTools.magnify.disable(this.element,1),cornerstoneTools.probe.disable(this.element,1),cornerstoneTools.brush.disable(this.element,1)),this.burshChoose&&cornerstoneTools.brush.deactivate(this.element,1),this.burshChoose=!1,cornerstoneTools.length.deactivate(this.element,1),cornerstoneTools.simpleAngle.deactivate(this.element,1),cornerstoneTools.ellipticalRoi.deactivate(this.element,1),cornerstoneTools.rectangleRoi.deactivate(this.element,1)}},{key:"removePartData",value:function(){cornerstone.imageCache.cachedImages.map(function(e){e.image&&e.image.data&&(e.image.data={})})}},{key:"resizeCon",value:function(){this.element&&cornerstone.resize(this.element,!0)}},{key:"lungWindown",value:function(e,n,t){var o=cornerstone.getViewport(this.element);o.voi.windowWidth=n,o.voi.windowCenter=e,cornerstone.setViewport(this.element,o)}},{key:"ellipticalRoiFan",value:function(){this.disableAllTools(!0),cornerstoneTools.ellipticalRoi.activate(this.element,1)}},{key:"rectangleRoiFan",value:function(){this.disableAllTools(!0),cornerstoneTools.rectangleRoi.activate(this.element,1)}},{key:"magicStickSingleFan",value:function(){this.disableAllTools(!0)}},{key:"probeFan",value:function(){this.disableAllTools(!0),cornerstoneTools.probe.activate(this.element,1)}},{key:"setcolDefault",value:function(e,n){this.colwDefault=n,this.colcDefault=e}},{key:"restFan",value:function(){console.log("restFanrestFanrestFan"),cornerstone.resize(this.element,!0);var e=cornerstone.getViewport(this.element);e.voi.windowWidth=this.colwDefault,e.voi.windowCenter=this.colcDefault,cornerstone.setViewport(this.element,e)}},{key:"wlFan",value:function(){this.disableAllTools(!0),cornerstoneTools.wwwc.activate(this.element,1)}},{key:"panFan",value:function(){this.disableAllTools(!0),cornerstoneTools.pan.activate(this.element,1)}},{key:"lengthFan",value:function(){this.disableAllTools(!0),cornerstoneTools.length.activate(this.element,1)}},{key:"simpleAngleFan",value:function(){this.disableAllTools(!0),cornerstoneTools.simpleAngle.activate(this.element,1)}},{key:"polygonFan",value:function(){this.disableAllTools(!0),console.log(this.element),this.burshChoose=!1}},{key:"quickselectFan",value:function(){this.disableAllTools(!0),console.log(this.element),this.burshChoose=!1}},{key:"regionpaintFan",value:function(){this.disableAllTools(!0),console.log(this.element),this.burshChoose=!1}},{key:"freehandFan",value:function(){this.disableAllTools(!0),console.log(this.element),this.burshChoose=!1}},{key:"magnifyFan",value:function(){this.disableAllTools(!0),cornerstoneTools.magnify.activate(this.element,1)}},{key:"brushFan",value:function(){this.disableAllTools(!0);this.buildUrl(this.axialStack1.currentImageIdIndex)}},{key:"brushFanTe",value:function(){console.log("brushFanTebrushFanTebrushFanTebrushFanTe"),this.disableAllTools(!0);this.buildUrl(this.axialStack1.currentImageIdIndex);cornerstone.updateImage(this.element)}},{key:"burshImageLoad",value:function(e,n){var t=this;cornerstone.loadImage(e).then(function(e){cornerstoneTools.getToolState(t.element,"stack")&&(cornerstoneTools.getToolState(t.element,"stack").data[0].currentImageIdIndex=t.axialStack1.currentImageIdIndex),cornerstone.displayImage(n,e),setTimeout(function(){t.event._dispatch("Cornerstone_Class.LoadFinish",{el:t.element})},0)},function(e){alert(e)})}},{key:"clearSigleFan",value:function(e){cornerstoneTools.clearToolState(this.element,e),cornerstone.updateImage(this.element)}},{key:"clearSigleData",value:function(e,n,t){this.onlyClose=t,cornerstoneTools.removeToolState(this.element,e,n),cornerstone.updateImage(this.element)}},{key:"clearFan",value:function(){cornerstoneTools.clearToolState(this.element,"length"),cornerstoneTools.clearToolState(this.element,"simpleAngle"),cornerstoneTools.clearToolState(this.element,"ellipticalRoi"),cornerstoneTools.clearToolState(this.element,"rectangleRoi"),cornerstoneTools.clearToolState(this.element,"probe"),cornerstone.updateImage(this.element)}},{key:"cobbFan",value:function(){this.disableAllTools(!0),cornerstoneTools.length.activate(this.element,1)}},{key:"alignmentFan",value:function(){this.disableAllTools(!0)}},{key:"zoomFan",value:function(){this.disableAllTools(!0),cornerstoneTools.zoom.activate(this.element,1)}},{key:"setNode",value:function(e){this.nodeArray=e}},{key:"deleteOtherCanv",value:function(e){ES.selctorDoc("#"+e).remove()}},{key:"close",value:function(){cornerstoneTools.clearToolState(this.element,"brush"),cornerstoneTools.clearToolState(this.element,"length"),cornerstoneTools.clearToolState(this.element,"simpleAngle"),cornerstoneTools.clearToolState(this.element,"ellipticalRoi"),cornerstoneTools.clearToolState(this.element,"rectangleRoi"),cornerstone.disable(this.element)}}]),e}();e.exports=a},954:function(e,n,t){var o=t(1044);"string"==typeof o&&(o=[[e.i,o,""]]);var i={transform:void 0};t(705)(o,i);o.locals&&(e.exports=o.locals)},955:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}return o(e,[{key:"init",value:function(){this.info={},this.singelId=Tool.getSigleId(),this.brushInfo={}}},{key:"setInfo",value:function(e){if(this.info[e.layerNumber]||(this.info[e.layerNumber]=[]),e.show=!0,e.uuid){var n=!0;this.info[e.layerNumber].map(function(t){if(t.uuid==e.uuid||t.id==e.id){for(var o in t)e[o]?t[o]=e[o]:e[o]=t[o];n=!1}}),n&&this.info[e.layerNumber].push(e)}else e.uuid=this.singelId,this.info[e.layerNumber].push(e),this.singelId=Tool.getSigleId()}},{key:"restSignleIdShow",value:function(e){for(var n in this.info)for(var t in this.info[n])t!=e.bid&&t!=e.uuid||(this.info[n][t].show=e.show)}},{key:"getInfo",value:function(e){var n={};return this.info[e.layerNumber]&&this.info[e.layerNumber].map(function(t){t.uuid!=e.uuid&&t.id!=e.uuid||(n=t)}),n}},{key:"removeInfo",value:function(e){if(this.info[e.layerNumber]){for(var n=void 0,t=0;t<this.info[e.layerNumber].length;t++){var o=this.info[e.layerNumber][t];o.uuid!=e.id&&o.id!=e.id||(n=JSON.parse(JSON.stringify(this.info[e.layerNumber][t])),this.info[e.layerNumber].splice(t,1))}return n}}},{key:"getSigleLayer",value:function(e){return this.info[value.layerNum]?this.info[value.layerNum]:[]}},{key:"removeAll",value:function(){this.info={}}}]),e}();e.exports=new i},977:function(e,n,t){"use strict";var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(1057);var i=function(e){function n(e,o,i,a){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o,i,a));return r.html=t(1059),r.name="crossline",r}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.moduleBase),o(n,[{key:"complete",value:function(){var e=this,n=!1;this.dom.find(".yline").on("mousedown",function(t){var o=e.xyChange({x:t.pageX,y:t.pageY});e.nowpos=o,console.log(o,t.pageX,t.pageY),e.dom.find(".xline").css({transform:"translate(0px,"+o.y+"px)"}),e.dom.find(".yline").css({transform:"translate("+o.x+"px,0px)"}),n=!0}),this.dom.find(".xline").on("mousedown",function(t){var o=e.xyChange({x:t.pageX,y:t.pageY});e.nowpos=o,e.dom.find(".xline").css({transform:"translate(0px,"+o.y+"px)"}),e.dom.find(".yline").css({transform:"translate("+o.x+"px,0px)"}),n=!0}),this.dom.parent().on("mousemove",function(t){if(n){var o=e.xyChange({x:t.pageX,y:t.pageY});e.nowpos=o,e.dom.find(".xline").css({transform:"translate(0px,"+o.y+"px)"}),e.dom.find(".yline").css({transform:"translate("+o.x+"px,0px)"}),e.event._dispatch("crossline.move")}}),this.dom.parent().on("mouseup",function(t){n=!1,e.event._dispatch("crossline.mouseup")}),this.dom.find(".yline").on("mouseup",function(t){n=!1,e.event._dispatch("crossline.mouseup")}),this.dom.find(".xline").on("mouseup",function(t){n=!1,e.event._dispatch("crossline.mouseup")})}},{key:"setYHeight",value:function(e){this.dom.find(".yline").css({height:e})}},{key:"setXYLinePos",value:function(e){this.dom.find(".xline").css({transform:"translate(0px,"+e.y+"px)"}),this.dom.find(".yline").css({transform:"translate("+e.x+"px,0px)"})}},{key:"xyChange",value:function(e){var n=ES.selctorDoc(window).box().clientWidth-180-290,t=ES.selctorDoc(window).box().clientHeight-60-64;return{x:e.x-("z"==this.type?180:180+n/2),y:e.y-("x"!=this.type?124:124+t/2)}}},{key:"setPos",value:function(e,n){this.nowpos=e,this.dom.find(".xline").css({transform:"translate(0px,"+e.y+"px)"}),this.dom.find(".yline").css({transform:"translate("+e.x+"px,0px)"})}},{key:"returnXY",value:function(e){var n=e.dom[0].dom.style.transform;return{x:1*n.split(",")[0].split("(")[1].split("px")[0],y:1*n.split(",")[1].split(")")[0].split("px")[0]}}},{key:"close",value:function(){}},{key:"setPostion",value:function(){}}]),n}();e.exports=i}});