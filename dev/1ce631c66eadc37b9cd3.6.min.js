webpackJsonp([6],{

/***/ 176:
/***/ (function(module, exports, __webpack_require__) {

// style-loader: Adds some css to the DOM by adding a <style> tag

// load the styles
var content = __webpack_require__(910);
if(typeof content === 'string') content = [[module.i, content, '']];
// Prepare cssTransformation
var transform;

var options = {}
options.transform = transform
// add the styles to the DOM
var update = __webpack_require__(471)(content, options);
if(content.locals) module.exports = content.locals;
// Hot Module Replacement
if(false) {
	// When the styles change, update the <style> tags
	if(!content.locals) {
		module.hot.accept("!!../../node_modules/css-loader/index.js!../../node_modules/less-loader/dist/cjs.js!./createproone.less", function() {
			var newContent = require("!!../../node_modules/css-loader/index.js!../../node_modules/less-loader/dist/cjs.js!./createproone.less");
			if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];
			update(newContent);
		});
	}
	// When the module is disposed, remove the <style> tags
	module.hot.dispose(function() { update(); });
}

/***/ }),

/***/ 177:
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var urlDict = {
  querycomponent: '/component/query',
  getcomponentdetail: '/component/read',
  createproject: '/project/create',
  projectdetail: '/project/basic/read',
  getimage: '/series/search',
  gethospital: '/hospital/search',
  getmodality: '/series/modality/all',
  isrepeat: '/project/name/exist'
};
var api = {
  querycomponent: function querycomponent(value) {
    return this.HttpRequest.POST(urlDict.querycomponent, value);
  },
  getcomponentdetail: function getcomponentdetail(value) {
    return this.HttpRequest.POST(urlDict.getcomponentdetail, value);
  },
  createproject: function createproject(value) {
    return this.HttpRequest.POST(urlDict.createproject, value);
  },
  projectdetail: function projectdetail(value) {
    return this.HttpRequest.POST(urlDict.projectdetail, value);
  },
  getimage: function getimage(value) {
    return this.HttpRequest.POST(urlDict.getimage, value);
  },
  gethospital: function gethospital(value) {
    return this.HttpRequest.POST(urlDict.gethospital, value);
  },
  getmodality: function getmodality(value) {
    return this.HttpRequest.POST(urlDict.getmodality, value);
  },
  isrepeat: function isrepeat(value) {
    return this.HttpRequest.POST(urlDict.isrepeat, value);
  }
};
module.exports = api;

/***/ }),

/***/ 178:
/***/ (function(module, exports) {

module.exports = "<div class=createproone> <div class=bigtitle>创建项目</div> <p class=title>第一步：项目基本信息</p> <div class=\"inputLine w100\" redlabel=inputBox> <span class=w135><label class=redstar>*</label>项目名称：</span> <input type=text class=\"inputBox apidata proname\" check=empty api=name /> </div> <br> <div class=\"inputLine w100\" redlabel=inputBox> <span class=w135><label class=redstar>*</label>项目描述：</span> <textarea type=text class=\"inputBox apidata\" check=empty api=remark></textarea> </div> <div class=uploadarea id=uploadarea> <img src=/images/page/shangchuan.png> <p>可以上传图片、视频文件等规范外部医生标注</p> <input type=file class=dianjiupload id=uploader /> </div> <ul class=filelist> </ul> </div>";

/***/ }),

/***/ 179:
/***/ (function(module, exports, __webpack_require__) {

"use strict";


function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

//这边基本上引入需要使用的资源less，api，需要使用的模块等等。

var createproone = function (_Interstellar$modelBa) {
    _inherits(createproone, _Interstellar$modelBa);

    function createproone(app) {
        _classCallCheck(this, createproone);

        var _this = _possibleConstructorReturn(this, (createproone.__proto__ || Object.getPrototypeOf(createproone)).call(this, app));

        _this.apiData = { "name": "", "remark": "", "remarkFileUrl": "[]" };
        return _this;
    }

    return createproone;
}(Interstellar.modelBase);

module.exports = createproone;

/***/ }),

/***/ 74:
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step("next", value); }, function (err) { step("throw", err); }); } } return step("next"); }); }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var createproone = function (_Interstellar$pagesBa) {
  _inherits(createproone, _Interstellar$pagesBa);

  function createproone() {
    _classCallCheck(this, createproone);

    return _possibleConstructorReturn(this, (createproone.__proto__ || Object.getPrototypeOf(createproone)).apply(this, arguments));
  }

  _createClass(createproone, [{
    key: 'complete',
    value: function complete() {
      var _this3 = this;

      this.projectType = window.location.hash.indexOf('createproone') !== -1 ? 1 : 3;
      if (this.projectType == 1) {
        this.app.header.openControl('projectmanage');
      } else {
        this.app.header.openControl('backflowproject');
      }
      this.app.header.changeselected(1);
      this.type = this.app.parpam.type;
      this.projectId = this.app.parpam.projectid;
      this.styleModel(1);
      this.resize();
      this.upload();
      this.render();
      // 存储空间名称。既可以在这里配置，也可以在SDK中全局配置。
      // 例如 var bucketName = "example-name";
      var bucketName = "proximatest";

      // 存储空间域名URL地址。既可以在这里配置，也可以在SDK中全局配置。
      // 例如 var bucketUrl = "https://example-name.cn-bj.ufileos.com/";
      var bucketUrl = "https://proximatest.internal-cn-sh2-01.ufileos.com/";

      // 计算token的地址。既可以在这里配置，也可以在SDK中全局配置。
      // 例如 var tokenUrl = "token_server.php";
      var tokenUrl = "../../libs/token_server.php";

      // 实例化UCloudUFile
      //that.ufile =  new UCloudUFile(bucketName, bucketUrl, tokenUrl);
      //数据变化的时候处理
      if (this.type != 'new' && !this.projectId || !this.type) {
        this.app.changePage('projectmanage');
        return;
      }
      this.model._event._addEvent('apiData.change', function () {
        if (_this3.dom.find('.proname').val() || _this3.dom.find('textarea').val()) {
          _this3.app.session.set('ischanged', true);
        }
        if (JSON.stringify(_this3.model.getData('apiData')) == '{}') {
          _this3.app.session.del('data_1');
          return;
        }
        if (_this3.model.getData('apiData').name && _this3.model.getData('apiData').remark) {
          _this3.app.session.set('data_1', JSON.stringify(_this3.model.getData('apiData')));
        } else {
          _this3.app.session.del('data_1');
        }
      });
      this.eventAdd();
      this.initscroll();
    }
  }, {
    key: 'eventAdd',
    value: function eventAdd() {
      var _this4 = this;

      var that = this;
      this.dom.find('.uploadarea').on('click', function () {
        _this4.dom.find('.dianjiupload').click();
      });
      this.dom.find('.dianjiupload').on('change', function () {
        var thisurl = 'http://video-static.xdcdn.xiaodutv.com/browse_static/v3/common/widget/global/player/newPlayer_e2332cd1.swf';
        // that.uploadufile()
        var temp = _this4.model.getData('apiData');
        temp['remarkFileUrl'] = JSON.parse(temp['remarkFileUrl']);
        temp['remarkFileUrl'].push(thisurl);
        temp['remarkFileUrl'] = JSON.stringify(temp['remarkFileUrl']);
        //temp['remarkFileUrl'] = 'https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1539756479843&di=46adde08da81fbb964771f15c6be8ba3&imgtype=0&src=http%3A%2F%2Fimgsrc.baidu.com%2Fimage%2Fc0%253Dpixel_huitu%252C0%252C0%252C294%252C40%2Fsign%3D84b6266e084f78f0940692b310496f39%2Fa08b87d6277f9e2f7853a5321430e924b899f3a2.jpg'
        // temp['remarkFileUrl']='http://video-static.xdcdn.xiaodutv.com/browse_static/v3/common/widget/global/player/newPlayer_e2332cd1.swf'
        _this4.model.setData('apiData', temp);
      });
      this.dom.find('.apidata').on('change', function () {
        if (ES.selctorDoc(this).attr('api')) {
          var keyname = ES.selctorDoc(this).attr('api');
          var temp = that.model.getData('apiData');
          temp[keyname] = JSON.stringify(ES.selctorDoc(this).val().trim()).slice(1, -1);
          that.model.setData('apiData', temp);
        }
      });
      this.dom.find('.proname').on('blur', _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
        var json, res, temp;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                console.log('blurevent');

                if (!(that.type !== 'view')) {
                  _context.next = 14;
                  break;
                }

                ES.selctorDoc(this).removeClass('redborder');
                ES.selctorDoc(this).parent().find('.required1').remove();
                ES.selctorDoc(this).parent().find('.required').remove();

                if (!(ES.selctorDoc(this).val().trim() == that.proname)) {
                  _context.next = 7;
                  break;
                }

                return _context.abrupt('return');

              case 7:
                json = {
                  name: ES.selctorDoc(this).val().trim(),
                  type: that.projectType
                };

                that.app.loading.show();
                _context.next = 11;
                return that.api.isrepeat(json);

              case 11:
                res = _context.sent;

                that.app.loading.hide();
                if (res.code == 401) {
                  console.log('blurres');
                  temp = that.model.getData('apiData');

                  temp.name = '';
                  that.model.setData('apiData', temp);
                  that.app.session.set('data_1', JSON.stringify(temp));
                  that.dom.find('.proname').after('<span class="required1">项目名称已存在</span>');
                  that.dom.find('.proname').addClass('redborder');
                }

              case 14:
              case 'end':
                return _context.stop();
            }
          }
        }, _callee, this);
      })));
      this.app.header.event._addEvent('header.changePageError', function () {
        _this4.dom.find('.redlabel').removeClass('redborder');
        _this4.dom.find('.required').remove();
        _this4.dom.find('.inputLine').dom.forEach(function (val, idx) {
          if (Tool.checkForm(ES.selctorDoc(val).dom, 'red') !== '') {
            val.find('.' + val.attr('redlabel')).addClass('redborder');
            val.find('.' + val.attr('redlabel')).after('<span class="required">' + Tool.checkForm(ES.selctorDoc(val).dom, 'red') + '</span>');
          }
        });
      });
    }
  }, {
    key: 'render',
    value: function () {
      var _ref2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {
        var pagedata, json, res;
        return regeneratorRuntime.wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                pagedata = {};
                _context2.t0 = this.type;
                _context2.next = _context2.t0 === "new" ? 4 : 9;
                break;

              case 4:
                pagedata = this.app.session.get('data_1') ? JSON.parse(this.app.session.get('data_1')) : this.model.apiData; //{ "name": "", "remark": "" ,"remarkFileUrl":"[]"}
                this.model.setData('apiData', pagedata);
                this.dom.find('.apidata[api=name]').val(pagedata ? pagedata.name : "");
                this.dom.find('.apidata[api=remark]').val(pagedata ? JSON.parse('"' + pagedata.remark + '"') : "");
                return _context2.abrupt('break', 23);

              case 9:
                json = {
                  id: this.projectId
                };

                this.app.loading.show();
                _context2.next = 13;
                return this.api.projectdetail(json);

              case 13:
                res = _context2.sent;

                this.app.loading.hide();
                if (res.code == 0) {
                  pagedata = res.data;
                }
                pagedata = this.app.session.get('data_1') ? JSON.parse(this.app.session.get('data_1')) : pagedata;
                this.proname = pagedata.name;
                this.model.setData('apiData', pagedata);
                this.dom.find('.apidata[api=name]').val(pagedata.name);
                this.dom.find('.apidata[api=remark]').val(JSON.parse('"' + pagedata.remark + '"'));
                this.app.session.del('ischanged');
                return _context2.abrupt('break', 23);

              case 23:
                if (this.type == 'view') {
                  this.dom.find('.apidata').attr('readonly', 'readonly');
                }

              case 24:
              case 'end':
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function render() {
        return _ref2.apply(this, arguments);
      }

      return render;
    }()
  }, {
    key: 'upload',
    value: function upload() {
      //利用html5 FormData() API,创建一个接收文件的对象，因为可以多次拖拽，这里采用单例模式创建对象Dragfiles
      var Dragfiles = function () {
        var instance;
        return function () {
          if (!instance) {
            instance = new FormData();
          }
          return instance;
        };
      }();
      //为Dragfiles添加一个清空所有文件的方法
      FormData.prototype.deleteAll = function () {
        var _this = this;
        this.forEach(function (value, key) {
          _this.delete(key);
        });
      };
      //添加拖拽事件
      var dz = document.getElementById('uploadarea');
      dz.ondragover = function (ev) {
        //阻止浏览器默认打开文件的操作
        ev.preventDefault();
        //拖入文件后边框颜色变红
        this.style.borderColor = 'red';
      };
      dz.ondrop = function (ev) {
        //恢复边框颜色
        this.style.borderColor = 'gray';
        //阻止浏览器默认打开文件的操作
        ev.preventDefault();
        var files = ev.dataTransfer.files;
        var len = files.length,
            i = 0;
        var frag = document.createDocumentFragment(); //为了减少js修改dom树的频度，先创建一个fragment，然后在fragment里操作
        var tr, time, size;
        var newForm = Dragfiles(); //获取单例
        var it = newForm.entries(); //创建一个迭代器，测试用
        while (i < len) {
          tr = document.createElement('tr');
          //获取文件大小
          size = Math.round(files[i].size * 100 / 1024) / 100 + 'KB';
          //获取格式化的修改时间
          time = files[i].lastModifiedDate.toLocaleDateString() + ' ' + files[i].lastModifiedDate.toTimeString().split(' ')[0];
          tr.innerHTML = '<td>' + files[i].name + '</td><td>' + time + '</td><td>' + size + '</td><td>删除</td>';
          console.log(size + ' ' + time);
          var html = '<li class="file">\n' + '                        <i class="iconfont icon-qubiezhen"></i>\n' + '                        <span class="filename">' + files[i].name + '</span>\n' + '                        <span class="progress"></span>' + '                        <i class="iconfont icon-guanbi"></i>' + '                    </li>';
          console.log(ES.selctorDoc('.filelist').dom, 'dom');
          ES.selctorDoc('.filelist').append(html);
          this.resize();
          frag.appendChild(tr);
          //添加文件到newForm
          newForm.append(files[i].name, files[i]);
          //console.log(it.next());
          i++;
        }
        this.upload1(Dragfiles);
        //this.childNodes[1].childNodes[1].appendChild(frag);
        //为什么是‘1'？文档里几乎每一样东西都是一个节点，甚至连空格和换行符都会被解释成节点。而且都包含在childNodes属性所返回的数组中.不同于jade模板
      };
    }
  }, {
    key: 'upload1',
    value: function upload1(value) {
      var data = value(); //获取formData
      $.ajax({
        url: 'upload',
        type: 'POST',
        data: data,
        async: true,
        cache: false,
        contentType: false,
        processData: false,
        success: function success(data) {
          alert('succeed!'); //可以替换为自己的方法
          closeModal();
          data.deleteAll(); //清空formData
          $('.tbody').empty(); //清空列表
        },
        error: function error(returndata) {
          alert('failed!'); //可以替换为自己的方法
        }
      });
    }
  }, {
    key: 'uploadufile',
    value: function uploadufile() {
      var fileRename = this.dom.find(".dianjiupload").val();
      var file = document.getElementById("uploader").files[0];
      var data = {
        file: file,
        fileRename: fileRename
      };
      var successCallBack = function successCallBack(res) {
        alert('上传成功');
        var html = '<li class="file" linkurl="' + res + '">\n' + '                        <i class="iconfont icon-qubiezhen"></i>\n' + '                        <span class="filename">' + file.name + '</span>\n' + '                        <span class="progress"></span>' + '                        <i class="iconfont icon-guanbi"></i>' + '                    </li>';
        console.log(ES.selctorDoc('.filelist').dom, 'dom');
        ES.selctorDoc('.filelist').append(html);
        // $("#result").html("上传成功");
        // $("#result").append(JSON.stringify(res));
      };
      var progressCallBack = function progressCallBack(res) {
        var percentComplete = "上传进度：" + res * 100 + "%";
        console.log(percentComplete);
        //$("#result").html(percentComplete);
      };
      var errorCallBack = function errorCallBack(res) {
        // $("#result").html("errorCallBack: " + JSON.stringify(res));
        console.error("errorCallBack", res);
      };
      this.ufile.uploadFile(data, successCallBack, errorCallBack, progressCallBack);
    }
  }, {
    key: 'resize',
    value: function resize() {
      var ch = ES.selctorDoc(window).box().clientHeight - 100;
      var cw = ES.selctorDoc(window).box().clientWidth - 40;
      ES.selctorDoc('.createproone').css({ 'height': ch, 'width': cw });
      this.initscroll();
    }
  }, {
    key: 'initscroll',
    value: function initscroll() {
      if (this.myScroll) {
        this.myScroll.refresh();
        return;
      }
      var rid = 'aaa_' + Math.floor(new Date().getTime() * Math.random());
      ES.selctorDoc('.createproone').attr('id', rid);
      this.myScroll = new IScroll('#' + rid, {
        scrollbars: true,
        mouseWheel: true,
        interactiveScrollbars: true,
        hideScrollbar: false,
        vScrollbar: true,
        shrinkScrollbars: 'scale',
        fadeScrollbars: false,
        disableMouse: true,
        disablePointer: true
      });
    }
  }]);

  return createproone;
}(Interstellar.pagesBase);

module.exports = createproone;

/***/ }),

/***/ 910:
/***/ (function(module, exports, __webpack_require__) {

exports = module.exports = __webpack_require__(470)(false);
// imports


// module
exports.push([module.i, ".createproone {\n  margin: 20px;\n  background: #fff;\n  height: 100%;\n  font-size: 14px;\n  overflow: hidden;\n  border: 1px solid #fff;\n  position: relative;\n}\n.createproone .bigtitle {\n  padding: 20px;\n  font-size: 17px;\n}\n.createproone .title {\n  font-size: 16px;\n  height: 40px;\n  line-height: 40px;\n  padding-left: 66px;\n  margin-bottom: 20px;\n}\n.createproone > div {\n  height: 40px;\n  line-height: 40px;\n}\n.createproone .inputLine {\n  width: 80%;\n  position: relative;\n  margin: 10px 0;\n  display: inline-block;\n}\n.createproone .inputLine > span {\n  width: 100px;\n  text-align: right;\n}\n.createproone .inputLine input {\n  padding-left: 10px;\n  border-radius: 4px;\n  border: 1px solid #e8e8e8;\n  height: 40px;\n  line-height: 40px;\n}\n.createproone .inputLine textarea {\n  padding-left: 10px;\n  border-radius: 4px;\n  border: 1px solid #e8e8e8;\n  width: 80%;\n  height: 120px;\n  resize: none;\n}\n.createproone .w100 {\n  width: 100%;\n}\n.createproone .w100 input {\n  width: 80%;\n}\n.createproone .w100 span {\n  display: inline-block;\n  vertical-align: top;\n}\n.createproone .w135 {\n  width: 155px!important;\n  text-align: right;\n}\n.createproone .hangnei {\n  display: inline-block;\n}\n.createproone .uploadarea {\n  padding-left: 10px;\n  text-align: center;\n  height: 200px;\n  width: 80%;\n  border: 1px dashed #448e97;\n  margin: 20px 20px 20px 162px;\n  cursor: pointer;\n  border-radius: 5px;\n}\n.createproone .uploadarea img {\n  width: 95px;\n  height: 105px;\n  margin-top: 30px;\n  margin-bottom: 10px;\n}\n.createproone .uploadarea p:first-child {\n  margin-top: 105px;\n}\n.createproone .uploadarea .dianjiupload {\n  position: absolute;\n  top: 2000px;\n  left: 2000px;\n}\n.createproone .filelist {\n  width: 80%;\n  margin: 20px 0 50px 162px;\n}\n.createproone .filelist li {\n  width: 100%;\n  position: relative;\n  margin-bottom: 20px;\n  /* Standard syntax */\n}\n.createproone .filelist li i {\n  font-size: 24px;\n  color: #448e97;\n}\n.createproone .filelist li .filename {\n  vertical-align: top;\n}\n.createproone .filelist li .progress {\n  position: absolute;\n  top: 20px;\n  left: 27px;\n  height: 7px;\n  display: inline-block;\n  background: #448e97;\n  width: 90%;\n  border-radius: 8px;\n  -webkit-transition: width .8s ease;\n  -moz-transition: width .8s ease;\n  transition: width .8s ease;\n  -webkit-animation: progressbar 7s 1;\n  animation: progressbar 7s 1;\n}\n.createproone .filelist li .icon-guanbi {\n  position: absolute;\n  right: 10px;\n  font-size: 18px;\n  top: 7px;\n  cursor: pointer;\n}\n@-webkit-keyframes progressbar {\n  from {\n    width: 0;\n  }\n  to {\n    width: 90%;\n  }\n}\n@keyframes progress {\n  from {\n    width: 0;\n  }\n  to {\n    width: 90%;\n  }\n}\n.createproone .required1 {\n  width: unset!important;\n  color: red;\n  position: absolute;\n}\n", ""]);

// exports


/***/ })

});
//# sourceMappingURL=1ce631c66eadc37b9cd3.6.min.js.map