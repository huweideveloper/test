webpackJsonp([68],{2180:function(e,n,t){"use strict";var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();t(2181);var o=function(e){function n(e,i,o,r){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var s=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,i,o,r));return s.html=t(2183),s.name="permissionSet",s.roleScroll=null,s}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.modalBase),i(n,[{key:"complete",value:function(){var e=this;this.initView(),"EDIT"==this.api.type&&this.dom.find(".modal-title").html("修改权限"),this.dom.find(".roleList").on("click",function(n){var t=ES.selctorDoc(n.target);e.dom.find(".actionUl").remove(),-1===n.target.className.lastIndexOf("check-box")||-1!=n.target.className.lastIndexOf("allChoose")?-1!==n.target.className.lastIndexOf("allChoose")&&(t.hasClass("choose")?t.parent().parent().find(".check-box").removeClass("choose"):t.parent().parent().find(".check-box").addClass("choose")):t.hasClass("choose")?t.removeClass("choose"):(t.addClass("choose"),t.parent().parent().parent().find(".allChoose").addClass("choose"))}),this.setData()}},{key:"setData",value:function(e){var n=this,t="";this.api.data[0].forEach(function(e){var i='<div class="actionArea">';n.api.data[e.id]&&n.api.data[e.id].forEach(function(e,n){i+='<p class="actionItem" did="'+e.id+'" title="'+e.name+'"><i class="check-box"></i><span>'+e.name+"</span></p>"}),i+="</div>",t+='<li class="permissions" did="'+e.id+'"><p class="pageItem" title="'+e.name+'" did="'+e.id+'"><i class="check-box allChoose"></i><span class="perName">'+e.name+"</span></p> "+i+"</li>"}),this.dom.find(".roleScroll").append(t),this.initscroll(this.roleScroll,"roleList")}},{key:"initView",value:function(){var e=this,n=this;this.dom.find(".icon-guanbi").on("click",function(){n.close()}),this.dom.find(".btn-cancel").on("click",function(){n.close()}),this.dom.find(".inputBox").on("blur",function(){n.event._dispatch("roleModal.roleName",{name:ES.selctorDoc(this).val()})}),this.dom.find(".btn-confirm").on("click",function(){if(n.dom.find(".inputLine").dom.forEach(function(e,n){e.find("."+e.attr("redlabel")).removeClass("redborder"),e.find(".required").remove(),""!==Tool.checkForm(ES.selctorDoc(e).dom,"red")&&(e.find("."+e.attr("redlabel")).addClass("redborder"),e.find("."+e.attr("redlabel")).after('<span class="required">'+Tool.checkForm(ES.selctorDoc(e).dom,"red")+"</span>"))}),n.dom.find(".redborder").dom)return!1;var t={name:e.dom.find('.inputBox[api="name"]').val(),resourceIdList:[]};e.dom.find(".roleList .choose").dom&&e.dom.find(".roleList .choose").dom.forEach(function(e){t.resourceIdList.push(1*e.parent().attr("did"))}),n.event._dispatch("roleModal.submit",t)})}},{key:"renderData",value:function(e){var n=this;e.pageResourceList.forEach(function(e){n.dom.find('.roleList li p[did="'+e.id+'"] .check-box').addClass("choose")}),this.dom.find('.inputBox[api="name"]').val(e.name)}},{key:"showError",value:function(e){this.dom.find(".inputBox").after('<span class="required">'+e+"</span>"),this.dom.find(".inputBox").addClass("redborder")}},{key:"initscroll",value:function(e,n){if(this.roleScroll)this.roleScroll.refresh();else{var t="aaa_"+Math.floor((new Date).getTime()*Math.random());this.dom.find("."+n).attr("id",t),this.roleScroll=new IScroll("#"+t,{scrollbars:!0,mouseWheel:!0,scrollX:!0,interactiveScrollbars:!0,hideScrollbar:!1,vScrollbar:!0,shrinkScrollbars:"scale",fadeScrollbars:!1,disableMouse:!0,disablePointer:!0})}}}]),n}();e.exports=o},2181:function(e,n,t){var i=t(2182);"string"==typeof i&&(i=[[e.i,i,""]]);var o={transform:void 0};t(705)(i,o);i.locals&&(e.exports=i.locals)},2182:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,'.permissonSet {\n  margin-left: -425px;\n  margin-top: -220px;\n  width: 850px;\n  height: 440px;\n  font-size: 14px;\n}\n.permissonSet .modal-header {\n  height: 40px;\n  line-height: 40px;\n  padding: 0;\n  padding-left: 20px;\n  background: #F4F4F4;\n}\n.permissonSet .modal-header .modal-title {\n  font-family: MicrosoftYaHei;\n  font-weight: bold;\n  font-size: 18px;\n  color: #333333;\n  letter-spacing: 0;\n}\n.permissonSet .modal-header i {\n  font-size: 15px;\n  float: right;\n  margin-right: 20px;\n  cursor: pointer;\n}\n.permissonSet .modal-body {\n  padding: 0px !important;\n  margin: 0 20px;\n}\n.permissonSet .modal-body span {\n  margin-left: 0px;\n}\n.permissonSet .modal-body .top {\n  margin: 20px 0;\n}\n.permissonSet .modal-body .inputLine {\n  display: inline-block;\n  position: relative;\n}\n.permissonSet .modal-body .inputLine > div {\n  display: inline-block;\n}\n.permissonSet .modal-body .inputLine .confirm {\n  margin-right: 0;\n}\n.permissonSet .modal-body .inputLine .inputBox {\n  width: 178px;\n  height: 30px;\n  line-height: 30px;\n  border: 1px solid #E8E8E8;\n  border-radius: 4px;\n  outline: none;\n  padding-left: 10px;\n}\n.permissonSet .modal-body .inputLine .xlk {\n  width: 310px;\n  height: 38px;\n  line-height: 38px;\n}\n.permissonSet .modal-body .inputLine .xlk i {\n  color: #CCCCCC;\n}\n.permissonSet .modal-body .inputLine .names {\n  font-family: "MicrosoftYaHei";\n  font-size: 14px;\n  color: #333333;\n  letter-spacing: 0;\n  margin-right: 10px;\n}\n.permissonSet .modal-body .inputLine .w61 {\n  width: 61px;\n  margin-left: 45px;\n}\n.permissonSet .modal-body .inputLine .ml45 {\n  margin-left: 45px;\n}\n.permissonSet .modal-body .inputLine .type {\n  line-height: 18px;\n}\n.permissonSet .modal-body .inputLine .userType {\n  display: inline-block;\n  width: 240px;\n  text-align: left;\n}\n.permissonSet .modal-body .inputLine .userType span {\n  margin-left: 0px;\n  line-height: 18px;\n}\n.permissonSet .modal-body .inputLine .forget {\n  color: #448E97;\n}\n.permissonSet .modal-body .inputLine .errorMessage {\n  color: red;\n}\n.permissonSet .modal-body .inputLine:first-child {\n  margin-right: 35px;\n}\n.permissonSet .modal-body .userconfig {\n  padding: 20px 0;\n  height: 210px;\n  border-top: 1px dashed #E8E8E8;\n  border-bottom: 1px dashed #E8E8E8;\n  display: flex;\n}\n.permissonSet .modal-body .userconfig > p {\n  display: inline-block;\n}\n.permissonSet .modal-body .roleList {\n  flex: 1;\n  overflow: hidden;\n  align-content: end;\n  position: relative;\n  height: 210px;\n}\n.permissonSet .modal-body .roleList .roleScroll {\n  flex-wrap: wrap;\n}\n.permissonSet .modal-body .roleList .roleScroll > li {\n  line-height: 25px;\n  position: relative;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  display: flex;\n}\n.permissonSet .modal-body .roleList .roleScroll > li .check-box {\n  margin-right: 5px;\n  vertical-align: middle;\n}\n.permissonSet .modal-body .roleList .roleScroll > li span {\n  overflow: hidden;\n  vertical-align: bottom;\n  width: 73%;\n}\n.permissonSet .modal-body .roleList .roleScroll > li .pageItem {\n  margin-right: 20px;\n  width: 96px;\n  overflow: hidden;\n}\n.permissonSet .modal-body .roleList .roleScroll > li .actionArea {\n  display: flex;\n  flex-wrap: wrap;\n  flex: 1;\n}\n.permissonSet .modal-body .roleList .roleScroll > li .actionItem {\n  width: 25%;\n}\n.permissonSet .modal-body .roleList .actionUl {\n  position: absolute;\n  background: rgba(0, 0, 0, 0.6);\n  border-radius: 2px;\n  color: #FFFFFF;\n  padding: 8px;\n  z-index: 1000;\n}\n.permissonSet .modal-body .roleList .actionUl > li {\n  white-space: nowrap;\n}\n.permissonSet .modal-body .roleList .actionUl > li .perName {\n  width: 70%;\n  overflow: hidden;\n}\n.permissonSet .modal-footer {\n  margin: 26px 0 20px 0;\n  text-align: end;\n}\n.permissonSet .modal-footer .btn {\n  width: 70px;\n  height: 30px;\n  line-height: 30px;\n  margin-left: 20px;\n}\n.permissonSet .required {\n  position: relative;\n  margin-left: 100px !important;\n}\n',""])},2183:function(e,n){e.exports='<div class="modal permissonSet"> <div class=modal-header> <p class=modal-title>创建权限</p> <i class="iconfont icon-guanbi"></i> </div> <div class=modal-body> <div class=top> <div class=inputLine redlabel=inputBox> <span class=names data-i18n=gh data-name=姓名>权限名称</span> <input type=text class=inputBox check=empty api=name /> </div> </div> <div class=userconfig> <p class=title>权限配置：</p> <ul class=roleList> <div class=roleScroll></div> </ul> </div> </div> <div class=modal-footer> <a class="btn btn-cancel">取消</a> <a class="btn btn-confirm">确定</a> </div> </div> '},2184:function(e,n,t){(e.exports=t(704)(!1)).push([e.i,".permission {\n  min-height: 837px;\n  background: #fff;\n  display: flex;\n}\n.permission .leftArea {\n  position: relative;\n  width: 180px;\n  border-right: 1px solid #e8e8e8;\n}\n.permission .leftArea .roleName {\n  background: #ffffff;\n  border: 1px solid #e8e8e8;\n  border-radius: 4px;\n  width: 120px;\n  padding-left: 30px;\n  height: 30px;\n  margin: 10px 14px 20px 16px;\n}\n.permission .rightArea {\n  position: relative;\n  overflow: hidden;\n  flex: 1;\n}\n.permission .icon-sousuo {\n  font-size: 14px;\n  color: #e8e8e8;\n  position: absolute;\n  top: 18px;\n  left: 25px;\n}\n.permission .listArea {\n  flex: 1;\n  padding-top: 10px;\n  position: relative;\n}\n.permission .roleList {\n  margin-top: 20px;\n}\n.permission .roleList li {\n  display: flex;\n  line-height: 40px;\n  font-size: 14px;\n  color: #000000;\n}\n.permission .roleList li .roleName {\n  width: 30%;\n  margin-left: 20px;\n}\n.permission .roleList li .roleContent {\n  flex: 1;\n}\n.permission .roleList li .permission {\n  vertical-align: top;\n  width: 45%;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  overflow: hidden;\n}\n.permission .roleList li .soft {\n  color: #666666;\n}\n.permission .noData {\n  height: 150px;\n  line-height: 150px;\n  font-size: 20px;\n  text-align: center;\n  vertical-align: middle;\n  font-weight: bolder;\n}\n.permission .roleList li:nth-child(2n) {\n  background: #fafafa;\n}\n.permission .roleTitle {\n  font-family: MicrosoftYaHei-Bold;\n  font-size: 14px;\n  color: #000000;\n  letter-spacing: 0;\n  font-weight: bolder;\n}\n.permission .title {\n  height: 40px;\n  font-family: PingFangSC-Regular;\n  font-size: 16px;\n  color: #8b8989;\n  letter-spacing: 0;\n  line-height: 40px;\n  padding-left: 20px;\n}\n",""])},338:function(e,n,t){"use strict";var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();function o(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function i(o,r){try{var s=n[o](r),a=s.value}catch(e){return void t(e)}if(!s.done)return Promise.resolve(a).then(function(e){i("next",e)},function(e){i("throw",e)});e(a)}("next")})}}var r=function(e){function n(){return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.pagesBase),i(n,[{key:"complete",value:function(){var e=this,n=this;this.menutreeConfig={config:["id"],icon:"no",bottom:void 0,itemconfig:[]};var i=this.app.userResource[ES.selctorDoc('.menu .twolink[link="rolemanage"]').parent().attr("id")];i&&i.length>0&&i.forEach(function(n){switch(n.type){case"CREATE":e.menutreeConfig.bottom={name:"创建权限"};break;case"EDIT":e.menutreeConfig.itemconfig.push({name:"修改",code:n.type});break;case"DELETE":e.menutreeConfig.itemconfig.push({name:"删除",code:n.type})}}),this.roleModal=t(2180),this.apidata={},this.resource_all(),this.renderMenu(),this.dom.find(".roleName").on("keydown",function(e){13==e.keyCode&&n.permission_query(ES.selctorDoc(this).val())})}},{key:"renderMenu",value:function(){var e=this;t.e(84).then(function(){var n=t(1528);e.menutree=e.app.loadModule(n,e.dom.find(".groupArea"),e.menutreeConfig),e.permission_query(""),e.menutree.event._addEvent("navFirst.choosed",function(n){e.dom.find(".listArea .title").html(n.name),e.permission_read(n.id)}),e.menutree.event._addEvent("menutree.itemAction",function(n){switch(n.type){case"CREATE":case"EDIT":e.showModal(n);break;case"DELETE":e.app.alert.show({title:"",template:'<span style="font-size: 18px;font-weight: bold;">确认删除吗？</span>',sure:function(){var t=o(regeneratorRuntime.mark(function t(){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api.permission_delete({id:n.id});case 2:0==(i=t.sent).code?e.permission_query(""):e.errorshow(i.msg);case 4:case"end":return t.stop()}},t,e)}));return function(){return t.apply(this,arguments)}}(),close:!0})}})}.bind(null,t)).catch(t.oe)}},{key:"showModal",value:function(){var e=o(regeneratorRuntime.mark(function e(n){var t,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.role=this.app.loadModal(this.roleModal,{adv:!0},{type:n.type,data:this.allPermission}),t=null,"EDIT"!=n.type){e.next=7;break}return e.next=5,this.api.permission_read({id:n.id});case 5:0==(t=e.sent).code?this.role.renderData(t.data):Tool.errorshow(t.msg,this.app);case 7:this.role.event._addEvent("roleModal.submit",function(){var e=o(regeneratorRuntime.mark(function e(o){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("CREATE"!=n.type&&o.name===t.data.name){e.next=7;break}return e.next=3,i.api.name_volidate({name:o.name});case 3:if(401!=e.sent.code){e.next=7;break}return i.role.showError("名称已存在"),e.abrupt("return");case 7:if(r=null,"EDIT"!=n.type){e.next=15;break}return o.id=n.id,e.next=12,i.api.permission_update(o);case 12:r=e.sent,e.next=18;break;case 15:return e.next=17,i.api.permission_create(o);case 17:r=e.sent;case 18:0==r.code?(i.permission_query(),i.role.close()):i.errorshow(r.msg);case 19:case"end":return e.stop()}},e,i)}));return function(n){return e.apply(this,arguments)}}());case 8:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}()},{key:"permission_query",value:function(){var e=o(regeneratorRuntime.mark(function e(n){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.permission_query({name:n});case 2:t=e.sent,this.menutree.changeMenu(t.data.permissionPoList,"single"),this.dom.find(".treeArea .navFirst").eq(0).click();case 5:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}()},{key:"permission_read",value:function(){var e=o(regeneratorRuntime.mark(function e(n){var t,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.permission_read({id:n});case 2:t=e.sent,i="",this.dom.find(".roleList").html('<li class="roleTitle">\n                <p class="roleName">页面权限</p>\n                <p class="roleContent">权限内容</p>\n            </li>'),t.data.pageResourceList.length&&t.data.pageResourceList.length>0?(o={0:[]},t.data.pageResourceList.forEach(function(e){o[e.parentId]||(o[e.parentId]=[]),0==e.parentId?o[0].push(e):o[e.parentId].push(e)}),o[0].forEach(function(e){var n="";o[e.id]&&o[e.id].forEach(function(t,i){n+=t.name,i!==o[e.id].length-1&&(n+=",")}),i+='<li><p class="roleName">'+e.name+'</p><p class="roleContent">'+n+"</p></li>"}),this.dom.find(".roleList").append(i)):(i='<p class="noData">暂无内容</p>',this.dom.find(".roleList").html(i));case 6:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}()},{key:"resource_all",value:function(){var e=o(regeneratorRuntime.mark(function e(){var n,t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.api.resource_all({});case 2:n=e.sent,this.allPermission={},t={0:[]},n.data.pageResourceList.forEach(function(e){t[e.parentId]||(t[e.parentId]=[]),0==e.parentId?t[0].push(e):t[e.parentId].push(e)}),this.allPermission=t;case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"errorshow",value:function(e){this.app.alert.show({title:" ",msg:e,close:!1})}}]),n}();e.exports=r},903:function(e,n,t){var i=t(2184);"string"==typeof i&&(i=[[e.i,i,""]]);var o={transform:void 0};t(705)(i,o);i.locals&&(e.exports=i.locals)},904:function(e,n,t){"use strict";var i="/base/permission/query",o="/base/permission/name/volidate",r="/base/permission/read",s="/base/permission/create",a="/base/permission/update",l="/base/permission/delete",p="/base/resource/all",c={permission_query:function(e){return this.HttpRequest.POST(i,e)},name_volidate:function(e){return this.HttpRequest.POST(o,e)},permission_read:function(e){return this.HttpRequest.POST(r,e)},permission_create:function(e){return this.HttpRequest.POST(s,e)},permission_update:function(e){return this.HttpRequest.POST(a,e)},permission_delete:function(e){return this.HttpRequest.POST(l,e)},resource_all:function(e){return this.HttpRequest.POST(p,e)}};e.exports=c},905:function(e,n){e.exports='<div class=permission> <div class=leftArea> <input type=text class=roleName placeholder=搜索 /> <i class="iconfont icon-sousuo"></i> <div class=groupArea></div> </div> <div class=rightArea> <div class=listArea> <p class=title></p> <ul class=roleList> <li class=roleTitle> <p class=roleName>权限名称</p> <p class=roleContent>权限内容</p> </li> </ul> </div> </div> </div> '},906:function(e,n,t){"use strict";var i=function(e){function n(e){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.apiData={page:1,pageSize:10},t.condition=[],t.tableconfig={icon:{name:{name:'<span data-i18n="pname">权限名称</span>',type:"text",w:"25%",ww:"25%",n:"40"},mobilePhone:{name:'<span data-i18n="gh">权限内容</span>',type:"text",w:"75%",ww:"75%"}},onofftype:{0:"关",1:"开"},type:"center"},t.listicon={action:{config:{dis:"inline",link:"noLink",content:[{text:"查看",key:"view"},{text:"修改",key:"edit"}]}}},t}return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}(n,Interstellar.modelBase),n}();e.exports=i}});